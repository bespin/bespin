<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title>Bespin &raquo; Dashboard</title>
	<link type="text/css" rel="stylesheet" href="css/dashboard.css"/>

    <script type="text/javascript" src="js/external/prototype-1.6.0.3.js"></script>
    <script type="text/javascript" src="js/external/scriptaculous-1.8.2/effects.js"></script>
    <script type="text/javascript" src="js/util/path.js"></script>
    <script type="text/javascript" src="js/client/server.js"></script>

    <script type="text/javascript">
    var svr = new Server();
    var currentProject;
    var oldli;

    function toggleFiles(li) {
        if (oldli) {
            oldli.removeClassName("selected");
            oldli.addClassName("deselected");
        }
        
        var project = li.getAttribute("b_project");
        if (currentProject == project) {
            currentProject = null;
            hideFiles(li);
        } else {
            li.removeClassName("deselected");
            li.addClassName("selected");

            currentProject = project;

            var files = $('files');

            // check if files isn't already showing for some other project
            if (files.style.display == 'none') {
                showFiles(li);
            }

            files.innerHTML = "";
            svr.list(project, null, displayFiles);  // get projects
        }

        oldli = li;
    }
    
    function showFiles(li) {
        $('files').show();
        $('graphs').style.left = '361px';
        $('graphs').style.borderLeft = 'none';
    }
    
    function hideFiles(li) {
        $('files').hide();
        $('graphs').style.left = '181px';
        $('graphs').style.borderLeft = '1px solid black';
    }

	function loggedIn(xhr) {
	    svr.list(null, null, displayProjects);  // get projects
        svr.listOpen(displaySessions);   // get sessions
	}

	function notLoggedIn(xhr) {
	    location.href = "index.html"; // take me home Scottie!
	}

    function displayFiles(files) {
        if (files.length == 0) return;

        var filesNode = $('files');
        var ul = new Element("ul");
        filesNode.appendChild(ul);

        for (var i = 0; i < files.length; i++) {
            var fileNode = new Element("li");
            fileNode.appendChild(new Element("a", { 'href' : 'editor.html#project=' + currentProject + '&path=' + files[i] }).update(files[i]));
            ul.appendChild(fileNode);
        }
    }

    function displaySessions(sessions) {
        var sessionsNode = $("sessionslist");
        sessionsNode.innerHTML = "";

        for (var project in sessions) {
            var projectNode = new Element("li").update(project);
            sessionsNode.appendChild(projectNode);

            var projectContents = new Element("ul");
            projectNode.appendChild(projectContents);

            for (var file in sessions[project]) {
                var fileNode = new Element("li");
                projectContents.appendChild(fileNode);

                var link = new Element("a", { 'href' : 'editor.html#project=' + project + '&path=' + file }).update(file);
                fileNode.appendChild(link);
            }
        }
    }

    function displayProjects(projects) {
        var projectNode = $("projectlist");
        projectNode.innerHTML = ""; // remove children

        if (projects.length == 0) return;

        for (var i = 0; i < projects.length; i++) {
            var project = projects[i];
            if (project.charAt(project.length - 1) != '/') {
                continue;
            } else {
                project = project.substring(0, project.length - 1);
            }

            var li = new Element("li", { 'onClick' : 'toggleFiles(this)', 'class' : 'deselected', 'b_project' : project });
            li.innerHTML = "<img src='images/dash_icn_more.png'/> " + project;
            projectNode.appendChild(li);
        }
    }

	function setupUI() {

		// get logged in name; if not logged in, display an error of some kind
		svr.currentuser(loggedIn, notLoggedIn);

		// get the projects for the user

		// add the projects to the UI

		// get the list of open sessions

		// add the open sessions to the UI


	}
    </script>
</head>
<body onload="setupUI()">
    <div id="header">
        <img id="logo" src="images/logo.png" alt="Bespin" />
    </div>
    <div id="subheader">
        <div id="status">Dashboard</div>
    </div>
    <div id="content">
      <div id="projects">
        <div id="project_header">Projects</div>
        <ul id="projectlist">
        </ul>
        <div id="sessions_header">Open Sessions</div>
        <ul id="sessionslist">
        </ul>
      </div>

      <div id="team">
        <div id="team_header">Team Members</div>
        <img src="images/team_mock.png"/>
      </div>
      <div id="graphs">
      </div>
    </div>
    <div id="files" style="display: none;">
    </div>
    <div id="footer">
        <div id="prompt"><img src="images/icn_command.png" alt=">" /></div>
        <div id="commandlineParent"><input id="commandline" /></div>
    </div>



</body>
</html>