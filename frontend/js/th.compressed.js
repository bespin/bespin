(function(){var b=false;var c=/xyz/.test(function(){xyz})?/\b_super\b/:{test:function(){return true}};this.Class=function(){this.type="Class"};Class.define=function(q){if(!q.superclass){q.superclass=Class}var p=q.superclass.prototype,r=q.members||{};b=true;var j=new q.superclass();b=false;if(q.uses){var n=Trait.define({uses:q.uses,_klass_prototype:j,_klass_properties:r});for(var m in n._exports){if(!n._exports.hasOwnProperty(m)){continue}if(r.hasOwnProperty(m)){if(typeof r[m]!="function"){throw new Trait.TraitError(m+" overrides trait method and must be a function.")}}else{r[m]=n._exports[m]}}}for(var i in r){if(!r.hasOwnProperty(i)){continue}j[i]=typeof r[i]=="function"&&typeof p[i]=="function"&&c.test(r[i])?(function(o,s){return function(){var u=this._super;this._super=p[o];var t=s.apply(this,arguments);this._super=u;return t}})(i,r[i]):r[i]}var h=function(){if(!b&&this.init){this.init.apply(this,arguments)}};h.prototype=j;h.constructor=h;h.superclass=q.superclass;h.prototype.type=q.type;h.does=function(t){if(!n){if(h.superclass.does){return h.superclass.does(t)}if(t){return false}return[]}var s=n.does(t);if(h.superclass.does){if(t){return s||h.superclass.does(t)}var u=h.superclass.does(t).concat([]);for(var o=s.length-1;o>=0;o--){if(u.indexOf(s[o])===-1){u.push(s[o])}}return u}return s};if(!h.prototype.hasOwnProperty("does")){h.prototype.does=h.does}return h};function a(h){return Object.prototype.toString.apply(h)==="[object Array]"}function f(h){if(h){return a(h)?h:[h]}return[]}function d(h){if(!h){return{}}var j={};if(!a(h)){j[h]=true;return j}for(var m=h.length-1;m>=0;m--){j[h[m]]=true}return j}function g(m,j){for(var h in j){if(!j.hasOwnProperty(h)){continue}m[h]=j[h]}return m}this.Trait=Class.define({members:{init:function(p){this._subtraits=f(p.uses);this._requires=d(p.requires);this._exports=p.methods?p.methods:{};var m;for(m in this._requires){if(!this._requires.hasOwnProperty(m)){continue}if(this._exports.hasOwnProperty(m)){throw new Trait.TraitError("Trait cannot require and provide the same method "+m)}}var n,h,j,q={};for(j=this._subtraits.length-1;j>=0;j--){n=this._subtraits[j];h=g({},n._exports);if(n._aliases){g(h,n._aliases)}if(n._excludes){for(m in n._excludes){if(!n._excludes.hasOwnProperty(m)){continue}delete h[m];g(q,n._excludes)}}for(m in h){if(!h.hasOwnProperty(m)){continue}if(p._klass_prototype&&p._klass_properties.hasOwnProperty(m)&&typeof p._klass_properties[m]=="function"){continue}if(this._exports.hasOwnProperty(m)){if((!p.methods||!p.methods.hasOwnProperty(m))&&this._exports[m]!=h[m]){throw new Trait.TraitError("Multiple subtraits provide method "+m+" creating a conflict. Exclude all but one of the methods or override the method in the trait/class to resolve.")}continue}this._exports[m]=h[m]}for(m in n._requires){if(!n._requires.hasOwnProperty(m)){continue}if(!this._exports.hasOwnProperty(m)){this._requires[m]=true}}delete n._aliases;delete n._excludes}for(m in q){if(!q.hasOwnProperty(m)){continue}if(!this._exports.hasOwnProperty(m)&&(!p._klass_prototype||(typeof p._klass_prototype[m]!="function"&&typeof p._klass_properties[m]!="function"))){throw new Trait.TraitError("Excluded method "+m+" must be provided by another class or trait.")}}for(m in this._requires){if(!this._requires.hasOwnProperty(m)){continue}if(this._exports.hasOwnProperty(m)){delete this._requires[m]}else{if(p._klass_prototype&&(typeof p._klass_prototype[m]!="function"&&typeof p._klass_properties[m]!="function")){throw new Trait.TraitError("Trait requirement "+m+" not fullfilled by class.")}}}},aliases:function(i){this._aliases=this._aliases||{};for(var h in i){if(!i.hasOwnProperty(h)){continue}if(!this._exports.hasOwnProperty(i[h])){throw new Trait.TraitError("can't alias "+h+" to "+i[h]+" because trait doesn't have that method")}if(this._exports.hasOwnProperty(h)){throw new Trait.TraitError("can't create an alias with name "+h+" because trait natively exports that method")}if(this._requires.hasOwnProperty(h)){throw new Trait.TraitError("can't create an alias with name "+h+" because trait requires method with same name")}this._aliases[h]=this._exports[i[h]]}return this},excludes:function(h){this._excludes=this._excludes||{};h=f(h);for(var j=h.length-1;j>=0;j--){if(!this._exports.hasOwnProperty(h[j])){throw new Trait.TraitError("can't exclude method "+h[j]+" because no such method exists in trait")}this._excludes[h[j]]=true}return this},does:function(o){if(!this._does){this._does=[this].concat(this._subtraits);var n,m,h;for(n=this._subtraits.length-1;n>=0;n--){h=this._subtraits[n].does();for(m=h.length-1;m>=0;m--){if(this._does.indexOf(h[m])===-1){this._does.push(h[m])}}}}if(o){return this._does.indexOf(o)>=0}return this._does},requires:function(h){if(h){return this._requires.hasOwnProperty(h)&&this._requires[h]}return this._requires},subtraits:function(h){if(h){return this._subtraits.indexOf(h)>=0}return this._subtraits},methods:function(h){if(h){return this._exports.hasOwnProperty(h)&&this._exports[h]}return this._exports}}});Trait.define=function(h){return new Trait(h)};Trait.TraitError=Class.define({superclass:Error,members:{init:function(h){this.name="TraitError";this.message=h}}})})();if(!("console" in window)){window.console={log:function(a){}}}if(location.href.indexOf("file:")==0){try{if(netscape.security.PrivilegeManager.enablePrivilege){netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead")}}catch(ex){console.log("Couldn't elevate priviledges to deal with file URLs")}}if(typeof th=="undefined"){th={}}th.browser={IE:!!(window.attachEvent&&!window.opera),Opera:!!window.opera,WebKit:navigator.userAgent.indexOf("AppleWebKit/")>-1,Gecko:navigator.userAgent.indexOf("Gecko")>-1&&navigator.userAgent.indexOf("KHTML")==-1,MobileSafari:!!navigator.userAgent.match(/Apple.*Mobile.*Safari/)};th.isMac=function(){return navigator.appVersion.indexOf("Macintosh")>=0};th.fixCanvas=function(a){if(!a.fillText&&a.mozDrawText){a.fillText=function(d,b,f,c){a.translate(b,f);a.mozTextStyle=a.font;a.mozDrawText(d);a.translate(-b,-f)}}if(!a.measureText&&a.mozMeasureText){a.measureText=function(c){if(a.font){a.mozTextStyle=a.font}var b=a.mozMeasureText(c);return{width:b}}}if(a.measureText&&!a.html5MeasureText){a.html5MeasureText=a.measureText;a.measureText=function(c){var b=a.html5MeasureText(c);b.ascent=a.html5MeasureText("m").width;return b}}if(!a.fillText){a.fillText=function(){}}if(!a.measureText){a.measureText=function(){return 10}}return a};th.byId=function(a){return document.getElementById(a)};th.isString=function(a){return !!arguments.length&&a!=null&&(typeof a=="string"||a instanceof String)};th.isArray=function(a){return a&&(a instanceof Array||typeof a=="array")};th.forEach=function(b,g,d){if(!b||!b.length){return}var a=th._getParts(b,d,g);b=a[0];for(var f=0,c=b.length;f<c;++f){a[2].call(a[1],b[f],f,b)}};th._getParts=function(b,c,a){return[th.isString(b)?b.split(""):b,c||this,th.isString(a)?new Function("item","index","array",a):a]};th.xhrGet=function(a){var b=new XMLHttpRequest();b.onreadystatechange=function(){if(b.readyState==4){a.load.apply(a.context,[b.responseText])}};b.open("GET",a.url);b.send(null)};th.remove=function(d,b){var c=[];for(var a=0;a<d.length;a++){if(d[a]!=b){c.push(d[a])}}return c};th.observe=function(f,a,d,b){var g=(b)?function(h){d.apply(b,[h])}:d;var c=f["on"+a];if(typeof c=="function"){f["on"+a]=function(h){if(c){c(h)}g(h)}}else{f["on"+a]=g}};th.trim=String.prototype.trim?function(a){if(a==undefined){return a}return a.trim()}:function(a){if(a==undefined){return a}return a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")};th.mixin=function(d,c){if(!d){d={}}for(var b=1,a=arguments.length;b<a;b++){th._mixin(d,arguments[b])}return d};th._mixin_tobj={};th._mixin=function(d,b){for(var a in b){if(th._mixin_tobj[a]===undefined||th._mixin_tobj[a]!=b[a]){d[a]=b[a]}}if(th.browser.IE&&b){var c=b.toString;if(typeof c=="function"&&c!=d.toString&&c!=th._mixin_tobj.toString&&c!="\nfunction toString() {\n    [native code]\n}\n"){d.toString=b.toString}}return d};th.cumulativeOffset=function(b){var a=0,c=0;do{a+=b.offsetTop||0;c+=b.offsetLeft||0;b=b.offsetParent}while(b);return th._returnOffset(c,a)};th._returnOffset=function(b,c){var a=[b,c];a.left=b;a.top=c;return a};th.isPercentage=function(a){return(a.indexOf&&a.indexOf("%")!=-1)};th.isCssPixel=function(a){a=th.trim(a).toLowerCase();return(a.indexOf("px")==a.length-2)};th.isCssLength=function(a){if(a===undefined){return false}if(a==0){return true}return/^[\d\.]+(em|ex|px|\%|in|cm|mm|pt|pc)$/.test(a)};th.isCssBorderStyle=function(a){return/^(none|hidden|dotted|dashed|solid|double|groove|ridge|inset|outset)$/.test(a)};th.defaultCSSBorder=function(){return{top:{width:0,style:"none",color:"black"},bottom:{width:0,style:"none",color:"black"},left:{width:0,style:"none",color:"black"},right:{width:0,style:"none",color:"black"}}};th.defaultCSSMargin=function(){return{top:0,bottom:0,left:0,right:0}};th.defaultCSSPadding=function(){return{top:0,bottom:0,left:0,right:0}};th.getSpaceDelimitedItems=function(a){return th.parenAwareSplit(" ",a)};th.getCommaDelimitedItems=function(a){return th.parenAwareSplit(",",a)};th.lastArrayItem=function(a){return a[a.length-1]};th.removeArrayItem=function(a,b){return a.splice(a.indexOf(b),1)};th.stopEvent=function(a){a.preventDefault();a.stopPropagation()};th.getSceneById=function(b){for(var a=0;a<th.global_scene_array.length;a++){if(th.global_scene_array[a].id==b){return th.global_scene_array[a]}}};th.parenAwareSplit=function(h,c){if(h.length!=1){throw"Invalid delimiter passed to parenAwareSplit: '"+h+"'"}var f=[];var b=0;var g;var d="";for(var a=0;a<c.length;a++){g=c[a];if(g==h){if(!b){f.push(th.trim(d));d="";continue}}else{if(g=="("){b++}else{if(g==")"){b--}}}d+=g}f.push(th.trim(d));return f};th.whitespace=" \t\n\r";th.isWhitespace=function(b){if(!b||b.length==0){return true}for(var a=0;a<b.length;a++){var d=b.charAt(a);if(th.whitespace.indexOf(d)==-1){return false}}return true};th.leadingWhitespace=function(c){var b=[];for(var a=0;a<c.length;a++){if(c[a]==" "||c[a]=="\t"||c[a]==""||c[a]===undefined){b.push(c[a])}else{return b}}return b};th.measureUsingDOM=function(d,c){if(!document){throw"Can't perform measurements outside of browser"}var a=document.getElementsByTagName("body")[0];var b=document.createElement("div");b.setAttribute("style","position: absolute; visibility:hidden");a.appendChild(b);if(c){d.apply(c,[b])}else{d(b)}a.removeChild(b)};th.measure_cache={};th.safeget=function(b,a){return(b==undefined)?a:b};th.unitRegex=/^([\d\.]+)(em|ex|px|\%|in|cm|mm|pt|pc)$/;th.absoluteUnitRegex=/^([\d\.]+)(px|in|cm|mm|pt|pc)$/;th.isBorderLength=function(a){return(a=="thin"||a=="medium"||a=="thick")};th.convertLengthToPixels=function(b,a){if(b==0){return 0}if(th.isBorderLength(b)){return th.convertBorderLengthToPixels(b)}else{if(th.absoluteUnitRegex.test(b)){return th.convertAbsoluteUnitToPixels(b)}}};th.convertBorderLengthToPixels=function(b){if(b===undefined){return 0}var c=b;if(th.measure_cache[c]!==undefined){return th.measure_cache[c]}var a=undefined;th.measureUsingDOM(function(d){d.setAttribute("style","position: relative; border-left: "+b+" solid black");d.innerHTML="some text";a=d.scrollWidth-d.clientWidth});th.measure_cache[c]=a;return a};th.convertAbsoluteUnitToPixels=function(a,d){var c;if(d===undefined){var b=th.absoluteUnitRegex.exec(a);if(b.length!=3){throw"Passed length "+a+" isn't a CSS absolute unit"}c=b[2];d=Number(b[1])}else{c=a}if(c=="px"){return d}else{if(c=="in"||c=="cm"||c=="mm"||c=="pt"||c=="pc"){return th.measureAbsoluteUnit(d+c)}else{throw"Unsupported unit: "+c}}};th.measureAbsoluteUnit=function(b){if(b===undefined){return 0}var c=b;if(th.measure_cache[c]){return th.measure_cache[c]}var a=undefined;th.measureUsingDOM(function(f){var d=f.getAttribute("style");f.setAttribute("style",d+="; width: "+b);a=f.scrollWidth});th.measure_cache[c]=a;return a};th.convertEmToPixels=function(d,b){var c=d+b;if(th.measure_cache[c]){return th.measure_cache[c]}var a=undefined;th.measureUsingDOM(function(g){var f=g.getAttribute("style");g.setAttribute("style",f+="; font: "+d+"; width: "+b+"em");a=g.scrollWidth});th.measure_cache[c]=a;return a};th.getHierarchyString=function(b){var a="";while(b){var c=b.type;if(b.id){c+="#"+b.id}if(b.className){c+="."+b.className}a=c+=" "+a;b=b.parent}return th.trim(a)};th.isObject=function(a){return a!==undefined&&(a===null||typeof a=="object"||th.isArray(a)||th.isFunction(a))};th.isFunction=(function(){var a=function(b){return b&&(typeof b=="function"||b instanceof Function)};return a})();th.hitch=function(b,a){return function(){if(arguments.length==0){a.apply(b)}else{a.apply(b,arguments)}}};th.delay=function(b,a,c){if(c){b=th.hitch(c,b)}return setTimeout(b,a)};th.clone=function(f){var a;var g;if(typeof f=="number"||typeof f=="string"){return f}if(f instanceof Object){a={};for(var d in f){g=this.clone(f[d]);if(g!==undefined){a[d]=g}}return a}if(f instanceof Array){a=[];for(var b;b<f.length;b){g=this.clone(f[b]);if(g!==undefined){a[b]=g}}return a}};if(typeof th=="undefined"){th={}}th.CssParser=Class.define({members:{parse:function(b,a){if(!a){a={}}b=b.replace(/\s+/gi," ");th.forEach(this.munge(b,false).split("`b%"),function(c){c=c.split("%b`");if(c.length<2){return}c[0]=this.restore(c[0]);var d=a[c[0]]||{};a[c[0]]=th.mixin(d,this.parsedeclarations(c[1]))},this);return a},REbraces:/{[^{}]*}/,REfull:/\[[^\[\]]*\]|{[^{}]*}|\([^()]*\)|function(\s+\w+)?(\s*%b`\d+`b%){2}/,REatcomment:/\/\*@((?:[^\*]|\*[^\/])*)\*\//g,REcomment_string:/(?:\/\*(?:[^\*]|\*[^\/])*\*\/)|(\\.|"(?:[^\\\"]|\\.|\\\n)*"|'(?:[^\\\']|\\.|\\\n)*')/g,REmunged:/%\w`(\d+)`\w%/,uid:0,munged:{},munge:function(d,b){var a=this;d=d.replace(this.REatcomment,"$1").replace(this.REcomment_string,function(h,f){if(!f){return""}var g="%s`"+(++a.uid)+"`s%";a.munged[a.uid]=f.replace(/^\\/,"");return g});var c=b?this.REfull:this.REbraces;while(match=c.exec(d)){replacement="%b`"+(++this.uid)+"`b%";this.munged[this.uid]=match[0];d=d.replace(c,replacement)}return d},restore:function(a){if(a===undefined){return a}while(match=this.REmunged.exec(a)){a=a.replace(this.REmunged,this.munged[match[1]])}return th.trim(a)},parsedeclarations:function(b){var c=this.munged[b].replace(/(?:^\s*[{'"]\s*)|(?:\s*([^\\])[}'"]\s*$)/g,"$1");c=this.munge(c);var a={};th.forEach(c.split(";"),function(d){d=d.split(":");if(d.length<2){return}a[this.restore(d[0])]=this.restore(d[1])},this);return a}}});th.CssExpander=Class.define({members:{init:function(){this.expandRules={border:this.expandBorder,"border-top":this.expandBorderSide,"border-left":this.expandBorderSide,"border-right":this.expandBorderSide,"border-bottom":this.expandBorderSide,"border-width":this.expandBorderWidth,"border-image":this.expandBorderImage,margin:this.expandMarginOrPadding,padding:this.expandMarginOrPadding,overflow:this.expandOverflow}},expand:function(c,b,a){if(!a){a={}}if(this.expandRules[c]){this.expandRules[c].apply(this,[c,b,a])}else{a[c]=b}return a},saveProperty:function(c,b,a){if(th.getSpaceDelimitedItems(b).length!=1&&c!="font"&&c!="-th-grid-cols"&&c!="-th-grid-rows"){console.error("th.CssExpander: Can't expand '"+c+"' with value '"+b+"'!")}a[c]=b},expandBorderWidth:function(c,b,a){this.expandSideNumbers("border-","-width",b,a)},expandOverflow:function(c,b,a){this.saveProperty("overflow-x",b,a);this.saveProperty("overflow-y",b,a)},expandMarginOrPadding:function(c,b,a){this.expandSideNumbers(c+"-","",b,a)},expandSideNumbers:function(f,b,d,c){var a=d.split(" ");if(a.length==3){a=[a[0],a[1],a[2],a[1]]}if(a.length==2){a=[a[0],a[1],a[0],a[1]]}if(a.length==1){a=[a[0],a[0],a[0],a[0]]}if(a.length>=4){this.saveProperty(f+"top"+b,a[0],c);this.saveProperty(f+"right"+b,a[1],c);this.saveProperty(f+"bottom"+b,a[2],c);this.saveProperty(f+"left"+b,a[3],c)}},expandBorder:function(c,b,a){this.expandBorderSide("border-top",b,a);this.expandBorderSide("border-right",b,a);this.expandBorderSide("border-bottom",b,a);this.expandBorderSide("border-left",b,a)},expandBorderSide:function(f,d,c){var a=th.getSpaceDelimitedItems(d);for(var b=0;b<a.length;b++){if(th.isCssLength(a[b])){this.saveProperty(f+"-width",a[b],c)}else{if(th.isCssBorderStyle(a[b])){this.saveProperty(f+"-style",a[b],c)}else{this.saveProperty(f+"-color",a[b],c)}}}},expandBorderImage:function(g,f,d){var b=th.getSpaceDelimitedItems(f);var a=["url","top","right","bottom","left","repeat-x","repeat-y"];for(var c=0;c<a.length;c++){this.saveProperty("border-image-"+a[c],b[c],d)}}}});th._cssExpander=new th.CssExpander();th.expandCssProperty=function(c,b,a){return th._cssExpander.expand(c,b,a)};if(typeof th=="undefined"){th={}}th.EventHelpers=new Trait({methods:{wrapEvent:function(d,b){var a=d.pageX-th.cumulativeOffset(this.canvas).left;var f=d.pageY-th.cumulativeOffset(this.canvas).top;var c=b.getComponentForPosition(a,f,true);d.thComponent=c;this.addComponentXY(d,b,c)},addComponentXY:function(g,d,b){if(!b.bounds){console.log("No dest bounds - "+b.type);console.log(b.bounds);console.log(b);return}var a=g.pageX-th.cumulativeOffset(this.canvas).left;var i=g.pageY-th.cumulativeOffset(this.canvas).top;var f={x:a,y:i};var h=b;while(h){f.x-=h.bounds.x;f.y-=h.bounds.y;h=h.parent;if(h==d){g.componentX=f.x;g.componentY=f.y;return}}}}});th.StringHelpers=new Trait({methods:{isPercentage:function(a){return a.indexOf&&a.indexOf("%")!=-1}}});th.ComponentHelpers=new Trait({methods:{d:function(){var a=this.getInsets();return{b:(this.bounds)?{x:this.bounds.x,y:this.bounds.y,w:this.bounds.width,h:this.bounds.height,iw:this.bounds.width-a.left-a.right,ih:this.bounds.height-a.top-a.bottom}:{},i:{l:a.left,r:a.right,t:a.top,b:a.bottom,w:a.left+a.right,h:a.top+a.bottom}}},isVertical:function(){return(this.orientation==th.VERTICAL)},isHorizontal:function(){return(this.orientation==th.HORIZONTAL)},shouldPaint:function(){return(this.shouldLayout()&&this.cssValue("visibility")!="hidden")},shouldLayout:function(){return(this.cssValue("display")!="none")},emptyInsets:function(){return{left:0,right:0,bottom:0,top:0}},resolveCss:function(){var b=th.global_resources;var m;var f=th.getHierarchyString(this);if(b.resolvedCssCache[f]){m=b.resolvedCssCache[f]}else{m={};var d;var j=["userAgentCss","userCss","authorCss"];for(var c=0;c<j.length;c++){var h=j[c];th.forEach(b[h],function(t){for(var p in t){var y=p.split(",");for(var z=0;z<y.length;z++){var q=th.trim(y[z]);var o=this.getSpecificity(q);var w=q.split(":");var x=w[0];w=(w.length>1)?w.slice(1):["(default)"];if(this.matchesSelector(x)){var v=t[p];for(d in v){for(var r=0;r<w.length;r++){var u=w[r];if(m[u]===undefined){m[u]={}}var n={value:v[d],selector:q,specificity:o};if(m[u][d]){n=this.getSpecificityWinner(n,m[u][d])}m[u][d]=n}}}}}},this)}b.resolvedCssCache[f]=m;this.blowCssCaches()}this.styles={};for(var g in m){for(var a in m[g]){if(this.styles[g]===undefined){this.styles[g]={}}this.styles[g][a]=m[g][a].value}}this.refreshCss=false},matchesSelector:function(a){var f=a.toLowerCase();if(f=="*"){return true}if(f.indexOf(">")!=-1){var c=f.split(">");if(c.length!=2){console.log("unsupported child selector syntax; must be SEL1 > SEL2, was '"+a+"'");return false}if(this.matchesSelector(th.trim(c[1]))){if(!this.parent){return false}return(this.parent.matchesSelector(th.trim(c[0])))}return false}if(f.indexOf(" ")!=-1){var c=f.split(" ");if(c.length!=2){console.log("unsupported ancestor selector syntax; must be SEL1 SEL2, was '"+a+"'");return false}if(this.matchesSelector(th.trim(c[1]))){var b=this.parent;while(b){if(b.matchesSelector(th.trim(c[0]))){return true}b=b.parent}return false}}if(f.indexOf(".")==0){if(!this.className){return false}if(this.className.toLowerCase()==f.substring(1)){return true}}if(f.indexOf("#")==0){if(!this.id){return false}return("#"+this.id).toLowerCase()==f}var d=this.type.toLowerCase();if(d==f){return true}if(this.id&&(f==(d+"#"+this.id))){return true}if(this.className&&(f==(d+"."+this.className.toLowerCase()))){return true}return false},getSpecificity:function(a,f){var c={a:0,b:0,c:0,d:0};if(f){c.a=1}var d=th.getSpaceDelimitedItems(a);for(var b=0;b<d.length;b++){var h=d[b];if(h=="*"||h=="+"||h==">"){continue}if(h.indexOf("#")==0){c.b+=1;continue}c.c+=h.split(".").length-1;var g=h.split(":");if(g.length==2){if(g[1]=="first-line"||g[1]=="first-letter"||g[1]=="before"||g[1]=="after"){c.d+=1}else{c.c+=1}}}return c},getSpecificityWinner:function(d,c){var b=d.specificity;var a=c.specificity;if(b.a>a.a){return d}if(a.a>b.a){return c}if(b.b>a.b){return d}if(a.b>b.b){return c}if(b.c>a.c){return d}if(a.c>b.c){return c}if(b.d>a.d){return d}if(a.d>b.d){return c}return d},paintBackground:function(p,g,c,m,t){var u=this.d();if(g===undefined){g=th.convertBorderLengthToPixels(this.cssValue("border-left-width")||"0px")}if(c===undefined){c=th.convertBorderLengthToPixels(this.cssValue("border-top-width")||"0px")}if(m===undefined){m=u.b.w-g-th.convertBorderLengthToPixels(this.cssValue("border-right-width")||"0px")}if(t===undefined){t=u.b.h-c-th.convertBorderLengthToPixels(this.cssValue("border-bottom-width")||"0px")}if(this.cssValue("background-color")){p.fillStyle=this.cssValue("background-color");p.fillRect(g,c,m,t)}if(this.cssValue("background-image")){var A=this.cssValue("background-image");var f=this.cssValue("background-repeat");var z=this.cssValue("background-position");var n=th.getCommaDelimitedItems(A);var a=(f)?f.split(","):[undefined];var b=(z)?z.split(","):[undefined];var s=Math.max(n.length,a.length,b.length);for(var r=0;r<s;r++){var j=r;if(r>=n.length){j=(n.length%r)-1}var q=this.processImage(th.trim(n[j]),m,t);if(q){var o=r;if(r>=a.length){o=(a.length%r)-1}var v=r;if(r>=b.length){v=(b.length%r)-1}this.paintImage(p,q,th.trim(a[o]),th.trim(b[v]),g,c,m,t)}}}},getFirstBackgroundImage:function(){var a=this.cssValue("background-image");if(a){var b=th.getCommaDelimitedItems(a);if(b[0]){a=th.global_resources.images[b[0]];if(a){return a}}}},processImage:function(D,r,y){if(D.indexOf("-webkit-gradient")==0){var z=D.substring(D.indexOf("(")+1,D.length-1);var n=th.getCommaDelimitedItems(z);for(var x=0;x<n.length;x++){n[x]=th.trim(n[x])}if(n[0]!="linear"){console.log('Unsupported gradient: "'+D+'"; only linear gradients supported');return undefined}var m=n[1].split(" ");var j=n[2].split(" ");var u=[];var s=[];u[0]=(m[0]=="top"||m[0]=="bottom")?m[1]:m[0];u[1]=(m[0]=="top"||m[0]=="bottom")?m[0]:m[1];s[0]=(j[0]=="top"||j[0]=="bottom")?j[1]:j[0];s[1]=(j[0]=="top"||j[0]=="bottom")?j[0]:j[1];var q=[u,s];for(var C=0;C<q.length;C++){var d=q[C];for(var B=0;B<d.length;B++){if(d[B]=="top"){d[B]="0%"}if(d[B]=="bottom"){d[B]="100%"}if(d[B]=="left"){d[B]="0%"}if(d[B]=="right"){d[B]="100%"}if(th.isPercentage(d[B])){var p=parseInt(d[B])/100;d[B]=p*((B==0)?r:y)}}}var g=document.createElement("canvas");g.setAttribute("width",r);g.setAttribute("height",y);var v=g.getContext("2d");var f=v.createLinearGradient(u[0],u[1],s[0],s[1]);for(var A=3;A<n.length;A++){var t=n[A].split("(");if(t[1].indexOf(",")!=-1){var o=t[1].split(",");o[1]=th.trim(o[1].substring(0,o[1].length-1));f.addColorStop(o[0],o[1])}else{t[1]=t[1].substring(0,t[1].length-1);f.addColorStop((t[0].toLowerCase()=="from"?0:1),t[1])}}v.fillStyle=f;v.fillRect(0,0,r,y);return g}else{if(!th.global_resources.images[D]){console.log("Warning: image identified by '"+D+"'")}else{return th.global_resources.images[D]}}},paintImage:function(t,C,f,B,g,d,m,z){if(!f){f="repeat"}if(!B){B="0% 0%"}if(!g){g=0}if(!d){d=0}if(!m){m=this.bounds.width}if(!z){z=this.bounds.height}t.save();try{if((g!=0)||(d!=0)){t.translate(g,d)}t.beginPath();t.rect(0,0,m,z);t.clip();var c=B.toLowerCase().split(" ");if(c.length==1){c.push("50%")}if(c.length!=2){console.log('Unsupported position syntax; only "X" or "X Y" supported, you passed in " + position + "');return}var b=[];b[0]=(c[0]=="top"||c[0]=="bottom")?c[1]:c[0];b[1]=(c[0]=="top"||c[0]=="bottom")?c[0]:c[1];th.forEach(b,function(i,h){if(i=="top"){b[h]="0%"}if(i=="right"){b[h]="100%"}if(i=="bottom"){b[h]="100%"}if(i=="left"){b[h]="0%"}if(i=="center"){b[h]="50%"}});var j=[0,0];for(var v=0;v<b.length;v++){var n=th.isPercentage(b[v]);var s=this.convertPositionToPixel(b[v],(v==0)?m:z);if(n){j[v]=this.convertPositionToPixel(b[v],(v==0)?C.width:C.height)}b[v]=s}var r=b[0]-j[0];var q=b[1]-j[1];if(!this.shouldRepeat(f)){t.drawImage(C,b[0]-j[0],b[1]-j[1])}else{var a=(this.shouldRepeatX(f))?parseInt(m/C.width)+1:1;var u=(this.shouldRepeatY(f))?parseInt(z/C.height)+1:1;if(this.shouldRepeatX(f)){while(r>0){r-=C.width}}if(this.shouldRepeatY(f)){while(q>0){q-=C.height}}var p=r;for(var o=0;o<u;o++){r=p;for(var A=0;A<a;A++){t.drawImage(C,r,q);r+=C.width}q+=C.height}}}finally{t.restore()}},shouldRepeatX:function(a){return(a=="repeat"||a=="repeat-x")},shouldRepeatY:function(a){return(a=="repeat"||a=="repeat-y")},shouldRepeat:function(a){return(a!="no-repeat")},convertPositionToPixel:function(c,b){if(th.isPercentage(c)){var a=c.substring(0,c.length-1)/100;return b*a}else{if(th.isCssPixel(c)){return c.substring(0,c.length-2)}}},calculateInsets:function(i,b,a){var d=(this.component)?this.component:this;var h=i+b;if(d.insetCache){}var c={top:0,bottom:0,left:0,right:0};if(a){c.top+=a.top;c.left+=a.left;c.right+=a.right;c.bottom+=a.bottom}for(var f in c){var g=th.safeget(d.cssValue(i+f+b),0);if(g){g=th.convertLengthToPixels(g,d)}c[f]+=g}if(!d.insetCache){d.insetCache={}}d.insetCache[h]=c;return c},getCurrentPseudoClass:function(){if(this.pseudoClass){return this.pseudoClass}return"(default)"},cssValue:function(c,b){if(b===undefined){b=this.getCurrentPseudoClass()}if(this.localStyles[b]===undefined){this.localStyles[b]={}}if(this.localStyles[b][c]!==undefined){return this.localStyles[b][c]}if(typeof this.styles=="undefined"||this.refreshCss){this.resolveCss()}if(this.styles[b]===undefined){this.styles[b]={}}var a=this.styles[b][c];if(a&&a!="inherit"){return this.styles[b][c]}if(a=="inherit"&&this.parent){return this.parent.cssValue(c)}if(b!="(default)"){return this.cssValue(c,"(default)")}if(c=="border-top-color"||c=="border-left-color"||c=="border-right-color"||c=="border-bottom-color"){return this.cssValue("color")}if(c=="border"||c=="border-top"||c=="border-left"||c=="border-right"||c=="border-bottom"){throw"Unsupported: request the individual border properties, please"}if(c=="margin"){throw"Unsupported: request the individual margin-top, margin-bottom, margin-right, and margin-left properties, please"}if(c=="padding"){throw"Unsupported: request the individual padding-top, padding-bottom, padding-right, and padding-left properties, please"}if(["color","letter-spacing","line-height","text-align","text-indent","text-transform","visibility","white-space","word-spacing","font"].indexOf(c)!=-1){if(this.parent){return this.parent.cssValue(c)}}if(c.indexOf("list-style-")!=-1){if(this.parent){return this.parent.cssValue(c)}}return},addCss:function(b,d,a){if(th.isString(b)){var f=b;this.blowCssCaches(f);if(a===undefined){a="(default)"}if(this.localStyles[a]===undefined){this.localStyles[a]={}}th.expandCssProperty(f,d,this.localStyles[a])}else{for(var c in b){this.addCss(c,b[c],a)}}},getSize:function(){var a=this.bounds;return{width:a.width,height:a.height}},setBounds:function(a,d,b,c){this.bounds={x:a,y:d,width:b,height:c}},getPreferredSize:function(){if(this.getPreferredHeight&&this.getPreferredWidth){var a=this.getPreferredHeight();var c=this.getPreferredWidth();return{height:a,width:c}}var b=this.getInsets();return{height:b.top+b.bottom,width:b.left+b.right}},getMinimumSize:function(){if(this.getMinimumHeight&&this.getMinimumWidth){var a=this.getMinimumHeight();var b=this.getMinimumWidth();return{height:a,width:b}}return this.getPreferredSize()},getMaximumSize:function(){if(this.getMaximumHeight&&this.getMaximumWidth){var a=this.getMaximumHeight();var b=this.getMaximumWidth();return{height:a,width:b}}return this.getPreferredSize()},getScene:function(){if(this.scene){return this.scene}if(!this.parent){return}var a=this.parent;while(!a.scene&&a.parent){a=a.parent}return a.scene},blowCssCaches:function(a){if(this.component){console.log("WARNING: BLOW CACHE has a component reference")}if(a===undefined){delete this.insetCache;return}if(a.indexOf("border")!=-1||a.indexOf("margin")!=-1||a.indexOf("padding")!=-1){delete this.insetCache}},isInsideOf:function(a){var b=this.parent;while(b){if(b===a){return true}b=b.parent}return false}}});th.ContainerHelpers=new Trait({methods:{getComponentForPosition:function(a,d,c){for(var b=0;b<this.children.length;b++){if(!this.children[b].bounds){continue}if(this.children[b].bounds.x<=a&&this.children[b].bounds.y<=d&&(this.children[b].bounds.x+this.children[b].bounds.width)>=a&&(this.children[b].bounds.y+this.children[b].bounds.height)>=d){if(!c){return this.children[b]}if(!this.children[b].shouldPaint()){continue}return(this.children[b].getComponentForPosition)?this.children[b].getComponentForPosition(a-this.children[b].bounds.x,d-this.children[b].bounds.y,c):this.children[b]}}return this},removeAll:function(){this.remove(this.children)},getMinimumSize:function(){return(this.layoutManager)?this.layoutManager.getMinimumSize(this):this._super()},getPreferredSize:function(){return(this.layoutManager)?this.layoutManager.getPreferredSize(this):this._super()},getMaximumSize:function(){return(this.layoutManager)?this.layoutManager.getMaximumSize(this):this._super()}}});th.BorderHelpers=new Trait({methods:{inset:function(a,b){if(typeof b=="number"){a.x+=b;a.y+=b;a.w-=2*b;a.h-=2*b}else{if(th.isArray(b)&&b.length==4){a.x+=b[0];a.y+=b[1];a.w-=b[1]+b[3];a.h-=b[0]+b[2]}}},cornerX:function(a,b){switch(b){case 0:case 3:return a.x;case 1:case 2:return a.x+a.w}},cornerY:function(a,b){switch(b){case 0:case 1:return a.y;case 2:case 3:return a.y+a.h}},round:function(a){a.x=Math.round(a.x);a.y=Math.round(a.y);a.w=Math.round(a.w);a.h=Math.round(a.h)},emptyRect:function(a){return(a.w<=0)||(a.h<=0)},isZeroSize:function(a){return(a.w<=0)&&(a.h<=0)},next:function(b){var a=(b+1)%4;if(a<0){return a+4}return a},prev:function(b){var a=(b-1)%4;if(a<0){return a+4}return a},allCornersZeroSize:function(a){var b=this.isZeroSize;return b(a[0])&&b(a[1])&&b(a[2])&&b(a[3])},checkFourFloatsEqual:function(a,b){return(a[0]==b&&a[1]==b&&a[2]==b&&a[3]==b)},computeInnerRadii:function(n,j){var d=[];var i=n[this.TOP_LEFT];var f=n[this.TOP_RIGHT];var h=n[this.BOTTOM_RIGHT];var o=n[this.BOTTOM_LEFT];var m=j[0];var a=j[1];var g=j[2];var c=j[3];d[this.TOP_LEFT]={w:Math.max(0,i.w-c),h:Math.max(0,i.h-m)};d[this.TOP_RIGHT]={w:Math.max(0,f.w-a),h:Math.max(0,f.h-m)};d[this.BOTTOM_RIGHT]={w:Math.max(0,h.w-a),h:Math.max(0,h.h-g)};d[this.BOTTOM_LEFT]={w:Math.max(0,o.w-c),h:Math.max(0,o.h-g)};return d},traceRoundRect:function(a,c,d,b){if(b){a.moveTo(c.x,c.y+d[this.TOP_LEFT].h);a.quadraticCurveTo(c.x,c.y,c.x+d[this.TOP_LEFT].w,c.y);a.lineTo(c.x+c.w-d[this.TOP_RIGHT].w,c.y);a.quadraticCurveTo(c.x+c.w,c.y,c.x+c.w,c.y+d[this.TOP_RIGHT].h);a.lineTo(c.x+c.w,c.y+c.h-d[this.BOTTOM_RIGHT].h);a.quadraticCurveTo(c.x+c.w,c.y+c.h,c.x+c.w-d[this.BOTTOM_RIGHT].w,c.y+c.h);a.lineTo(c.x+d[this.BOTTOM_LEFT].w,c.y+c.h);a.quadraticCurveTo(c.x,c.y+c.h,c.x,c.y+c.h-d[this.BOTTOM_LEFT].h);a.lineTo(c.x,c.y+d[this.TOP_LEFT].h)}else{a.moveTo(c.x,c.y+d[this.TOP_LEFT].h);a.lineTo(c.x,c.y+c.h-d[this.BOTTOM_LEFT].h);a.quadraticCurveTo(c.x,c.y+c.h,c.x+d[this.BOTTOM_LEFT].w,c.y+c.h);a.lineTo(c.x+c.w-d[this.BOTTOM_RIGHT].w,c.y+c.h);a.quadraticCurveTo(c.x+c.w,c.y+c.h,c.x+c.w,c.y+c.h-d[this.BOTTOM_RIGHT].h);a.lineTo(c.x+c.w,c.y+d[this.TOP_RIGHT].h);a.quadraticCurveTo(c.x+c.w,c.y,c.x+c.w-d[this.TOP_RIGHT].w,c.y);a.lineTo(c.x+d[this.TOP_LEFT].w,c.y);a.quadraticCurveTo(c.x,c.y,c.x,c.y+d[this.TOP_LEFT].h)}}}});th.ColorHelpers=new Trait({methods:{colors:{aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},RGBtoHSL:function(n,m,c){var a=Math.max(n,m,c);var f=Math.min(n,m,c);var d=(a+f)/2;var j=0;var i=0;if(a!=f){if(d<0.5){i=(a-f)/(a+f)}else{i=(a-f)/(2-a-f)}if(n==a){j=(m-c)/(6*(a-f))}if(m==a){j=(2+(c-n)/(6*(a-f)))}if(c==a){j=(4+(n-m)/(6*(a-f)))}}if(j<0){j+=1}return[j,i,d]},getColorRGB:function(a){if(typeof a=="undefined"){return[0,0,0]}if(th.isArray(a)&&a.length==3){return[a[0],a[1],a[2]]}if(!th.isString(a)){throw"Error: th.Color.getColorRGB(): Function was passed a non string parameter"}if(a.charAt(0)=="#"){var d=parseInt(a.slice(1),16);return[d%256,(d>>8)%256,(d>>16)%256]}if(a.indexOf("rgb(")==0){var d=a.match(/\d+/g);for(var b=0;b<3;b++){d[b]=parseInt(d[b]);if(d[b]>255){d[b]=255}if(d[b]<0){d[b]=0}}return d}if(a.indexOf("rgb(a")==0){var d=a.match(/\d+/g);for(var b=0;b<3;b++){d[b]=parseInt(d[b]);if(d[b]>255){d[b]=255}if(d[b]<0){d[b]=0}}return d}if(typeof this.colors[a]=="undefined"){return[0,0,0]}return this.colors[a]},getSpecial3DColors:function(a,m,j){var h,d;var b,g;var n,c;b=this.getColorRGB(a);g=this.getColorRGB(m);n=(3691*b[0]+6283*b[1]+2026*b[2])/12000;c=(3691*g[0]+6283*g[1]+2026*g[2])/12000;if(c<51){h=30;d=50;if(n==0){b=[96,96,96]}}else{if(c>204){h=45;d=70;if(n==254){b=[192,192,192]}}else{h=30+(c/17);d=50+(c*20/255)}}if(j=="dark"){for(var f=0;f<3;f++){b[f]-=Math.floor(b[f]*h/100)}}else{if(j=="light"){for(var f=0;f<3;f++){b[f]+=Math.floor((255-b[f])*d/100)}}else{b=[0,0,0]}}return b},getColorString:function(a){return"rgb("+a[0]+","+a[1]+","+a[2]+")"}}});th.KeyHelpers=new Trait({methods:{key:{TAB:9,ENTER:13,ESCAPE:27,SPACE:32,DELETE:46,BACKSPACE:8,ARROW_LEFT:37,ARROW_UP:38,ARROW_RIGHT:39,ARROW_DOWN:40,A:65,map:[],isShiftDown:false,bind:function(a,g,f,c){if(c===undefined){c=this}var i=(a.toUpperCase().indexOf("CTRL")!=-1);var d=(a.toUpperCase().indexOf("ALT")!=-1);var h=(a.toUpperCase().indexOf("META")!=-1)||(a.toUpperCase().indexOf("APPLE")!=-1);var b=(a.toUpperCase().indexOf("SHIFT")!=-1);if(a.toUpperCase().indexOf("CMD")!=-1){if(th.isMac()){h=true}else{i=true}}this.map[[g,h,i,d,b]]=th.hitch(c,f)},onKeyDown:function(b){this.isShiftDown=b.shiftKey;var a=this.map[[b.keyCode,b.metaKey,b.ctrlKey,b.altKey,b.shiftKey]];if(th.isFunction(a)){a(b);th.stopEvent(b);return false}},onKeyUp:function(a){this.isShiftDown=false},setupEvents:function(a){a.bus.bind("keydown",a,this.onKeyDown,this);a.bus.bind("keyup",a,this.onKeyUp,this)},getPrintableChar:function(a){if(a.charCode>255){return false}if(a.charCode<32){return false}if((a.altKey||a.metaKey||a.ctrlKey)&&(a.charCode>96&&a.charCode<123)){return false}return String.fromCharCode(a.charCode)},}}});if(typeof th=="undefined"){th={}}th.VERTICAL="vertical";th.HORIZONTAL="horizontal";th.Resources=Class.define({members:{init:function(){this.loading=false;this.userAgentCss=[];this.authorCss=[];this.userCss=[];this.resolvedCssCache={};this.blockUntilImagesLoaded=true;this.images={};this.sheetCount=0;this.currentSheet=0;this.imageCount=0;this.currentImage=0;this.loaded=false;this.cssLoaded=false;this.imagesLoaded=false;this.callbacks=[]},load:function(b,a){if(this.loaded){return}this.baseUrl=b;this.stringStyles=a;this.loading=true;this.parseCSS()},processImage:function(){this.currentImage++;if(this.imageCount==this.currentImage){this.imagesLoaded=true;this.onLoaded()}},loadImages:function(f,d){var g,j,b;for(var m in f){var h=f[m];if((g=h.indexOf("url("))!=-1){j=h.indexOf(")",g);if(j==-1){console.log("Warning: malformed url found ('"+h+"')");break}var i=h.substring(g,j);var c=i+")";var a=i.substring(4);if(a.charAt(0)=="'"||a.charAt(0)=='"'){a=a.substring(1,a.length-1)}if(this.images[c]!==undefined){continue}this.imageCount++;b=new Image();if(this.blockUntilImagesLoaded){this.imagesLoaded=false;var n=this;b.onload=function(){n.processImage()};b.onerror=function(){n.processImage()}}if(d==undefined){d=""}b.src=d+a;this.images[c]=b}}},onLoaded:function(){if(this.cssLoaded&&((this.blockUntilImagesLoaded&&this.imagesLoaded)||!this.blockUntilImagesLoaded)){this.loaded=true;this.loading=false;if(this.callbacks){th.forEach(this.callbacks,function(a){if(a.context){a.callback.apply(a.context)}else{a.callback()}})}}},registerOnLoadCallback:function(b,a){this.callbacks.push({callback:b,context:a})},parseCSS:function(){var c=[];var g=false;if(typeof this.baseUrl!=="undefined"){c.push({url:this.baseUrl+"css/default.css",resourceBase:this.baseUrl,array:this.userAgentCss,index:0})}else{if(th.DEFAULT_CSS){this.processCSS(th.DEFAULT_CSS,undefined,this.userAgentCss,0);g=true}}var f,b=document.getElementsByTagName("link");var a=0;for(var d=0;d<b.length;d++){f=b[d];if(f.rel.toLowerCase().indexOf("thstylesheet")>=0&&f.href){c.push({url:f.href,resourceBase:undefined,array:this.authorCss,index:a++})}}if(this.stringStyles){this.processCSS(this.stringStyles,this.authorCss,a++)}if(c.length==0){this.cssLoaded=true;return this.onLoaded()}this.sheetCount=c.length;if(g){this.sheetCount++}if(this.stringStyles){this.sheetCount++}th.forEach(c,function(h){th.xhrGet({url:h.url,load:function(i){this.processCSS(i,h.resourceBase,h.array,h.index)},context:this})},this)},processCSS:function(b,g,h,a){h[a]=new th.CssParser().parse(b);for(var f in h[a]){var d={};for(var c in h[a][f]){th.expandCssProperty(c,h[a][f][c],d)}h[a][f]=d;this.loadImages(d,g)}if(++this.currentSheet==this.sheetCount){this.cssLoaded=true;this.onLoaded()}}}});th.Timer=Class.define({members:{init:function(){this.timer={}},start:function(c,d,b,f){var a=new Date();if(this.timer[c]&&this.timer[c].end>a){clearTimeout(this.timer[c].obj)}this.timer[c]={obj:th.delay(d,b,f),end:(a+b)}},stop:function(a){if(!this.timer[a]){return}if(this.timer[a].end>new Date()){clearTimeout(this.timer[a].obj)}delete this.timer[a]}}});th.Bus=Class.define({members:{init:function(){this.events={}},bind:function(f,b,a,g){var d=this.events[f];if(!d){d=[];this.events[f]=d}b=th.isArray(b)?b:[b];for(var h=0;h<b.length;h++){for(var c=0;c<d.length;c++){if(d[c].selector==b[h]&&d[c].listenerFn==a){return}}d.push({selector:b[h],listenerFn:a,context:g})}},unbind:function(a){for(var d in this.events){var c=this.events[d];for(var b=0;b<c.length;b++){if(c[b].selector===a){this.events[d]=th.remove(c,c[b]);c=this.events[d];b--}}}},fire:function(a,f,b){var d=this.events[a];if(!d||d.length==0){return}for(var c=0;c<d.length;c++){if(d[c].selector.constructor==String){if(d[c].selector.charAt(0)=="#"){if(b.id==d[c].selector.substring(1)){this.dispatchEvent(a,f,b,d[c])}}else{if(d[c].selector==b.declaredClass){this.dispatchEvent(a,f,b,d[c])}}}else{if(d[c].selector==b){this.dispatchEvent(a,f,b,d[c])}}}},dispatchEvent:function(a,c,b,d){c.thComponent=b;if(d.context){d.listenerFn.apply(d.context,[c])}else{d.listenerFn(c)}}}});th.FocusManager=Class.define({members:{bus:null,KEY_TAB:9,C:67,V:86,X:88,init:function(a,d,f){this.bus=a;this.subscribers=[];this.focused=undefined;this.focusedIndex=-1;this.domInputFirst=d;this.domInputLast=f;this.domHasFocus=undefined;this.ignoreDomEvent=false;this.domInputFirst.value="<norealtext>";this.domInputLast.value="<norealtext>";var b=[this.domInputFirst,this.domInputLast];for(var c=0;c<2;c++){th.observe(b[c],"focus",this.enterFirst,this);th.observe(b[c],"blur",this.domFocusLost,this);th.observe(b[c],"keydown",this.handleKeyDown,this);th.observe(b[c],"keypress",this.handleKeyPress,this);th.observe(b[c],"keyup",this.handleKeyUp,this)}if(th.browser.WebKit){th.observe(document,"cut",this.handleCut,this);th.observe(document,"copy",this.handleCopy,this);th.observe(document,"paste",this.handlePaste,this)}},relateTo:function(b){this.relateTo=b.canvas;var a=th.cumulativeOffset(this.relateTo).left+10;var c=th.cumulativeOffset(this.relateTo).top+10;this.domInputFirst.style.position="absolute";this.domInputLast.style.position="absolute";this.domInputFirst.style.width="10px";this.domInputLast.style.width="10px";this.domInputFirst.style["z-index"]="-100";this.domInputLast.style["z-index"]="-100";if(this.relateTo.style.display=="none"){this.toggleInputs({isVisible:false})}this.moveInputs({x:a,y:c});this.bus.bind("move",b,this.moveInputs,this);this.bus.bind("toggle",b,this.toggleInputs,this)},toggleInputs:function(b){var a=b.isVisible?"block":"none";this.domInputFirst.style.display=a;this.domInputLast.style.display=a},moveInputs:function(a){this.domInputFirst.style.top=(a.y+50)+"px";this.domInputLast.style.top=(a.y+50)+"px";this.domInputFirst.style.left=(a.x+50)+"px";this.domInputLast.style.left=(a.x+65)+"px"},performCopy:function(a,b){if(a.clipboardData!==undefined){a.clipboardData.setData("text/plain",b);th.stopEvent(a)}else{this.domHasFocus.value=b;this.domHasFocus.select()}},handleCopy:function(b){if(this.focused===undefined){return}if(th.isFunction(this.focused.performCopy)){var a=this.focused.performCopy();if(!a){th.stopEvent(b);return}else{this.performCopy(b,a)}}},handlePaste:function(a){if(this.focused===undefined){return}if(th.isFunction(this.focused.performPaste)){if(a.clipboardData!==undefined){this.focused.performPaste(a.clipboardData.getData("text/plain"));th.stopEvent(a)}else{this.domHasFocus.value="";th.delay(function(){this.focused.performPaste(this.domHasFocus.value)},0,this)}}},handleCut:function(b){if(this.focused===undefined){return}if(th.isFunction(this.focused.performCut)){var a=this.focused.performCut();if(!a){th.stopEvent(b);return}else{this.performCopy(b,a)}}},enterFirst:function(a){this.domHasFocus=this.domInputFirst;this.domInputFirst.select();if(this.ignoreDomEvent){return}if(this.subscribers.length==-1){return}this.focus(this.subscribers[0]);this.ignoreDomScroll=true},enterLast:function(a){this.domHasFocus=this.domInputLast;this.domInputLast.select();if(this.ignoreDomEvent){return}if(this.subscribers.length==-1){return}this.focus(th.lastArrayItem(this.subscribers));this.ignoreDomScroll=true},domFocusLost:function(a){if(this.ignoreDomEvent){return}if(this.focused!==undefined){if(th.isFunction(this.focused.allowLoseFocus)){if(!this.focused.allowLoseFocus(a)){this.focus(this.focused);return}}}this.focusedLostFocus();delete this.focused;delete this.domHasFocus;this.focusedIndex=-1},removeFocus:function(){this.focusedLostFocus();delete this.focused;delete this.domHasFocus;this.focusedIndex=-1},focusedLostFocus:function(){if(!this.focused){return}this.bus.fire("focus:lost",e,this.focused);delete this.focused.pseudoClass;this.focused.repaint()},handleKeyDown:function(b){if(this.focused===undefined){return}if(b.keyCode==this.KEY_TAB&&this.subscribers.length!=0){var a=false;if(b.shiftKey==false){if(this.focused.focusNext===undefined){this.focusedIndex++;if(this.focusedIndex>=this.subscribers.length){a=true}else{this.focus(this.subscribers[this.focusedIndex])}}else{this.focus(this.focused.focusNext)}}else{if(this.focused.focusPrev===undefined){this.focusedIndex--;if(this.focusedIndex<=-1){a=true}else{this.focus(this.subscribers[this.focusedIndex])}}else{this.focus(this.focused.focusPrev)}}if(!a){th.stopEvent(b)}else{delete this.domHasFocus}return}if(!th.browser.WebKit&&(b.ctrlKey||b.metaKey)){if(b.keyCode==this.C){this.handleCopy(b);return}else{if(b.keyCode==this.X){this.handleCut(b);return}else{if(b.keyCode==this.V){this.handlePaste(b);return}}}}b.focusManager=this;this.bus.fire("keydown",b,this.focused)},handleKeyPress:function(a){if(this.focused===undefined){return}a.focusManager=this;this.bus.fire("keypress",a,this.focused)},handleKeyUp:function(a){if(this.focused===undefined){return}a.focusManager=this;this.bus.fire("keyup",a,this.focused)},focus:function(b){var a=this.subscribers.indexOf(b);if(a==-1){console.error("FocusManager:focus: no such subscribed component!");return}e={};e.newFocused=b;e.focusManager=this;if(this.focused!==undefined&&b!==this.focused){if(th.isFunction(this.focused.allowLoseFocus)){if(!this.focused.allowLoseFocus(e)){this.focusedIndex=this.subscribers.indexOf(this.focused);return false}}}if(this.focused!==undefined){this.focusedLostFocus()}this.focusedIndex=a;this.focused=b;this.bus.fire("focus:received",e,this.focused);this.focused.pseudoClass="active";this.focused.repaint();if(this.focusedIndex==this.subscribers.length-1){this.ignoreDomEvent=true;this.domInputLast.focus();this.ignoreDomEvent=false}else{if(this.focusedIndex==0||this.domHasFocus===undefined){this.ignoreDomEvent=true;this.domInputFirst.focus();this.ignoreDomEvent=false}}return true},subscribe:function(a){if(!this.hasSubscriber(a)){this.subscribers.push(a);a.focusManager=this}},hasSubscriber:function(a){return(this.subscribers.indexOf(a)!=-1)},unsubscribe:function(b){var a=this.subscribers.indexOf(components);if(a==-1){console.error("FocusManager:unsubscribe: no such subscribed component!");return}this.subscribers.splice(a,1);if(a==this.focused){this.bus.fire("focus:lost",{},b);delete b.focusManager;this.focused=-1}},hasFocus:function(a){return(this.subscribers.indexOf(a)==this.focused)}}});th.global_event_bus=new th.Bus();th.global_resources=new th.Resources();th.global_scene_array=new Array();th.global_timer=new th.Timer();th.Scene=Class.define({uses:[th.EventHelpers],members:{bus:th.global_event_bus,init:function(a,f){if(th.isString(a)){a=document.getElementById("canvasOrId")}this.canvas=a;this.id=this.canvas.id;var d=f;var b="";if(f&&!th.isString(f)){d=f.baseUrl;b=f.stringStyles}this.smartRedraw=false;this.resources=th.global_resources;this.resourceCallbackRegistered=false;if(!this.resources.loaded&&!this.resources.loading){this.resources.load(d,b)}th.observe(window,"resize",function(){this.render()},this);this.root=new th.Panel({id:this.id});this.root.scene=this;this.testCanvas=document.createElement("canvas");this.scratchContext=this.testCanvas.getContext("2d");th.fixCanvas(this.scratchContext);this.parseTags();th.global_scene_array.push(this);th.observe(this.canvas,"mousedown",function(g){this.wrapEvent(g,this.root);this.mouseDownComponent=g.thComponent;th.global_event_bus.fire("mousedown",g,g.thComponent)},this);th.observe(window,"mouseup",function(g){if(!this.mouseDownComponent){return}this.wrapEvent(g,this.root);g.isOverMe=(g.thComponent===this.mouseDownComponent);th.global_event_bus.fire("mouseup",g,this.mouseDownComponent);delete this.mouseDownComponent},this);th.observe(this.canvas,"dblclick",function(g){this.wrapEvent(g,this.root);th.global_event_bus.fire("dblclick",g,g.thComponent)},this);th.observe(this.canvas,"click",function(g){this.wrapEvent(g,this.root);th.global_event_bus.fire("click",g,g.thComponent)},this);th.observe(window,"mousemove",function(g){this.wrapEvent(g,this.root);if(this.mouseDownComponent){this.addComponentXY(g,this.root,this.mouseDownComponent);th.global_event_bus.fire("mousedrag",g,this.mouseDownComponent)}},this);th.observe(this.canvas,"mousemove",function(g){this.wrapEvent(g,this.root);th.global_event_bus.fire("mousemove",g,g.thComponent);if(g.thComponent!==this.mouseOverComponent){if(this.mouseOverComponent!==undefined){th.global_event_bus.fire("mouseout",{},this.mouseOverComponent)}this.mouseOverComponent=g.thComponent;th.global_event_bus.fire("mouseover",{},this.mouseOverComponent)}},this);th.observe(this.canvas,"mouseout",function(g){if(this.mouseOverComponent){th.global_event_bus.fire("mouseout",{},this.mouseOverComponent);delete this.mouseOverComponent}},this);var c=th.hitch(this,function(i){this.wrapEvent(i,this.root);var g=i.thComponent;var h=g.parent;while(h){if(h.type=="ScrollPane"){i.delta=0;if(i.wheelDelta){i.delta=i.wheelDelta/500;if(window.opera){i.delta=-i.delta}}else{if(i.detail){i.delta=-i.detail/15}}if(i.delta&&th.isFunction(h.performScroll)){h.performScroll(i)}break}h=h.parent}});if(th.browser.Gecko){window.addEventListener("DOMMouseScroll",c,false)}else{th.observe(this.canvas,"mousewheel",c)}},_byId:function(d,c){for(var b=0;b<c.length;b++){if(c[b].id==d){return c[b]}if(c[b].children){var a=this._byId(d,c[b].children);if(a!==undefined){return a}}}},byId:function(a){return this._byId(a,this.root.children)},render:function(a){if(!this.resources.loaded){if(!this.resourceCallbackRegistered){this.resources.registerOnLoadCallback(this.render,this);if(a){this.resources.registerOnLoadCallback(function(){a(this)},this)}this.resourceCallbackRegistered=true}return}this.layout();this.paint();this.paintSelf();if(a){a(this)}},blockUntilRender:function(){if(!this.resources.loaded){}},parseTags:function(){this.parseCanvasAttributes("grid");this.parseCanvasAttributes("flowLayout");var a=this.canvas.childNodes;this.attachChildElementsToParent(a,this.root)},parseCanvasAttributes:function(){th.forEach(arguments,function(a){if(this.canvas.hasAttribute(a)){this.root[a]=this.canvas.getAttribute(a)}},this)},attachChildElementsToParent:function(a,b){th.forEach(a,function(d){if(d.nodeType==Node.ELEMENT_NODE){var c=this.createComponentFromElement(d,b);if(c){b.add(c);this.attachChildElementsToParent(d.childNodes,c)}else{console.log("Couldn't create component from element \""+d.tagName+'"')}}},this)},createComponentFromElement:function(a,d){var i={};for(var m in th){var g=m.toLowerCase();if(i[g]){console.log('componentMap collision with key "'+g+'"')}i[g]=m}var b=a.tagName.toLowerCase();m=i[b];if(!m){return}var c=th[m];if(!c){return}var h=a.attributes;var f={};th.forEach(h,function(o){var n=o.name;var p=o.value;if(n=="cell"){n="constraints"}f[n]=p});var j=new c(f);if(!j.type){return}if(j.type.toLowerCase()!=b){return}return j},layout:function(){if(this.root){this.root.bounds={x:0,y:0,width:this.canvas.width,height:this.canvas.height};this.root.layoutTree()}},paintSelf:function(a){},paint:function(b){if(!this.resources.loaded){if(!this.resourceCallbackRegistered){this.resources.registerOnLoadCallback(this.render,this);this.resourceCallbackRegistered=true}return}if(!b){b=this.root}if(b){if(b===this.root){b.resolveCss()}if(!b.opaque&&b.parent){return this.paint(b.parent)}var a=this.canvas.getContext("2d");th.fixCanvas(a);a.save();var c=b.parent;var d=b;while(c){if(d.bounds===undefined||d.bounds.x===undefined||d.bounds.y===undefined||d.bounds.width===undefined||d.bounds.height===undefined){return}a.translate(d.bounds.x,d.bounds.y);a.beginPath();a.rect(0,0,d.bounds.width,d.bounds.height);a.closePath();a.clip();d=c;c=c.parent}if(!this.smartRedraw){a.clearRect(0,0,b.bounds.width,b.bounds.height)}b.paint(a);if(b.border){b.border.paint(a)}a.restore()}}}});th.SimpleBorder=Class.define({type:"Border",uses:[th.ComponentHelpers],members:{init:function(a){this.SIDES=["top","right","bottom","left"];this.component=a},getBorderWidth:function(a){var b=this.component.cssValue("border-"+a+"-width");if(b===undefined){return 0}return th.convertLengthToPixels(b,this.component)},getInsets:function(){return this.calculateInsets("border-","-width")},paint:function(a){if(this.component.cssValue("border-image-url")===undefined){this.paintSimpleBorder(a)}else{this.paintImageBorder(a)}},paintSimpleBorder:function(m){for(var c=0;c<this.SIDES.length;c++){var n=this.SIDES[c];var a=this.getBorderWidth(n);if(a>0){var b=this.component.cssValue("border-"+n+"-color");var g,f,d,j;switch(n){case"top":g=0;f=0;d=a;j=this.component.bounds.width;break;case"right":g=this.component.bounds.width-a;f=0;d=this.component.bounds.height;j=a;break;case"bottom":g=0;f=this.component.bounds.height-a;d=a;j=this.component.bounds.width;break;case"left":g=0;f=0;d=this.component.bounds.height;j=a;break}this.paintBorder(m,b,g,f,j,d)}}},paintImageBorder:function(s){var f=th.global_resources.images[this.component.cssValue("border-image-url")];if(f.width==0){return}var q,n,a,c,p,g,j;q=parseInt(this.component.cssValue("border-image-top"));n=parseInt(this.component.cssValue("border-image-bottom"));a=parseInt(this.component.cssValue("border-image-right"));c=parseInt(this.component.cssValue("border-image-left"));p=f.width;g=f.height;j=this.component.d();bT=th.convertLengthToPixels(this.component.cssValue("border-top-width"));bR=th.convertLengthToPixels(this.component.cssValue("border-right-width"));bB=th.convertLengthToPixels(this.component.cssValue("border-bottom-width"));bL=th.convertLengthToPixels(this.component.cssValue("border-left-width"));s.drawImage(f,0,0,c,q,0,0,bL,bT);s.drawImage(f,p-a,0,a,q,j.b.w-bR,0,bR,bT);s.drawImage(f,0,g-n,c,n,0,j.b.h-bB,bL,bB);s.drawImage(f,p-a,g-n,a,n,j.b.w-bR,j.b.h-bB,bR,bB);switch(this.component.cssValue("border-image-repeat-x")){case"stretch":s.drawImage(f,c,0,p-c-a,q,bL,0,j.b.w-bL-bR,bT);s.drawImage(f,c,g-n,p-c-a,n,bL,j.b.h-bB,j.b.w-bL-bR,bB);break;case"repeat":var i;s.save();s.beginPath();s.rect(bL,0,j.b.w-bL-bR,j.b.h);s.clip();i=c*(bT/q);for(var o=bL;o<j.b.w-bR;o+=i){s.drawImage(f,c,0,p-c-a,q,o,0,i,bT)}i=a*(bB/n);for(var o=bL;o<j.b.w-bR;o+=i){s.drawImage(f,c,g-n,p-c-a,n,o,j.b.h-bB,i,bB)}s.restore();break;default:console.error('border-image-repeat-x "'+this.component.cssValue("border-image-repeat-x")+'" not supported!');break}switch(this.component.cssValue("border-image-repeat-y")){case"stretch":s.drawImage(f,0,q,c,g-q-n,0,bT,bL,j.b.h-bT-bB);s.drawImage(f,p-a,q,a,g-q-n,j.b.w-bR,bT,bR,j.b.h-bT-bB);break;case"repeat":var i;s.save();s.beginPath();s.rect(0,bT,j.b.w,j.b.h-bT-bB);s.clip();i=q*(bL/c);for(var m=bT;m<j.b.h-bB;m+=i){s.drawImage(f,0,q,c,g-q-n,0,m,bL,i)}i=q*(bR/a);for(var m=bT;m<j.b.h-bB;m+=i){s.drawImage(f,p-a,q,a,g-q-n,j.b.w-bR,m,bR,i)}s.restore();break;default:console.error('border-image-repeat-y "'+this.component.cssValue("border-image-repeat-x")+'" not supported!');break}},paintBorder:function(c,d,a,g,b,f){c.fillStyle=d;c.fillRect(a,g,b,f)}}});th.Component=Class.define({type:"Component",uses:[th.ComponentHelpers],members:{init:function(a){if(!a){a={}}for(var b in a){this[b]=a[b]}this.scrollTop=0;this.scrollLeft=0;if(!this.bounds){this.bounds={}}this.border=new th.SimpleBorder(this);if(this.opaque==undefined){this.opaque=true}this.bus=th.global_event_bus;this.styles=undefined;this.localStyles={};this.refreshCss=true},getScratchContext:function(){var a=this.getScene();if(a){return a.scratchContext}},getInsets:function(){var a=this.border.getInsets();a=this.calculateInsets("padding-","",a);return a},getMargins:function(){return this.calculateInsets("margin-")},paint:function(a){},repaint:function(){if(!this.getScene()){return}this.getScene().paint(this)}}});th.SimpleLayout=Class.define({members:{init:function(a){if(!a){a={}}this.orientation=a.orientation||th.HORIZONTAL},layout:function(c){var q=c.d();if(c.children.length>0){var p=(this.orientation==th.HORIZONTAL);var g=(p)?q.b.iw:q.b.ih;var f=parseInt(g/c.children.length);var s=g%c.children.length;var m=(p)?q.i.l:q.i.t;var n=m;for(var o=0;o<c.children.length;o++){var b=0;if(s>0){s--;b=1}var a=m;var j=f+b;c.children[o].bounds=(p)?{x:a,y:n,width:j,height:q.b.ih}:{x:n,y:a,width:q.b.iw,height:j};m+=j}}},getMinimumSize:function(a,d){var f=(this.orientation==th.HORIZONTAL)?"width":"height";var c=0;for(var b=0;b<a.children.length;b++){c+=a.children[b].getMinimumSize()[f]}return c},getPreferredSize:function(a){var d=(this.orientation==th.HORIZONTAL)?"width":"height";var c=0;for(var b=0;b<a.children.length;b++){c+=a.children[b].getPreferredSize()[d]}return c},getMaximumSize:function(a){var d=(this.orientation==th.HORIZONTAL)?"width":"height";var c=0;for(var b=0;b<a.children.length;b++){c+=a.children[b].getMaximumSize()[d]}return c}}});th.FlowLayout=Class.define({members:{init:function(a){if(a!="horizontal"&&a!="vertical"){console.error('Not known orientation "'+a+'"')}this.orientation=a=="horizontal"?th.HORIZONTAL:th.VERTICAL},layout:function(q){var y=q.d();if(q.children.length>0){var x=(this.orientation==th.HORIZONTAL);var v=(x)?y.b.iw:y.b.ih;var f=x?"width":"height";var g=x?"left":"top";var c=x?"right":"bottom";var b=x?"top":"left";var a=x?"bottom":"right";var j=0;var s=0;var u=[];th.forEach(q.children,function(B,h){var d=0;var A=B.calculateInsets("margin-","");if(B.layoutdata!==undefined){if(B.layoutdata.indexOf("px")>0){d=th.convertLengthToPixels(B.layoutdata)}else{try{s+=parseFloat(B.layoutdata);j+=A[g]+A[c];return}catch(i){console.error('Cannot interpretate layoutData "'+B.layoutdata+'" of child "'+B.id+'"')}}}else{d+=B.getPreferredSize()[f]}u[h]=d;j+=d+A[g]+A[c]});var z=v-j;var r=(x)?y.i.l:y.i.t;var p=(!x)?y.i.l:y.i.t;for(var w=0;w<q.children.length;w++){var o=q.children[w];var t=o.calculateInsets("margin-","");var n=r+t[g];if(u[w]!==undefined){var m=u[w]}else{var m=(z/s)*parseFloat(o.layoutdata)}o.bounds=(x)?{x:n,y:p+t[b],width:m,height:y.b.iw-(t[b]+t[a])}:{x:p+t[b],y:n,width:y.b.iw-(t[b]+t[a]),height:m};r+=m+t[g]+t[c]}}}},getMinimumSize:function(a,d){var f=(this.orientation==th.HORIZONTAL)?"width":"height";var c=0;for(var b=0;b<a.children.length;b++){c+=a.children[b].getMinimumSize()[f]}return c},getPreferredSize:function(a){var d=(this.orientation==th.HORIZONTAL)?"width":"height";var c=0;for(var b=0;b<a.children.length;b++){c+=a.children[b].getPreferredSize()[d]}return c},getMaximumSize:function(a){var d=(this.orientation==th.HORIZONTAL)?"width":"height";var c=0;for(var b=0;b<a.children.length;b++){c+=a.children[b].getMaximumSize()[d]}return c}});th.Container=Class.define({type:"Container",superclass:th.Component,uses:[th.ContainerHelpers],members:{init:function(a){this._super(a);this.children=[];this.checkedForFormLayout=false;this.layoutManager=new th.SimpleLayout()},add:function(){for(var c=0;c<arguments.length;c++){var a=th.isArray(arguments[c])?arguments[c]:[arguments[c]];this.children=this.children.concat(a);for(var b=0;b<a.length;b++){a[b].parent=this;a[b].refreshCss=true}}},remove:function(){for(var d=0;d<arguments.length;d++){var b=th.isArray(arguments[d])?arguments[d]:[arguments[d]];for(var c=0;c<b.length;c++){var a=this.children.length;this.children=th.remove(this.children,b[c]);if(a!=this.children.length){delete b[c].parent}}}},replace:function(b,a){this.bus.unbind(this.children[a]);b.parent=this;this.children[a]=b},paint:function(a){if(this.shouldPaint()){this.paintSelf(a);this.paintChildren(a)}},paintSelf:function(a){},paintChildren:function(a){for(var d=0;d<this.children.length;d++){if(!this.children[d].shouldPaint()){continue}if(!this.children[d].bounds){continue}a.save();try{a.translate(this.children[d].bounds.x,this.children[d].bounds.y)}catch(b){a.restore();continue}try{a.beginPath();a.rect(0,0,this.children[d].bounds.width,this.children[d].bounds.height);a.closePath();a.clip()}catch(c){}a.save();this.children[d].paint(a);if(this.children[d].border){this.children[d].border.paint(a)}a.restore();a.restore()}},installLayoutManager:function(c){this.layoutManager=c;var f=false;for(var b=0;b<this.children.length;b++){if(this.children[b]["constraints"]!==undefined){if(!this.children[b].cssValue("-th-constraints")){this.children[b].addCss("-th-constraints",this.children[b]["constraints"])}}if(this.children[b].cssValue("-th-constraints")){f=true}}if(c instanceof th.formlayout.FormLayout){if(!f){var d=1;var a=1;th.forEach(this.children,function(g){var j=false;while(d<=c.getRowCount()){while(a<=c.getColumnCount()){var i=c.getColumnSpec(a);if(i.isSpacer()){a++;continue}j=true;break}if(j){var h=c.getRowSpec(d);if(!h.isSpacer()){break}}j=false;d++;a=1}if(!j){return}c.addLayoutComponent(g,new th.formlayout.CellConstraints(a,d));a++})}else{th.forEach(this.children,function(g){var h=g.cssValue("-th-constraints");c.addLayoutComponent(g,new th.formlayout.CellConstraints(h))})}}},layoutTree:function(){if(!this.checkedForFormLayout){this.checkedForFormLayout=true;if(this.grid){var b=this.grid.split(";");if(b.length!=2){console.log("Couldn't parse 'grid' property: "+this.grid)}else{this.addCss("-th-grid-cols",b[0]);this.addCss("-th-grid-rows",b[1])}var d=this.cssValue("-th-grid-cols");var c=this.cssValue("-th-grid-rows");if(d&&c){this.installLayoutManager(new th.formlayout.FormLayout(d,c))}}else{if(this.flowLayout){this.layoutManager=new th.FlowLayout(this.flowLayout)}}}this.layout();for(var a=0;a<this.children.length;a++){if(this.children[a].layoutTree){this.children[a].layoutTree()}}},layout:function(){if(this.layoutManager){this.layoutManager.layout(this)}},render:function(){if(!th.global_resources.loaded){return}this.layoutTree();this.repaint()}}});th.WindowScene=Class.define({type:"Window",superclass:th.Scene,members:{init:function(a){this._super(a.canvasOrId,a.baseUrlOrParams);this.isVisible=(a.isVisible===undefined)?false:a.isVisible;this.canvas.style.position="absolute";if(this.isVisible){this.canvas.style.display="block"}else{this.canvas.style.display="none"}a.x=(a.x===undefined)?100:a.x;a.y=(a.y===undefined)?100:a.x;this.move(a.x,a.y);this.label=new th.Label();this.label.type="WindowLabel";this.label.text=a.title||"";this.label.parent=this.root;this.label.addCss("visibility","hidden");this.isDraggable=(a.isDraggable===undefined)?true:a.isDraggable;if(this.isDraggable){th.observe(this.canvas,"mousedown",this.onmousedown,this);th.observe(window,"mouseup",this.onmouseup,this);th.observe(window,"mousemove",this.onmousemove,this)}},move:function(a,b){this.canvas.style.top=b+"px";this.canvas.style.left=a+"px";this.posX=a;this.posY=b;this.bus.fire("move",{x:a,y:b},this)},centerUp:function(){this.move(Math.round((window.innerWidth-this.canvas.width)*0.5),Math.round((window.innerHeight-this.canvas.height)*0.25))},center:function(){this.move(Math.round((window.innerWidth-this.canvas.width)*0.5),Math.round((window.innerHeight-this.canvas.height)*0.5))},toggle:function(){this.isVisible=!this.isVisible;if(this.isVisible){this.canvas.style.display="block"}else{this.canvas.style.display="none"}this.bus.fire("toggle",{isVisible:this.isVisible},this)},getPosition:function(){return{x:this.posX,y:this.posY}},onmousedown:function(g){var h=this.root.d();var f=th.cumulativeOffset(this.canvas).left+h.i.l;var b=f+this.canvas.width-h.i.r;var c=th.cumulativeOffset(this.canvas).top+h.i.t;var a=c+this.canvas.height-h.i.b;if(g.clientX>f&&g.clientX<b&&g.clientY>c&&g.clientY<a){return}this.startValue={mouse:{x:g.clientX,y:g.clientY},window:this.getPosition()};th.stopEvent(g)},onmousemove:function(c){if(this.startValue){var b=this.startValue;var a=b.window.x-(b.mouse.x-c.clientX);var d=b.window.y-(b.mouse.y-c.clientY);this.move(a,d);th.stopEvent(c)}},onmouseup:function(a){delete this.startValue},paintSelf:function(){if(this.label.text==""){return}var a=this.canvas.getContext("2d");this.label.resolveCss();this.label.bounds={x:th.convertLengthToPixels(this.label.cssValue("left")||"0px"),y:th.convertLengthToPixels(this.label.cssValue("top")||"0px"),width:th.convertLengthToPixels(this.label.cssValue("width"))||this.label.getPreferredSize().width,height:th.convertLengthToPixels(this.label.cssValue("width"))||this.label.getPreferredSize().height};a.save();a.translate(this.label.bounds.x,this.label.bounds.y);this.label.paint(a);a.restore()}}});if(typeof th=="undefined"){th={}}th.Panel=Class.define({type:"Panel",superclass:th.Container,members:{init:function(a){this._super(a)},paintSelf:function(a){this.paintBackground(a)}}});th.Button=Class.define({type:"Button",superclass:th.Component,members:{init:function(a){if(!a){a={}}this._super(a);this.orientation=a.orientation||th.VERTICAL},getPreferredSize:function(){var f=this.getInsets();var d=f.left+f.right;var h=f.top+f.bottom;var a=this.cssValue("height");if(a!==undefined){a=th.convertLengthToPixels(a,this)}var g=this.cssValue("width");if(g!==undefined){g=th.convertLengthToPixels(g,this)}if(a!==undefined&&g!==undefined){return{width:g+d,height:a+h}}var b=this.tmb();if((b)&&(b.top&&b.mid&&b.bot)){if(this.isVertical()){if(a===undefined){a=b.top.height+b.mid.height+b.bot.height}if(g===undefined){g=b.top.width}}else{if(a===undefined){a=b.top.height}if(g===undefined){g=b.top.width+b.mid.width+b.bot.width}}return{width:g+d,height:a+h}}var c=this.getFirstBackgroundImage();if(c){return{width:c.width+d,height:c.height+h}}return{width:d,height:h}},tmb:function(){var b=this.cssValue("-th-top-image");var a=this.cssValue("-th-middle-image");var c=this.cssValue("-th-bottom-image");if(b){b=th.global_resources.images[b]}if(a){a=th.global_resources.images[a]}if(c){c=th.global_resources.images[c]}if(b&&a&&c){return{top:b,mid:a,bot:c}}},paint:function(a){var b=this.d();var c=this.tmb();if(!c){c={}}if(c.top&&c.mid&&c.bot){if(this.isVertical()){if(b.b.h>=c.top.height+c.bot.height){a.drawImage(c.top,0,0);if(b.b.h>c.top.height+c.bot.height){a.drawImage(c.mid,0,c.top.height,c.mid.width,b.b.h-c.top.height-c.bot.height)}a.drawImage(c.bot,0,b.b.h-c.bot.height)}}else{if(b.b.w>=c.top.width+c.bot.width){a.drawImage(c.top,0,0);if(b.b.w>c.top.width+c.bot.width){a.drawImage(c.mid,c.top.width,0,b.b.w-c.top.width-c.bot.width,c.mid.height)}a.drawImage(c.bot,b.b.w-c.bot.width,0)}}}else{this.paintBackground(a)}}}});th.Scrollbar=Class.define({type:"Scrollbar",superclass:th.Container,members:{init:function(a){if(!a){a={}}this._super(a);this.orientation=a.orientation||th.VERTICAL;this.value=a.value||0;this.min=a.min||0;this.max=a.max||100;this.extent=a.extent||0.1;this.increment=a.increment||2;this.up=new th.Button({className:"up"});this.down=new th.Button({className:"down"});this.bar=new th.Button({className:"bar"});this.add([this.up,this.down,this.bar]);this.bus.bind("click",this.up,this.scrollup,this);this.bus.bind("click",this.down,this.scrolldown,this);this.bus.bind("mousedrag",this.bar,this.onmousedrag,this);this.bus.bind("mouseup",this.bar,this.onmouseup,this)},getPixelRange:function(){},setValue:function(a){if(a<this.min){this.value=this.min}else{if(a>this.max){this.value=this.max}else{this.value=a}}this.bus.fire("scroll",{min:this.min,max:this.max,value:this.value},this)},onmousedrag:function(f){var c=(this.isVertical())?f.clientY:f.clientX;if(this.dragstart_value==undefined){this.dragstart_value=this.value;this.dragstart_mouse=c;return}var d=c-this.dragstart_mouse;var a=this.getPixelRange();var b=(this.max-this.min)/a;this.setValue(this.dragstart_value+Math.floor(d*b));this.render()},onmouseup:function(a){delete this.dragstart_value;delete this.dragstart_mouse},scrollup:function(a){if(this.value>this.min){this.setValue(Math.max(0,this.value-this.increment));this.render()}},scrolldown:function(a){if(this.value<this.max){this.setValue(Math.min(this.max,this.value+this.increment));this.render()}},tmb:function(){var b=this.cssValue("-th-top-image");var a=this.cssValue("-th-middle-image");var c=this.cssValue("-th-bottom-image");if(b){b=th.global_resources.images[b]}if(a){a=th.global_resources.images[a]}if(c){c=th.global_resources.images[c]}if(b&&a&&c){return{top:b,mid:a,bot:c}}},getPreferredSize:function(){var d=this.getInsets();var c=d.left+d.right;var g=d.top+d.bottom;var a=this.cssValue("height");if(a!==undefined){a=th.convertLengthToPixels(a,this)}var f=this.cssValue("width");if(f!==undefined){f=th.convertLengthToPixels(f,this)}if(a!==undefined&&f!==undefined){return{width:f+c,height:a+g}}var b=this.tmb();if(b.top&&b.mid&&b.bot){if(this.isVertical()){if(a===undefined){a=b.top.height+b.mid.height+b.bot.height}if(f===undefined){f=b.top.width}}else{if(a===undefined){a=b.top.height}if(f===undefined){f=b.top.width+b.mid.width+b.bot.width}}return{width:f+c,height:a+g}}},layout:function(){var m=this.d();this.bar.orientation=this.orientation;if(this.max<this.min){console.error("scrollbar max is less than min; can't do layout",this);for(var f=0;f<this.children.length;f++){delete this.children[f].bounds}return}if(this.orientation==th.VERTICAL){var n=m.b.iw;var g=this.up.getPreferredSize().height;this.up.bounds={x:m.i.l,y:m.i.t,width:n,height:g};this.down.bounds={x:m.i.l,y:m.b.ih-g,width:n,height:g};var o=m.b.ih-this.up.bounds.height-this.down.bounds.height;var j=Math.min(Math.floor(o/(1+this.extent),o));var a=Math.floor(this.up.bounds.height+Math.min((this.value*o*this.extent/(this.max*(1+this.extent)))));var b=(a+j)-this.down.bounds.y;if(b>0){a-=b}this.bar.bounds={x:m.i.l,y:a,width:m.b.iw,height:j}}else{var n=this.up.getPreferredSize().width;var g=m.b.ih;this.up.bounds={x:m.i.l,y:m.i.t,width:n,height:g};this.down.bounds={x:m.b.iw-n,y:m.i.t,width:n,height:g};var c=m.b.iw-this.up.bounds.width-this.down.bounds.width;var j=Math.min(Math.floor(c/(1+this.extent),c));var a=Math.floor(this.up.bounds.height+Math.min((this.value*c*this.extent/(this.max*(1+this.extent)))));var b=(a+j)-this.down.bounds.x;if(b>0){a-=b}this.bar.bounds={x:a,y:m.i.t,width:j,height:m.b.ih}}},paint:function(a){if(this.max<0){return}this.bar.orientation=this.orientation;this.paintTrack(a);this._super(a)},paintTrack:function(a){}}});th.VerticalScrollbar=Class.define({type:"VerticalScrollbar",superclass:th.Scrollbar,members:{init:function(a){if(!a){a={}}a.orientation=th.VERTICAL;this._super(a)},getPixelRange:function(){var a=this.d();return a.b.ih-this.up.bounds.height-this.down.bounds.height-this.bar.bounds.height},paintTrack:function(a){var b=this.d();var c=this.tmb();if(!c){return}if(c.top){a.drawImage(c.top,b.i.l,this.up.bounds.height)}if(c.mid){a.drawImage(c.mid,b.i.l,this.up.bounds.height+c.top.height,c.mid.width,this.down.bounds.y-this.down.bounds.height-(this.up.bounds.x-this.up.bounds.height))}if(c.bot){a.drawImage(c.bot,b.i.l,this.down.bounds.y-c.bot.height)}}}});th.HorizontalScrollbar=Class.define({type:"HorizontalScrollbar",superclass:th.Scrollbar,members:{init:function(a){if(!a){a={}}a.orientation=th.HORIZONTAL;this._super(a)},getPixelRange:function(){var a=this.d();return a.b.iw-this.up.bounds.width-this.down.bounds.width-this.bar.bounds.width},paintTrack:function(a){var b=this.d();var c=this.tmb();if(!c){return}if(c.top){a.drawImage(c.top,this.up.bounds.width,b.i.t)}if(c.mid){a.drawImage(c.mid,this.up.bounds.width+c.top.width,b.i.t,this.down.bounds.x-(this.up.bounds.x+this.up.bounds.width),c.mid.height)}if(c.bot){a.drawImage(c.bot,this.down.bounds.x-c.bot.width,b.i.t)}}}});th.ResizeNib=Class.define({type:"ResizeNib",superclass:th.Component,members:{init:function(a){this._super(a);this.bus.bind("mousedown",this,this.onmousedown,this);this.bus.bind("mouseup",this,this.onmouseup,this);this.bus.bind("mousedrag",this,this.onmousedrag,this)},onmousedown:function(a){this.startPos={x:a.clientX,y:a.clientY}},onmousedrag:function(a){if(this.startPos){if(!this.firedDragStart){this.bus.fire("dragstart",this.startPos,this);this.firedDragStart=true}this.bus.fire("drag",{startPos:this.startPos,currentPos:{x:a.clientX,y:a.clientY}},this)}},onmouseup:function(a){if(this.startPos&&this.firedDragStart){this.bus.fire("dragstop",{startPos:this.startPos,currentPos:{x:a.clientX,y:a.clientY}},this);delete this.firedDragStart}delete this.startPos},paint:function(o){var g=this.d();if(this.orientation==th.VERTICAL){var j=7;var n=Math.floor((g.b.w/2)-(j/2));var m=7;o.fillStyle=this.cssValue("-th-vertical-bar-shadow-color");for(var f=0;f<3;f++){o.fillRect(n,m,j,1);m+=3}m=8;o.fillStyle=this.cssValue("-th-vertical-bar-color");for(var f=0;f<3;f++){o.fillRect(n,m,j,1);m+=3}}else{var c=7;var a=8;var h=c+2;var n=Math.floor(g.b.w/2-(a/2));var m=Math.floor(g.b.h/2-(h/2));var b=n;if(this.cssValue("-th-horizontal-bar-subtle-shadow-color")){o.fillStyle=this.cssValue("-th-horizontal-bar-subtle-shadow-color");for(var f=0;f<3;f++){o.fillRect(b,m,1,h);b+=3}}b=n+1;o.fillStyle=this.cssValue("-th-horizontal-bar-shadow-color");for(var f=0;f<3;f++){o.fillRect(b,m+h-1,1,1);b+=3}b=n+1;o.fillStyle=this.cssValue("-th-horizontal-bar-color");for(var f=0;f<3;f++){o.fillRect(b,m+1,1,c);b+=3}}}}});th.Splitter=Class.define({type:"Splitter",superclass:th.Panel,members:{init:function(a){this._super(a);this.opaque=false;this.topNib=new th.ResizeNib({orientation:this.orientation});this.bottomNib=new th.ResizeNib({orientation:this.orientation});this.add(this.topNib,this.bottomNib);this.label=a.label;if(this.label){this.add(this.label)}this.scrollbar=a.scrollbar;if(this.scrollbar){this.add(this.scrollbar)}this.bus.bind("drag",[this.topNib,this.bottomNib],this.ondrag,this);this.bus.bind("dragstart",[this.topNib,this.bottomNib],this.ondragstart,this);this.bus.bind("dragstop",[this.topNib,this.bottomNib],this.ondragstop,this)},ondrag:function(a){this.bus.fire("drag",a,this)},ondragstart:function(a){this.bus.fire("dragstart",a,this)},ondragstop:function(a){this.bus.fire("dragstop",a,this)},getPreferredSize:function(){var d=this.getInsets();var c=d.left+d.right;var g=d.top+d.bottom;var b=this.cssValue("height");if(b!==undefined){b=th.convertLengthToPixels(b,this)}var f=this.cssValue("width");if(f!==undefined){f=th.convertLengthToPixels(f,this)}if(b!==undefined&&f!==undefined){return{width:f+c,height:b+g}}if(this.scrollbar&&this.scrollbar.shouldLayout()){var a=this.scrollbar.getPreferredSize();if(a){return{width:a.width+c,height:a.height+g}}}return{width:(f===undefined)?c:f+c,height:(b===undefined)?g:b+g}},layout:function(){var a=this.d();if(!this.orientation){this.orientation=(this.bounds.height>this.bounds.width)?th.HORIZONTAL:th.VERTICAL}if(this.orientation==th.HORIZONTAL){this.topNib.bounds={x:a.i.l,y:a.i.t,height:a.b.iw,width:a.b.iw};this.bottomNib.bounds={x:a.i.l,y:a.b.ih-a.b.iw,height:a.b.iw,width:a.b.iw};if(this.scrollbar&&this.scrollbar.shouldLayout()){this.scrollbar.bounds={x:a.i.l,y:this.topNib.bounds.height,height:a.b.ih-(this.topNib.bounds.height*2),width:a.b.iw}}}else{this.topNib.bounds={x:a.i.l,y:a.i.t,height:a.b.ih,width:a.b.ih};this.bottomNib.bounds={x:a.b.iw-a.b.ih,y:a.i.t,height:a.b.ih,width:a.b.ih};if(this.label){this.label.bounds={x:this.topNib.bounds.x+this.topNib.bounds.width,y:a.i.t,height:a.b.ih,width:a.b.iw-(a.b.ih*2)}}}}}});th.VerticalSplitter=Class.define({type:"VerticalSplitter",superclass:th.Splitter,members:{init:function(a){if(!a){a={}}a.orientation=th.HORIZONTAL;this._super(a)}}});th.SplitPanelContainer=Class.define({type:"SplitPanelContainer",superclass:th.Panel,members:{init:function(a){this._super(a);this.splitter=new th.Splitter({orientation:this.orientation,label:a.label})},getContents:function(){var a=th.remove(this.children,this.splitter);if(a.length>0){return a[0]}},layout:function(){var c=th.remove(this.children,this.splitter);if(this.children.length==c.length){this.add(this.splitter)}var b=this.splitter.getPreferredSize();var a=(this.orientation==th.HORIZONTAL)?b.width:b.height;if(this.splitter.shouldLayout()){if(this.orientation==th.HORIZONTAL){this.splitter.bounds={x:this.bounds.width-a,y:0,height:this.bounds.height,width:a}}else{this.splitter.bounds={x:0,y:this.bounds.height-a,height:a,width:this.bounds.width}}}else{a=0}if(c.length>0){if(this.orientation==th.HORIZONTAL){c[0].bounds={x:0,y:0,height:this.bounds.height,width:this.bounds.width-a}}else{c[0].bounds={x:0,y:0,height:this.bounds.height-a,width:this.bounds.width}}}}}});th.SplitPanel=Class.define({type:"SplitPanel",superclass:th.Panel,uses:[th.StringHelpers],members:{init:function(a){this._super(a);if(!this.orientation){this.orientation=th.HORIZONTAL}if(!this.regions){this.regions=[{},{}]}},ondragstart:function(b){var a=b.thComponent.parent;a.region.startSize=a.region.size},ondrag:function(b){var a=b.thComponent.parent;var c=(this.orientation==th.HORIZONTAL)?b.currentPos.x-b.startPos.x:b.currentPos.y-b.startPos.y;a.region.size=a.region.startSize+c;this.render()},ondragstop:function(b){var a=b.thComponent.parent;delete a.region.startSize},layout:function(){this.remove(this.children);for(var c=0;c<this.regions.length;c++){var h=this.regions[c];if(!h.container){h.container=new th.SplitPanelContainer({orientation:this.orientation,label:h.label});h.container.region=h;this.bus.bind("dragstart",h.container.splitter,this.ondragstart,this);this.bus.bind("drag",h.container.splitter,this.ondrag,this);this.bus.bind("dragstop",h.container.splitter,this.ondragstop,this)}if(h.contents&&(h.contents!=h.container.getContents())){h.container.removeAll();h.container.add(h.contents)}if(c==this.regions.length-1){h.container.splitter.addCss("display","none")}this.add(h.container)}var j=(this.orientation==th.HORIZONTAL)?this.bounds.width:this.bounds.height;var a=0;for(var c=0;c<this.regions.length;c++){var f=this.regions[c];if(!f.size){f.size=(this.defaultSize||(100/this.regions.length)+"%")}if(this.isPercentage(f.size)){f.size=Math.floor((parseInt(f.size)/100)*j)}if(f.size<30){f.size=30}a+=f.size}if(a>j){var g=a-j;for(var c=this.regions.length-1;c>=0;c--){var f=this.regions[c];var b=f.size;f.size-=g;if(f.size<30){f.size=30}g-=(b-f.size);if(g<=0){break}}}else{if(a<j){var f=this.regions[this.regions.length-1].size+=(j-a)}}var d=0;for(var c=0;c<this.regions.length;c++){var h=this.regions[c];if(this.orientation==th.HORIZONTAL){h.container.bounds={x:d,y:0,width:h.size,height:this.bounds.height}}else{h.container.bounds={x:0,y:d,width:this.bounds.width,height:h.size}}d+=h.size}}}});th.Label=Class.define({type:"Label",superclass:th.Panel,members:{init:function(a){if(!a){a={}}this._super(a);this.text=a.text||""},styleContext:function(a){if(!a){return}a.font=this.cssValue("font");a.fillStyle=this.cssValue("color");return a},getPreferredSize:function(){var b=this.styleContext(this.parent.getScratchContext());var c=this.getInsets();var a=b.measureText(this.text).width+2;a+=c.left+c.right;var d=Math.floor(b.measureText(this.text).ascent*1.5);d+=c.top+c.bottom;return{height:d,width:a}},paint:function(n){this._super(n);var f=this.d();this.styleContext(n);var g=n.measureText(this.text);var h=f.i.t+g.ascent;if(th.browser.WebKit){h+=1}if(g.width<=(f.b.w-f.i.w)){var i;var a=this.cssValue("text-align")||"left";switch(a){case"start":case"left":i=f.i.l;break;case"center":i=f.i.l+((f.b.iw-g.width)/2);break;case"end":case"right":i=f.i.l+f.b.iw-g.width;break;default:console.error('orientation "'+this.orientation+'"???');break}n.fillText(this.text,i,h)}else{if(this.text===undefined){this.text=""}var c=this.text;var m=c.length-2;while(g.width>(f.b.iw)){if(m<=0){if(this.text.length>1){c="..."}else{c=this.text}break}var b=Math.floor(m/2);var j=b+(m%2);c=this.text.substring(0,b)+"..."+this.text.substring(this.text.length-j);g=n.measureText(c);m-=1}n.fillText(c,f.i.l,h)}}}});th.Input=Class.define({type:"input",superclass:th.Panel,uses:[th.KeyHelpers],members:{init:function(a){if(!a){a={}}this._super(a);this.text=a.text||"";this.xOff=0;this.isMouseDown=false;this.isCursorVisible=true;this.cursorTimer=undefined;this.cursorTogglePeriod=600;this.selStart=this.text.length;this.selEnd=this.selStart;this.selRelStart=this.selStart;this.selRelEnd=this.selEnd;this.bus.bind("keypress",this,this.onKeyPress,this);this.bus.bind("mousedown",this,this.onMouseDown,this);this.bus.bind("mousemove",this,this.onMouseMove,this);this.bus.bind("mouseup",this,this.onMouseUp,this);this.bus.bind("dblclick",this,this.onMouseDoubleClick,this);this.key.bind("",this.key.ARROW_LEFT,this.actions.moveCursorLeft,this);this.key.bind("SHIFT",this.key.ARROW_LEFT,this.actions.moveCursorLeft,this);this.key.bind("CMD",this.key.ARROW_LEFT,this.actions.moveCursorBeginning,this);this.key.bind("CMD SHIFT",this.key.ARROW_LEFT,this.actions.moveCursorBeginning,this);this.key.bind("",this.key.ARROW_RIGHT,this.actions.moveCursorRight,this);this.key.bind("SHIFT",this.key.ARROW_RIGHT,this.actions.moveCursorRight,this);this.key.bind("CMD",this.key.ARROW_RIGHT,this.actions.moveCursorEnd,this);this.key.bind("CMD SHIFT",this.key.ARROW_RIGHT,this.actions.moveCursorEnd,this);this.key.bind("",this.key.BACKSPACE,this.actions.backspace,this);this.key.bind("",this.key.DELETE,this.actions.deleteKey,this);this.key.bind("CMD",this.key.A,this.selectAll,this);this.key.setupEvents(this);this.bus.bind("focus:received",this,function(){this.isCursorVisible=false;clearTimeout(this.cursorTimer);this.toggleCursor()},this);this.bus.bind("focus:lost",this,function(){this.isCursorVisible=false;clearTimeout(this.cursorTimer)},this)},actions:{moveCursorLeft:function(a){if(this.selStart!=this.selEnd&&!a.shiftKey){this.setSelection(this.selRelStart,undefined,false)}else{this.setSelection(Math.max(--this.selStart,0),(a.shiftKey?this.selEnd:undefined),false)}},moveCursorRight:function(a){if(this.selStart!=this.selEnd&&!a.shiftKey){this.setSelection(this.selRelEnd,undefined,false)}else{this.setSelection(Math.max(++this.selStart,0),(a.shiftKey?this.selEnd:undefined),false)}},moveCursorBeginning:function(a){this.setSelection(0,(a.shiftKey?this.selEnd:undefined),true)},moveCursorEnd:function(a){this.setSelection(this.text.length,(a.shiftKey?this.selEnd:undefined),true)},backspace:function(a){if(this.selStart==this.selEnd){this.text=this.text.substring(0,this.selRelStart-1)+this.text.substring(this.selRelEnd);this.setSelection(--this.selRelStart,undefined,true)}else{this.text=this.text.substring(0,this.selRelStart)+this.text.substring(this.selRelEnd);this.setSelection(this.selRelStart,undefined,true)}this.bus.fire("text:changed",{text:this.text},this)},deleteKey:function(a){if(this.selStart==this.selEnd){this.text=this.text.substring(0,this.selRelStart)+this.text.substring(this.selRelEnd+1);this.setSelection(this.selRelStart,undefined,true);this.repaint()}else{this.text=this.text.substring(0,this.selRelStart)+this.text.substring(this.selRelEnd);this.setSelection(this.selRelStart,undefined,true)}this.bus.fire("text:changed",{text:this.text},this)}},performCopy:function(){if(this.selStart==this.selEnd){return false}return this.getSelectedText()},performCut:function(){if(this.selStart==this.selEnd){return false}var a=this.getSelectedText();this.text=this.text.substring(0,this.selRelStart)+this.text.substring(this.selRelEnd);this.selEnd=this.selStart;this.repaint();this.bus.fire("text:changed",{text:this.text},this);return a},performPaste:function(a){this.text=this.text.substring(0,this.selRelStart)+a+this.text.substring(this.selRelEnd);this.setSelection(this.selRelStart+a.length,undefined);this.bus.fire("text:changed",{text:this.text},this)},setSelection:function(c,b,h){if(b===undefined){b=c}if(h===undefined){h=true}this.selStart=Math.max(Math.min(c,this.text.length),0);this.selEnd=Math.max(Math.min(b,this.text.length),0);var g=this.selRelStart;var j=this.selRelEnd;if(this.selStart>this.selEnd){this.selRelStart=this.selEnd;this.selRelEnd=this.selStart}else{this.selRelStart=this.selStart;this.selRelEnd=this.selEnd}if(g!=this.selRelStart||j!=this.selRelEnd){if(this.selStart!=0){var i=this.d();var a=this.styleContext(this.parent.getScratchContext());this.styleContext(a);var f=a.measureText(this.text.substring(0,this.selStart)).width;if((this.xOff+f)>i.b.iw){if(!h){this.xOff=Math.max(this.xOff-Math.round(i.b.iw/2),-a.measureText(this.text).width+i.b.iw)}else{this.xOff=i.b.iw-f}}var f=a.measureText(this.text.substring(0,this.selStart)).width;if((this.xOff+f)<=0){if(!h){this.xOff=Math.min(this.xOff+Math.round(i.b.iw/2),0)}else{this.xOff=i.i.l-f}}}else{this.xOff=0}clearTimeout(this.cursorTimer);this.isCursorVisible=false;this.toggleCursor()}},selectAll:function(){this.setSelection(0,this.text.length)},getSelectedText:function(){return this.text.substring(this.selRelStart,this.selRelEnd)},setText:function(a){this.text=a;this.setSelection(a.length);this.bus.fire("text:changed",{text:this.text},this)},getPosForPosition:function(f){var b=this.styleContext(this.parent.getScratchContext());this.styleContext(b);var a;var c=this.xOff+this.d().i.l;var d=c;for(a=1;a<this.text.length+1&&d<f;a++){d=c+b.measureText(this.text.substring(0,a)).width}return a-1},onMouseDown:function(a){if(this.focusManager!==undefined){if(!this.focusManager.focus(this)){th.stopEvent(a);return}}this.isMouseDown=true;this.setSelection(this.getPosForPosition(a.componentX),(this.key.isShiftDown?this.selRelEnd:undefined));th.stopEvent(a)},onMouseMove:function(a){if(this.isMouseDown){this.setSelection(this.getPosForPosition(a.componentX),this.selEnd)}},onMouseUp:function(a){this.isMouseDown=false},onMouseDoubleClick:function(c){var a=this.getPosForPosition(c.componentX);var d=a;for(d;d!=-1&&this.text[d]!=" ";d--){}var b=this.text.indexOf(" ",a);b=(b==-1?this.text.length:b);this.setSelection(++d,b)},onKeyPress:function(b){var a=this.key.getPrintableChar(b);if(a){this.text=this.text.substring(0,this.selRelStart)+a+this.text.substring(this.selRelEnd);this.setSelection(++this.selStart);this.bus.fire("text:changed",{text:this.text},this)}},toggleCursor:function(){this.isCursorVisible=!this.isCursorVisible;this.repaint();this.cursorTimer=setTimeout(th.hitch(this,this.toggleCursor),this.cursorTogglePeriod)},styleContext:function(a){if(!a){return}a.font=this.cssValue("font");a.fillStyle=this.cssValue("color");return a},getPreferredSize:function(){var b=this.styleContext(this.parent.getScratchContext());var c=this.getInsets();var a=b.measureText(this.text).width+2;a+=c.left+c.right;var d=Math.floor(b.measureText(this.text).ascent*1.5);d+=c.top+c.bottom;return{height:d,width:a}},paint:function(b){this._super(b);var g=this.d();b.save();b.beginPath();b.rect(g.i.l,g.i.t,g.b.iw,g.b.ih);b.clip();b.translate(g.i.l+this.xOff,0);var c=b.measureText(this.text);var h=g.i.t+c.ascent;if(th.browser.WebKit){h+=1}this.styleContext(b);var f=b.fillStyle;var a=b.measureText(this.text.substring(0,this.selRelStart)).width-(this.selRelStart!=0?1:0);if(this.selStart==this.selEnd){if(this.isCursorVisible){b.fillRect(a,g.i.t-2,1,h+3)}}else{b.fillStyle=this.cssValue("selection-color")||"#B5D2F3";b.fillRect(a,g.i.t-2,b.measureText(this.text.substring(this.selRelStart,this.selRelEnd)).width,h+3)}b.fillStyle=f;b.fillText(this.text,0,h+2);b.restore()}}});th.HtmlLabel=Class.define({type:"Label",superclass:th.Panel,members:{init:function(a){if(!a){a={}}this._super(a);this.text=a.text||"";this.lastText="";this.parsedHtml=[];this.regTag=/#\w+|\w+/g;this.regTags=/<(\w+|\w+\s+|#[a-fA-F0-9]{3}|#[a-fA-F0-9]{6})>|<\/(\w+|\w+\s|#[a-fA-F0-9]{3}|#[a-fA-F0-9]{6})>/g},styleContext:function(a,b){if(!a||!b){return}a.font=[b["font-weight"],b["font-style"],b["font-size"],b["font-family"]].join(" ");a.fillStyle=b.color;return a},parseHtml:function(){if(this.lastText==this.text&&this.parsedHtml.length!=0){return}var d={"font-family":"Tahoma","font-size":"9pt","font-style":"","font-weight":"","text-decoration":"",color:"black"};var j=[d];var m=th.getSpaceDelimitedItems(this.cssValue("font"));var g=[];for(var f=0;f<m.length;f++){if(th.isCssLength(m[f])){d["font-size"]=m[f]}else{switch(m[f]){case"bold":d["font-weight"]="bold";break;case"italic":d["font-style"]="italic";break;default:g.push(m[f]);break}}}d["font-family"]=g.join(", ");d.color=this.cssValue("color");if(this.lastText==this.text&&this.parsedHtml.length==0){this.parsedHtml.push({style:d});return}var c,p,n=this.text;var h=[""];var a=0;this.parsedHtml=[];var o=this.text.match(this.regTags);if(o!=null){for(var f=0;f<o.length;f++){var b=n.indexOf(o[f]);this.parsedHtml.push({style:j[a],text:n.substring(0,b)});n=n.substring(b+o[f].length);p=o[f].match(this.regTag)[0];if(o[f][1]!="/"){c=th.clone(j[a]);switch(p){case"b":case"strong":c["font-weight"]="bold";break;case"i":c["font-style"]="italic";break;case"u":c["text-decoration"]="underline";break;default:if(p[0]=="#"){c.color=p}else{console.error("parseHtml: Can't parse the tag '"+p+"' => !skip! parsing!");return}break}j.push(c);h.push(p);a++}else{if(h[a]!=p){console.error("parseHtml: Close tag '"+p+"' but should close '"+h[a]+"' => !skip! parsing!");return}j.pop();h.pop();a--}}if(a!=0){console.error("parseHtml: not all tag were closed again => !skip! parsing!");return}}this.parsedHtml.push({style:j[0],text:n});this.shouldParse=false;this.lastText=this.text},getPreferredSize:function(){this.parseHtml();var b=this.styleContext(this.parent.getScratchContext(),this.parsedHtml[0].style);var c=this.getInsets();var a=b.measureText(this.text).width+2;a+=c.left+c.right;var d=Math.floor(b.measureText(this.text).ascent*1.5);d+=c.top+c.bottom;return{height:d,width:a}},paint:function(p){this._super(p);var g=this.d();if(this.text!=this.lastText){this.parseHtml()}if(this.text!=this.lastText){return}this.styleContext(p,this.parsedHtml[0].style);h=p.measureText("text");var j=g.i.t+h.ascent;if(th.browser.WebKit){j+=1}var b=0;var m=(g.b.w-g.i.w);var h,c,n;var o,a;p.save();for(var f=0;f<this.parsedHtml.length;f++){o=this.parsedHtml[f].text;a=this.parsedHtml[f].style;if(o==""){continue}this.styleContext(p,a);h=p.measureText(o);if(b+h.width<=m){p.fillText(o,g.i.l+b,j);if(a["text-decoration"]=="underline"){p.lineWidth=1;p.strokeStyle=a.color;p.beginPath();p.moveTo(g.i.l+b,j+2.5);p.lineTo(g.i.l+b+h.width,j+2.5);p.stroke();p.closePath()}b+=h.width}else{n=o.length-2;c=o;while((b+h.width>m)&&n>0){c=o.substring(0,--n)+"...";h=p.measureText(c)}p.fillText(c,g.i.l+b,j);break}}p.restore()}}});th.TextButton=Class.define({type:"TextButton",superclass:th.Label,members:{init:function(a){if(!a){a={}}this._super(a);this.clickFunction=a.onclick;this.bus.bind("mousedown",this,this.onMouseDown,this);this.bus.bind("mouseup",this,this.onMouseUp,this)},onMouseDown:function(a){this.pseudoClass="active";this.repaint()},onMouseUp:function(a){delete this.pseudoClass;this.repaint();if(a.isOverMe){this.onClick()}},onClick:function(e){if(th.isFunction(this.clickFunction)){this.clickFunction(e)}else{if(th.isString(this.clickFunction)){eval(this.clickFunction)}}}},});th.ExpandingInfoPanel=Class.define({type:"ExpandingInfoPanel",superclass:th.Panel,members:{init:function(a){this._super(a)},getMinimumRowHeight:function(){return 40},getMinimumColumnWidth:function(){},layout:function(){if(this.children.length==0){return}var o=this.d();var v=Math.floor(Math.sqrt(this.children.length));var u=Math.floor(o.b.h/v);while(u<this.getMinimumRowHeight()&&v>1){v--;u=Math.floor(o.b.h/v)}var s=Math.floor(this.children.length/v);var t=this.children.length%v;var g=0;var a=o.b.h%v;var c=0;for(var m=0;m<v;m++){var n=(m==v-1)?u+a:u;var q=(t>0)?s+1:s;t--;var b=Math.floor(o.b.w/q);var j=o.b.w%q;var f=0;for(var p=0;p<q;p++){var r=(p==q-1)?b+j:b;this.children[g++].bounds={x:f,y:c,width:r,height:n};f+=r}c+=n}}}});th.List=Class.define({type:"List",superclass:th.Container,members:{init:function(a){if(!a){a={}}this._super(a);this.items=a.items||[];this.allowDeselection=a.allowDeselection||false;this.bus.bind("mousedown",this,this.onmousedown,this);this.bus.bind("keydown",this,this.onkeydown,this);this.renderer=new th.Label();this.renderer.addCss("visibility","hidden");this.add(this.renderer);if(a.topLabel){this.addTopLabel(a.topLabel)}},getPreferredSize:function(){return{width:100,height:this.getRowHeight()*this.items.length}},performCopy:function(){if(!this.selected){return false}return this.getItemText(this.selected)},performCut:function(){if(!this.selected){return}var a=this.getItemText(this.selected);th.removeArrayItem(this.items,this.selected);delete this.selected;this.repaint();return a},performPaste:function(a){this.items.push(a);this.repaint()},addTopLabel:function(a){this.label=a;this.label.className="header";this.add(this.label)},onmousedown:function(b){if(this.focusManager!==undefined){if(!this.focusManager.focus(this)){th.stopEvent(b);return}}var a=this.getItemForPosition({x:b.componentX,y:b.componentY});if(a!=this.selected){if(a){this.selected=a;this.bus.fire("itemselected",{container:this,item:this.selected},this);this.getScene().render()}else{if(this.allowDeselection){delete this.selected}}}th.stopEvent(b)},onkeydown:function(a){if(a.keyCode==38){this.moveSelectionUp();th.stopEvent(a)}else{if(a.keyCode==40){this.moveSelectionDown();th.stopEvent(a)}}},selectItemByText:function(c){if(this.items.length==0){return false}var b=null;if(th.isObject(this.items[0])){for(var a=0;a<this.items.length;a++){if(this.getItemText(this.items[a])==c){b=this.items[a];break}}if(b==null){return false}}else{if(this.items.indexOf(c)==-1){return false}b=this.items[this.items.indexOf(c)]}if(this.selected!=b){this.selected=b;this.repaint()}return true},moveSelectionUp:function(){if(!this.selected||this.items.length==0){return}var a=0;while(this.items[a]!=this.selected){a++}if(a!=0){this.selected=this.items[a-1];this.bus.fire("itemselected",{container:this,item:this.selected},this);this.repaint()}},moveSelectionDown:function(){if(!this.selected&&this.items.length==0){return}if(!this.selected&&this.items.length!=0){var a=-1}else{var a=0;while(this.items[a]!=this.selected){a++}}if(a!=this.items.length-1){this.selected=this.items[a+1];this.bus.fire("itemselected",{container:this,item:this.selected},this);this.repaint()}},getItemForPosition:function(d){d.y+=this.scrollTop;var c=this.getInsets().top;if(this.label){c+=this.label.bounds.height}for(var a=0;a<this.items.length;a++){var b=this.heights[a];if(d.y>=c&&d.y<=c+b){return this.items[a]}c+=b}},getItemText:function(a){if(a.text){return a.text}if(th.isString(a)){return a}return a.toString()},getRenderer:function(a){this.renderer.text=this.getItemText(a.item);this.renderer.selected=a.selected;this.renderer.pseudoClass=(this.renderer.selected)?"active":undefined;this.renderer.item=a.item;this.renderer.className=a.even?"even":"odd";if(a.item.contents){this.renderer.className+="more"}this.renderer.resolveCss();return this.renderer},getRenderContext:function(a,b){return{item:a,even:b%2==0,selected:this.selected===a}},getRowHeight:function(){if(!this.rowHeight){var c=this.d();var b=(this.items.length>0)?this.items[0]:undefined;if(b){var a=this.getRenderer(this.getRenderContext(b,0));this.rowHeight=a.getPreferredSize().height}}return this.rowHeight||0},layout:function(){},paint:function(p){var j=this.d();var f=Math.max(this.getPreferredSize().height,j.b.h);var m=j.i.t;if(this.label){this.label.addCss("visibility","visible");var i=this.label.getPreferredSize().height;this.label.bounds={y:m,x:j.i.l,height:i,width:j.b.w};this.label.paint(p);this.label.border.paint(p);m+=i;this.label.addCss("visibility","hidden")}p.save();p.translate(-this.scrollLeft,-this.scrollTop);try{this.paintBackground(p,0,m,j.b.w,f);if(this.items.length==0){return}if(!this.renderer){console.log("No renderer for List of type "+this.type+" with id "+this.id+"; cannot paint contents");return}this.heights=[];var b=0;while(m<f&&b<this.items.length){var c=(b<this.items.length);var o=c?this.items[b]:"";var a=this.getRenderer(this.getRenderContext(o,b));if(!a){break}var n=j.b.w-j.i.w;var g=(this.rowHeight)?this.rowHeight:(c)?a.getPreferredSize().height:this.heights[this.heights.length-1];if(c){this.heights.push(g)}if((m+g)>=this.scrollTop){a.bounds={x:0,y:0,height:g,width:n};p.save();p.translate(j.i.l,m);p.beginPath();p.rect(0,0,n,g);p.closePath();p.clip();a.addCss("visibility","visible");a.paint(p);a.border.paint(p);a.addCss("visibility","hidden");p.restore()}b++;m+=g}}finally{p.restore()}}}});th.ScrollPane=Class.define({type:"ScrollPane",superclass:th.Panel,members:{init:function(a){if(!a){a={}}this._super(a);this.hscroll=new th.HorizontalScrollbar();this.vscroll=new th.VerticalScrollbar();this.bus.bind("scroll",this.hscroll,this.hscrolled,this);this.bus.bind("scroll",this.vscroll,this.vscrolled,this);this.hscroll_c=this.hscroll;this.vscroll_c=this.vscroll;if(a.splitter){this.vsplitter=new th.VerticalSplitter({scrollbar:this.vscroll});this.vscroll_c=this.vsplitter;this.bus.bind("dragstart",this.vsplitter,this.ondragstart,this);this.bus.bind("drag",this.vsplitter,this.ondrag,this);this.bus.bind("dragstop",this.vsplitter,this.ondragstop,this)}this.viewport=new th.Panel();this.viewport.layout=function(){};this.children=[this.viewport,this.hscroll_c,this.vscroll_c];this.viewport.parent=this;this.hscroll_c.parent=this;this.vscroll_c.parent=this},performScroll:function(a){l=this.vscroll_c.scrollbar;this.vscroll_c.scrollbar.setValue(this.vscroll_c.scrollbar.value-a.delta*100);th.stopEvent(a)},ondragstart:function(a){if(this.preferredWidth==undefined){this.preferredWidth=this.bounds.width}this.startSize=this.preferredWidth},ondrag:function(a){var b=a.currentPos.x-a.startPos.x;this.preferredWidth=this.startSize+b;this.getScene().render()},ondragstop:function(a){delete this.startSize},hscrolled:function(a){this.viewport.scrollLeft=a.value;this.getScene().render()},vscrolled:function(a){this.viewport.scrollTop=a.value;this.getScene().render()},add:function(a){if(th.isArray(a)){a=a[0]}this.view=a;this.viewport.add(this.view)},remove:function(a){if(this.view==a){this.viewport.remove(a);this.view=undefined}},getPreferredSize:function(){if(this.preferredWidth&&this.preferredHeight){return{width:this.preferredWidth,height:this.preferredHeight}}var a;if(this.view){a=this.view.getPreferredSize()}else{a=this._super()}if(this.preferredWidth){a.width=this.preferredWidth}if(this.preferredHeight){a.height=this.preferredHeight}return a},layout:function(){var n=this.view;if(!n){return}var j=this.d();this.viewport.setBounds(j.i.l,j.i.t,j.b.iw,j.b.ih);var r=n.getPreferredSize();var m=Math.max(r.width,this.viewport.bounds.width);var p=Math.max(r.height,this.viewport.bounds.height);var g=this.cssValue("overflow-x")!="hidden";var f=this.cssValue("overflow-y")!="hidden";if(!g){m=this.viewport.bounds.width}if(!f){p=this.viewport.bounds.height}n.setBounds(-this.viewport.scrollLeft,-this.viewport.scrollTop,m,p);if(!f&&!g){return}var c=n.bounds;var q=this.hscroll_c.getPreferredSize();var a=this.vscroll_c.getPreferredSize();var b=false;var o=false;if((c.width>j.b.iw)&&g){b=true}if((c.height>(j.b.ih-(b?q.height:0)))&&f){o=true}var i=(b||this.hsplitter);var h=(o||this.vsplitter);if(i){this.hscroll_c.addCss("visibility","visible");this.hscroll_c.setBounds(j.i.l,(j.i.t+j.b.ih)-q.height,j.b.iw,q.height);this.viewport.bounds.height-=this.hscroll_c.bounds.height;if(!h){n.bounds.height-=this.hscroll_c.bounds.height}if(b){this.hscroll.min=0;this.hscroll.max=c.width-this.viewport.bounds.width;this.hscroll.extent=this.hscroll.max/c.width;this.hscroll.addCss("visibility","visible")}else{this.hscroll.max=0;this.hscroll.addCss("visibility","hidden")}}else{this.hscroll_c.addCss("visibility","hidden")}if(h){this.vscroll_c.addCss("visibility","visible");this.vscroll_c.setBounds((j.i.l+j.b.iw)-a.width,j.i.t,a.width,j.b.ih);this.viewport.bounds.width-=this.vscroll_c.bounds.width;if(!i){n.bounds.width-=this.vscroll_c.bounds.width}if(o){this.vscroll.min=0;this.vscroll.max=c.height-this.viewport.bounds.height;this.vscroll.extent=this.vscroll.max/c.height;this.vscroll.addCss("visibility","visible")}else{this.vscroll.max=0;this.vscroll.addCss("visibility","hidden")}}else{this.vscroll_c.addCss("visibility","hidden")}if(b&&o){this.hscroll_c.bounds.width-=this.vscroll_c.bounds.width}else{if(!b){n.bounds.x=0;this.viewport.scrollLeft=0;this.hscroll.value=0}if(!o){n.bounds.y=0;this.viewport.scrollTop=0;this.vscroll.value=0}}}}});th.HorizontalTree=Class.define({type:"HorizontalTree",superclass:th.Panel,members:{init:function(b){if(!b){b={}}this._super(b);this.scrollPane=new th.ScrollPane();this.add(this.scrollPane);this.contents=new th.Panel();this.scrollPane.add(this.contents);var a=this;this.contents.getPreferredSize=function(){var c=0;var d=0;var f;th.forEach(a.scrollPanes,function(h){if(!h.preferredWidth){if(f==undefined){f=th.convertLengthToPixels(a.cssValue("-th-list-width"),a)}c+=f}else{c+=h.preferredWidth}var g=h.getPreferredSize().height;if(g>d){d=g}});return{height:d,width:c}};this.contents.layout=function(){var h=this.d();var f=h.i.l;for(var g=0;g<a.scrollPanes.length;g++){var c=a.scrollPanes[g];if(!c.preferredWidth){c.preferredWidth=th.convertLengthToPixels(a.cssValue("-th-list-width"),a)}c.bounds={x:f,y:h.i.t,width:c.preferredWidth,height:h.b.h-h.i.h};f+=c.bounds.width}if(a.details){a.details.bounds={x:f,y:h.i.t,width:th.convertLengthToPixels(a.cssValue("-th-default-width"),a),height:h.b.h-h.i.h}}};this.orientation=th.HORIZONTAL;this.scrollPanes=[]},setData:function(b){for(var a=0;a<this.scrollPanes.length;a++){this.contents.remove(this.scrollPanes[a]);if(this.scrollPanes[a].view){this.bus.unbind(this.scrollPanes[a].view)}}this.scrollPanes=[];this.data=b;this.showChildren(null,b)},updateData:function(a,b){a.contents=b;if(this.getSelectedItem()==a){this.showChildren(a,a.contents)}},replaceList:function(a,b){this.scrollPanes[a].view.items=b;delete this.scrollPanes[a].view.selected;this.render()},removeListsFrom:function(b){for(var a=b;a<this.scrollPanes.length;a++){this.bus.unbind(this.scrollPanes[a].view);this.remove(this.scrollPanes[a])}this.scrollPanes=this.scrollPanes.slice(0,b)},showChildren:function(d,c){if(this.details){this.contents.remove(this.details);delete this.details}if(!th.isArray(c)){c(this.getSelectedPath(),this);this.render();return}if(!c||c.length==0){return}var f=this.createList(c);if(this.id){f.id=this.id+"-list-"+(this.scrollPanes.length+1)}this.bus.bind("itemselected",f,this.itemSelected,this);var b=this;this.bus.bind("dblclick",f,function(g){b.bus.fire("dblclick",g,b)});var a=new th.ScrollPane({splitter:true});a.add(f);this.scrollPanes.push(a);this.contents.add(a);if(this.parent){this.render()}if(this.scrollPane.hscroll.max!=0){this.scrollPane.hscroll.setValue(this.scrollPane.hscroll.max)}},showDetails:function(a){if(this.details){this.contents.remove(this.details)}if(this.parent){this.render()}},createList:function(b){var c=new th.List({items:b});var d=c.getItemText;var a=this;c.getItemText=function(f){if(a.getItemText){return a.getItemText(f)}else{return d(f)}};return c},getSelectedItem:function(){var a=this.getSelectedPath();if(a.length>0){return a[a.length-1]}},getSelectedPath:function(c){c=c||false;var d=[];var b;for(b=0;b<this.scrollPanes.length;b++){if(this.scrollPanes[b].view.selected){d.push(this.scrollPanes[b].view.selected)}else{break}}if(d.length==0){return}if(c){var a="";for(b=0;b<d.length-1;b++){a+=this.getItemText(d[b])+"/"}if(!d[d.length-1].contents){a+=this.getItemText(d[d.length-1])}else{a+=this.getItemText(d[d.length-1])+"/"}return a}else{return d}},itemSelected:function(h){var f=h.thComponent;if(!f.selected){return}var g=[];for(var c=0;c<this.scrollPanes.length;c++){g.push(this.scrollPanes[c].view.selected);if(this.scrollPanes[c].view==f){for(var a=c+1;a<this.scrollPanes.length&&this.scrollPanes[a].view.selected;a++){if(this.scrollPanes[a-1].view.selected){this.scrollPanes[a-1].view.selected.lastSelected=this.scrollPanes[a].view.selected.name}delete this.scrollPanes[a].view.selected}break}}this.bus.fire("itemselected",{e:h},this);if(g.length<this.scrollPanes.length){var d=this.scrollPanes.slice(0,g.length);for(var m=g.length;m<this.scrollPanes.length;m++){this.contents.remove(this.scrollPanes[m]);this.bus.unbind(this.scrollPanes[m].view)}this.scrollPanes=d}var b=g[g.length-1];if(b&&b.contents){this.showChildren(b,b.contents)}else{this.showDetails(b)}},getItem:function(c){var a=this.data;var d;for(var b=0;b<c.length;b++){for(var f=0;f<a.length;f++){if(a[f]==c[b]){d=a[f];a=d.contents;break}}}return d},getList:function(a){var b=this.scrollPanes[a];if(b!=undefined){return b.view}else{return undefined}},getListCount:function(){return this.scrollPanes.length},layout:function(){var a=this.d();this.scrollPane.setBounds(a.i.l,a.i.t,a.b.iw,a.b.ih)},paintSelf:function(a){this._super(a)}}});th.DEFAULT_CSS="* {/* this should probably be the browser's default font */font: 10pt Arial, sans-serif;}VerticalScrollbar {-th-top-image: url(/images/scroll_gutter_top.png);-th-middle-image: url(/images/scroll_gutter_mid.png);-th-bottom-image: url(/images/scroll_gutter_btm.png);}VerticalScrollbar > Button.bar {-th-top-image: url(/images/scroll_thumb_top.png);-th-middle-image: url(/images/scroll_thumb_mid.png);-th-bottom-image: url(/images/scroll_thumb_btm.png);}VerticalScrollbar > Button.up {background-image: url(/images/scroll_cntrl_up.png);}VerticalScrollbar > Button.down {background-image: url(/images/scroll_cntrl_dwn.png);}HorizontalScrollbar {-th-top-image: url(/images/h_scroll_gutter_btm.png);-th-middle-image: url(/images/h_scroll_gutter_mid.png);-th-bottom-image: url(/images/h_scroll_gutter_top.png);}HorizontalScrollbar > Button.bar {-th-top-image: url(/images/h_scroll_thumb_btm.png);-th-middle-image: url(/images/h_scroll_thumb_mid.png);-th-bottom-image: url(/images/h_scroll_thumb_top.png);}HorizontalScrollbar > Button.up {background-image: url(/images/h_scroll_cntrl_up.png);}HorizontalScrollbar > Button.down {background-image: url(/images/h_scroll_cntrl_dwn.png);}ResizeNib {-th-vertical-bar-color: rgb(10, 10, 8);-th-vertical-bar-shadow-color: rgb(185, 180, 158);-th-horizontal-bar-subtle-shadow-color: rgba(0, 0, 0, 0.1);-th-horizontal-bar-shadow-color: black;-th-horizontal-bar-color: rgb(183, 180, 160);}Label {padding: 2px 5px;color: black;}List Label:active {border-top: 1px solid rgb(180, 114, 30);border-bottom: 1px solid rgb(162, 97, 19);background-image: -webkit-gradient(linear, left top, left bottom, from(#AF6814), to(#DE8419));}HorizontalTree {-th-list-width: 160px;-th-details-width: 150px;}Splitter.vertical {height: 20px;}Splitter.horizontal {width: 17px;}Button {background-color: gray;}TextButton {text-align: center;}HorizontalTree List {background-color: inherit;}List {background-color: white;}List Label:active {background-color: blue;}ScrollPane {background-color: #413F37;border: 1px solid black;}HorizontalTree > ScrollPane {overflow-y: hidden;}HorizontalTree ScrollPane {border: 0;}HorizontalTree Panel {background-color: blue;}HorizontalTree {border: 1px solid black;";if(typeof th=="undefined"){th={}}th.Settings=Class.define({members:{init:function(){this.settings={tabSize:4,strictlines:true,smartmove:true}},get:function(a){return this.settings[a]},isSettingOn:function(a){var b=this.settings[a];return(b===true)||(b==="on")||(b==="enable")}}});th.global_settings=new th.Settings();if(typeof th.Editor=="undefined"){th.Editor={}}th.Editor.Template=Class.define({type:"Editor::Template",superclass:th.Panel,uses:[th.KeyHelpers],members:{init:function(a){this._super(a);this.model=new th.Editor.Model(this);this.cursor=new th.Editor.Cursor(this);this.actions=new th.Editor.Actions(this);this.vscroll=new th.VerticalScrollbar();this.add(this.vscroll);this.leftPadding=0;this.rightPadding=0;this.scrollTop=0;this.bus.bind("scroll",this.vscroll,this.vscrolled,this);this.bus.bind("editor:model:model_changed",this,this.onModelChange,this);this.bus.bind("keypress",this,this.onKeyPress,this);this.key.bind("",this.key.ARROW_RIGHT,this.execAction("moveCursorRight"),this.actions);this.key.bind("",this.key.ARROW_LEFT,this.execAction("moveCursorLeft"),this.actions);this.key.bind("",this.key.ARROW_UP,this.execAction("moveCursorUp"),this.actions);this.key.bind("",this.key.ARROW_DOWN,this.execAction("moveCursorDown"),this.actions);this.key.bind("",this.key.BACKSPACE,this.execAction("backspace"),this.actions);this.key.bind("",this.key.DELETE,this.execAction("deleteKey"),this.actions);this.key.bind("",this.key.ENTER,this.execAction("newline"),this.actions);this.key.setupEvents(this);this.NoWL=[];this.selection=undefined},vscrolled:function(a){this.scrollTop=a.value;this.repaint()},onModelChange:function(b){var a;var c=0;for(var d=0;d<this.model.getRowCount();d++){a=this.model.getMetaRowLength(d);this.NoWL[d]=(a==0)?1:Math.ceil(a/this.CpL);c+=this.NoWL[d]}this.vscroll.min=0;this.vscroll.max=c*this.charSize.height-this.d().b.ih;this.vscroll.extent=this.vscroll.max/this.d().b.ih;this.vscroll.addCss("visibility","visible")},updateScrollbar:function(){this.vscroll.value=this.scrollTop;this.vscroll.layout();this.vscroll.repaint()},execAction:function(a){if(this.actions[a]===undefined){return function(b){}}return th.hitch(this,function(c){var b={event:c,pos:th.clone(this.cursor.getCursorPosition())};this.actions[a](b)})},onKeyPress:function(c){var a=this.key.getPrintableChar(c);if(a){var b={event:c,pos:th.clone(this.cursor.getCursorPosition()),newchar:a};this.actions.insertCharacter(b)}},getSelection:function(){return this.selection},setSelection:function(a){this.selection=a},getScrollInfo:function(){return{scrollTop:this.scrollTop,scrollHeight:this.getRowCount()*this.charSize.height}},layout:function(){if(this.font===undefined){this.font=this.cssValue("font");var a=this.getScratchContext();a.font=this.font;this.charSize=a.measureText("M");this.charSize.height=Math.ceil(this.charSize.ascent*2.8)}if(this.color===undefined){this.color=this.cssValue("color")}var b=this.d();this.vscroll.bounds={x:b.b.w-14,y:0,height:b.b.h,width:14};this.effw=b.b.iw-this.leftPadding-this.rightPadding;this.CpL=Math.floor(this.effw/this.charSize.width);this.LpP=Math.ceil(b.b.ih/this.charSize.height);this.bus.fire("editor:model:model_changed",{},this)},paintText:function(o){var v=this.d();var a=this.CpL*this.charSize.width;var m=this.LpP*this.charSize.height;var c=this.getFirstVisibleRow(this.scrollTop);var n=this.getFirstVisibleRow(this.scrollTop+v.b.ih);var f=-1;var p;for(var q=0;q<(n.row-c.row);q++){p=this.rowLength(q);if(p>f){f=p}}f=a*Math.ceil(f/a);var w=this.getScratchContext();w.canvas.height=v.b.ih*2;w.canvas.width=Math.max(f*this.charSize.width,v.b.w)*2;w.translate(0,this.charSize.height*0.75);w.font=this.font;w.fillStyle=this.color;for(var q=c.row;q<=n.row;q++){this.paintRow(w,q);if(this.options.wrap){w.translate(0,this.NoWL[q]*this.charSize.height)}else{w.translate(0,this.charSize.height)}}o.translate(this.leftPadding,0-c.offset);if(this.options.wrap){var h=0,g=0,j=a,u=m;var s=0,r=0,t=a,b=m;while(h<(f*this.charSize.width)){o.drawImage(w.canvas,h,g,j,u,s,r,t,b);h+=a;r+=this.charSize.height}}else{o.drawImage(w.canvas,0,0,a,m,0,0,a,m)}},paintSelf:function(a){if(this.model.isEmpty()){return}a.save();this.paintUnderText(a);a.restore();a.save();this.paintText(a);a.restore();a.save();this.paintOverText(a);a.restore()},adjustScrollTop:function(){var f=this.cursor.getCursorPosition();var b=0;if(this.options.wrap){for(var d=0;d<f.row;d++){b+=this.NoWL[d]}b+=Math.floor(f.col/this.CpL)}else{b=f.row}var c=b*this.charSize.height;var a=c+this.charSize.height;if(c<this.scrollTop){this.scrollTop=c}else{if(a>(this.scrollTop+this.LpP*this.charSize.height)){this.scrollTop=a-this.LpP*this.charSize.height}}},getRowCount:function(){},paintRow:function(a,d){var b=this.model.getMetaRowString(d);a.fillText(b,0,0);var c=this.cursor.getCursorPosition();if(c.row==d){a.fillRect(c.col*this.charSize.width,-this.charSize.height*0.75,1,this.charSize.height)}},paintUnderText:function(a){},paintOverText:function(a){},getFirstVisibleRow:function(c){if(c===undefined){c=this.scrollTop}var b;if(!this.options.wrap){b=Math.floor(c/this.charSize.height);return{row:b,offset:c-b*this.charSize.height}}else{var a=0;b=0;while((a+=this.NoWL[b]*this.charSize.height)<c){b++}return{row:b,offset:c-a+this.NoWL[b]*this.charSize.height}}},rowLength:function(a){return this.model.getMetaRowLength(a)}}});th.SimpleEditor=Class.define({type:"SimpleEditor",superclass:th.Editor.Template,members:{init:function(a){this._super(a);this.rightPadding=20;this.leftPadding=30;this.options={};this.options.wrap=(a.wrap===undefined)?false:(a.wrap=="true")},paintUnderText:function(a){a.fillStyle="#A9F4CF";a.fillRect(0,0,this.leftPadding-5,this.d().b.ih);a.fillStyle="white";a.fillRect(this.leftPadding-5,0,this.d().b.iw-this.leftPadding+5,this.d().b.ih)}}});th.Editor.Model=Class.define({type:"Editor::Model",members:{init:function(a){this.editor=a;this.rows=[];this.cacheRowMetadata=[]},isEmpty:function(){if(this.rows.length>1){return false}if(this.rows.length==1&&this.rows[0].length>0){return false}return true},getDirtyRows:function(){var a=(this.dirtyRows)?this.dirtyRows:[];this.dirtyRows=null;return a},setRowDirty:function(a){if(!this.dirtyRows){this.dirtyRows=new Array(this.rows.length)}this.dirtyRows[a]=true},isRowDirty:function(a){if(!this.dirtyRows){return true}return this.dirtyRows[a]},setRowArray:function(b,a){if(!th.isArray(a)){a=a.split("")}this.rows[b]=a},getRowArray:function(a){while(this.rows.length<=a){this.rows.push([])}return this.rows[a]},getRowLength:function(a){if(a<0||a>=this.rows.length){return 0}return this.rows[a].length},hasRow:function(a){return(this.rows[a])},insertCharacters:function(a,b){var d=this.getRowArray(a.row);while(d.length<a.col){d.push(" ")}var c=(a.col>0)?d.splice(0,a.col):[];c=c.concat(b.split(""));this.rows[a.row]=c.concat(d);this.setRowDirty(a.row);this.invalidateSyntaxCache(a.row)},getDocument:function(){var b=[];for(var a=0;a<this.getRowCount();a++){b[a]=this.getRowArray(a).join("")}return b.join("\n")},insertDocument:function(b){this.clear();var c=b.split("\n");for(var a=0;a<c.length;a++){this.insertCharacters({row:a,col:0},c[a])}},changeEachRow:function(b){for(var a=0;a<this.getRowCount();a++){var c=this.getRowArray(a);c=b(c);this.setRowArray(a,c)}},replace:function(f,d){var g=new RegExp(f,"g");for(var a=0;a<this.getRowCount();a++){var b=this.getRowArray(a).join("");var c=b.replace(g,d);if(c!=b){this.rows[a]=c.split("")}}},deleteCharacters:function(a,b){var d=this.getRowArray(a.row);var c=(a.col+b-1)-d.length;if(c>0){b-=c}if(b>0){this.setRowDirty(a.row);this.invalidateSyntaxCache(a.row);return d.splice(a.col,b).join("")}return""},clear:function(){this.rows=[];this.cacheRowMetadata=[]},deleteRows:function(c,a){var b=(c+a-1)-this.rows.length;if(b>0){a-=b}if(a>0){this.rows.splice(c,a);this.cacheRowMetadata.splice(c,a)}},splitRow:function(a,d){this.invalidateSyntaxCache(a.row);this.setRowDirty(a.row);var g=this.getRowArray(a.row);var b;if(d&&d.length>0){b=d}else{b=[]}if(a.col<g.length){b=b.concat(g.splice(a.col))}if(a.row==(this.rows.length-1)){this.rows.push(b)}else{var c=this.rows.splice(0,a.row+1);c.push(b);c=c.concat(this.rows);this.rows=c;var f=this.cacheRowMetadata.splice(0,a.row+1);f.push(undefined);this.cacheRowMetadata=f.concat(this.cacheRowMetadata)}},joinRow:function(d,a){this.invalidateSyntaxCache(d);this.setRowDirty(d);if(d>=this.rows.length-1){return}var c=this.getRowArray(d);var b=this.rows[d+1];if(typeof a!="undefined"){b.splice(0,a)}this.rows[d]=c.concat(b);this.rows.splice(d+1,1);this.cacheRowMetadata.splice(d+1,1)},getRowCount:function(){return this.rows.length},getChunk:function(d){var c=d.startPos;var f=d.endPos;var h,j;var a="";h=c.col;var g=this.getRowArray(c.row);j=(f.row==c.row)?f.col:g.length;if(j>g.length){j=g.length}a+=g.join("").substring(h,j);for(var b=c.row+1;b<f.row;b++){a+="\n";a+=this.getRowArray(b).join("")}if(c.row!=f.row){h=0;j=f.col;g=this.getRowArray(f.row);if(j>g.length){j=g.length}a+="\n"+g.join("").substring(h,j)}return a},deleteChunk:function(c){var a=this.getChunk(c);var b=c.startPos;var d=c.endPos;this.invalidateSyntaxCache(b.row);var g,h;g=b.col;var f=this.getRowArray(b.row);h=(d.row==b.row)?d.col:f.length;if(h>f.length){h=f.length}this.deleteCharacters({row:b.row,col:g},h-g);if(b.row!=d.row){g=0;h=d.col;f=this.getRowArray(d.row);if(h>f.length){h=f.length}this.deleteCharacters({row:d.row,col:g},h-g)}if((d.row-b.row)>1){this.deleteRows(b.row+1,d.row-b.row-1)}if(d.row!=b.row){this.joinRow(b.row)}return a},insertChunk:function(b,d){this.invalidateSyntaxCache(b.row);var c=d.split("\n");var a=th.clone(b);for(var f=0;f<c.length;f++){this.insertCharacters(a,c[f]);a.col=a.col+c[f].length;if(f<c.length-1){this.splitRow(a);a.col=0;a.row=a.row+1}}return a},getRowMetadata:function(n){if(!this.isRowDirty(n)&&this.cacheRowMetadata[n]){return this.cacheRowMetadata[n]}var m={tabExpansions:[]};var h=this.editor.model.getRowArray(n);var i=h.join("");var b=th.global_settings.get("tabSize");m.lineTextWithoutTabExpansion=i;m.lineLengthWithoutTabExpansion=h.length;for(var a=0;a<i.length;a++){if(i.charCodeAt(a)==9){var f=b-(a%b);var g="";for(var d=1;d<f;d++){g+=" "}var c=(a==0)?"":i.substring(0,a);var j=(a<i.length-1)?i.substring(a+1):"";i=c+" "+g+j;m.tabExpansions.push({start:c.length,end:c.length+g.length+1});a+=f-1}}m.lineText=i;if(this.editor.searchString){m.searchIndices=this.getStringIndicesInRow(n,this.editor.searchString)}else{m.searchIndices=false}this.cacheRowMetadata[n]=m;return m},invalidateSyntaxCache:function(a){if(typeof this.editor.syntaxModel!="undefined"&&th.isFunction(this.editor.syntaxModel.invalidateCache)){this.editor.syntaxModel.invalidateCache(a)}},getMetaRowString:function(a){return this.getRowMetadata(a).lineText},getMetaRowLength:function(a){return this.getRowMetadata(a).lineText.length}}});th.Editor.Cursor=Class.define({type:"Editor::Cursor",members:{init:function(a){this.model=a.model;this.editor=a;this.position={row:0,col:0};this.virtualCol=0},getCursorPosition:function(b){if(b!=undefined){var h=th.clone(b);var c=this.model.getRowArray(h.row);var a=th.global_settings.get("tabSize");if(c.indexOf("\t")!=-1){var f=0,g=0;for(var d=0;d<b.col;d++){if(c[d]=="\t"){h.col+=a-1-(g%a);f++;g=0}else{g++;f=0}}}return h}else{return this.position}},getModelPosition:function(h){h=(h!=undefined)?h:this.position;var b=th.clone(h);var c=this.model.getRowArray(h.row);var a=th.global_settings.get("tabSize");if(c.indexOf("\t")!=-1){var f=0,g=0;for(var d=0;d<b.col;d++){if(c[d]=="\t"){b.col-=a-1-(g%a);f++;g=0}else{g++;f=0}}}return b},getCharacterLength:function(c,b){if(c.length>1){return}if(b==undefined){b=this.position.col}if(c=="\t"){var a=th.global_settings.get("tabSize");return(a-(b%a))}else{return 1}},getStringLength:function(c){if(!c||c.length==0){return 0}var b=0;c=c.split("");for(var a=0;a<c.length;a++){b+=this.getCharacterLength(c[a],b)}return b},getLeadingWhitespace:function(c){var b=this.model.getRowArray(c).join("");var a=/^(\s+).*/.exec(b);return(a&&a.length==2?this.getStringLength(a[1]):0)},getContinuousSpaceCount:function(g,h,d){d=d||this.position.row;var b=th.global_settings;var j=this.model.getRowArray(d);var i=(g<h?1:-1);var a=j.length;g=g+(i==1?0:-1);h=h+(i==1?0:-1);g=this.getModelPosition({col:g,row:d}).col;h=this.getModelPosition({col:h,row:d}).col;if(b.isSettingOn("strictlines")){g=Math.min(g,a);h=Math.min(h,a)}var c=0;for(var f=g;f!=h;f+=i){if(f<a){if(j[f]!=" "){break}}c++}return c},getNextTablevelLeft:function(b){var a=th.global_settings.get("tabSize");b=b||this.position.col;b--;return Math.floor(b/a)*a},getNextTablevelRight:function(b){var a=th.global_settings.get("tabSize");b=b||this.position.col;b++;return Math.ceil(b/a)*a},moveToLineStart:function(){var b=th.clone(this.position);var a=this.getLeadingWhitespace(b.row);if(this.position.col==0){this.moveCursor({col:a})}else{if(this.position.col==a){this.moveCursor({col:0})}else{if(a!=this.model.getMetaRowLength(this.getCursorPosition().row)){this.moveCursor({col:a})}else{this.moveCursor({col:0})}}}return{oldPos:b,newPos:th.clone(this.position)}},moveToLineEnd:function(){var a=th.clone(this.position);this.moveCursor({col:this.model.getMetaRowLength(a.row)});return{oldPos:a,newPos:th.clone(this.position)}},moveToTop:function(){var a=th.clone(this.position);this.moveCursor({row:0,col:0});return{oldPos:a,newPos:th.clone(this.position)}},moveToBottom:function(){var a=th.clone(this.position);var b=this.editor.getRowCount()-1;this.moveCursor({row:b,col:this.model.getMetaRowLength(b)});return{oldPos:a,newPos:th.clone(this.position)}},moveUp:function(){var c=th.global_settings;var b=this.editor.getSelection();var a=th.clone(this.position);var d=this.virtualCol;this.moveCursor({row:a.row-1,col:Math.max(a.col,this.virtualCol)});if(c.isSettingOn("strictlines")&&this.position.col>this.model.getMetaRowLength(this.position.row)){this.moveToLineEnd();this.virtualCol=Math.max(a.col,d)}return{oldPos:a,newPos:th.clone(this.position)}},moveDown:function(){var c=th.global_settings;var b=this.editor.getSelection();var a=th.clone(this.position);var d=this.virtualCol;this.moveCursor({row:Math.max(0,a.row+1),col:Math.max(a.col,this.virtualCol)});if(c.isSettingOn("strictlines")&&this.position.col>this.model.getMetaRowLength(this.position.row)){this.moveToLineEnd();this.virtualCol=Math.max(a.col,d)}return{oldPos:a,newPos:th.clone(this.position)}},moveLeft:function(d){var g=th.global_settings;var b=g.get("tabSize");var c=th.clone(this.position);var f=(d.event?d.event.shiftKey:false);if(!this.editor.getSelection()||f){if(g.isSettingOn("smartmove")){var a=this.getContinuousSpaceCount(c.col,this.getNextTablevelLeft());if(a==b){this.moveCursor({col:c.col-a});return{oldPos:c,newPos:th.clone(this.position)}}}if(g.isSettingOn("strictlines")&&(this.position.col==0)){this.moveUp();if(c.row>0){this.moveToLineEnd()}}else{this.moveCursor({row:c.row,col:Math.max(0,c.col-1)})}}else{this.moveCursor(this.editor.getSelection().startPos)}return{oldPos:c,newPos:th.clone(this.position)}},moveRight:function(d){var g=th.global_settings;var b=g.get("tabSize");var c=th.clone(this.position);var f=(d.event?d.event.shiftKey:false);if(!this.editor.getSelection()||f){if(g.isSettingOn("smartmove")&&d!=true){var a=this.getContinuousSpaceCount(c.col,this.getNextTablevelRight());if(a==b){this.moveCursor({col:c.col+a});return{oldPos:c,newPos:th.clone(this.position)}}}if(g.isSettingOn("strictlines")&&(this.position.col>=this.model.getMetaRowLength(this.position.row))){this.moveDown();if(c.row<this.model.getRowCount()-1){this.moveCursor({col:0})}}else{this.moveCursor({col:this.position.col+1})}}else{this.moveCursor(this.editor.getSelection().endPos)}return{oldPos:c,newPos:th.clone(this.position)}},movePageUp:function(){},movePageDown:function(){},smartMoveLeft:function(){var d=th.clone(this.position);var f=this.model.getMetaRowString(d.row);var h,b;if(this.position.col==0){this.moveUp();this.moveToLineEnd()}else{if(f.length<this.position.col){this.moveToLineEnd()}var a=this.position.col;var g=false;while(a>0){a--;h=f.charAt(a);b=h.charCodeAt(0);if(b==32){g=true}else{a++;break}}if(!g){while(a>0){a--;h=f.charAt(a);b=h.charCodeAt(0);if((b<65)||(b>122)){if(a!=this.position.col-1){a++}break}}}this.moveCursor({col:a})}return{oldPos:d,newPos:th.clone(this.position)}},smartMoveRight:function(){var d=th.clone(this.position);var f=this.getMetaRowString(d.row);if(f.length<=this.position.col){this.moveDown();this.moveToLineStart()}else{var h,b;var a=this.position.col;var g=false;while(a<f.length){h=f[a];b=h.charCodeAt(0);if(b==32){g=true;a++}else{break}}if(!g){while(a<f.length){a++;if(f.length==a){this.moveToLineEnd();a=-1;break}h=f[a];b=h.charCodeAt(0);if((b<65)||(b>122)){break}}}if(a!=-1){this.moveCursor({col:a})}}return{oldPos:d,newPos:th.clone(this.position)}},moveCursor:function(c){if(!c){return}if(c.col===undefined){c.col=this.position.col}if(c.row===undefined){c.row=this.position.row}this.virtualCol=0;var b=this.position;var d=Math.min(c.row,this.model.getRowCount()-1);if(d<0){d=0}var a=this.isInvalidCursorPosition(d,c.col);if(a){if(b.row!=c.row){c.col=a.right}else{if(b.col<c.col){c.col=a.right}else{if(b.col>c.col){c.col=a.left}else{c.col=a.right}}}}this.position={row:d,col:c.col}},isInvalidCursorPosition:function(j,c){var f=th.global_settings;var a=f.get("tabSize");var g=this.model.getRowArray(j);var h=0;for(var d=0;d<g.length;d++){if(g[d].charCodeAt(0)==9){var b=a-(h%a);if((c>h)&&(c<(h+b))){return{left:h,right:h+b,half:b/2}}h+=b-1}h++}return undefined}}});th.Editor.Actions=Class.define({members:{init:function(a){this.editor=a;this.model=a.model;this.cursorManager=a.cursor;this.ignoreRepaints=false},moveCursor:function(b,a){var c=this.cursorManager[b](a);this.repaint();a.pos=c.newPos;return a},moveCursorLeft:function(a){return this.moveCursor("moveLeft",a)},moveCursorRight:function(a){return this.moveCursor("moveRight",a)},moveCursorUp:function(a){return this.moveCursor("moveUp",a)},moveCursorDown:function(a){return this.moveCursor("moveDown",a)},moveToLineStart:function(a){return this.moveCursor("moveToLineStart",a)},moveToLineEnd:function(a){return this.moveCursor("moveToLineEnd",a)},moveToFileTop:function(a){return this.moveCursor("moveToTop",a)},moveToFileBottom:function(a){return this.moveCursor("moveToBottom",a)},movePageUp:function(a){return this.moveCursor("movePageUp",a)},movePageDown:function(a){return this.moveCursor("movePageDown",a)},moveWordLeft:function(a){return this.moveCursor("smartMoveLeft",a)},moveWordRight:function(a){return this.moveCursor("smartMoveRight",a)},backspace:function(c){var d=th.global_settings;if(this.editor.readonly){return}if(this.editor.selection){this.deleteSelection(c)}else{if(c.pos.col>0){if(d.isSettingOn("smartmove")){var b=d.get("tabSize");var a=this.cursorManager.getContinuousSpaceCount(c.pos.col,this.cursorManager.getNextTablevelLeft(c.pos.col));if(a==b){var f=c.pos;this.editor.selection={startPos:{row:f.row,col:f.col-b},endPos:{row:f.row,col:f.col}};this.deleteSelection(c);return}}this.cursorManager.moveCursor({col:Math.max(0,c.pos.col-1)});c.pos.col-=1;this.deleteCharacter(c)}else{c.joinDirection="up";this.joinLine(c)}}},deleteCharacter:function(c){if(this.editor.readonly){return}if(c.pos.col<this.model.getMetaRowLength(c.pos.row)){var b=this.cursorManager.getModelPosition(c.pos);var a=this.model.deleteCharacters(b,1);this.editor.bus.fire("editor:model:model_changed",{},this.editor);this.repaint()}},deleteSelection:function(b){if(this.editor.readonly||!this.editor.selection){return}var c;if(b.selection){c=b.selection}else{c=this.editor.getSelection()}var a=this.model.getChunk(c);this.model.deleteChunk(c);this.editor.setSelection(undefined);this.cursorManager.moveCursor(c.startPos);this.editor.bus.fire("editor:model:model_changed",{},this.editor);this.repaint();return a},joinLine:function(b){if(this.editor.readonly){return}if(b.joinDirection=="up"){if(b.pos.row==0){return}var a=this.model.getMetaRowLength(b.pos.row-1);this.model.joinRow(b.pos.row-1,b.autounindentSize);this.cursorManager.moveCursor({row:b.pos.row-1,col:a})}else{if(b.pos.row>=this.model.getRowCount()-1){return}this.model.joinRow(b.pos.row)}this.editor.bus.fire("editor:model:model_changed",{},this.editor);this.repaint()},deleteKey:function(c){var d=th.global_settings;if(this.editor.readonly){return}if(this.editor.selection){this.deleteSelection(c)}else{if(c.pos.col<this.model.getMetaRowLength(c.pos.row)){if(d.isSettingOn("smartmove")){var b=d.get("tabSize");var a=this.cursorManager.getContinuousSpaceCount(c.pos.col,this.cursorManager.getNextTablevelRight(c.pos.col));if(a==b){var f=c.pos;this.editor.selection={startPos:{row:f.row,col:f.col},endPos:{row:f.row,col:f.col+b}};this.deleteSelection(c);return}}this.deleteCharacter(c)}else{c.joinDirection="down";this.joinLine(c)}}},deleteCharacter:function(c){if(this.editor.readonly){return}if(c.pos.col<this.model.getMetaRowLength(c.pos.row)){var b=this.cursorManager.getModelPosition(c.pos);var a=this.model.deleteCharacters(b,1);this.editor.bus.fire("editor:model:model_changed",{},this.editor);this.repaint()}},newline:function(b){if(this.editor.readonly){return}var f=th.global_settings;var g=th.leadingWhitespace(this.model.getRowArray(b.pos.row));var d=0,a=f.get("tabSize");for(var c=0;c<g.length;c++){if(g[c]==" "||g[c]==""||g[c]===undefined){d++}else{if(g[c]=="\t"){d+=a}else{break}}}this.model.splitRow(this.cursorManager.getModelPosition(b.pos),g);this.cursorManager.moveCursor({row:this.cursorManager.getCursorPosition().row+1,col:d});this.editor.bus.fire("editor:model:model_changed",{},this.editor);this.repaint()},insertCharacter:function(a){if(this.editor.readonly){return}if(this.editor.selection){this.deleteSelectionAndInsertCharacter(a)}else{this.model.insertCharacters(this.cursorManager.getModelPosition(a.pos),a.newchar);this.cursorManager.moveRight(true);this.editor.bus.fire("editor:model:model_changed",{},this.editor);this.repaint()}},repaint:function(){if(!this.ignoreRepaints){this.editor.adjustScrollTop();this.editor.updateScrollbar();this.editor.repaint()}}}});if(typeof th=="undefined"){th={}}th.Hashtable=(function(){function d(C){return(typeof C==="undefined")}function a(C){return(typeof C==="function")}function n(C){return(typeof C==="string")}function p(D,C){return a(D[C])}function y(C){return p(C,"equals")}function u(C){return p(C,"hashCode")}function A(D){if(n(D)){return D}else{if(u(D)){var C=D.hashCode();if(!n(C)){return A(C)}return C}else{if(p(D,"toString")){return D.toString()}else{return String(D)}}}}function x(C,D){return C.equals(D)}function f(C,D){if(y(D)){return D.equals(C)}else{return C===D}}function b(D,C){return D===C}function s(D,I,F,J,E){var H;for(var G=0,C=D.length;G<C;G++){H=D[G];if(E(I,F(H))){return J?[G,H]:true}}return false}function w(F,E){if(p(F,"splice")){F.splice(E,1)}else{if(E===F.length-1){F.length=E}else{var D=F.slice(E+1);F.length=E;for(var G=0,C=D.length;G<C;G++){F[E+G]=D[G]}}}}function B(D,C){if(D===null){throw new Error("null is not a valid "+C)}else{if(d(D)){throw new Error(C+" must not be undefined")}}}var j="key",c="value";function i(C){B(C,j)}function g(C){B(C,c)}function m(D,E,C){this.entries=[];this.addEntry(D,E);if(C!==null){this.getEqualityFunction=function(){return C}}}function z(C){return C[0]}function o(C){return C[1]}m.prototype={getEqualityFunction:function(C){if(y(C)){return x}else{return f}},searchForEntry:function(C){return s(this.entries,C,z,true,this.getEqualityFunction(C))},getEntryForKey:function(C){return this.searchForEntry(C)[1]},getEntryIndexForKey:function(C){return this.searchForEntry(C)[0]},removeEntryForKey:function(D){var C=this.searchForEntry(D);if(C){w(this.entries,C[0]);return true}return false},addEntry:function(C,D){this.entries[this.entries.length]=[C,D]},size:function(){return this.entries.length},keys:function(E){var F=E.length;for(var D=0,C=this.entries.length;D<C;D++){E[F+D]=this.entries[D][0]}},values:function(D){var F=D.length;for(var E=0,C=this.entries.length;E<C;E++){D[F+E]=this.entries[E][1]}},containsKey:function(C){return s(this.entries,C,z,false,this.getEqualityFunction(C))},containsValue:function(C){return s(this.entries,C,o,false,b)}};function v(){}v.prototype=[];function r(C){return C[0]}function h(E,C,D){return s(E,C,r,true,D)}function t(D,C){var E=D[C];if(E&&(E instanceof v)){return E[1]}return null}function q(E,D){var F=[];var C={};E=a(E)?E:A;D=a(D)?D:null;this.put=function(I,K){i(I);g(K);var G=E(I);var L=t(C,G);if(L){var H=L.getEntryForKey(I);if(H){H[1]=K}else{L.addEntry(I,K)}}else{var J=new v();J[0]=G;J[1]=new m(I,K,D);F[F.length]=J;C[G]=J}};this.get=function(I){i(I);var G=E(I);var J=t(C,G);if(J){var H=J.getEntryForKey(I);if(H){return H[1]}}return null};this.containsKey=function(H){i(H);var G=E(H);var I=t(C,G);if(I){return I.containsKey(H)}return false};this.containsValue=function(I){g(I);for(var H=0,G=F.length;H<G;H++){if(F[H][1].containsValue(I)){return true}}return false};this.clear=function(){F.length=0;C={}};this.isEmpty=function(){return F.length===0};this.keys=function(){var I=[];for(var H=0,G=F.length;H<G;H++){F[H][1].keys(I)}return I};this.values=function(){var H=[];for(var I=0,G=F.length;I<G;I++){F[I][1].values(H)}return H};this.remove=function(I){i(I);var H=E(I);var J=t(C,H);if(J){if(J.removeEntryForKey(I)){if(J.size()===0){var G=h(F,H,J.getEqualityFunction(I));w(F,G[0]);delete C[H]}}}};this.size=function(){var I=0;for(var H=0,G=F.length;H<G;H++){I+=F[H][1].size()}return I}}return q})();th.FirefoxBorder=Class.define({type:"Border",uses:[th.ComponentHelpers,th.BorderHelpers,th.ColorHelpers],members:{SIDES:["top","right","bottom","left"],CORNERS:["top-left","top-right","bottom-right","bottom-left"],TOP:0,TOP_LEFT:0,RIGHT:1,TOP_RIGHT:1,BOTTOM:2,BOTTOM_RIGHT:2,LEFT:3,BOTTOM_LEFT:3,BIT_TOP:1,BIT_RIGHT:2,BIT_BOTTOM:4,BIT_LEFT:8,init:function(a){this.component=a;this.outerRect={x:0,y:0,w:0,h:0};this.innerRect={x:0,y:0,w:0,h:0};this.borderStyles=[];this.borderWidths=[];this.borderRadii=[];this.borderColors=[];this.borderColorsDark=[];this.borderColorsLight=[];this.skipSides=0;this.oneUnitBorder=false;this.noBorderRadius=false;this.cornerDimensions=[];for(var b=0;b<4;b++){this.borderStyles[b]="none";this.borderWidths[b]=0;this.borderColors[b]="black";this.borderColorsDark[b]="black";this.borderColorsLight[b]="black";this.borderRadii[b]={w:0,h:0};this.cornerDimensions[b]={w:0,h:0}}this.borderDataCalculated=false},getInsets:function(){return this.calculateInsets("border-","-width")},recalculateBorderData:function(){var h=this.component.d();var c,b,a;this.backgroundColor=this.getColorString(this.getColorRGB(this.component.cssValue("background-color")));for(var g=0;g<4;g++){var f=this.SIDES[g];c=th.convertBorderLengthToPixels(this.component.cssValue("border-"+f+"-width"));b=this.getColorString(this.getColorRGB(this.component.cssValue("border-"+f+"-color")));a=this.component.cssValue("border-"+f+"-style");this.borderWidths[g]=(c===undefined)?0:c;this.borderColors[g]=b;this.borderColorsDark[g]=this.getColorString(this.getSpecial3DColors(b,this.backgroundColor,"dark"));this.borderColorsLight[g]=this.getColorString(this.getSpecial3DColors(b,this.backgroundColor,"light"));this.borderStyles[g]=(a===undefined)?"none":a}this.outerRect={x:0,y:0,w:h.b.w,h:h.b.h};this.innerRect={x:0,y:0,w:h.b.w,h:h.b.h};this.inset(this.innerRect,this.borderWidths);this.cornerDimensions[0].w=this.borderWidths[3];this.cornerDimensions[0].h=this.borderWidths[0];this.cornerDimensions[1].w=this.borderWidths[1];this.cornerDimensions[1].h=this.borderWidths[0];this.cornerDimensions[2].w=this.borderWidths[1];this.cornerDimensions[2].h=this.borderWidths[2];this.cornerDimensions[3].w=this.borderWidths[3];this.cornerDimensions[3].h=this.borderWidths[2];this.oneUnitBorder=this.checkFourFloatsEqual(this.borderWidths,1);this.noBorderRadius=this.allCornersZeroSize(this.borderRadii);this.borderDataCalculated=true},areBorderSideFinalStylesSame:function(b){if(b==0){throw"th.Border:areBorderSideFinalStyleSame - Invalid side bit-field '0'"}firstStyle=0;for(var a=0;a<4;a++){if(firstStyle==a){if(((1<<a)&b)==0){firstStyle++}continue}if(((1<<a)&b)==0){continue}if(this.borderStyles[firstStyle]!=this.borderStyles[a]||this.borderColors[firstStyle]!=this.borderColors[a]){return false}}switch(this.borderStyles[firstStyle]){case"groove":case"ridge":case"inset":case"outset":return((b&(this.BIT_TOP|this.BIT_LEFT))==0||(b&(this.BIT_BOTTOM|this.BIT_RIGHT))==0)}return true},isSolidCornerStyle:function(b,a){switch(b){case"dotted":case"dashed":case"solid":return true;case"inset":case"outset":return a==this.TOP_LEFT||a==this.BOTTOM_RIGHT;case"groove":case"ridge":return this.oneUnitBorder&&(a==this.TOP_LEFT||a==this.BOTTOM_RIGHT);case"double":return this.oneUnitBorder;default:return false}},borderColorStyleForSolidCorner:function(b,a){switch(b){case"dotted":case"dashed":case"solid":case"double":return"solid";case"inset":case"groove":if(a==this.TOP_LEFT){return"dark"}else{if(a==this.BOTTOM_RIGHT){return"light"}}break;case"outset":case"ridge":if(a==this.TOP_LEFT){return"light"}else{if(a==this.BOTTOM_RIGHT){return"dark"}}break}return"none"},doCornerSubPath:function(a,b){var c={x:0,y:0};if(b==this.TOP_RIGHT||b==this.BOTTOM_RIGHT){c.x=this.outerRect.w-this.cornerDimensions[b].w}if(b==this.BOTTOM_RIGHT||b==this.BOTTOM_LEFT){c.y=this.outerRect.h-this.cornerDimensions[b].h}a.rect(this.outerRect.x+c.x,this.outerRect.y+c.y,this.cornerDimensions[b].w,this.cornerDimensions[b].h)},doSideClipWithoutCornersSubPath:function(b,a){var f={x:0,y:0};var d=this.next(a);if(a==this.TOP){f.x=this.cornerDimensions[this.TOP_LEFT].w}else{if(a==this.RIGHT){f.x=this.outerRect.w-this.borderWidths[this.RIGHT];f.y=this.cornerDimensions[this.TOP_RIGHT].h}else{if(a==this.BOTTOM){f.x=this.cornerDimensions[this.BOTTOM_LEFT].w;f.y=this.outerRect.h-this.borderWidths[this.BOTTOM]}else{if(a==this.LEFT){f.y=this.cornerDimensions[this.TOP_LEFT].h}}}}var g={w:0,h:0};g.w=this.cornerDimensions[a].w+this.cornerDimensions[d].w;g.h=this.cornerDimensions[a].h+this.cornerDimensions[d].h;var c={x:this.outerRect.x+f.x,y:this.outerRect.y+f.y,w:this.outerRect.w-g.w,h:this.outerRect.h-g.h};if(a==this.TOP||a==this.BOTTOM){c.h=this.borderWidths[a]}else{c.w=this.borderWidths[a]}b.rect(c.x,c.y,c.w,c.h)},maybeMoveToMidPoint:function(c,a,d){var b={x:a.x-c.x,y:a.y-c.y};if(b.x!=0&&b.y!=0){k=Math.min((d.x-c.x)/b.x,(d.y-a.y)/b.y);a.x=c.x+b.x*k;a.y=c.y+b.y*k}},doSideClipSubPath:function(q,d){var n=this.corner;var a=[{x:0,y:0},{x:0,y:0}];var b=[{x:0,y:0},{x:0,y:0}];var c=this.prev(d);var m=this.next(d);var r=this.borderStyles[d]=="dashed"||this.borderStyles[d]=="dotted";var p=this.borderStyles[c]=="dashed"||this.borderStyles[c]=="dotted";var i=this.borderStyles[m]=="dashed"||this.borderStyles[m]=="dotted";var g=0;var o=0;if(!this.isZeroSize(this.borderRadii[d])){g=1}else{if(p&&r){g=2}}if(!this.isZeroSize(this.borderRadii[m])){o=1}else{if(p&&r){o=2}}var j={x:0,y:0};j.x=this.innerRect.x+this.innerRect.w/2;j.y=this.innerRect.y+this.innerRect.h/2;var h=this.cornerX,f=this.cornerY;a[0].x=h(this.outerRect,d);a[0].y=f(this.outerRect,d);a[1].x=h(this.innerRect,d);a[1].y=f(this.innerRect,d);b[0].x=h(this.outerRect,m);b[0].y=f(this.outerRect,m);b[1].x=h(this.innerRect,m);b[1].y=f(this.innerRect,m);if(g==1){this.maybeMoveToMidPoint(a[0],a[1],j)}else{if(g==2){if(side=="top"||side=="bottom"){a[1].x=h(this.outerRect,d);a[1].y=f(this.innerRect,d)}else{a[1].x=h(this.innerRect,d);a[1].y=f(this.outerRect,d)}}}if(o==1){this.maybeMoveToMidPoint(b[0],b[1],j)}else{if(o==2){if(side=="top"||side=="bottom"){b[0].x=h(this.innerRect,m);b[0].y=f(this.outerRect,m)}else{b[0].x=h(this.outerRect,m);b[0].y=f(this.innerRect,m)}}}q.moveTo(a[0].x,a[0].y);q.lineTo(b[0].x,b[0].y);q.lineTo(b[1].x,b[1].y);q.lineTo(a[1].x,a[1].y);q.closePath()},fillSolidBorder:function(t,w,x,B,j,A,u){t.fillStyle=u;if(B!==undefined&&!this.allCornersZeroSize(B)){var q=this.computeInnerRadii(B,j);t.beginPath();this.traceRoundRect(t,w,B,true);this.traceRoundRect(t,x,q,false);t.fill();return}if(A==15&&this.checkFourFloatsEqual(j,j[0])){var n=w;var o={x:n.x,y:n.y,w:n.w,h:n.h};this.inset(o,j[0]/2);t.strokeStyle=u;t.lineWidth=j[0];t.beginPath();t.rect(o.x,o.y,o.w,o.h);t.stroke();return}var D,C,a,m;var h,g,i,s;var y,v,z,b;var d,c,f,p;if(A&1){D=w.x;C=w.y;a=w.w;m=j[0]}if(A&4){y=w.x;v=w.y+w.h-j[2];z=w.w;b=j[2]}if(A&8){d=w.x;c=w.y;f=j[3];p=w.h}if(A&2){h=w.x+w.w-j[1];g=w.y;i=j[1];s=w.h}if((A&9)==9){c+=j[0];p-=j[0]}if((A&3)==3){a-=j[1]}if((A&6)==6){s-=j[2]}if((A&12)==12){y+=j[3];z-=j[3]}if(A&1){t.fillRect(D,C,a,m)}if(A&2){t.fillRect(h,g,i,s)}if(A&4){t.fillRect(y,v,z,b)}if(A&8){t.fillRect(d,c,f,p)}},makeBorderColor:function(c,d){var a;var b=0;switch(d){case"none":return"black";case"light":return this.borderColorsLight[c];case"dark":return this.borderColorsDark[c];case"solid":default:return this.borderColors[c]}},computeColorForLine:function(a,f,b,c,d){return this.makeBorderColor(a,f[a])},drawBorderSides:function(j,u){if(u==0){return}var s;var o;var v=[];var t=[];var p=0;var h=[];for(var n=0;n<4;n++){if(((1<<n)&u)==0){continue}s=this.borderStyles[n];o=this.borderColors[n];break}if(s=="none"||s=="hidden"){return}if(this.oneUnitBorder&&(s=="ridge"||s=="groove"||s=="double")){s="solid"}switch(s){case"solid":case"dashed":case"dotted":v[0]="solid";t[0]="solid";p=1;break;case"groove":v[0]="dark";v[1]="light";t[0]="light";t[1]="dark";p=2;break;case"ridge":v[0]="light";v[1]="dark";t[0]="dark";t[1]="light";p=2;break;case"double":v[0]="solid";v[1]="none";v[2]="solid";t[0]="solid";t[1]="none";t[2]="solid";p=3;break;case"inset":v[0]="dark";t[0]="light";p=1;break;case"outset":v[0]="light";t[0]="dark";p=1;break;default:throw"Unhandled style '"+s+"'";break}if(u&(this.BIT_RIGHT|this.BIT_BOTTOM)){h=t}else{h=v}var b=[[],[],[]];if(p==1){for(var n=0;n<4;n++){b[0][n]=this.borderWidths[n]}}else{if(p==2){for(var n=0;n<4;n++){var d=this.borderWidths[n];b[0][n]=parseInt(d/2)+d%2;b[1][n]=parseInt(d/2)}}else{if(p==3){for(var n=0;n<4;n++){var d=this.borderWidths[n];if(d==1){b[0][n]=1;b[1][n]=b[2][n]=0}else{var f=d%3;b[0][n]=b[2][n]=b[1][n]=parseInt((d-f)/3);if(f==1){b[1][n]++}else{if(f==2){b[0][n]++;b[2][n]++}}}}}}}var c=this.outerRect;var q={x:c.x,y:c.y,w:c.w,h:c.h};var a={x:c.x,y:c.y,w:c.w,h:c.h};var g;if(!this.noBorderRadius){g=th.clone(this.borderRadii)}var r;for(var n=0;n<p;n++){r=b[n];this.inset(a,r);if(h[n]!="none"){var m=this.computeColorForLine(n,h,p,o,this.backgroundColor);this.fillSolidBorder(j,q,a,g,r,u,m)}if(!this.noBorderRadius){g=this.computeInnerRadii(g,r)}q.x=a.x;q.y=a.y;q.w=a.w;q.h=a.h}},paint:function(a){if(this.component.cssValue("border-image-url")===undefined){this.paintBorder(a)}else{this.paintImageBorder(a)}},paintImageBorder:function(s){var f=th.global_resources.images[this.component.cssValue("border-image-url")];if(f.width==0){return}var q,n,a,c,p,g,j;q=parseInt(this.component.cssValue("border-image-top"));n=parseInt(this.component.cssValue("border-image-bottom"));a=parseInt(this.component.cssValue("border-image-right"));c=parseInt(this.component.cssValue("border-image-left"));p=f.width;g=f.height;j=this.component.d();bT=th.convertLengthToPixels(this.component.cssValue("border-top-width"));bR=th.convertLengthToPixels(this.component.cssValue("border-right-width"));bB=th.convertLengthToPixels(this.component.cssValue("border-bottom-width"));bL=th.convertLengthToPixels(this.component.cssValue("border-left-width"));s.drawImage(f,0,0,c,q,0,0,bL,bT);s.drawImage(f,p-a,0,a,q,j.b.w-bR,0,bR,bT);s.drawImage(f,0,g-n,c,n,0,j.b.h-bB,bL,bB);s.drawImage(f,p-a,g-n,a,n,j.b.w-bR,j.b.h-bB,bR,bB);switch(this.component.cssValue("border-image-repeat-x")){case"stretch":s.drawImage(f,c,0,p-c-a,q,bL,0,j.b.w-bL-bR,bT);s.drawImage(f,c,g-n,p-c-a,n,bL,j.b.h-bB,j.b.w-bL-bR,bB);break;case"repeat":var i;s.save();s.beginPath();s.rect(bL,0,j.b.w-bL-bR,j.b.h);s.clip();i=c*(bT/q);for(var o=bL;o<j.b.w-bR;o+=i){s.drawImage(f,c,0,p-c-a,q,o,0,i,bT)}i=a*(bB/n);for(var o=bL;o<j.b.w-bR;o+=i){s.drawImage(f,c,g-n,p-c-a,n,o,j.b.h-bB,i,bB)}s.restore();break;default:console.error('border-image-repeat-x "'+this.component.cssValue("border-image-repeat-x")+'" not supported!');break}switch(this.component.cssValue("border-image-repeat-y")){case"stretch":s.drawImage(f,0,q,c,g-q-n,0,bT,bL,j.b.h-bT-bB);s.drawImage(f,p-a,q,a,g-q-n,j.b.w-bR,bT,bR,j.b.h-bT-bB);break;case"repeat":var i;s.save();s.beginPath();s.rect(0,bT,j.b.w,j.b.h-bT-bB);s.clip();i=q*(bL/c);for(var m=bT;m<j.b.h-bB;m+=i){s.drawImage(f,0,q,c,g-q-n,0,m,bL,i)}i=q*(bR/a);for(var m=bT;m<j.b.h-bB;m+=i){s.drawImage(f,p-a,q,a,g-q-n,j.b.w-bR,m,bR,i)}s.restore();break;default:console.error('border-image-repeat-y "'+this.component.cssValue("border-image-repeat-x")+'" not supported!');break}},paintBorder:function(s){var n=this.component.d();var d=this.isZeroSize;this.recalculateBorderData();var h=this.areBorderSideFinalStylesSame(1|8);var r=this.areBorderSideFinalStylesSame(2|4);var c=this.areBorderSideFinalStylesSame(15);if(c&&(this.borderStyles[0]=="none"||this.borderStyles[0]=="hidden")){return}this.round(this.outerRect);this.round(this.innerRect);if(this.emptyRect(this.outerRect)){return}if(c){this.drawBorderSides(s,this.BIT_TOP|this.BIT_RIGHT|this.BIT_BOTTOM|this.BIT_LEFT)}else{for(var p=0;p<4;p++){var f=[p,this.prev(p)];if(!d(this.borderRadii[p])){continue}if(this.borderWidths[f[0]]==1&&this.borderWidths[f[1]]==1){if(p==this.TOP_LEFT||p==this.TOP_RIGHT){this.cornerDimensions[p].w=0}else{this.cornerDimensions[p].h=0}}}for(var p=0;p<4;p++){if(d(this.cornerDimensions[p])){continue}var f=[p,this.prev(p)];var i=(1<<f[0])|(1<<f[1]);var g=this.areBorderSideFinalStylesSame(i);if(g&&d(this.borderRadii[p])&&this.isSolidCornerStyle(this.borderStyles[f[0]],p)){s.beginPath();this.doCornerSubPath(s,p);s.fillStyle=this.makeBorderColor(f[0],this.borderColorStyleForSolidCorner(this.borderStyles[f[0]],p));s.fill();continue}s.save();s.beginPath();this.doCornerSubPath(s,p);s.clip();if(g){this.drawBorderSides(s,i)}else{var o=this.component.getScratchContext();o.canvas.height=n.b.h;o.canvas.width=n.b.w;o.clearRect(0,0,n.b.w,n.b.h);o.globalCompositeOperation="lighter";for(var q=0;q<2;q++){var m=f[q];var a=this.borderStyles[m];o.save();o.beginPath();this.doSideClipSubPath(o,m);o.clip();this.drawBorderSides(o,1<<m);o.restore()}s.globalCompositeOpertation="source-over";s.drawImage(o.canvas,0,0,n.b.w,n.b.h,0,0,n.b.w,n.b.h)}s.restore()}var j=0;if(this.oneUnitBorder&&this.noBorderRadius){if(h){this.drawBorderSides(s,1|8);j|=1|8}if(r){this.drawBorderSides(s,4|2);j|=4|2}}for(var m=0;m<4;m++){if(j&(1<<m)){continue}if(this.borderWidths[m]==0||this.borderStyles[m]=="hidden"||this.borderStyles[m]=="none"){continue}s.save();s.beginPath();this.doSideClipWithoutCornersSubPath(s,m);s.clip();this.drawBorderSides(s,1<<m);s.restore()}}}}});if(typeof th=="undefined"){th={}}if(typeof th.formlayout=="undefined"){th.formlayout={}}th.formlayout.Exception=Class.define({members:{init:function(a){this.message=a},toString:function(){return this.message}}});th.formlayout.IllegalArgumentException=Class.define({superclass:th.formlayout.Exception,members:{init:function(a){this._super(a)}}});th.formlayout.IndexOutOfBoundsException=Class.define({superclass:th.formlayout.Exception,members:{init:function(a){this._super(a)}}});th.formlayout.FormLayoutParseException=Class.define({superclass:th.formlayout.Exception,members:{init:function(a){this._super(a)}}});th.formlayout.Unit=Class.define({members:{init:function(a,d,c,b){this.name=a;this.abbreviation=d;this.parseAbbreviation=c;this.requiresIntegers=b},toString:function(){return this.name},encode:function(){return this.parseAbbreviation||this.abbreviation},abbreviation:function(){return this.abbreviation}}});th.formlayout.Unit.valueOf=function(c,b){if(c.length==0){var a=th.formlayout.Sizes.getDefaultUnit();if(a){return a}return b?th.formlayout.ConstantSize.DIALOG_UNITS_X:th.formlayout.ConstantSize.DIALOG_UNITS_Y}else{if(c=="px"){return th.formlayout.ConstantSize.PIXEL}else{if(c=="dlu"){return b?th.formlayout.ConstantSize.DIALOG_UNITS_X:th.formlayout.ConstantSize.DIALOG_UNITS_Y}else{if(c=="em"){return th.formlayout.ConstantSize.EM}else{if(c=="pt"){return th.formlayout.ConstantSize.POINT}else{if(c=="in"){return th.formlayout.ConstantSize.INCH}else{if(c=="mm"){return th.formlayout.ConstantSize.MILLIMETER}else{if(c=="cm"){return th.formlayout.ConstantSize.CENTIMETER}else{throw"Invalid unit name '"+c+"'. Must be one of: px, dlu, pt, mm, cm, in"}}}}}}}}};th.formlayout.FormLayout=Class.define({members:{init:function(c,b){if(th.isString(c)){c=th.formlayout.ColumnSpec.decodeSpecs(c)}if(th.isString(b)){b=th.formlayout.RowSpec.decodeSpecs(b)}this.colSpecs=c;this.rowSpecs=b;this.colGroupIndices=[];this.rowGroupIndices=[];this.constraintMap=new th.Hashtable();this.componentSizeCache=new th.formlayout.ComponentSizeCache();var a=this;this.minimumWidthMeasure=function(d){return a.componentSizeCache.getMinimumSize(d).width};this.minimumHeightMeasure=function(d){return a.componentSizeCache.getMinimumSize(d).height};this.preferredWidthMeasure=function(d){return a.componentSizeCache.getPreferredSize(d).width};this.preferredHeightMeasure=function(d){return a.componentSizeCache.getPreferredSize(d).height}},getColumnCount:function(){return this.colSpecs.length},getColumnSpec:function(a){return this.colSpecs[a-1]},setColumnSpec:function(b,a){this.colSpecs[b-1]=a},appendColumn:function(a){this.colSpecs.push(a)},insertColumn:function(b,a){if(b<1||b>this.getColumnCount()){throw"The column index "+b+"must be in the range [1, "+this.getColumnCount()+"]."}this.colSpecs[b-1]=a;this.shiftComponentsHorizontally(b,false);this.adjustGroupIndices(this.colGroupIndices,b,false)},removeColumn:function(a){if(a<1||a>this.getColumnCount()){throw"The column index "+a+" must be in the range [1, "+this.getColumnCount()+"]."}this.colSpecs.remove(a-1);this.shiftComponentsHorizontally(a,true);this.adjustGroupIndices(this.colGroupIndices,a,true)},getRowCount:function(){return this.rowSpecs.length},getRowSpec:function(a){return this.rowSpecs[a-1]},setRowSpec:function(b,a){this.rowSpecs[b-1]=a},appendRow:function(a){this.rowSpecs.push(a)},insertRow:function(b,a){if(b<1||b>this.getRowCount()){throw"The row index "+b+" must be in the range [1, "+this.getRowCount()+"]."}this.rowSpecs.add(b-1,a);this.shiftComponentsVertically(b,false);this.adjustGroupIndices(this.rowGroupIndices,b,false)},removeRow:function(a){if(a<1||a>this.getRowCount()){throw"The row index "+a+"must be in the range [1, "+this.getRowCount()+"]."}this.rowSpecs.remove(a-1);this.shiftComponentsVertically(a,true);this.adjustGroupIndices(this.rowGroupIndices,a,true)},shiftComponentsHorizontally:function(b,a){var d=a?-1:1;var c=this.constraintMap.keys();th.forEach(c,function(i){var j=this.constraintMap.get(i);var h=j.gridX;var f=j.gridWidth;var g=h+f-1;if(h==b&&a){throw"The removed column "+b+" must not contain component origins.\nIllegal component="+i}else{if(h>=b){j.gridX+=d}else{if(g>=b){j.gridWidth+=d}}}})},shiftComponentsVertically:function(d,a){var c=a?-1:1;var b=this.constraintMap.keys();th.forEach(b,function(g){var m=this.constraintMap.get(g);var j=m.gridY;var i=m.gridHeight;var f=j+i-1;if(j==d&&a){throw"The removed row "+d+" must not contain component origins.\nIllegal component="+g}else{if(j>=d){m.gridY+=c}else{if(f>=d){m.gridHeight+=c}}}})},adjustGroupIndices:function(f,b,a){var j=a?-1:+1;for(var g=0;g<f.length;g++){var h=f[g];for(var d=0;d<h.length;d++){var c=h[d];if(c==b&&a){throw"The removed index "+b+" must not be grouped."}else{if(c>=b){h[d]+=j}}}}},getConstraints:function(a){return this.constraintMap.get(a)},setConstraints:function(a,b){b.ensureValidGridBounds(this.getColumnCount(),this.getRowCount());this.constraintMap.put(a,b)},removeConstraints:function(a){this.constraintMap.remove(a);this.componentSizeCache.removeEntry(a)},getColumnGroups:function(){return this.colGroupIndices},setColumnGroups:function(f){var a=this.getColumnCount();var g=[];for(var d=0;d<this.colGroupIndices.length;d++){for(var c=0;c<this.colGroupIndices[d].length;c++){var b=this.colGroupIndices[d][c];if(b<1||b>a){throw"Invalid column group index "+b+" in group "+(d+1)}if(g[b]){throw"Column index "+b+" must not be used in multiple column groups."}g[b]=true}}this.colGroupIndices=f},addGroupedColumn:function(g){var d=this.getColumnGroups();if(d.length==0){d=[0][g]}else{var c=d.length-1;var f=d[c];var a=f.length;var b=f.slice(0,a);b[a]=g;d[c]=b}this.setColumnGroups(d)},getRowGroups:function(){return this.rowGroupIndices},setRowGroups:function(d){var a=this.getRowCount();var g=[];for(var c=0;c<this.rowGroupIndices.length;c++){for(var b=0;b<this.rowGroupIndices[c].length;b++){var f=this.rowGroupIndices[c][b];if(f<1||f>a){throw"Invalid row group index "+f+" in group "+(c+1)}if(g[f]){throw"Row index "+f+" must not be used in multiple row groups."}g[f]=true}}this.rowGroupIndices=d},addGroupedRow:function(g){var d=this.getRowGroups();if(d.length==0){d=[0][g]}else{var c=d.length-1;var f=d[c];var a=f.length;var b=f.slice(0,a);b[a]=g;d[c]=b}this.setRowGroups(d)},getHonorsVisibility:function(){return this.honorsVisibility},setHonorsVisibility:function(a){var g=this.getHonorsVisibility();if(g==a){return}this.honorsVisibility=a;var f=this.constraintMap.keys();if(f.length==0){return}var d=f[0];var c=d.parent;if(c){c.render()}},setHonorsVisibilityForComponent:function(c,a){var d=this.getConstraints(c);if(a==d.honorsVisibility){return}d.honorsVisibility=a;if(c.parent){c.parent.render()}},addLayoutComponent:function(a,b){if(th.isString(b)){this.setConstraints(a,new th.formlayout.CellConstraints(b))}else{this.setConstraints(a,b)}},removeLayoutComponent:function(a){this.removeConstraints(a)},getMinimumSize:function(a){return this.computeLayoutSize(a,this.minimumWidthMeasure,this.minimumHeightMeasure)},getPreferredSize:function(a){return this.computeLayoutSize(a,this.preferredWidthMeasure,this.preferredHeightMeasure)},getMaximumSize:function(a){return{width:1000000,height:1000000}},invalidateLayout:function(a){this.invalidateCaches()},layout:function(g){this.initializeColAndRowComponentLists();var f=g.getSize();var c=g.getInsets();var b=f.width-c.left-c.right;var d=f.height-c.top-c.bottom;var a=this.computeGridOrigins(g,b,c.left,this.colSpecs,this.colComponents,this.colGroupIndices,this.minimumWidthMeasure,this.preferredWidthMeasure);var h=this.computeGridOrigins(g,d,c.top,this.rowSpecs,this.rowComponents,this.rowGroupIndices,this.minimumHeightMeasure,this.preferredHeightMeasure);this.layoutComponents(a,h)},initializeColAndRowComponentLists:function(){this.colComponents=[];for(var a=0;a<this.getColumnCount();a++){this.colComponents[a]=[]}this.rowComponents=[];for(var a=0;a<this.getRowCount();a++){this.rowComponents[a]=[]}var b=this.constraintMap.keys();th.forEach(b,function(c){var d=this.constraintMap.get(c);if(this.takeIntoAccount(c,d)){if(d.gridWidth==1){this.colComponents[d.gridX-1].push(c)}if(d.gridHeight==1){this.rowComponents[d.gridY-1].push(c)}}},this)},computeLayoutSize:function(g,d,v){this.initializeColAndRowComponentLists();var w=this.maximumSizes(g,this.colSpecs,this.colComponents,this.minimumWidthMeasure,this.preferredWidthMeasure,d);var u=this.maximumSizes(g,this.rowSpecs,this.rowComponents,this.minimumHeightMeasure,this.preferredHeightMeasure,v);var q=this.groupedSizes(this.colGroupIndices,w);var n=this.groupedSizes(this.rowGroupIndices,u);var a=this.computeOrigins(q,0);var h=this.computeOrigins(n,0);var t=this.sum(q);var f=this.sum(n);var s=t;var p=f;var b=this.computeMaximumFixedSpanTable(this.colSpecs);var c=this.computeMaximumFixedSpanTable(this.rowSpecs);var i=this.constraintMap.keys();var m=this;th.forEach(i,function(F){var C=m.constraintMap.get(F);if(!m.takeIntoAccount(F,C)){return}if((C.gridWidth>1)&&(C.gridWidth>b[C.gridX-1])){var D=d(F);var B=C.gridX-1;var A=B+C.gridWidth;var E=a[B];var x=t-a[A];var z=E+D+x;if(z>s){s=z}}if((C.gridHeight>1)&&(C.gridHeight>c[C.gridY-1])){var I=v(F);var H=C.gridY-1;var G=H+C.gridHeight;var E=h[H];var x=f-h[G];var y=E+I+x;if(y>p){p=y}}});var r=g.getInsets();var o=s+r.left+r.right;var j=p+r.top+r.bottom;return{width:o,height:j}},computeGridOrigins:function(j,n,f,m,d,i,q,g){var u=this.maximumSizes(j,m,d,q,g,q);var b=this.maximumSizes(j,m,d,q,g,g);var r=this.groupedSizes(i,u);var t=this.groupedSizes(i,b);var s=this.sum(r);var p=this.sum(t);var h=this.compressedSizes(m,n,s,p,r,b);var o=this.groupedSizes(i,h);var c=this.sum(o);var a=this.distributedSizes(m,n,c,o);return this.computeOrigins(a,f)},computeOrigins:function(c,f){var b=c.length;var d=[];d[0]=f;for(var a=1;a<=b;a++){d[a]=d[a-1]+c[a-1]}return d},layoutComponents:function(a,c){var b=this.constraintMap.keys();th.forEach(b,function(f){var h={};var m=this.constraintMap.get(f);var d=m.gridX-1;var j=m.gridY-1;var i=m.gridWidth;var g=m.gridHeight;h.x=a[d];h.y=c[j];h.width=a[d+i]-h.x;h.height=c[j+g]-h.y;m.setBounds(f,this,h,this.minimumWidthMeasure,this.minimumHeightMeasure,this.preferredWidthMeasure,this.preferredHeightMeasure)},this)},invalidateCaches:function(){this.componentSizeCache.invalidate()},maximumSizes:function(a,f,h,b,g,d){var m=f.length;var n=[];for(var c=0;c<m;c++){var j=f[c];n[c]=j.maximumSize(a,h[c],b,g,d)}return n},compressedSizes:function(d,m,g,j,p,n){if(m<g){return p}if(m>=j){return n}var f=d.length;var q=[];var a=j-m;var o=j-g;var b=a/o;for(var c=0;c<f;c++){var h=d[c];q[c]=n[c];if(h.getSize().compressible()){q[c]-=Math.round((n[c]-p[c])*b)}}return q},groupedSizes:function(a,f){if(!a||a.length==0){return f}var d=[];for(var c=0;c<d.length;c++){d[c]=f[c]}for(var g=0;g<a.length;g++){var h=a[g];var j=0;for(var c=0;c<h.length;c++){var b=h[c]-1;j=Math.max(j,d[b])}for(var c=0;c<h.length;c++){var b=h[c]-1;d[b]=j}}return d},distributedSizes:function(j,s,r,d){var t=s-r;if(t<0){return d}var n=j.length;var c=0;for(var f=0;f<n;f++){var o=j[f];c+=o.getResizeWeight()}if(c==0){return d}var u=[];var b=t;var q=parseInt(t);for(var f=0;f<n;f++){var o=j[f];var h=o.getResizeWeight();if(h==th.formlayout.FormSpec.NO_GROW){u[f]=d[f]}else{var m=b-q;var a=t*h/c;var g=a-m;var p=Math.round(g);u[f]=d[f]+p;b-=a;q-=p}}return u},computeMaximumFixedSpanTable:function(g){var c=g.length;var d=[];var f=1000000;for(var b=c-1;b>=0;b--){var a=g[b];if(a.canGrow()){f=0}d[b]=f;if(f<1000000){f++}}return d},sum:function(c){var b=0;for(var a=c.length-1;a>=0;a--){b+=c[a]}return b},takeIntoAccount:function(a,b){return a.cssValue("visibility")!="hidden"||((!b.honorsVisibility)&&!this.getHonorsVisibility())||!b.honorsVisibility},getLayoutInfo:function(g){this.initializeColAndRowComponentLists();var f=g.getSize();var c=g.getInsets();var b=f.width-c.left-c.right;var d=f.height-c.top-c.bottom;var a=this.computeGridOrigins(g,b,c.left,this.colSpecs,this.colComponents,this.colGroupIndices,this.minimumWidthMeasure,this.preferredWidthMeasure);var h=this.computeGridOrigins(g,d,c.top,this.rowSpecs,this.rowComponents,this.rowGroupIndices,this.minimumHeightMeasure,this.preferredHeightMeasure);return new th.formlayout.LayoutInfo(a,h)}}});th.formlayout.LayoutInfo=Class.define({members:{init:function(b,a){this.columnOrigins=b;this.rowOrigins=a},getX:function(){return this.columnOrigins[0]},getY:function(){return this.rowOrigins[0]},getWidth:function(){return this.columnOrigins[this.columnOrigins.length-1]-this.columnOrigins[0]},getHeight:function(){return this.rowOrigins[this.rowOrigins.length-1]-this.rowOrigins[0]}}});th.formlayout.ComponentSizeCache=Class.define({members:{init:function(){this.minimumSizes=new th.Hashtable();this.preferredSizes=new th.Hashtable()},invalidate:function(){this.minimumSizes.clear();this.preferredSizes.clear()},getSize:function(a,d,c){var b=d.get(a);if(!b){b=a[c]();d.put(a,b)}return b},getMinimumSize:function(a){return this.getSize(a,this.minimumSizes,"getMinimumSize")},getPreferredSize:function(a){return this.getSize(a,this.preferredSizes,"getPreferredSize")},removeEntry:function(a){this.minimumSizes.remove(a);this.preferredSizes.remove(a)}}});th.formlayout.FormSpec=Class.define({members:{NO_GROW:0,DEFAULT_GROW:1,spacer:false,init:function(c,a,b){this.defaultAlignment=c;this.size=a;this.resizeWeight=b||0},isSpacer:function(){return this.spacer},getDefaultAlignment:function(){return this.defaultAlignment},getSize:function(){return this.size},getResizeWeight:function(){return this.resizeWeight},canGrow:function(){return this.resizeWeight!=this.NO_GROW},isHorizontal:function(){throw"This needs to be overridden."},setDefaultAlignment:function(a){this.defaultAlignment=a},setSize:function(a){this.size=a},setResizeWeight:function(a){this.resizeWeight=a},maximumSize:function(b,d,a,f,c){return this.size.maximumSize(b,d,a,f,c)},parseAndInitValues:function(d){if(d.indexOf("spacer(")==0){d=d.substring("spacer(".length,d.length-1);this.spacer=true}var b=d.split(":");if(b.length==0){throw new th.formlayout.IllegalArgumentException("The form spec must not be empty.")}var a=0;var c=b[a++];var f=th.formlayout.DefaultAlignment.valueOf(c,this.isHorizontal());if(f){this.setDefaultAlignment(f);if(b.length==1){throw new th.formlayout.IllegalArgumentException("The form spec must provide a size.")}c=b[a++]}this.setSize(this.parseSize(c));if(a<b.length){this.setResizeWeight(this.parseResizeWeight(b[a]))}},parseSize:function(a){if(a.indexOf("[")==0&&a.indexOf("]")==a.length-1){return this.parseBoundedSize(a)}if(a.indexOf("max(")==0&&a.indexOf(")")==a.length-1){return this.parseOldBoundedSize(a,false)}if(a.indexOf("min(")==0&&a.indexOf(")")==a.length-1){return this.parseOldBoundedSize(a,true)}return this.parseAtomicSize(a)},parseBoundedSize:function(b){var g=b.substring(1,b.length-1);var i=g.split(/\s*,\s*/);var h=undefined;var a=undefined;var d=undefined;if(i.length==2){var f=this.parseAtomicSize(i[0]);var c=this.parseAtomicSize(i[1]);if(this.isConstant(f)){if(this.isConstant(c)){a=f;h=c;d=c}else{a=f;h=c}}else{h=f;d=c}}else{if(i.length==3){a=this.parseAtomicSize(i[0]);h=this.parseAtomicSize(i[1]);d=this.parseAtomicSize(i[2])}}if(((a==null)||(this.isConstant(a)))&&((d==null)||(this.isConstant(d)))){return new th.formlayout.BoundedSize(h,a,d)}throw new th.formlayout.IllegalArgumentException("Illegal bounded size '"+b+"'. Must be one of:\n[<constant size>,<logical size>]                 // lower bound\n[<logical size>,<constant size>]                 // upper bound\n[<constant size>,<logical size>,<constant size>] // lower and upper bound.\nExamples:\n[50dlu,pref]                                     // lower bound\n[pref,200dlu]                                    // upper bound\n[50dlu,pref,200dlu]                              // lower and upper bound.")},parseAtomicSize:function(c){var a=th.trim(c);if(a.indexOf("'")==0&&a.indexOf("'")==a.length-1){var d=a.length;if(d<2){throw new th.formlayout.IllegalArgumentException('Missing closing "\'" for prototype.')}return new th.formlayout.PrototypeSize(a.substring(1,d-1))}var b=th.formlayout.ComponentSize.valueOf(a);if(b!=null){return b}return th.formlayout.ConstantSize.valueOf(a,this.isHorizontal())},parseResizeWeight:function(b){if(b=="g"||b=="grow"){return th.formlayout.FormSpec.DEFAULT_GROW}if(b=="n"||b=="nogrow"||b=="none"){return th.formlayout.FormSpec.NO_GROW}if((b.indexOf("grow(")==0||b.indexOf("g(")==0)&&b.indexOf(")")==b.length-1){var c=b.indexOf("(");var d=b.indexOf(")");var a=b.substring(c+1,d);return parseFloat(a)}throw new th.formlayout.IllegalArgumentException("The resize argument '"+b+"' is invalid.  Must be one of: grow, g, none, n, grow(<double>), g(<double>)")},isConstant:function(a){return(a instanceof th.formlayout.ConstantSize)||(a instanceof th.formlayout.PrototypeSize)},toString:function(){buffer=this.defaultAlignment;buffer+=":";buffer+=this.size.toString();buffer+=":";if(this.resizeWeight==th.formlayout.FormSpec.NO_GROW){buffer+="noGrow"}else{if(this.resizeWeight==th.formlayout.FormSpec.DEFAULT_GROW){buffer+="grow"}else{buffer+="grow(";buffer+=this.resizeWeight;buffer+=")"}}return buffer},toShortString:function(){buffer=this.defaultAlignment.abbreviation();buffer+=":";buffer+=this.size.toString();buffer+=":";if(this.resizeWeight==th.formlayout.FormSpec.NO_GROW){buffer+="n"}else{if(this.resizeWeight==th.formlayout.FormSpec.DEFAULT_GROW){buffer+="g"}else{buffer+="g(";buffer+=this.resizeWeight;buffer+=")"}}return buffer},encode:function(){var a="";var b=this.isHorizontal()?th.formlayout.ColumnSpec.DEFAULT:th.formlayout.RowSpec.DEFAULT;if(!b.equals(this.defaultAlignment)){a+=this.defaultAlignment.abbreviation();a+=":"}a+=this.size.encode();if(this.resizeWeight==th.formlayout.FormSpec.NO_GROW){}else{if(this.resizeWeight==th.formlayout.FormSpec.DEFAULT_GROW){a+=":";a+="g"}else{a+=":";a+="g(";a+=this.resizeWeight;a+=")"}}return a}}});th.formlayout.DefaultAlignment=Class.define({members:{init:function(a){this.name=a},toString:function(){return this.name},abbreviation:function(){return this.name.charAt(0)}}});th.formlayout.DefaultAlignment.valueOf=function(b,a){if(b=="f"||b=="fill"){return th.formlayout.FormSpec.FILL_ALIGN}else{if(b=="c"||b=="center"){return th.formlayout.FormSpec.CENTER_ALIGN}else{if(a){if(b=="r"||b=="right"){return th.formlayout.FormSpec.RIGHT_ALIGN}else{if(b=="l"||b=="left"){return th.formlayout.FormSpec.LEFT_ALIGN}else{return}}}else{if(b=="t"||b=="top"){return th.formlayout.FormSpec.TOP_ALIGN}else{if(b=="b"||b=="bottom"){return th.formlayout.FormSpec.BOTTOM_ALIGN}else{return}}}}}};th.formlayout.FormSpec.LEFT_ALIGN=new th.formlayout.DefaultAlignment("left");th.formlayout.FormSpec.RIGHT_ALIGN=new th.formlayout.DefaultAlignment("right");th.formlayout.FormSpec.TOP_ALIGN=new th.formlayout.DefaultAlignment("top");th.formlayout.FormSpec.BOTTOM_ALIGN=new th.formlayout.DefaultAlignment("bottom");th.formlayout.FormSpec.CENTER_ALIGN=new th.formlayout.DefaultAlignment("center");th.formlayout.FormSpec.FILL_ALIGN=new th.formlayout.DefaultAlignment("fill");th.formlayout.ColumnSpec=Class.define({superclass:th.formlayout.FormSpec,members:{init:function(c,a,b){this._super(c,a,b)},isHorizontal:function(){return true}}});th.formlayout.ColumnSpec.decode=function(a,d){var c=th.trim(a);var b=c.toLowerCase();return th.formlayout.ColumnSpec.decodeExpanded(b)};th.formlayout.ColumnSpec.decodeExpanded=function(b){var a=th.formlayout.ColumnSpec.CACHE.get(b);if(!a){a=new th.formlayout.ColumnSpec(th.formlayout.ColumnSpec.DEFAULT,th.formlayout.Sizes.DEFAULT,th.formlayout.FormSpec.NO_GROW);a.parseAndInitValues(b);th.formlayout.ColumnSpec.CACHE.put(b,a)}return a};th.formlayout.ColumnSpec.decodeSpecs=function(a,b){return th.formlayout.FormSpecParser.parseColumnSpecs(a,b)};th.formlayout.ColumnSpec.createGap=function(a){return new th.formlayout.RowSpec(th.formlayout.ColumnSpec.DEFAULT,a,th.formlayout.ColumnSpec.NO_GROW)};th.formlayout.ColumnSpec.LEFT=th.formlayout.FormSpec.LEFT_ALIGN;th.formlayout.ColumnSpec.CENTER=th.formlayout.FormSpec.CENTER_ALIGN;th.formlayout.ColumnSpec.MIDDLE=th.formlayout.ColumnSpec.CENTER;th.formlayout.ColumnSpec.RIGHT=th.formlayout.FormSpec.RIGHT_ALIGN;th.formlayout.ColumnSpec.FILL=th.formlayout.FormSpec.FILL_ALIGN;th.formlayout.ColumnSpec.DEFAULT=th.formlayout.ColumnSpec.FILL;th.formlayout.ColumnSpec.CACHE=new th.Hashtable();th.formlayout.RowSpec=Class.define({superclass:th.formlayout.FormSpec,members:{init:function(c,a,b){this._super(c,a,b)},isHorizontal:function(){return false}}});th.formlayout.RowSpec.decode=function(b,d){var c=th.trim(b);var a=c.toLowerCase();return th.formlayout.RowSpec.decodeExpanded(a)};th.formlayout.RowSpec.decodeExpanded=function(b){var a=th.formlayout.RowSpec.CACHE.get(b);if(!a){a=new th.formlayout.RowSpec(th.formlayout.RowSpec.DEFAULT,th.formlayout.Sizes.DEFAULT,th.formlayout.FormSpec.NO_GROW);a.parseAndInitValues(b);th.formlayout.RowSpec.CACHE.put(b,a)}return a};th.formlayout.RowSpec.decodeSpecs=function(a,b){return th.formlayout.FormSpecParser.parseRowSpecs(a,b)};th.formlayout.RowSpec.createGap=function(a){return new th.formlayout.RowSpec(th.formlayout.RowSpec.DEFAULT,a,th.formlayout.RowSpec.NO_GROW)};th.formlayout.RowSpec.TOP=th.formlayout.FormSpec.TOP_ALIGN;th.formlayout.RowSpec.CENTER=th.formlayout.FormSpec.CENTER_ALIGN;th.formlayout.RowSpec.BOTTOM=th.formlayout.FormSpec.BOTTOM_ALIGN;th.formlayout.RowSpec.FILL=th.formlayout.FormSpec.FILL_ALIGN;th.formlayout.RowSpec.DEFAULT=th.formlayout.RowSpec.CENTER;th.formlayout.RowSpec.CACHE=new th.Hashtable();th.formlayout.BoundedSize=Class.define({members:{init:function(b,c,a){this.basis=b;this.lowerBound=c;this.upperBound=a},getBasis:function(){return this.basis},getLowerBound:function(){return this.lowerBound},getUpperBound:function(){return this.upperBound},maximumSize:function(b,f,a,g,c){var d=this.basis.maximumSize(b,f,a,g,c);if(this.lowerBound){d=Math.max(d,this.lowerBound.maximumSize(b,f,a,g,c))}if(this.upperBound){d=Math.min(d,this.upperBound.maximumSize(b,f,a,g,c))}return d},compressible:function(){return this.basis.compressible()},equals:function(a){if(this===a){return true}var b=a;return this.basis.equals(b.basis)&&((this.lowerBound==null&&b.lowerBound==null)||(this.lowerBound!=null&&this.lowerBound.equals(b.lowerBound)))&&((this.upperBound==null&&b.upperBound==null)||(this.upperBound!=null&&this.upperBound.equals(b.upperBound)))},hashCode:function(){var a=this.basis.hashCode();if(this.lowerBound){a=a*37+this.lowerBound.hashCode()}if(this.upperBound){a=a*37+this.upperBound.hashCode()}return a}}});th.formlayout.ConstantSize=Class.define({members:{init:function(b,a){this.value=b;this.unit=a},getValue:function(){return this.value},getUnit:function(){return this.unit},getPixelSize:function(a){if(this.unit==th.formlayout.ConstantSize.PIXEL){return this.intValue()}else{if(this.unit==th.formlayout.ConstantSize.EM){return th.formlayout.Sizes.emAsPixel(this.value,a)}else{if(this.unit==th.formlayout.ConstantSize.POINT){return th.formlayout.Sizes.pointAsPixel(this.intValue(),a)}else{if(this.unit==th.formlayout.ConstantSize.INCH){return th.formlayout.Sizes.inchAsPixel(this.value,a)}else{if(this.unit==th.formlayout.ConstantSize.MILLIMETER){return th.formlayout.Sizes.millimeterAsPixel(this.value,a)}else{if(this.unit==th.formlayout.ConstantSize.CENTIMETER){return th.formlayout.Sizes.centimeterAsPixel(this.value,a)}else{if(this.unit==th.formlayout.ConstantSize.DIALOG_UNITS_X){return th.formlayout.Sizes.dialogUnitXAsPixel(this.intValue(),a)}else{if(this.unit==th.formlayout.ConstantSize.DIALOG_UNITS_Y){return th.formlayout.Sizes.dialogUnitYAsPixel(this.intValue(),a)}else{throw"Invalid unit "+this.unit}}}}}}}}},maximumSize:function(b,d,a,f,c){return this.getPixelSize(b)},compressible:function(){return false},equals:function(b){if(this==b){return true}if(!(b instanceof th.formlayout.ConstantSize)){return false}var a=b;return this.value==a.value&&this.unit==a.unit},hashCode:function(){return this.value+37*this.unit.hashCode()},toString:function(){return this.value+unit.abbreviation()},encode:function(){return this.value+unit.encode()},intValue:function(){return Math.round(this.value)}}});th.formlayout.ConstantSize.valueOf=function(h,a){var d=th.formlayout.ConstantSize.splitValueAndUnit(h);var c=d[0];var b=d[1];var f=th.formlayout.Unit.valueOf(b,a);var g=parseFloat(c);if(f.requiresIntegers){if(g!=parseInt(g)){throw f.toString()+" value "+c+" must be an integer."}}return new th.formlayout.ConstantSize(g,f)};th.formlayout.ConstantSize.dluX=function(a){return new th.formlayout.ConstantSize(a,th.formlayout.ConstantSize.DLUX)};th.formlayout.ConstantSize.dluY=function(a){return new th.formlayout.ConstantSize(a,th.formlayout.ConstantSize.DLUY)};th.formlayout.ConstantSize.splitValueAndUnit=function(d){var b=[];var a=d.length;var c=a;while(c>0&&(!/[^a-zA-Z]/.test(d.charAt(c-1)))){c--}b[0]=d.substring(0,c);b[1]=d.substring(c);return b};th.formlayout.ConstantSize.PIXEL=new th.formlayout.Unit("Pixel","px",undefined,true);th.formlayout.ConstantSize.EM=new th.formlayout.Unit("Em","em",undefined,false);th.formlayout.ConstantSize.POINT=new th.formlayout.Unit("Point","pt",undefined,false);th.formlayout.ConstantSize.DIALOG_UNITS_X=new th.formlayout.Unit("Dialog units X","dluX","dlu",true);th.formlayout.ConstantSize.DIALOG_UNITS_Y=new th.formlayout.Unit("Dialog units Y","dluY","dlu",true);th.formlayout.ConstantSize.MILLIMETER=new th.formlayout.Unit("Millimeter","mm",undefined,false);th.formlayout.ConstantSize.CENTIMETER=new th.formlayout.Unit("Centimeter","cm",undefined,false);th.formlayout.ConstantSize.INCH=new th.formlayout.Unit("Inch","in",undefined,false);th.formlayout.ConstantSize.PX=th.formlayout.ConstantSize.PIXEL;th.formlayout.ConstantSize.PT=th.formlayout.ConstantSize.POINT;th.formlayout.ConstantSize.DLUX=th.formlayout.ConstantSize.DIALOG_UNITS_X;th.formlayout.ConstantSize.DLUY=th.formlayout.ConstantSize.DIALOG_UNITS_Y;th.formlayout.ConstantSize.MM=th.formlayout.ConstantSize.MILLIMETER;th.formlayout.ConstantSize.CM=th.formlayout.ConstantSize.CENTIMETER;th.formlayout.ConstantSize.IN=th.formlayout.ConstantSize.INCH;th.formlayout.PrototypeSize=Class.define({members:{init:function(a){this.proto=a},getPrototype:function(){return this.proto},maximumSize:function(b,d,a,f,c){throw"PrototypeSize.maximumSize() not yet implemented"},compressible:function(){return false},encode:function(){return"'"+this.proto+"'"},equals:function(a){if(this==a){return true}if(!(a instanceof th.formlayout.PrototypeSize)){return false}return this.proto==a.proto},toString:function(){return this.encode()}}});th.formlayout.ComponentSize=Class.define({members:{init:function(a){this.name=a},maximumSize:function(b,m,d,j,h){var a=this==th.formlayout.Sizes.MINIMUM?d:(this==th.formlayout.Sizes.PREFERRED?j:h);var f=0;for(var g=0;g<m.length;g++){var n=m[g];f=Math.max(f,a(n))}return f},compressible:function(){return this==th.formlayout.Sizes.DEFAULT},toString:function(){return this.encode()},encode:function(){return name.substring(0,1)}}});th.formlayout.ComponentSize.valueOf=function(a){if(a=="m"||a=="min"){return th.formlayout.Sizes.MINIMUM}if(a=="p"||a=="pref"){return th.formlayout.Sizes.PREFERRED}if(a=="d"||a=="default"){return th.formlayout.Sizes.DEFAULT}return};th.formlayout.DefaultUnitConverter=Class.define({members:{inchAsPixel:function(b,a){return th.convertAbsoluteUnitToPixels("in",b)},millimeterAsPixel:function(b,a){return th.convertAbsoluteUnitToPixels("mm",b)},centimeterAsPixel:function(a,b){return th.convertAbsoluteUnitToPixels("cm",a)},pointAsPixel:function(b,a){return th.convertAbsoluteUnitToPixels("pt",b)},emAsPixel:function(b,a){return th.convertEmToPixels(a.cssValue("font"),b)},dialogUnitXAsPixel:function(b,a){throw"Unsupported"},dialogUnitYAsPixel:function(b,a){throw"Unsupported"}}});th.formlayout.Sizes={};th.formlayout.Sizes.unitConverter=new th.formlayout.DefaultUnitConverter();th.formlayout.Sizes.pixel=function(a){return new th.formlayout.ConstantSize(a,th.formlayout.ConstantSize.PIXEL)};th.formlayout.Sizes.ZERO=th.formlayout.Sizes.pixel(0);th.formlayout.Sizes.DLUX1=th.formlayout.ConstantSize.dluX(1);th.formlayout.Sizes.DLUX2=th.formlayout.ConstantSize.dluX(2);th.formlayout.Sizes.DLUX3=th.formlayout.ConstantSize.dluX(3);th.formlayout.Sizes.DLUX4=th.formlayout.ConstantSize.dluX(4);th.formlayout.Sizes.DLUX5=th.formlayout.ConstantSize.dluX(5);th.formlayout.Sizes.DLUX6=th.formlayout.ConstantSize.dluX(6);th.formlayout.Sizes.DLUX7=th.formlayout.ConstantSize.dluX(7);th.formlayout.Sizes.DLUX8=th.formlayout.ConstantSize.dluX(8);th.formlayout.Sizes.DLUX9=th.formlayout.ConstantSize.dluX(9);th.formlayout.Sizes.DLUX11=th.formlayout.ConstantSize.dluX(11);th.formlayout.Sizes.DLUX14=th.formlayout.ConstantSize.dluX(14);th.formlayout.Sizes.DLUX21=th.formlayout.ConstantSize.dluX(21);th.formlayout.Sizes.DLUY1=th.formlayout.ConstantSize.dluY(1);th.formlayout.Sizes.DLUY2=th.formlayout.ConstantSize.dluY(2);th.formlayout.Sizes.DLUY3=th.formlayout.ConstantSize.dluY(3);th.formlayout.Sizes.DLUY4=th.formlayout.ConstantSize.dluY(4);th.formlayout.Sizes.DLUY5=th.formlayout.ConstantSize.dluY(5);th.formlayout.Sizes.DLUY6=th.formlayout.ConstantSize.dluY(6);th.formlayout.Sizes.DLUY7=th.formlayout.ConstantSize.dluY(7);th.formlayout.Sizes.DLUY8=th.formlayout.ConstantSize.dluY(8);th.formlayout.Sizes.DLUY9=th.formlayout.ConstantSize.dluY(9);th.formlayout.Sizes.DLUY11=th.formlayout.ConstantSize.dluY(11);th.formlayout.Sizes.DLUY14=th.formlayout.ConstantSize.dluY(14);th.formlayout.Sizes.DLUY21=th.formlayout.ConstantSize.dluY(21);th.formlayout.Sizes.MINIMUM=new th.formlayout.ComponentSize("minimum");th.formlayout.Sizes.PREFERRED=new th.formlayout.ComponentSize("preferred");th.formlayout.Sizes.DEFAULT=new th.formlayout.ComponentSize("default");th.formlayout.Sizes.defaultUnit=th.formlayout.ConstantSize.PIXEL;th.formlayout.Sizes.constant=function(d,a){var b=d.toLowerCase();var c=th.trim(b);return th.formlayout.ConstantSize.valueOf(c,a)};th.formlayout.Sizes.bounded=function(b,c,a){return th.formlayout.BoundedSize(b,c,a)};th.formlayout.Sizes.emAsPixel=function(b,a){return b==0?0:th.formlayout.Sizes.unitConverter.emAsPixel(b,a)};th.formlayout.Sizes.inchAsPixel=function(b,a){return b==0?0:th.formlayout.Sizes.unitConverter.inchAsPixel(b,a)};th.formlayout.Sizes.millimeterAsPixel=function(b,a){return b==0?0:th.formlayout.Sizes.unitConverter.millimeterAsPixel(b,a)};th.formlayout.Sizes.centimeterAsPixel=function(a,b){return a==0?0:th.formlayout.Sizes.unitConverter.centimeterAsPixel(a,b)};th.formlayout.Sizes.pointAsPixel=function(b,a){return b==0?0:th.formlayout.Sizes.unitConverter.pointAsPixel(b,a)};th.formlayout.Sizes.dialogUnitXAsPixel=function(b,a){return b==0?0:th.formlayout.Sizes.unitConverter.dialogUnitXAsPixel(b,a)};th.formlayout.Sizes.dialogUnitYAsPixel=function(b,a){return b==0?0:th.formlayout.Sizes.unitConverter.dialogUnitYAsPixel(b,a)};th.formlayout.Sizes.getDefaultUnit=function(){return th.formlayout.Sizes.defaultUnit};th.formlayout.Alignment=Class.define({members:{init:function(b,a){this.name=b;this.orientation=a},toString:function(){return this.name},abbreviation:function(){return this.name.charAt(0)},isHorizontal:function(){return this.orientation!=th.formlayout.Alignment.VERTICAL},isVertical:function(){return this.orientation!=th.formlayout.Alignment.HORIZONTAL}}});th.formlayout.Alignment.HORIZONTAL=0;th.formlayout.Alignment.VERTICAL=1;th.formlayout.Alignment.BOTH=2;th.formlayout.Alignment.valueOf=function(a){var b=a.toLowerCase();if(b=="d"||b=="default"){return th.formlayout.CellConstraints.DEFAULT}else{if(b=="f"||b=="fill"){return th.formlayout.CellConstraints.FILL}else{if(b=="c"||b=="center"){return th.formlayout.CellConstraints.CENTER}else{if(b=="l"||b=="left"){return th.formlayout.CellConstraints.LEFT}else{if(b=="r"||b=="right"){return th.formlayout.CellConstraints.RIGHT}else{if(b=="t"||b=="top"){return th.formlayout.CellConstraints.TOP}else{if(b=="b"||b=="bottom"){return th.formlayout.CellConstraints.BOTTOM}else{throw"Invalid alignment "+a+". Must be one of: left, center, right, top, bottom, fill, default, l, c, r, t, b, f, d."}}}}}}}};th.formlayout.CellConstraints=Class.define({members:{init:function(b,i,g,f,d,h,c){var a=undefined;if(th.isString(b)){a=b;delete b}this.gridX=(b==undefined)?1:b;this.gridY=(i==undefined)?1:i;this.gridWidth=(g==undefined)?1:g;this.gridHeight=(f==undefined)?1:f;this.hAlign=d||th.formlayout.CellConstraints.DEFAULT;this.vAlign=h||th.formlayout.CellConstraints.DEFAULT;this.insets=c||th.formlayout.CellConstraints.EMPTY_INSETS;if(this.gridX<=0){throw new th.formlayout.IndexOutOfBoundsException("The grid x must be a positive number.")}if(this.gridY<=0){throw new th.formlayout.IndexOutOfBoundsException("The grid y must be a positive number.")}if(this.gridWidth<=0){throw new th.formlayout.IndexOutOfBoundsException("The grid width must be a positive number.")}if(this.gridHeight<=0){throw new th.formlayout.IndexOutOfBoundsException("The grid height must be a positive number.")}this.ensureValidOrientations(this.hAlign,this.vAlign);if(a){this.initFromConstraints(a)}},ensureValidOrientations:function(a,b){if(!a.isHorizontal()){throw new th.formlayout.IllegalArgumentException("The horizontal alignment must be one of: left, center, right, fill, default.")}if(!b.isVertical()){throw new th.formlayout.IllegalArgumentException("The vertical alignment must be one of: top, center, botto, fill, default.")}},initFromConstraints:function(a){var d=a.split(",");var g=d.length;if(!(g==2||g==4||g==6)){throw new th.formlayout.IllegalArgumentException("You must provide 2, 4 or 6 arguments.")}var b=0;var f=parseInt(th.trim(d[b++]));if(!f){throw new th.formlayout.IllegalArgumentException("First cell constraint element must be a number.")}this.gridX=f;if(this.gridX<=0){throw new th.formlayout.IndexOutOfBoundsException("The grid x must be a positive number.")}f=parseInt(th.trim(d[b++]));if(!f){throw new th.formlayout.IllegalArgumentException("Second cell constraint element must be a number.")}this.gridY=f;if(this.gridY<=0){throw new th.formlayout.IndexOutOfBoundsException("The grid y must be a positive number.")}if(b>=d.length){return}var c=th.trim(d[b++]);f=parseInt(c);if(f){this.gridWidth=f;if(this.gridWidth<=0){throw new th.formlayout.IndexOutOfBoundsException("The grid width must be a positive number.")}f=parseInt(th.trim(d[b++]));if(f==null){throw new th.formlayout.IllegalArgumentException("Fourth cell constraint element must be like third.")}this.gridHeight=f;if(this.gridHeight<=0){throw new th.formlayout.IndexOutOfBoundsException("The grid height must be a positive number.")}if(b>=d.length){return}c=th.trim(d[b++])}this.hAlign=this.decodeAlignment(c);this.vAlign=this.decodeAlignment(th.trim(d[b++]));this.ensureValidOrientations(this.hAlign,this.vAlign)},ensureValidGridBounds:function(b,a){if(this.gridX<=0){throw new th.formlayout.IndexOutOfBoundsException("The column index "+this.gridX+" must be positive.")}if(this.gridX>b){throw new th.formlayout.IndexOutOfBoundsException("The column index "+this.gridX+" must be less than or equal to "+b+".")}if(this.gridX+this.gridWidth-1>b){throw new th.formlayout.IndexOutOfBoundsException("The grid width "+this.gridWidth+" must be less than or equal to "+(b-this.gridX+1)+".")}if(this.gridY<=0){throw new th.formlayout.IndexOutOfBoundsException("The row index "+this.gridY+" must be positive.")}if(this.gridY>a){throw new th.formlayout.IndexOutOfBoundsException("The row index "+this.gridY+" must be less than or equal to "+a+".")}if(this.gridY+this.gridHeight-1>a){throw new th.formlayout.IndexOutOfBoundsException("The grid height "+this.gridHeight+" must be less than or equal to "+(a-this.gridY+1)+".")}},decodeAlignment:function(a){return th.formlayout.Alignment.valueOf(a)},setBounds:function(C,B,u,d,g,A,f){var D=this.gridWidth==1?B.getColumnSpec(this.gridX):undefined;var v=this.gridHeight==1?B.getRowSpec(this.gridY):undefined;var p=this.concreteAlignment(this.hAlign,D);var m=this.concreteAlignment(this.vAlign,v);var q=this.insets?this.insets:th.formlayout.CellConstraints.EMPTY_INSETS;var s=u.x+q.left;var r=u.y+q.top;var z=u.width-q.left-q.right;var a=u.height-q.top-q.bottom;var b=this.componentSize(C,D,z,d,A);var o=this.componentSize(C,v,a,g,f);var j=this.origin(p,s,z,b);var i=this.origin(m,r,a,o);var n=this.extent(p,z,b);var t=this.extent(m,a,o);C.setBounds(j,i,n,t)},concreteAlignment:function(a,b){return !b?(a==th.formlayout.CellConstraints.DEFAULT?th.formlayout.CellConstraints.FILL:a):this.usedAlignment(a,b)},usedAlignment:function(a,b){if(a!=th.formlayout.CellConstraints.DEFAULT){return a}var c=b.getDefaultAlignment();if(c==th.formlayout.FormSpec.FILL_ALIGN){return th.formlayout.CellConstraints.FILL}if(c==th.formlayout.ColumnSpec.LEFT){return th.formlayout.CellConstraints.LEFT}else{if(c==th.formlayout.FormSpec.CENTER_ALIGN){return th.formlayout.CellConstraints.CENTER}else{if(c==th.formlayout.ColumnSpec.RIGHT){return th.formlayout.CellConstraints.RIGHT}else{if(c==th.formlayout.RowSpec.TOP){return th.formlayout.CellConstraints.TOP}else{return th.formlayout.CellConstraints.BOTTOM}}}}},componentSize:function(c,b,f,a,d){if(!b){return d(c)}else{if(b.getSize()==th.formlayout.Sizes.MINIMUM){return a(c)}else{if(b.getSize()==th.formlayout.Sizes.PREFERRED){return d(c)}else{return Math.min(f,d(c))}}}},origin:function(d,b,c,a){if(d==th.formlayout.CellConstraints.RIGHT||d==th.formlayout.CellConstraints.BOTTOM){return b+c-a}else{if(d==th.formlayout.CellConstraints.CENTER){return b+(c-a)/2}else{return b}}},extent:function(c,b,a){return c==th.formlayout.CellConstraints.FILL?b:a},toString:function(){var a="CellConstraints";a+="[x=";a+=this.gridX;a+="; y=";a+=this.gridY;a+="; w=";a+=this.gridWidth;a+="; h=";a+=this.gridHeight;a+="; hAlign=";a+=this.hAlign;a+="; vAlign=";a+=this.vAlign;a+="; honorsVisibility=";a+=this.honorsVisibility;a+="]";return a},xy:function(){var a=arguments;switch(arguments.length){case 2:return this.xywh(a[0],a[1],1,1);case 3:return this.xywh(a[0],a[1],1,1,a[2]);case 4:return this.xywh(a[0],a[1],1,1,a[2],a[3]);default:throw"wrong number of arguments passed to xy()"}},xyw:function(){var a=arguments;switch(arguments.length){case 3:return this.xywh(a[0],a[1],a[2],1,th.formlayout.CellConstraints.DEFAULT,th.formlayout.CellConstraints.DEFAULT);case 4:return this.xywh(a[0],a[1],a[2],1,a[3]);case 5:return this.xywh(a[0],a[1],a[2],1,a[3],a[4]);default:throw"wrong number of arguments passed to xyw()"}},xywh:function(){var b=arguments;switch(arguments.length){case 4:return this.xywh(b[0],b[1],b[2],b[3],th.formlayout.CellConstraints.DEFAULT,th.formlayout.CellConstraints.DEFAULT);case 5:var a=this.xywh(b[0],b[1],b[2],b[3]);a.setAlignment(b[4],true);return a;case 6:this.gridX=b[0];this.gridY=b[1];this.gridWidth=b[2];this.gridHeight=b[3];this.hAlign=b[4];this.vAlign=b[5];this.ensureValidOrientations(this.hAlign,this.vAlign);return this;default:throw"wrong number of arguments passed to xywh()"}}}});th.formlayout.CellConstraints.DEFAULT=new th.formlayout.Alignment("default",th.formlayout.Alignment.BOTH);th.formlayout.CellConstraints.FILL=new th.formlayout.Alignment("fill",th.formlayout.Alignment.BOTH);th.formlayout.CellConstraints.LEFT=new th.formlayout.Alignment("left",th.formlayout.Alignment.HORIZONTAL);th.formlayout.CellConstraints.RIGHT=new th.formlayout.Alignment("right",th.formlayout.Alignment.HORIZONTAL);th.formlayout.CellConstraints.CENTER=new th.formlayout.Alignment("center",th.formlayout.Alignment.BOTH);th.formlayout.CellConstraints.TOP=new th.formlayout.Alignment("top",th.formlayout.Alignment.VERTICAL);th.formlayout.CellConstraints.BOTTOM=new th.formlayout.Alignment("bottom",th.formlayout.Alignment.VERTICAL);th.formlayout.CellConstraints.EMPTY_INSETS={top:0,left:0,bottom:0,right:0};th.formlayout.FormSpecParser=Class.define({members:{init:function(c,b,d,a){this.layoutMap=d;this.source=c},parseColumnSpecs:function(){var b=this.split(this.source,0);var d=b.length;var a=[];for(var c=0;c<d;c++){var f=b[c];a[c]=th.formlayout.ColumnSpec.decodeExpanded(f)}return a},parseRowSpecs:function(){var d=this.split(this.source,0);var a=d.length;var c=[];for(var b=0;b<a;b++){var f=d[b];c[b]=th.formlayout.RowSpec.decodeExpanded(f)}return c},split:function(h,f){var p=[];var b=0;var j=0;var a=h.length;var o=0;var n;var m=true;for(var g=0;g<a;g++){n=h.charAt(g);if(m&&th.isWhitespace(n)){o++;continue}m=false;if((n==",")&&(b==0)&&(j==0)){var d=h.substring(o,g);this.addSpec(p,d,f+o);o=g+1;m=true}else{if(n=="("){if(j>0){this.fail(f+g,"illegal '(' in [...]")}b++}else{if(n==")"){if(j>0){this.fail(f+g,"illegal ')' in [...]")}b--;if(b<0){this.fail(f+g,"missing '('")}}else{if(n=="["){if(j>0){this.fail(f+g,"too many '['")}j++}else{if(n=="]"){j--;if(j<0){this.fail(f+g,"missing '['")}}}}}}}if(b>0){this.fail(f+a,"missing ')'")}if(j>0){this.fail(f+a,"missing ']")}if(o<a){var d=h.substring(o);this.addSpec(p,d,f+o)}return p},addSpec:function(c,g,f){var b=th.trim(g);var h=this.multiplier(b,f);if(!h){c.push(b);return}var d=this.split(h.expression,f+h.offset);for(var a=0;a<h.multiplier;a++){th.forEach(d,function(i){c.push(i)})}},multiplier:function(h,f){var g=new RegExp(th.formlayout.FormSpecParser.MULTIPLIER_PREFIX_PATTERN);if(!g.test(h)){return}var b=g.exec(h);b.end=b.index+b[0].length;if(b.index>0){this.fail(f+b.index,"illegal multiplier position")}var a=new RegExp(th.formlayout.DIGIT_PATTERN);if(!a.test(h)){return}var j=a.exec(h);j.end=b.index+b[0].length;var i=h.substring(0,j.end);var c=parseInt(i);if(isNaN(c)){this.fail(f,"Invalid multiplier")}if(c<=0){this.fail(f,"illegal 0 multiplier")}var d=h.substring(b.end,h.length()-1);return{multiplier:c,expression:d,offset:b.end}},fail:function(a,b,c){if(!c){c=this.source}throw new th.formlayout.FormLayoutParseException(this.message(c,a,b))},message:function(f,b,d){var a="\n";a+="\n";a+=f;a+="\n";for(var c=0;c<b;c++){a+=" "}a+="^";a+=d;return a}}});th.formlayout.FormSpecParser.parseColumnSpecs=function(a,b){var c=new th.formlayout.FormSpecParser(a,"encoded column specifications",b,true);return c.parseColumnSpecs()};th.formlayout.FormSpecParser.parseRowSpecs=function(a,b){var c=new th.formlayout.FormSpecParser(a,"encoded column specifications",b,false);return c.parseRowSpecs()};th.formlayout.FormSpecParser.MULTIPLIER_PREFIX_PATTERN="\\d+\\s*\\*\\s*\\(";th.formlayout.FormSpecParser.DIGIT_PATTERN="\\d+";