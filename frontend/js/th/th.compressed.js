(function(){var c=false;var d=/xyz/.test(function(){xyz})?/\b_super\b/:{test:function(){return true}};this.Class=function(){this.type="Class"};Class.define=function(s){if(!s.superclass){s.superclass=Class}var q=s.superclass.prototype,t=s.members||{};c=true;var m=new s.superclass();c=false;if(s.uses){var p=Trait.define({uses:s.uses,_klass_prototype:m,_klass_properties:t});for(var n in p._exports){if(!p._exports.hasOwnProperty(n)){continue}if(t.hasOwnProperty(n)){if(typeof t[n]!="function"){throw new Trait.TraitError(n+" overrides trait method and must be a function.")}}else{t[n]=p._exports[n]}}}for(var l in t){if(!t.hasOwnProperty(l)){continue}m[l]=typeof t[l]=="function"&&typeof q[l]=="function"&&d.test(t[l])?(function(o,u){return function(){var w=this._super;this._super=q[o];var v=u.apply(this,arguments);this._super=w;return v}})(l,t[l]):t[l]}var j=function(){if(!c&&this.init){this.init.apply(this,arguments)}};j.prototype=m;j.constructor=j;j.superclass=s.superclass;j.prototype.type=s.type;j.does=function(v){if(!p){if(j.superclass.does){return j.superclass.does(v)}if(v){return false}return[]}var u=p.does(v);if(j.superclass.does){if(v){return u||j.superclass.does(v)}var w=j.superclass.does(v).concat([]);for(var o=u.length-1;o>=0;o--){if(w.indexOf(u[o])===-1){w.push(u[o])}}return w}return u};if(!j.prototype.hasOwnProperty("does")){j.prototype.does=j.does}return j};function a(j){return Object.prototype.toString.apply(j)==="[object Array]"}function h(j){if(j){return a(j)?j:[j]}return[]}function f(j){if(!j){return{}}var l={};if(!a(j)){l[j]=true;return l}for(var m=j.length-1;m>=0;m--){l[j[m]]=true}return l}function i(m,l){for(var j in l){if(!l.hasOwnProperty(j)){continue}m[j]=l[j]}return m}this.Trait=Class.define({members:{init:function(p){this._subtraits=h(p.uses);this._requires=f(p.requires);this._exports=p.methods?p.methods:{};var m;for(m in this._requires){if(!this._requires.hasOwnProperty(m)){continue}if(this._exports.hasOwnProperty(m)){throw new Trait.TraitError("Trait cannot require and provide the same method "+m)}}var n,j,l,q={};for(l=this._subtraits.length-1;l>=0;l--){n=this._subtraits[l];j=i({},n._exports);if(n._aliases){i(j,n._aliases)}if(n._excludes){for(m in n._excludes){if(!n._excludes.hasOwnProperty(m)){continue}delete j[m];i(q,n._excludes)}}for(m in j){if(!j.hasOwnProperty(m)){continue}if(p._klass_prototype&&p._klass_properties.hasOwnProperty(m)&&typeof p._klass_properties[m]=="function"){continue}if(this._exports.hasOwnProperty(m)){if((!p.methods||!p.methods.hasOwnProperty(m))&&this._exports[m]!=j[m]){throw new Trait.TraitError("Multiple subtraits provide method "+m+" creating a conflict. Exclude all but one of the methods or override the method in the trait/class to resolve.")}continue}this._exports[m]=j[m]}for(m in n._requires){if(!n._requires.hasOwnProperty(m)){continue}if(!this._exports.hasOwnProperty(m)){this._requires[m]=true}}delete n._aliases;delete n._excludes}for(m in q){if(!q.hasOwnProperty(m)){continue}if(!this._exports.hasOwnProperty(m)&&(!p._klass_prototype||(typeof p._klass_prototype[m]!="function"&&typeof p._klass_properties[m]!="function"))){throw new Trait.TraitError("Excluded method "+m+" must be provided by another class or trait.")}}for(m in this._requires){if(!this._requires.hasOwnProperty(m)){continue}if(this._exports.hasOwnProperty(m)){delete this._requires[m]}else{if(p._klass_prototype&&(typeof p._klass_prototype[m]!="function"&&typeof p._klass_properties[m]!="function")){throw new Trait.TraitError("Trait requirement "+m+" not fullfilled by class.")}}}},aliases:function(l){this._aliases=this._aliases||{};for(var j in l){if(!l.hasOwnProperty(j)){continue}if(!this._exports.hasOwnProperty(l[j])){throw new Trait.TraitError("can't alias "+j+" to "+l[j]+" because trait doesn't have that method")}if(this._exports.hasOwnProperty(j)){throw new Trait.TraitError("can't create an alias with name "+j+" because trait natively exports that method")}if(this._requires.hasOwnProperty(j)){throw new Trait.TraitError("can't create an alias with name "+j+" because trait requires method with same name")}this._aliases[j]=this._exports[l[j]]}return this},excludes:function(j){this._excludes=this._excludes||{};j=h(j);for(var l=j.length-1;l>=0;l--){if(!this._exports.hasOwnProperty(j[l])){throw new Trait.TraitError("can't exclude method "+j[l]+" because no such method exists in trait")}this._excludes[j[l]]=true}return this},does:function(o){if(!this._does){this._does=[this].concat(this._subtraits);var n,m,l;for(n=this._subtraits.length-1;n>=0;n--){l=this._subtraits[n].does();for(m=l.length-1;m>=0;m--){if(this._does.indexOf(l[m])===-1){this._does.push(l[m])}}}}if(o){return this._does.indexOf(o)>=0}return this._does},requires:function(j){if(j){return this._requires.hasOwnProperty(j)&&this._requires[j]}return this._requires},subtraits:function(j){if(j){return this._subtraits.indexOf(j)>=0}return this._subtraits},methods:function(j){if(j){return this._exports.hasOwnProperty(j)&&this._exports[j]}return this._exports}}});Trait.define=function(j){return new Trait(j)};Trait.TraitError=Class.define({superclass:Error,members:{init:function(j){this.name="TraitError";this.message=j}}})})();if(!("console" in window)){window.console={log:function(a){}}}if(location.href.indexOf("file:")==0){try{if(netscape.security.PrivilegeManager.enablePrivilege){netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead")}}catch(ex){console.log("Couldn't elevate priviledges to deal with file URLs")}}if(typeof th=="undefined"){th={}}th.browser={IE:!!(window.attachEvent&&!window.opera),Opera:!!window.opera,WebKit:navigator.userAgent.indexOf("AppleWebKit/")>-1,Gecko:navigator.userAgent.indexOf("Gecko")>-1&&navigator.userAgent.indexOf("KHTML")==-1,MobileSafari:!!navigator.userAgent.match(/Apple.*Mobile.*Safari/)};th.fixCanvas=function(a){if(!a.fillText&&a.mozDrawText){a.fillText=function(f,c,h,d){a.translate(c,h);a.mozTextStyle=a.font;a.mozDrawText(f);a.translate(-c,-h)}}if(!a.measureText&&a.mozMeasureText){a.measureText=function(d){if(a.font){a.mozTextStyle=a.font}var c=a.mozMeasureText(d);return{width:c}}}if(a.measureText&&!a.html5MeasureText){a.html5MeasureText=a.measureText;a.measureText=function(d){var c=a.html5MeasureText(d);c.ascent=a.html5MeasureText("m").width;return c}}if(!a.fillText){a.fillText=function(){}}if(!a.measureText){a.measureText=function(){return 10}}return a};th.byId=function(a){return document.getElementById(a)};th.isString=function(a){return !!arguments.length&&a!=null&&(typeof a=="string"||a instanceof String)};th.isArray=function(a){return a&&(a instanceof Array||typeof a=="array")};th.forEach=function(c,j,f){if(!c||!c.length){return}var a=th._getParts(c,f,j);c=a[0];for(var h=0,d=c.length;h<d;++h){a[2].call(a[1],c[h],h,c)}};th._getParts=function(c,d,a){return[th.isString(c)?c.split(""):c,d||this,th.isString(a)?new Function("item","index","array",a):a]};th.xhrGet=function(a){var c=new XMLHttpRequest();c.onreadystatechange=function(){if(c.readyState==4){a.load.apply(a.context,[c.responseText])}};c.open("GET",a.url);c.send(null)};th.remove=function(f,c){var d=[];for(var a=0;a<f.length;a++){if(f[a]!=c){d.push(f[a])}}return d};th.observe=function(h,a,f,c){var i=(c)?function(j){f.apply(c,[j])}:f;var d=h["on"+a];if(typeof d=="function"){h["on"+a]=function(j){if(d){d(j)}i(j)}}else{h["on"+a]=i}};th.loadImg=function(c,d){var a=new Image();if(th.isFunction(d)){a.onload=d}a.src=c;return a};th.trim=String.prototype.trim?function(a){if(a==undefined){return a}return a.trim()}:function(a){if(a==undefined){return a}return a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")};th.mixin=function(f,d){if(!f){f={}}for(var c=1,a=arguments.length;c<a;c++){th._mixin(f,arguments[c])}return f};th._mixin_tobj={};th._mixin=function(f,c){for(var a in c){if(th._mixin_tobj[a]===undefined||th._mixin_tobj[a]!=c[a]){f[a]=c[a]}}if(th.browser.IE&&c){var d=c.toString;if(typeof d=="function"&&d!=f.toString&&d!=th._mixin_tobj.toString&&d!="\nfunction toString() {\n    [native code]\n}\n"){f.toString=c.toString}}return f};th.cumulativeOffset=function(c){var a=0,d=0;do{a+=c.offsetTop||0;d+=c.offsetLeft||0;c=c.offsetParent}while(c);return th._returnOffset(d,a)};th._returnOffset=function(c,d){var a=[c,d];a.left=c;a.top=d;return a};th.isPercentage=function(a){return(a.indexOf&&a.indexOf("%")!=-1)};th.isCssPixel=function(a){a=th.trim(a).toLowerCase();return(a.indexOf("px")==a.length-2)};th.isCssLength=function(a){if(a===undefined){return false}if(a==0){return true}return/^[\d\.]+(em|ex|px|\%|in|cm|mm|pt|pc)$/.test(a)};th.isCssBorderStyle=function(a){return/^(none|hidden|dotted|dashed|solid|double|groove|ridge|inset|outset)$/.test(a)};th.defaultCSSBorder=function(){return{top:{width:0,style:"none",color:"black"},bottom:{width:0,style:"none",color:"black"},left:{width:0,style:"none",color:"black"},right:{width:0,style:"none",color:"black"}}};th.defaultCSSMargin=function(){return{top:0,bottom:0,left:0,right:0}};th.defaultCSSPadding=function(){return{top:0,bottom:0,left:0,right:0}};th.getSpaceDelimitedItems=function(a){return th.parenAwareSplit(" ",a)};th.getCommaDelimitedItems=function(a){return th.parenAwareSplit(",",a)};th.lastArrayItem=function(a){return a[a.length-1]};th.removeArrayItem=function(a,c){return a.splice(a.indexOf(c),1)};th.stopEvent=function(a){a.preventDefault()};th.getSceneById=function(c){for(var a=0;a<th.global_scene_array.length;a++){if(th.global_scene_array[a].id==c){return th.global_scene_array[a]}}};th.parenAwareSplit=function(j,d){if(j.length!=1){throw"Invalid delimiter passed to parenAwareSplit: '"+j+"'"}var h=[];var c=0;var i;var f="";for(var a=0;a<d.length;a++){i=d[a];if(i==j){if(!c){h.push(th.trim(f));f="";continue}}else{if(i=="("){c++}else{if(i==")"){c--}}}f+=i}h.push(th.trim(f));return h};th.whitespace=" \t\n\r";th.isWhitespace=function(d){if(!d||d.length==0){return true}for(var a=0;a<d.length;a++){var f=d.charAt(a);if(th.whitespace.indexOf(f)==-1){return false}}return true};th.measureUsingDOM=function(f,d){if(!document){throw"Can't perform measurements outside of browser"}var a=document.getElementsByTagName("body")[0];var c=document.createElement("div");c.setAttribute("style","position: absolute; visibility:hidden");a.appendChild(c);if(d){f.apply(d,[c])}else{f(c)}a.removeChild(c)};th.measure_cache={};th.safeget=function(c,a){return(c==undefined)?a:c};th.unitRegex=/^([\d\.]+)(em|ex|px|\%|in|cm|mm|pt|pc)$/;th.absoluteUnitRegex=/^([\d\.]+)(px|in|cm|mm|pt|pc)$/;th.isBorderLength=function(a){return(a=="thin"||a=="medium"||a=="thick")};th.convertLengthToPixels=function(c,a){if(c==0){return 0}if(th.isBorderLength(c)){return th.convertBorderLengthToPixels(c)}else{if(th.absoluteUnitRegex.test(c)){return th.convertAbsoluteUnitToPixels(c)}}};th.convertBorderLengthToPixels=function(c){if(c===undefined){return 0}var d=c;if(th.measure_cache[d]){return th.measure_cache[d]}var a=undefined;th.measureUsingDOM(function(f){f.setAttribute("style","position: relative; border-left: "+c+" solid black");f.innerHTML="some text";a=f.scrollWidth-f.clientWidth});th.measure_cache[d]=a;return a};th.convertAbsoluteUnitToPixels=function(a,f){var d;if(f===undefined){var c=th.absoluteUnitRegex.exec(a);if(c.length!=3){throw"Passed length "+a+" isn't a CSS absolute unit"}d=c[2];f=Number(c[1])}else{d=a}if(d=="px"){return f}else{if(d=="in"||d=="cm"||d=="mm"||d=="pt"||d=="pc"){return th.measureAbsoluteUnit(f+d)}else{throw"Unsupported unit: "+d}}};th.measureAbsoluteUnit=function(c){if(c===undefined){return 0}var d=c;if(th.measure_cache[d]){return th.measure_cache[d]}var a=undefined;th.measureUsingDOM(function(h){var f=h.getAttribute("style");h.setAttribute("style",f+="; width: "+c);a=h.scrollWidth});th.measure_cache[d]=a;return a};th.convertEmToPixels=function(f,c){var d=f+c;if(th.measure_cache[d]){return th.measure_cache[d]}var a=undefined;th.measureUsingDOM(function(i){var h=i.getAttribute("style");i.setAttribute("style",h+="; font: "+f+"; width: "+c+"em");a=i.scrollWidth});th.measure_cache[d]=a;return a};th.getHierarchyString=function(c){var a="";while(c){var d=c.type;if(c.id){d+="#"+c.id}if(c.className){d+="."+c.className}a=d+=" "+a;c=c.parent}return th.trim(a)};th.isObject=function(a){return a!==undefined&&(a===null||typeof a=="object"||th.isArray(a)||th.isFunction(a))};th.isFunction=(function(){var a=function(c){return c&&(typeof c=="function"||c instanceof Function)};return a})();th.hitch=function(c,a){return function(){a.apply(c)}};th.delay=function(c,a,d){if(d){c=th.hitch(d,c)}setTimeout(c,a)};th.clone=function(h){var a;var j;if(typeof h=="number"||typeof h=="string"){return h}if(h instanceof Object){a={};for(var f in h){j=this.clone(h[f]);if(j!==undefined){a[f]=j}}return a}if(h instanceof Array){a=[];for(var d;d<h.length;d){j=this.clone(h[d]);if(j!==undefined){a[d]=j}}return a}};if(typeof th=="undefined"){th={}}th.CssParser=Class.define({members:{parse:function(c,a){if(!a){a={}}c=c.replace(/\s+/gi," ");th.forEach(this.munge(c,false).split("`b%"),function(d){d=d.split("%b`");if(d.length<2){return}d[0]=this.restore(d[0]);var f=a[d[0]]||{};a[d[0]]=th.mixin(f,this.parsedeclarations(d[1]))},this);return a},REbraces:/{[^{}]*}/,REfull:/\[[^\[\]]*\]|{[^{}]*}|\([^()]*\)|function(\s+\w+)?(\s*%b`\d+`b%){2}/,REatcomment:/\/\*@((?:[^\*]|\*[^\/])*)\*\//g,REcomment_string:/(?:\/\*(?:[^\*]|\*[^\/])*\*\/)|(\\.|"(?:[^\\\"]|\\.|\\\n)*"|'(?:[^\\\']|\\.|\\\n)*')/g,REmunged:/%\w`(\d+)`\w%/,uid:0,munged:{},munge:function(f,c){var a=this;f=f.replace(this.REatcomment,"$1").replace(this.REcomment_string,function(j,h){if(!h){return""}var i="%s`"+(++a.uid)+"`s%";a.munged[a.uid]=h.replace(/^\\/,"");return i});var d=c?this.REfull:this.REbraces;while(match=d.exec(f)){replacement="%b`"+(++this.uid)+"`b%";this.munged[this.uid]=match[0];f=f.replace(d,replacement)}return f},restore:function(a){if(a===undefined){return a}while(match=this.REmunged.exec(a)){a=a.replace(this.REmunged,this.munged[match[1]])}return th.trim(a)},parsedeclarations:function(c){var d=this.munged[c].replace(/(?:^\s*[{'"]\s*)|(?:\s*([^\\])[}'"]\s*$)/g,"$1");d=this.munge(d);var a={};th.forEach(d.split(";"),function(f){f=f.split(":");if(f.length<2){return}a[this.restore(f[0])]=this.restore(f[1])},this);return a}}});th.CssExpander=Class.define({members:{init:function(){this.expandRules={border:this.expandBorder,"border-top":this.expandBorderSide,"border-left":this.expandBorderSide,"border-right":this.expandBorderSide,"border-bottom":this.expandBorderSide,"border-width":this.expandBorderWidth,"border-image":this.expandBorderImage,margin:this.expandMarginOrPadding,padding:this.expandMarginOrPadding}},expand:function(d,c,a){if(!a){a={}}if(this.expandRules[d]){this.expandRules[d].apply(this,[d,c,a])}else{a[d]=c}return a},saveProperty:function(d,c,a){if(th.getSpaceDelimitedItems(c).length!=1&&d!="font"&&d!="-th-grid-cols"&&d!="-th-grid-rows"){console.error("th.CssExpander: Can't expand '"+d+"' with value '"+c+"'!")}a[d]=c},expandBorderWidth:function(d,c,a){this.expandSideNumbers("border-","-width",c,a)},expandMarginOrPadding:function(d,c,a){this.expandSideNumbers(d+"-","",c,a)},expandSideNumbers:function(h,c,f,d){var a=f.split(" ");if(a.length==3){a=[a[0],a[1],a[2],a[1]]}if(a.length==2){a=[a[0],a[1],a[0],a[1]]}if(a.length==1){a=[a[0],a[0],a[0],a[0]]}if(a.length>=4){this.saveProperty(h+"top"+c,a[0],d);this.saveProperty(h+"right"+c,a[1],d);this.saveProperty(h+"bottom"+c,a[2],d);this.saveProperty(h+"left"+c,a[3],d)}},expandBorder:function(d,c,a){this.expandBorderSide("border-top",c,a);this.expandBorderSide("border-right",c,a);this.expandBorderSide("border-bottom",c,a);this.expandBorderSide("border-left",c,a)},expandBorderSide:function(h,f,d){var a=th.getSpaceDelimitedItems(f);for(var c=0;c<a.length;c++){if(th.isCssLength(a[c])){this.saveProperty(h+"-width",a[c],d)}else{if(th.isCssBorderStyle(a[c])){this.saveProperty(h+"-style",a[c],d)}else{this.saveProperty(h+"-color",a[c],d)}}}},expandBorderImage:function(j,h,f){var c=th.getSpaceDelimitedItems(h);var a=["url","top","right","bottom","left","repeat-x","repeat-y"];for(var d=0;d<a.length;d++){this.saveProperty("border-image-"+a[d],c[d],f)}}}});th._cssExpander=new th.CssExpander();th.expandCssProperty=function(d,c,a){return th._cssExpander.expand(d,c,a)};if(typeof th=="undefined"){th={}}th.EventHelpers=new Trait({methods:{wrapEvent:function(f,c){var a=f.pageX-th.cumulativeOffset(this.canvas).left;var h=f.pageY-th.cumulativeOffset(this.canvas).top;var d=c.getComponentForPosition(a,h,true,c);f.thComponent=d;this.addComponentXY(f,c,d)},addComponentXY:function(i,f,d){if(!d.bounds){console.log("No dest bounds - "+d.type);console.log(d.bounds);console.log(d);return}var a=i.pageX-th.cumulativeOffset(this.canvas).left;var l=i.pageY-th.cumulativeOffset(this.canvas).top;var h={x:a,y:l};var j=d;while(j){h.x-=j.bounds.x;h.y-=j.bounds.y;j=j.parent;if(j==f){i.componentX=h.x-j.bounds.x;i.componentY=h.y-j.bounds.y;return}}}}});th.StringHelpers=new Trait({methods:{isPercentage:function(a){return a.indexOf&&a.indexOf("%")!=-1}}});th.ComponentHelpers=new Trait({methods:{d:function(){var a=this.getInsets();return{b:(this.bounds)?{x:this.bounds.x,y:this.bounds.y,w:this.bounds.width,h:this.bounds.height,iw:this.bounds.width-a.left-a.right,ih:this.bounds.height-a.top-a.bottom}:{},i:{l:a.left,r:a.right,t:a.top,b:a.bottom,w:a.left+a.right,h:a.top+a.bottom}}},shouldPaint:function(){return(this.shouldLayout()&&this.cssValue("visibility")!="hidden")},shouldLayout:function(){return(this.cssValue("display")!="none")},emptyInsets:function(){return{left:0,right:0,bottom:0,top:0}},resolveCss:function(){var c=th.global_resources;var n;var h=th.getHierarchyString(this);if(c.resolvedCssCache[h]){n=c.resolvedCssCache[h]}else{n={};var f;var m=["userAgentCss","userCss","authorCss"];for(var d=0;d<m.length;d++){var l=m[d];th.forEach(c[l],function(v){for(var q in v){var A=q.split(",");for(var B=0;B<A.length;B++){var t=th.trim(A[B]);var p=this.getSpecificity(t);var y=t.split(":");var z=y[0];y=(y.length>1)?y.slice(1):["(default)"];if(this.matchesSelector(z)){var x=v[q];for(f in x){for(var u=0;u<y.length;u++){var w=y[u];if(n[w]===undefined){n[w]={}}var o={value:x[f],selector:t,specificity:p};if(n[w][f]){o=this.getSpecificityWinner(o,n[w][f])}n[w][f]=o}}}}}},this)}c.resolvedCssCache[h]=n;this.blowCssCaches()}this.styles={};for(var j in n){for(var a in n[j]){if(this.styles[j]===undefined){this.styles[j]={}}this.styles[j][a]=n[j][a].value}}this.refreshCss=false},matchesSelector:function(a){var h=a.toLowerCase();if(h=="*"){return true}if(h.indexOf(">")!=-1){var d=h.split(">");if(d.length!=2){console.log("unsupported child selector syntax; must be SEL1 > SEL2, was '"+a+"'");return false}if(this.matchesSelector(th.trim(d[1]))){if(!this.parent){return false}return(this.parent.matchesSelector(th.trim(d[0])))}return false}if(h.indexOf(" ")!=-1){var d=h.split(" ");if(d.length!=2){console.log("unsupported ancestor selector syntax; must be SEL1 SEL2, was '"+a+"'");return false}if(this.matchesSelector(th.trim(d[1]))){var c=this.parent;while(c){if(c.matchesSelector(th.trim(d[0]))){return true}c=c.parent}return false}}if(h.indexOf(".")==0){if(!this.className){return false}if(this.className.toLowerCase()==h.substring(1)){return true}}if(h.indexOf("#")==0){if(!this.id){return false}return("#"+this.id).toLowerCase()==h}var f=this.type.toLowerCase();if(f==h){return true}if(this.id&&(h==(f+"#"+this.id))){return true}if(this.className&&(h==(f+"."+this.className.toLowerCase()))){return true}return false},getSpecificity:function(a,h){var d={a:0,b:0,c:0,d:0};if(h){d.a=1}var f=th.getSpaceDelimitedItems(a);for(var c=0;c<f.length;c++){var l=f[c];if(l=="*"||l=="+"||l==">"){continue}if(l.indexOf("#")==0){d.b+=1;continue}d.c+=l.split(".").length-1;var j=l.split(":");if(j.length==2){if(j[1]=="first-line"||j[1]=="first-letter"||j[1]=="before"||j[1]=="after"){d.d+=1}else{d.c+=1}}}return d},getSpecificityWinner:function(f,d){var c=f.specificity;var a=d.specificity;if(c.a>a.a){return f}if(a.a>c.a){return d}if(c.b>a.b){return f}if(a.b>c.b){return d}if(c.c>a.c){return f}if(a.c>c.c){return d}if(c.d>a.d){return f}if(a.d>c.d){return d}return f},paintBackground:function(q,l,f,n,v){var z=this.d();if(l===undefined){l=0}if(f===undefined){f=0}if(n===undefined){n=z.b.w}if(v===undefined){v=z.b.h}if(this.cssValue("background-color")){q.fillStyle=this.cssValue("background-color");q.fillRect(l,f,n,v)}if(this.cssValue("background-image")){var C=this.cssValue("background-image");var j=this.cssValue("background-repeat");var B=this.cssValue("background-position");var o=th.getCommaDelimitedItems(C);var a=(j)?j.split(","):[undefined];var c=(B)?B.split(","):[undefined];var u=Math.max(o.length,a.length,c.length);for(var t=0;t<u;t++){var m=t;if(t>=o.length){m=(o.length%t)-1}var s=this.processImage(th.trim(o[m]),n,v);if(s){var p=t;if(t>=a.length){p=(a.length%t)-1}var A=t;if(t>=c.length){A=(c.length%t)-1}this.paintImage(q,s,th.trim(a[p]),th.trim(c[A]),l,f,n,v)}}}},getFirstBackgroundImage:function(){var a=this.cssValue("background-image");if(a){var c=th.getCommaDelimitedItems(a);if(c[0]){a=th.global_resources.images[c[0]];if(a){return a}}}},processImage:function(E,s,z){if(E.indexOf("-webkit-gradient")==0){var A=E.substring(E.indexOf("(")+1,E.length-1);var n=th.getCommaDelimitedItems(A);for(var y=0;y<n.length;y++){n[y]=th.trim(n[y])}if(n[0]!="linear"){console.log('Unsupported gradient: "'+E+'"; only linear gradients supported');return undefined}var m=n[1].split(" ");var l=n[2].split(" ");var v=[];var t=[];v[0]=(m[0]=="top"||m[0]=="bottom")?m[1]:m[0];v[1]=(m[0]=="top"||m[0]=="bottom")?m[0]:m[1];t[0]=(l[0]=="top"||l[0]=="bottom")?l[1]:l[0];t[1]=(l[0]=="top"||l[0]=="bottom")?l[0]:l[1];var q=[v,t];for(var D=0;D<q.length;D++){var d=q[D];for(var C=0;C<d.length;C++){if(d[C]=="top"){d[C]="0%"}if(d[C]=="bottom"){d[C]="100%"}if(d[C]=="left"){d[C]="0%"}if(d[C]=="right"){d[C]="100%"}if(th.isPercentage(d[C])){var p=parseInt(d[C])/100;d[C]=p*((C==0)?s:z)}}}var j=document.createElement("canvas");j.setAttribute("width",s);j.setAttribute("height",z);var x=j.getContext("2d");var f=x.createLinearGradient(v[0],v[1],t[0],t[1]);for(var B=3;B<n.length;B++){var u=n[B].split("(");if(u[1].indexOf(",")!=-1){var o=u[1].split(",");o[1]=th.trim(o[1].substring(0,o[1].length-1));f.addColorStop(o[0],o[1])}else{u[1]=u[1].substring(0,u[1].length-1);f.addColorStop((u[0].toLowerCase()=="from"?0:1),u[1])}}x.fillStyle=f;x.fillRect(0,0,s,z);return j}else{if(!th.global_resources.images[E]){console.log("Warning: image identified by '"+E+"'")}else{return th.global_resources.images[E]}}},paintImage:function(v,E,j,D,l,f,n,B){if(!j){j="repeat"}if(!D){D="0% 0%"}if(!l){l=0}if(!f){f=0}if(!n){n=this.bounds.width}if(!B){B=this.bounds.height}v.save();try{if((l!=0)||(f!=0)){v.translate(l,f)}var d=D.toLowerCase().split(" ");if(d.length==1){d.push("50%")}if(d.length!=2){console.log('Unsupported position syntax; only "X" or "X Y" supported, you passed in " + position + "');return}var c=[];c[0]=(d[0]=="top"||d[0]=="bottom")?d[1]:d[0];c[1]=(d[0]=="top"||d[0]=="bottom")?d[0]:d[1];th.forEach(c,function(i,h){if(i=="top"){c[h]="0%"}if(i=="right"){c[h]="100%"}if(i=="bottom"){c[h]="100%"}if(i=="left"){c[h]="0%"}if(i=="center"){c[h]="50%"}});var m=[0,0];for(var A=0;A<c.length;A++){var o=th.isPercentage(c[A]);var u=this.convertPositionToPixel(c[A],(A==0)?n:B);if(o){m[A]=this.convertPositionToPixel(c[A],(A==0)?E.width:E.height)}c[A]=u}var t=c[0]-m[0];var s=c[1]-m[1];if(!this.shouldRepeat(j)){v.drawImage(E,c[0]-m[0],c[1]-m[1])}else{var a=(this.shouldRepeatX(j))?parseInt(n/E.width)+1:1;var z=(this.shouldRepeatY(j))?parseInt(B/E.height)+1:1;if(this.shouldRepeatX(j)){while(t>0){t-=E.width}}if(this.shouldRepeatY(j)){while(s>0){s-=E.height}}var q=t;for(var p=0;p<z;p++){t=q;for(var C=0;C<a;C++){v.drawImage(E,t,s);t+=E.width}s+=E.height}}}finally{v.restore()}},shouldRepeatX:function(a){return(a=="repeat"||a=="repeat-x")},shouldRepeatY:function(a){return(a=="repeat"||a=="repeat-y")},shouldRepeat:function(a){return(a!="no-repeat")},convertPositionToPixel:function(d,c){if(th.isPercentage(d)){var a=d.substring(0,d.length-1)/100;return c*a}else{if(th.isCssPixel(d)){return d.substring(0,d.length-2)}}},calculateInsets:function(l,c,a){var f=(this.component)?this.component:this;var j=l+c;if(f.insetCache){}var d={top:0,bottom:0,left:0,right:0};if(a){d.top+=a.top;d.left+=a.left;d.right+=a.right;d.bottom+=a.bottom}for(var h in d){var i=th.safeget(f.cssValue(l+h+c),0);if(i){i=th.convertLengthToPixels(i,f)}d[h]+=i}if(!f.insetCache){f.insetCache={}}f.insetCache[j]=d;return d},getCurrentPseudoClass:function(){if(this.pseudoClass){return this.pseudoClass}return"(default)"},cssValue:function(c,a){if(a===undefined){a=this.getCurrentPseudoClass()}if(this.localStyles[a]===undefined){this.localStyles[a]={}}if(this.localStyles[a][c]!==undefined){return this.localStyles[a][c]}if(typeof this.styles=="undefined"||this.refreshCss){this.resolveCss()}if(this.styles[a]===undefined){this.styles[a]={}}if(this.styles[a][c]){return this.styles[a][c]}if(a!="(default)"){return this.cssValue(c,"(default)")}if(c=="border-top-color"||c=="border-left-color"||c=="border-right-color"||c=="border-bottom-color"){return this.cssValue("color")}if(c=="border"||c=="border-top"||c=="border-left"||c=="border-right"||c=="border-bottom"){throw"Unsupported: request the individual border properties, please"}if(c=="margin"){throw"Unsupported: request the individual margin-top, margin-bottom, margin-right, and margin-left properties, please"}if(c=="padding"){throw"Unsupported: request the individual padding-top, padding-bottom, padding-right, and padding-left properties, please"}if(["color","letter-spacing","line-height","text-align","text-indent","text-transform","visibility","white-space","word-spacing","font"].indexOf(c)!=-1){if(this.parent){return this.parent.cssValue(c)}}if(c.indexOf("list-style-")!=-1){if(this.parent){return this.parent.cssValue(c)}}return},addCss:function(c,f,a){if(th.isString(c)){var h=c;this.blowCssCaches(h);if(a===undefined){a="(default)"}if(this.localStyles[a]===undefined){this.localStyles[a]={}}th.expandCssProperty(h,f,this.localStyles[a])}else{for(var d in c){this.addCss(d,c[d],a)}}},getSize:function(){var a=this.bounds;return{width:a.width,height:a.height}},setBounds:function(a,f,c,d){this.bounds={x:a,y:f,width:c,height:d}},getPreferredSize:function(){if(this.getPreferredHeight&&this.getPreferredWidth){var a=this.getPreferredHeight();var d=this.getPreferredWidth();return{height:a,width:d}}var c=this.getInsets();return{height:c.top+c.bottom,width:c.left+c.right}},getMinimumSize:function(){if(this.getMinimumHeight&&this.getMinimumWidth){var a=this.getMinimumHeight();var c=this.getMinimumWidth();return{height:a,width:c}}return this.getPreferredSize()},getMaximumSize:function(){if(this.getMaximumHeight&&this.getMaximumWidth){var a=this.getMaximumHeight();var c=this.getMaximumWidth();return{height:a,width:c}}return this.getPreferredSize()},getScene:function(){if(this.scene){return this.scene}if(!this.parent){return}var a=this.parent;while(!a.scene&&a.parent){a=a.parent}return a.scene},blowCssCaches:function(a){if(this.component){console.log("WARNING: BLOW CACHE has a component reference")}if(a===undefined){delete this.insetCache;return}if(a.indexOf("border")!=-1||a.indexOf("margin")!=-1||a.indexOf("padding")!=-1){delete this.insetCache}},isInsideOf:function(a){var c=this.parent;while(c){if(c===a){return true}c=c.parent}return false}}});th.ContainerHelpers=new Trait({methods:{getComponentForPosition:function(a,h,f,d){a-=d.bounds.x;h-=d.bounds.y;for(var c=0;c<this.children.length;c++){if(!this.children[c].bounds){continue}if(this.children[c].bounds.x<=a&&this.children[c].bounds.y<=h&&(this.children[c].bounds.x+this.children[c].bounds.width)>=a&&(this.children[c].bounds.y+this.children[c].bounds.height)>=h){if(!f){return this.children[c]}if(!this.children[c].shouldPaint()){continue}return(this.children[c].getComponentForPosition)?this.children[c].getComponentForPosition(a-this.children[c].bounds.x,h-this.children[c].bounds.y,f,this.children[c]):this.children[c]}}return this},removeAll:function(){this.remove(this.children)},getMinimumSize:function(){return(this.layoutManager)?this.layoutManager.getMinimumSize(this):this._super()},getPreferredSize:function(){return(this.layoutManager)?this.layoutManager.getPreferredSize(this):this._super()},getMaximumSize:function(){return(this.layoutManager)?this.layoutManager.getMaximumSize(this):this._super()}}});th.BorderHelpers=new Trait({methods:{inset:function(a,c){if(typeof c=="number"){a.x+=c;a.y+=c;a.w-=2*c;a.h-=2*c}else{if(th.isArray(c)&&c.length==4){a.x+=c[0];a.y+=c[1];a.w-=c[1]+c[3];a.h-=c[0]+c[2]}}},cornerX:function(a,d){switch(d){case 0:case 3:return a.x;case 1:case 2:return a.x+a.w}},cornerY:function(a,d){switch(d){case 0:case 1:return a.y;case 2:case 3:return a.y+a.h}},round:function(a){a.x=Math.round(a.x);a.y=Math.round(a.y);a.w=Math.round(a.w);a.h=Math.round(a.h)},emptyRect:function(a){return(a.w<=0)||(a.h<=0)},isZeroSize:function(a){return(a.w<=0)&&(a.h<=0)},next:function(c){var a=(c+1)%4;if(a<0){return a+4}return a},prev:function(c){var a=(c-1)%4;if(a<0){return a+4}return a},allCornersZeroSize:function(a){var c=this.isZeroSize;return c(a[0])&&c(a[1])&&c(a[2])&&c(a[3])},checkFourFloatsEqual:function(a,c){return(a[0]==c&&a[1]==c&&a[2]==c&&a[3]==c)},getSpecial3DColors:function(d,u,p){var s;var l,j;var o=parseInt(u.slice(1),16);var f=parseInt(d.slice(1),16);var a=o%256;var t=(o>>8)%256;var n=(o>>16)%256;var h=f%256;var i=(f>>8)%256;var q=(f>>16)%256;var m=(3691*a+6283*t+2026*n)/12000;var v=(3691*h+6283*i+2026*q)/12000;if(v<51){l=30;j=50;if(m==0){a=t=n=96}}else{if(v>204){l=45;j=70;if(m==254){a=t=n=192}}else{l=30+(v/17);j=50+(v*20/255)}}if(p==="dark"){r=a-(l*a/100);g=t-(l*t/100);b=n-(l*n/100);s="rgb("+parseInt(r)+","+parseInt(g)+","+parseInt(b)+")"}else{if(p==="light"){r=a+(j*(255-a)/100);g=t+(j*(255-t)/100);b=n+(j*(255-n)/100);s="rgb("+parseInt(r)+","+parseInt(g)+","+parseInt(b)+")"}}return s},computeInnerRadii:function(o,m){var d=[];var j=o[this.TOP_LEFT];var f=o[this.TOP_RIGHT];var i=o[this.BOTTOM_RIGHT];var p=o[this.BOTTOM_LEFT];var n=m[0];var a=m[1];var h=m[2];var c=m[3];d[this.TOP_LEFT]={w:Math.max(0,j.w-c),h:Math.max(0,j.h-n)};d[this.TOP_RIGHT]={w:Math.max(0,f.w-a),h:Math.max(0,f.h-n)};d[this.BOTTOM_RIGHT]={w:Math.max(0,i.w-a),h:Math.max(0,i.h-h)};d[this.BOTTOM_LEFT]={w:Math.max(0,p.w-c),h:Math.max(0,p.h-h)};return d},traceRoundRect:function(a,d,f,c){if(c){a.moveTo(d.x,d.y+f[this.TOP_LEFT].h);a.quadraticCurveTo(d.x,d.y,d.x+f[this.TOP_LEFT].w,d.y);a.lineTo(d.x+d.w-f[this.TOP_RIGHT].w,d.y);a.quadraticCurveTo(d.x+d.w,d.y,d.x+d.w,d.y+f[this.TOP_RIGHT].h);a.lineTo(d.x+d.w,d.y+d.h-f[this.BOTTOM_RIGHT].h);a.quadraticCurveTo(d.x+d.w,d.y+d.h,d.x+d.w-f[this.BOTTOM_RIGHT].w,d.y+d.h);a.lineTo(d.x+f[this.BOTTOM_LEFT].w,d.y+d.h);a.quadraticCurveTo(d.x,d.y+d.h,d.x,d.y+d.h-f[this.BOTTOM_LEFT].h);a.lineTo(d.x,d.y+f[this.TOP_LEFT].h)}else{a.moveTo(d.x,d.y+f[this.TOP_LEFT].h);a.lineTo(d.x,d.y+d.h-f[this.BOTTOM_LEFT].h);a.quadraticCurveTo(d.x,d.y+d.h,d.x+f[this.BOTTOM_LEFT].w,d.y+d.h);a.lineTo(d.x+d.w-f[this.BOTTOM_RIGHT].w,d.y+d.h);a.quadraticCurveTo(d.x+d.w,d.y+d.h,d.x+d.w,d.y+d.h-f[this.BOTTOM_RIGHT].h);a.lineTo(d.x+d.w,d.y+f[this.TOP_RIGHT].h);a.quadraticCurveTo(d.x+d.w,d.y,d.x+d.w-f[this.TOP_RIGHT].w,d.y);a.lineTo(d.x+f[this.TOP_LEFT].w,d.y);a.quadraticCurveTo(d.x,d.y,d.x,d.y+f[this.TOP_LEFT].h)}}}});if(typeof th=="undefined"){th={}}th.VERTICAL="v";th.HORIZONTAL="h";th.Resources=Class.define({members:{init:function(){this.loading=false;this.userAgentCss=[];this.authorCss=[];this.userCss=[];this.resolvedCssCache={};this.blockUntilImagesLoaded=true;this.images={};this.sheetCount=0;this.currentSheet=0;this.imageCount=0;this.currentImage=0;this.loaded=false;this.cssLoaded=false;this.imagesLoaded=false;this.callbacks=[]},load:function(c,a){if(this.loaded){return}this.baseUrl=c;this.stringStyles=a;this.loading=true;this.parseCSS()},processImage:function(){this.currentImage++;if(this.imageCount==this.currentImage){this.imagesLoaded=true;this.onLoaded()}},loadImages:function(h,f){var i,m,c;for(var n in h){var j=h[n];if((i=j.indexOf("url("))!=-1){m=j.indexOf(")",i);if(m==-1){console.log("Warning: malformed url found ('"+j+"')");break}var l=j.substring(i,m);var d=l+")";var a=l.substring(4);if(a.charAt(0)=="'"||a.charAt(0)=='"'){a=a.substring(1,a.length-1)}if(this.images[d]!==undefined){continue}this.imageCount++;c=new Image();if(this.blockUntilImagesLoaded){this.imagesLoaded=false;var o=this;c.onload=function(){o.processImage()};c.onerror=function(){o.processImage()}}if(f==undefined){f=""}c.src=f+a;this.images[d]=c}}},onLoaded:function(){if(this.cssLoaded&&((this.blockUntilImagesLoaded&&this.imagesLoaded)||!this.blockUntilImagesLoaded)){this.loaded=true;this.loading=false;if(this.callbacks){th.forEach(this.callbacks,function(a){if(a.context){a.callback.apply(a.context)}else{a.callback()}})}}},registerOnLoadCallback:function(c,a){this.callbacks.push({callback:c,context:a})},parseCSS:function(){var d=[];var j=false;if(typeof this.baseUrl!=="undefined"){d.push({url:this.baseUrl+"css/default.css",resourceBase:this.baseUrl,array:this.userAgentCss,index:0})}else{if(th.DEFAULT_CSS){this.processCSS(th.DEFAULT_CSS,undefined,this.userAgentCss,0);j=true}}var h,c=document.getElementsByTagName("link");var a=0;for(var f=0;f<c.length;f++){h=c[f];if(h.rel.toLowerCase().indexOf("thstylesheet")>=0&&h.href){d.push({url:h.href,resourceBase:undefined,array:this.authorCss,index:a++})}}if(this.stringStyles){this.processCSS(this.stringStyles,this.authorCss,a++)}if(d.length==0){this.cssLoaded=true;return this.onLoaded()}this.sheetCount=d.length;if(j){this.sheetCount++}if(this.stringStyles){this.sheetCount++}th.forEach(d,function(i){th.xhrGet({url:i.url,load:function(l){this.processCSS(l,i.resourceBase,i.array,i.index)},context:this})},this)},processCSS:function(c,i,j,a){j[a]=new th.CssParser().parse(c);for(var h in j[a]){var f={};for(var d in j[a][h]){th.expandCssProperty(d,j[a][h][d],f)}j[a][h]=f;this.loadImages(f,i)}if(++this.currentSheet==this.sheetCount){this.cssLoaded=true;this.onLoaded()}}}});th.Bus=Class.define({members:{init:function(){this.events={}},bind:function(h,c,a,j){var f=this.events[h];if(!f){f=[];this.events[h]=f}c=th.isArray(c)?c:[c];for(var l=0;l<c.length;l++){for(var d=0;d<f.length;d++){if(f[d].selector==c[l]&&f[d].listenerFn==a){return}}f.push({selector:c[l],listenerFn:a,context:j})}},unbind:function(a){for(var f in this.events){var d=this.events[f];for(var c=0;c<d.length;c++){if(d[c].selector===a){this.events[f]=th.remove(d,d[c]);d=this.events[f];c--}}}},fire:function(a,h,c){var f=this.events[a];if(!f||f.length==0){return}for(var d=0;d<f.length;d++){if(f[d].selector.constructor==String){if(f[d].selector.charAt(0)=="#"){if(c.id==f[d].selector.substring(1)){this.dispatchEvent(a,h,c,f[d])}}else{if(f[d].selector==c.declaredClass){this.dispatchEvent(a,h,c,f[d])}}}else{if(f[d].selector==c){this.dispatchEvent(a,h,c,f[d])}}}},dispatchEvent:function(a,d,c,f){d.thComponent=c;if(f.context){f.listenerFn.apply(f.context,[d])}else{f.listenerFn(d)}}}});th.FocusManager=Class.define({members:{bus:null,KEY_TAB:9,init:function(a,c,d){this.bus=a;this.subscribers=[];this.focused=undefined;this.focusedIndex=-1;this.domInputFirst=c;this.domInputLast=d;this.domHasFocus=undefined;this.ignoreDomEvent=false;this.domInputFirst.value="<norealtext>";this.domInputLast.value="<norealtext>";th.observe(this.domInputFirst,"focus",this.enterFirst,this);th.observe(this.domInputFirst,"blur",this.domFocusLost,this);th.observe(this.domInputFirst,"keydown",this.handleKeyDown,this);th.observe(this.domInputLast,"focus",this.enterLast,this);th.observe(this.domInputLast,"blur",this.domFocusLost,this);th.observe(this.domInputLast,"keydown",this.handleKeyDown,this);th.observe(document,"cut",this.handleCut,this);th.observe(document,"copy",this.handleCopy,this);th.observe(document,"paste",this.handlePaste,this)},relateTo:function(c){this.relateTo=c.canvas;var a=th.cumulativeOffset(this.relateTo).left+10;var d=th.cumulativeOffset(this.relateTo).top+10;this.domInputFirst.style.position="absolute";this.domInputLast.style.position="absolute";this.domInputFirst.style["z-index"]=-100;this.domInputLast.style["z-index"]=-100;this.domInputFirst.style.width="1px";this.domInputLast.style.width="1px";if(this.relateTo.style.display=="none"){this.toggleInputs({isVisible:false})}this.moveInputs({x:a,y:d});this.bus.bind("move",c,this.moveInputs,this);this.bus.bind("toggle",c,this.toggleInputs,this)},toggleInputs:function(c){var a=c.isVisible?"block":"none";this.domInputFirst.style.display=a;this.domInputLast.style.display=a},moveInputs:function(a){this.domInputFirst.style.top=(a.y+50)+"px";this.domInputLast.style.top=(a.y+50)+"px";this.domInputFirst.style.left=(a.x+50)+"px";this.domInputLast.style.left=(a.x+65)+"px"},performCopy:function(a,c){if(a.clipboardData!==undefined){a.clipboardData.setData("text/plain",c);th.stopEvent(a)}else{this.domHasFocus.value=c;this.domHasFocus.select()}},handleCopy:function(c){if(this.focused===undefined){return}if(th.isFunction(this.focused.performCopy)){var a=this.focused.performCopy();if(!a){th.stopEvent(c);return}else{this.performCopy(c,a)}}},handlePaste:function(a){if(this.focused===undefined){return}if(th.isFunction(this.focused.performPaste)){if(a.clipboardData!==undefined){this.focused.performPaste(a.clipboardData.getData("text/plain"));th.stopEvent(a)}else{this.domHasFocus.value="";th.delay(function(){this.focused.performPaste(this.domHasFocus.value)},0,this)}}},handleCut:function(c){if(this.focused===undefined){return}if(th.isFunction(this.focused.performCut)){var a=this.focused.performCut();if(!a){th.stopEvent(c);return}else{this.performCopy(c,a)}}},enterFirst:function(a){this.domHasFocus=this.domInputFirst;this.domInputFirst.select();if(this.ignoreDomEvent){return}if(this.subscribers.length==-1){return}this.focus(this.subscribers[0]);this.ignoreDomScroll=true},enterLast:function(a){this.domHasFocus=this.domInputLast;this.domInputLast.select();if(this.ignoreDomEvent){return}if(this.subscribers.length==-1){return}this.focus(th.lastArrayItem(this.subscribers));this.ignoreDomScroll=true},domFocusLost:function(a){if(this.ignoreDomEvent){return}if(this.focused!==undefined){if(th.isFunction(this.focused.allowLoseFocus)){if(!this.focused.allowLoseFocus(a)){this.focus(this.focused);return}}}this.focusedLostFocus();delete this.focused;delete this.domHasFocus;this.focusedIndex=-1},focusedLostFocus:function(){this.bus.fire("focus:lost",e,this.focused);delete this.focused.pseudoClass;this.focused.repaint()},handleKeyDown:function(c){if(this.focused===undefined){return}if(c.keyCode==this.KEY_TAB&&this.subscribers.length!=0){var a=false;if(c.shiftKey==false){if(this.focused.focusNext===undefined){this.focusedIndex++;if(this.focusedIndex>=this.subscribers.length){a=true}else{this.focus(this.subscribers[this.focusedIndex])}}else{this.focus(this.focused.focusNext)}}else{if(this.focused.focusPrev===undefined){this.focusedIndex--;if(this.focusedIndex<=-1){a=true}else{this.focus(this.subscribers[this.focusedIndex])}}else{this.focus(this.focused.focusPrev)}}if(!a){th.stopEvent(c)}else{delete this.domHasFocus}return}c.focusManager=this;this.bus.fire("keydown",c,this.focused)},focus:function(c){var a=this.subscribers.indexOf(c);if(a==-1){console.error("FocusManager:focus: no such subscribed component!");return}e={};e.newFocused=c;e.focusManager=this;if(this.focused!==undefined&&c!==this.focused){if(th.isFunction(this.focused.allowLoseFocus)){if(!this.focused.allowLoseFocus(e)){this.focusedIndex=this.subscribers.indexOf(this.focused);return false}}}if(this.focused!==undefined){this.focusedLostFocus()}this.focusedIndex=a;this.focused=c;this.bus.fire("focus:received",e,this.focused);this.focused.pseudoClass="active";this.focused.repaint();if(this.focusedIndex==this.subscribers.length-1){this.ignoreDomEvent=true;this.domInputLast.focus();this.ignoreDomEvent=false}else{if(this.focusedIndex==0||this.domHasFocus===undefined){this.ignoreDomEvent=true;this.domInputFirst.focus();this.ignoreDomEvent=false}}return true},subscribe:function(a){if(!this.hasSubscriber(a)){this.subscribers.push(a);a.focusManager=this}},hasSubscriber:function(a){return(this.subscribers.indexOf(a)!=-1)},unsubscribe:function(c){var a=this.subscribers.indexOf(components);if(a==-1){console.error("FocusManager:unsubscribe: no such subscribed component!");return}this.subscribers.splice(a,1);if(a==this.focused){this.bus.fire("focus:lost",{},c);delete c.focusManager;this.focused=-1}},hasFocus:function(a){return(this.subscribers.indexOf(a)==this.focused)}}});th.global_event_bus=new th.Bus();th.global_resources=new th.Resources();th.global_scene_array=new Array();th.Scene=Class.define({uses:[th.EventHelpers],members:{bus:th.global_event_bus,init:function(a,f){if(th.isString(a)){a=document.getElementById("canvasOrId")}this.canvas=a;this.id=this.canvas.id;var d=f;var c="";if(f&&!th.isString(f)){d=f.baseUrl;c=f.stringStyles}this.smartRedraw=false;this.resources=th.global_resources;this.resourceCallbackRegistered=false;if(!this.resources.loaded&&!this.resources.loading){this.resources.load(d,c)}th.observe(window,"resize",function(){this.render()},this);this.root=new th.Panel({id:this.id});this.root.scene=this;this.testCanvas=document.createElement("canvas");this.scratchContext=this.testCanvas.getContext("2d");th.fixCanvas(this.scratchContext);this.parseTags();th.observe(this.canvas,"mousedown",function(h){this.wrapEvent(h,this.root);this.mouseDownComponent=h.thComponent;th.global_event_bus.fire("mousedown",h,h.thComponent)},this);th.observe(this.canvas,"dblclick",function(h){this.wrapEvent(h,this.root);th.global_event_bus.fire("dblclick",h,h.thComponent)},this);th.observe(this.canvas,"click",function(h){this.wrapEvent(h,this.root);th.global_event_bus.fire("click",h,h.thComponent)},this);th.observe(window,"mousemove",function(h){this.wrapEvent(h,this.root);th.global_event_bus.fire("mousemove",h,h.thComponent);if(this.mouseDownComponent){this.addComponentXY(h,this.root,this.mouseDownComponent);th.global_event_bus.fire("mousedrag",h,this.mouseDownComponent)}},this);th.observe(this.canvas,"mouseup",function(h){if(!this.mouseDownComponent){return}this.addComponentXY(h,this.root,this.mouseDownComponent);th.global_event_bus.fire("mouseup",h,this.mouseDownComponent);delete this.mouseDownComponent},this);th.global_scene_array.push(this)},_byId:function(f,d){for(var c=0;c<d.length;c++){if(d[c].id==f){return d[c]}if(d[c].children){var a=_byId(f,d[c].children);if(a!==undefined){return a}}}},byId:function(a){return this._byId(a,this.root.children)},render:function(a){if(!this.resources.loaded){if(!this.resourceCallbackRegistered){this.resources.registerOnLoadCallback(this.render,this);if(a){this.resources.registerOnLoadCallback(function(){a(this)},this)}this.resourceCallbackRegistered=true}return}this.layout();this.paint();if(a){a(this)}},blockUntilRender:function(){if(!this.resources.loaded){}},parseTags:function(){this.parseCanvasAttributes("grid");var a=this.canvas.childNodes;this.attachChildElementsToParent(a,this.root)},parseCanvasAttributes:function(){th.forEach(arguments,function(a){if(this.canvas.hasAttribute(a)){this.root[a]=this.canvas.getAttribute(a)}},this)},attachChildElementsToParent:function(a,c){th.forEach(a,function(f){if(f.nodeType==Node.ELEMENT_NODE){var d=this.createComponentFromElement(f,c);if(d){c.add(d);this.attachChildElementsToParent(f.childNodes,d)}else{console.log("Couldn't create component from element \""+f.tagName+'"')}}},this)},createComponentFromElement:function(a,f){var l={};for(var n in th){var i=n.toLowerCase();if(l[i]){console.log('componentMap collision with key "'+i+'"')}l[i]=n}var c=a.tagName.toLowerCase();n=l[c];if(!n){return}var d=th[n];if(!d){return}var j=a.attributes;var h={};th.forEach(j,function(p){var o=p.name;var q=p.value;if(o=="cell"){o="constraints"}h[o]=q});var m=new d(h);if(!m.type){return}if(m.type.toLowerCase()!=c){return}return m},layout:function(){if(this.root){this.root.bounds={x:0,y:0,width:this.canvas.width,height:this.canvas.height};this.root.layoutTree()}},paint:function(c){if(!this.resources.loaded){if(!this.resourceCallbackRegistered){this.resources.registerOnLoadCallback(this.render,this);this.resourceCallbackRegistered=true}return}if(!c){c=this.root}if(c){if(c===this.root){c.resolveCss()}if(!c.opaque&&c.parent){return this.paint(c.parent)}var a=this.canvas.getContext("2d");th.fixCanvas(a);a.save();var d=c.parent;var f=c;while(d){a.translate(f.bounds.x,f.bounds.y);f=d;d=d.parent}a.translate(f.bounds.x,f.bounds.y);if(!this.smartRedraw){a.clearRect(0,0,c.bounds.width,c.bounds.height)}a.beginPath();a.rect(0,0,c.bounds.width,c.bounds.height);a.closePath();a.clip();c.paint(a);if(c.border){c.border.paint(a)}a.restore()}}}});th.Border=Class.define({type:"Border",uses:[th.ComponentHelpers,th.BorderHelpers],members:{SIDES:["top","right","bottom","left"],CORNERS:["top-left","top-right","bottom-right","bottom-left"],TOP:0,TOP_LEFT:0,RIGHT:1,TOP_RIGHT:1,BOTTOM:2,BOTTOM_RIGHT:2,LEFT:3,BOTTOM_LEFT:3,BIT_TOP:1,BIT_RIGHT:2,BIT_BOTTOM:4,BIT_LEFT:8,init:function(a){this.component=a;this.outerRect={x:0,y:0,w:0,h:0};this.innerRect={x:0,y:0,w:0,h:0};this.borderStyles=[];this.borderWidths=[];this.borderRadii=[];this.borderColors=[];this.skipSides=0;this.oneUnitBorder=false;this.noBorderRadius=false;this.cornerDimensions=[];for(var c=0;c<4;c++){this.borderStyles[c]="none";this.borderWidths[c]=0;this.borderColors[c]="rgba(0, 0, 0, 0)";this.borderRadii[c]={w:0,h:0};this.cornerDimensions[c]={w:0,h:0}}this.borderDataCalculated=false},getInsets:function(){return this.calculateInsets("border-","-width")},recalculateBorderData:function(){var n=this.component.d();var m=this.component.getScratchContext();var c="",h,f,a;for(var l=0;l<4;l++){var j=this.SIDES[l];h=th.convertBorderLengthToPixels(this.component.cssValue("border-"+j+"-width"));c=this.component.cssValue("border-"+j+"-color");if(c!==undefined){m.fillStyle=c;f=m.fillStyle;a=this.component.cssValue("border-"+j+"-style")}this.borderWidths[l]=(h===undefined)?0:h;this.borderColors[l]=(f===undefined)?"rgb(0, 0, 0)":f;this.borderStyles[l]=(a===undefined)?"none":a}this.outerRect={x:0,y:0,w:n.b.w,h:n.b.h};this.innerRect={x:0,y:0,w:n.b.w,h:n.b.h};this.inset(this.innerRect,this.borderWidths);this.cornerDimensions[0].w=this.borderWidths[3];this.cornerDimensions[0].h=this.borderWidths[0];this.cornerDimensions[1].w=this.borderWidths[1];this.cornerDimensions[1].h=this.borderWidths[0];this.cornerDimensions[2].w=this.borderWidths[1];this.cornerDimensions[2].h=this.borderWidths[2];this.cornerDimensions[3].w=this.borderWidths[3];this.cornerDimensions[3].h=this.borderWidths[2];this.oneUnitBorder=this.checkFourFloatsEqual(this.borderWidths,1);this.noBorderRadius=this.allCornersZeroSize(this.borderRadii);c=this.component.cssValue("background-color");if(c!==undefined){m.fillStyle=c}this.backgroundColor=m.fillStyle;this.borderDataCalculated=true},areBorderSideFinalStylesSame:function(c){if(c==0){throw"th.Border:areBorderSideFinalStyleSame - Invalid side bit-field '0'"}firstStyle=0;for(var a=0;a<4;a++){if(firstStyle==a){if(((1<<a)&c)==0){firstStyle++}continue}if(((1<<a)&c)==0){continue}if(this.borderStyles[firstStyle]!=this.borderStyles[a]||this.borderColors[firstStyle]!=this.borderColors[a]){return false}}switch(this.borderStyles[firstStyle]){case"groove":case"ridge":case"inset":case"outset":return((c&(this.BIT_TOP|this.BIT_LEFT))==0||(c&(this.BIT_BOTTOM|this.BIT_RIGHT))==0)}return true},isSolidCornerStyle:function(c,a){switch(c){case"dotted":case"dashed":case"solid":return true;case"inset":case"outset":return a==this.TOP_LEFT||a==this.BOTTOM_RIGHT;case"groove":case"ridge":return this.oneUnitBorder&&(a==this.TOP_LEFT||a==this.BOTTOM_RIGHT);case"double":return this.oneUnitBorder;default:return false}},borderColorStyleForSolidCorner:function(c,a){switch(c){case"dotted":case"dashed":case"solid":case"double":return"solid";case"inset":case"groove":if(a==this.TOP_LEFT){return"dark"}else{if(a==this.BOTTOM_RIGHT){return"light"}}break;case"outset":case"ridge":if(a==this.TOP_LEFT){return"light"}else{if(a==this.BOTTOM_RIGHT){return"dark"}}break}return"none"},doCornerSubPath:function(a,c){var d={x:0,y:0};if(c==this.TOP_RIGHT||c==this.BOTTOM_RIGHT){d.x=this.outerRect.w-this.cornerDimensions[c].w}if(c==this.BOTTOM_RIGHT||c==this.BOTTOM_LEFT){d.y=this.outerRect.h-this.cornerDimensions[c].h}a.rect(this.outerRect.x+d.x,this.outerRect.y+d.y,this.cornerDimensions[c].w,this.cornerDimensions[c].h)},doSideClipWithoutCornersSubPath:function(c,a){var h={x:0,y:0};var f=this.next(a);if(a==this.TOP){h.x=this.cornerDimensions[this.TOP_LEFT].w}else{if(a==this.RIGHT){h.x=this.outerRect.w-this.borderWidths[this.RIGHT];h.y=this.cornerDimensions[this.TOP_RIGHT].h}else{if(a==this.BOTTOM){h.x=this.cornerDimensions[this.BOTTOM_LEFT].w;h.y=this.outerRect.h-this.borderWidths[this.BOTTOM]}else{if(a==this.LEFT){h.y=this.cornerDimensions[this.TOP_LEFT].h}}}}var i={w:0,h:0};i.w=this.cornerDimensions[a].w+this.cornerDimensions[f].w;i.h=this.cornerDimensions[a].h+this.cornerDimensions[f].h;var d={x:this.outerRect.x+h.x,y:this.outerRect.y+h.y,w:this.outerRect.w-i.w,h:this.outerRect.h-i.h};if(a==this.TOP||a==this.BOTTOM){d.h=this.borderWidths[a]}else{d.w=this.borderWidths[a]}c.rect(d.x,d.y,d.w,d.h)},maybeMoveToMidPoint:function(d,a,f){var c={x:a.x-d.x,y:a.y-d.y};if(c.x!=0&&c.y!=0){k=Math.min((f.x-d.x)/c.x,(f.y-a.y)/c.y);a.x=d.x+c.x*k;a.y=d.y+c.y*k}},doSideClipSubPath:function(s,f){var o=this.corner;var a=[{x:0,y:0},{x:0,y:0}];var c=[{x:0,y:0},{x:0,y:0}];var d=this.prev(f);var n=this.next(f);var t=this.borderStyles[f]=="dashed"||this.borderStyles[f]=="dotted";var q=this.borderStyles[d]=="dashed"||this.borderStyles[d]=="dotted";var l=this.borderStyles[n]=="dashed"||this.borderStyles[n]=="dotted";var i=0;var p=0;if(!this.isZeroSize(this.borderRadii[f])){i=1}else{if(q&&t){i=2}}if(!this.isZeroSize(this.borderRadii[n])){p=1}else{if(q&&t){p=2}}var m={x:0,y:0};m.x=this.innerRect.x+this.innerRect.w/2;m.y=this.innerRect.y+this.innerRect.h/2;var j=this.cornerX,h=this.cornerY;a[0].x=j(this.outerRect,f);a[0].y=h(this.outerRect,f);a[1].x=j(this.innerRect,f);a[1].y=h(this.innerRect,f);c[0].x=j(this.outerRect,n);c[0].y=h(this.outerRect,n);c[1].x=j(this.innerRect,n);c[1].y=h(this.innerRect,n);if(i==1){this.maybeMoveToMidPoint(a[0],a[1],m)}else{if(i==2){if(side=="top"||side=="bottom"){a[1].x=j(this.outerRect,f);a[1].y=h(this.innerRect,f)}else{a[1].x=j(this.innerRect,f);a[1].y=h(this.outerRect,f)}}}if(p==1){this.maybeMoveToMidPoint(c[0],c[1],m)}else{if(p==2){if(side=="top"||side=="bottom"){c[0].x=j(this.innerRect,n);c[0].y=h(this.outerRect,n)}else{c[0].x=j(this.outerRect,n);c[0].y=h(this.innerRect,n)}}}s.moveTo(a[0].x,a[0].y);s.lineTo(c[0].x,c[0].y);s.lineTo(c[1].x,c[1].y);s.lineTo(a[1].x,a[1].y);s.closePath()},fillSolidBorder:function(u,x,y,C,m,B,v){u.fillStyle=v;if(C!==undefined&&!this.allCornersZeroSize(C)){var s=this.computeInnerRadii(C,m);u.beginPath();this.traceRoundRect(u,x,C,true);this.traceRoundRect(u,y,s,false);u.fill();return}if(B==15&&this.checkFourFloatsEqual(m,m[0])){var o=x;var p={x:o.x,y:o.y,w:o.w,h:o.h};this.inset(p,m[0]/2);u.strokeStyle=v;u.lineWidth=m[0];u.beginPath();u.rect(p.x,p.y,p.w,p.h);u.stroke();return}var E,D,a,n;var j,i,l,t;var z,w,A,c;var f,d,h,q;if(B&1){E=x.x;D=x.y;a=x.w;n=m[0]}if(B&4){z=x.x;w=x.y+x.h-m[2];A=x.w;c=m[2]}if(B&8){f=x.x;d=x.y;h=m[3];q=x.h}if(B&2){j=x.x+x.w-m[1];i=x.y;l=m[1];t=x.h}if((B&9)==9){d+=m[0];q-=m[0]}if((B&3)==3){a-=m[1]}if((B&6)==6){t-=m[2]}if((B&12)==12){z+=m[3];A-=m[3]}if(B&1){u.fillRect(E,D,a,n)}if(B&2){u.fillRect(j,i,l,t)}if(B&4){u.fillRect(z,w,A,c)}if(B&8){u.fillRect(f,d,h,q)}},makeBorderColor:function(c,f,h){var a;var d=0;switch(h){case"none":return"rgb(0, 0, 0)";case"light":case"dark":return this.getSpecial3DColors(f,c,h);case"solid":default:return c}},computeColorForLine:function(a,h,c,d,f){return this.makeBorderColor(d,f,h[a])},drawBorderSides:function(m,x){if(x==0){return}var u;var p;var y=[];var v=[];var q=0;var l=[];for(var o=0;o<4;o++){if(((1<<o)&x)==0){continue}u=this.borderStyles[o];p=this.borderColors[o];break}if(u=="none"||u=="hidden"){return}if(this.oneUnitBorder&&(u=="ridge"||u=="groove"||u=="double")){u="solid"}switch(u){case"solid":case"dashed":case"dotted":y[0]="solid";v[0]="solid";q=1;break;case"groove":y[0]="dark";y[1]="light";v[0]="light";v[1]="dark";q=2;break;case"ridge":y[0]="light";y[1]="dark";v[0]="dark";v[1]="light";q=2;break;case"double":y[0]="solid";y[1]="none";y[2]="solid";v[0]="solid";v[1]="none";v[2]="solid";q=3;break;case"inset":y[0]="dark";v[0]="light";q=1;break;case"outset":y[0]="light";v[0]="dark";q=1;break;default:throw"Unhandled style '"+u+"'";break}if(x&(this.BIT_RIGHT|this.BIT_BOTTOM)){l=v}else{l=y}var c=[[],[],[]];if(q==1){for(var o=0;o<4;o++){c[0][o]=this.borderWidths[o]}}else{if(q==2){for(var o=0;o<4;o++){var f=this.borderWidths[o];c[0][o]=parseInt(f/2)+f%2;c[1][o]=parseInt(f/2)}}else{if(q==3){for(var o=0;o<4;o++){var f=this.borderWidths[o];if(f==1){c[0][o]=1;c[1][o]=c[2][o]=0}else{var h=f%3;c[0][o]=c[2][o]=c[1][o]=parseInt((f-h)/3);if(h==1){c[1][o]++}else{if(h==2){c[0][o]++;c[2][o]++}}}}}}}var d=this.outerRect;var s={x:d.x,y:d.y,w:d.w,h:d.h};var a={x:d.x,y:d.y,w:d.w,h:d.h};var j;if(!this.noBorderRadius){j=th.clone(this.borderRadii)}var t;for(var o=0;o<q;o++){t=c[o];this.inset(a,t);if(l[o]!="none"){var n=this.computeColorForLine(o,l,q,p,this.backgroundColor);this.fillSolidBorder(m,s,a,j,t,x,n)}if(!this.noBorderRadius){j=this.computeInnerRadii(j,t)}s.x=a.x;s.y=a.y;s.w=a.w;s.h=a.h}},paint:function(a){if(this.component.cssValue("border-image-url")===undefined){this.paintBorder(a)}else{this.paintImageBorder(a)}},paintImageBorder:function(u){var f=th.global_resources.images[this.component.cssValue("border-image-url")];if(f.width==0){return}var s,o,a,c,q,i,m;s=parseInt(this.component.cssValue("border-image-top"));o=parseInt(this.component.cssValue("border-image-bottom"));a=parseInt(this.component.cssValue("border-image-right"));c=parseInt(this.component.cssValue("border-image-left"));q=f.width;i=f.height;m=this.component.d();u.drawImage(f,0,0,c,s,0,0,m.i.l,m.i.t);u.drawImage(f,q-a,0,a,s,m.b.w-m.i.r,0,m.i.r,m.i.t);u.drawImage(f,0,i-o,c,o,0,m.b.h-m.i.b,m.i.l,m.i.b);u.drawImage(f,q-a,i-o,a,o,m.b.w-m.i.r,m.b.h-m.i.b,m.i.r,m.i.b);switch(this.component.cssValue("border-image-repeat-x")){case"stretch":u.drawImage(f,c,0,q-c-a,s,m.i.l,0,m.b.iw,m.i.t);u.drawImage(f,c,i-o,q-c-a,o,m.i.l,m.b.h-m.i.b,m.b.iw,m.i.t);break;case"repeat":var j;u.save();u.beginPath();u.rect(m.i.l,0,m.b.iw,m.b.h);u.clip();j=c*(m.i.t/s);for(var p=m.i.l;p<m.b.w-m.i.r;p+=j){u.drawImage(f,c,0,q-c-a,s,p,0,j,m.i.t)}p=m.i.l;j=a*(m.i.b/o);while(p<m.b.w-m.i.r){u.drawImage(f,c,i-o,q-c-a,o,p,m.b.h-m.i.b,j,m.i.b);p+=j}u.restore();break;default:console.error('border-image-repeat-x "'+this.component.cssValue("border-image-repeat-x")+'" not supported!');break}switch(this.component.cssValue("border-image-repeat-y")){case"stretch":u.drawImage(f,0,s,c,i-s-o,0,m.i.t,m.i.l,m.b.ih);u.drawImage(f,q-c,s,a,i-s-o,m.b.w-m.i.r,m.i.t,m.i.r,m.b.ih);break;case"repeat":var j;u.save();u.beginPath();u.rect(0,m.i.t,m.b.w,m.b.ih);u.clip();j=s*(m.i.l/c);for(var n=m.i.t;n<m.b.h-m.i.b;n+=j){u.drawImage(f,0,s,c,i-s-o,0,n,j,m.i.l)}j=s*(m.i.r/a);for(var n=m.i.t;n<m.b.h-m.i.b;n+=j){u.drawImage(f,q-c,s,a,i-s-o,m.b.w-m.i.r,n,j,m.i.l)}u.restore();break;default:console.error('border-image-repeat-y "'+this.component.cssValue("border-image-repeat-x")+'" not supported!');break}},paintBorder:function(t){var n=this.component.d();var d=this.isZeroSize;this.recalculateBorderData();var i=this.areBorderSideFinalStylesSame(1|8);var s=this.areBorderSideFinalStylesSame(2|4);var c=this.areBorderSideFinalStylesSame(15);if(c&&(this.borderStyles[0]=="none"||this.borderStyles[0]=="hidden")){return}this.round(this.outerRect);this.round(this.innerRect);if(this.emptyRect(this.outerRect)){return}if(c){this.drawBorderSides(t,this.BIT_TOP|this.BIT_RIGHT|this.BIT_BOTTOM|this.BIT_LEFT)}else{for(var p=0;p<4;p++){var f=[p,this.prev(p)];if(!d(this.borderRadii[p])){continue}if(this.borderWidths[f[0]]==1&&this.borderWidths[f[1]]==1){if(p==this.TOP_LEFT||p==this.TOP_RIGHT){this.cornerDimensions[p].w=0}else{this.cornerDimensions[p].h=0}}}for(var p=0;p<4;p++){if(d(this.cornerDimensions[p])){continue}var f=[p,this.prev(p)];var j=(1<<f[0])|(1<<f[1]);var h=this.areBorderSideFinalStylesSame(j);if(h&&d(this.borderRadii[p])&&this.isSolidCornerStyle(this.borderStyles[f[0]],p)){t.beginPath();this.doCornerSubPath(t,p);t.fillStyle=this.makeBorderColor(this.borderColors[f[0]],this.backgroundColor,this.borderColorStyleForSolidCorner(this.borderStyles[f[0]],p));t.fill();continue}t.save();t.beginPath();this.doCornerSubPath(t,p);t.clip();if(h){this.drawBorderSides(t,j)}else{var o=this.component.getScratchContext();o.canvas.height=n.b.h;o.canvas.width=n.b.w;o.clearRect(0,0,n.b.w,n.b.h);o.globalCompositeOperation="lighter";for(var q=0;q<2;q++){var m=f[q];var a=this.borderStyles[m];o.save();o.beginPath();this.doSideClipSubPath(o,m);o.clip();this.drawBorderSides(o,1<<m);o.restore()}t.globalCompositeOpertation="source-over";t.drawImage(o.canvas,0,0,n.b.w,n.b.h,0,0,n.b.w,n.b.h)}t.restore()}var l=0;if(this.oneUnitBorder&&this.noBorderRadius){if(i){this.drawBorderSides(t,1|8);l|=1|8}if(s){this.drawBorderSides(t,4|2);l|=4|2}}for(var m=0;m<4;m++){if(l&(1<<m)){continue}if(this.borderWidths[m]==0||this.borderStyles[m]=="hidden"||this.borderStyles[m]=="none"){continue}t.save();t.beginPath();this.doSideClipWithoutCornersSubPath(t,m);t.clip();this.drawBorderSides(t,1<<m);t.restore()}}}}});th.Component=Class.define({type:"Component",uses:[th.ComponentHelpers],members:{init:function(a){if(!a){a={}}for(var c in a){this[c]=a[c]}if(!this.bounds){this.bounds={}}this.border=new th.Border(this);if(this.opaque==undefined){this.opaque=true}this.bus=th.global_event_bus;this.styles=undefined;this.localStyles={};this.refreshCss=true},getScratchContext:function(){var a=this.getScene();if(a){return a.scratchContext}},getInsets:function(){var a=this.border.getInsets();a=this.calculateInsets("padding-","",a);return a},getMargins:function(){return this.calculateInsets("margin-")},paint:function(a){},repaint:function(){if(!this.getScene()){return}this.getScene().paint(this)}}});th.SimpleLayout=Class.define({members:{init:function(a){if(!a){a={}}this.orientation=a.orientation||th.HORIZONTAL},layout:function(f){var s=f.d();if(f.children.length>0){var q=(this.orientation==th.HORIZONTAL);var l=(q)?s.b.iw:s.b.ih;var j=parseInt(l/f.children.length);var t=l%f.children.length;var n=(q)?s.i.l:s.i.t;var o=n;for(var p=0;p<f.children.length;p++){var c=0;if(t>0){t--;c=1}var a=n;var m=j+c;f.children[p].bounds=(q)?{x:a,y:o,width:m,height:s.b.ih}:{x:o,y:a,width:s.b.iw,height:m};n+=m}}},getMinimumSize:function(a,f){var h=(this.orientation==th.HORIZONTAL)?"width":"height";var d=0;for(var c=0;c<a.children.length;c++){d+=a.children[c].getMinimumSize()[h]}return d},getPreferredSize:function(a){var f=(this.orientation==th.HORIZONTAL)?"width":"height";var d=0;for(var c=0;c<a.children.length;c++){d+=a.children[c].getPreferredSize()[f]}return d},getMaximumSize:function(a){var f=(this.orientation==th.HORIZONTAL)?"width":"height";var d=0;for(var c=0;c<a.children.length;c++){d+=a.children[c].getMaximumSize()[f]}return d}}});th.Container=Class.define({type:"Container",superclass:th.Component,uses:[th.ContainerHelpers],members:{init:function(a){this._super(a);this.children=[];this.checkedForFormLayout=false;this.layoutManager=new th.SimpleLayout()},add:function(){for(var d=0;d<arguments.length;d++){var a=th.isArray(arguments[d])?arguments[d]:[arguments[d]];this.children=this.children.concat(a);for(var c=0;c<a.length;c++){a[c].parent=this;a[c].refreshCss=true}}},remove:function(){for(var f=0;f<arguments.length;f++){var c=th.isArray(arguments[f])?arguments[f]:[arguments[f]];for(var d=0;d<c.length;d++){var a=this.children.length;this.children=th.remove(this.children,c[d]);if(a!=this.children.length){delete c[d].parent}}}},replace:function(c,a){this.bus.unbind(this.children[a]);c.parent=this;this.children[a]=c},paint:function(a){if(this.shouldPaint()){this.paintSelf(a);this.paintChildren(a)}},paintSelf:function(a){},paintChildren:function(a){for(var f=0;f<this.children.length;f++){if(!this.children[f].shouldPaint()){continue}if(!this.children[f].bounds){continue}a.save();try{a.translate(this.children[f].bounds.x,this.children[f].bounds.y)}catch(c){a.restore();continue}try{a.beginPath();a.rect(0,0,this.children[f].bounds.width,this.children[f].bounds.height);a.closePath();a.clip()}catch(d){}a.save();this.children[f].paint(a);if(this.children[f].border){this.children[f].border.paint(a)}a.restore();a.restore()}},installLayoutManager:function(d){this.layoutManager=d;var h=false;for(var c=0;c<this.children.length;c++){if(this.children[c]["constraints"]!==undefined){if(!this.children[c].cssValue("-th-constraints")){this.children[c].addCss("-th-constraints",this.children[c]["constraints"])}}if(this.children[c].cssValue("-th-constraints")){h=true}}if(d instanceof th.formlayout.FormLayout){if(!h){var f=1;var a=1;th.forEach(this.children,function(i){var m=false;while(f<=d.getRowCount()){while(a<=d.getColumnCount()){var l=d.getColumnSpec(a);if(l.isSpacer()){a++;continue}m=true;break}if(m){var j=d.getRowSpec(f);if(!j.isSpacer()){break}}m=false;f++;a=1}if(!m){return}d.addLayoutComponent(i,new th.formlayout.CellConstraints(a,f));a++})}else{th.forEach(this.children,function(i){var j=i.cssValue("-th-constraints");d.addLayoutComponent(i,new th.formlayout.CellConstraints(j))})}}},layoutTree:function(){if(!this.checkedForFormLayout){this.checkedForFormLayout=true;if(this.grid){var c=this.grid.split(";");if(c.length!=2){console.log("Couldn't parse 'grid' property: "+this.grid)}else{this.addCss("-th-grid-cols",c[0]);this.addCss("-th-grid-rows",c[1])}}var f=this.cssValue("-th-grid-cols");var d=this.cssValue("-th-grid-rows");if(f&&d){this.installLayoutManager(new th.formlayout.FormLayout(f,d))}}this.layout();for(var a=0;a<this.children.length;a++){if(this.children[a].layoutTree){this.children[a].layoutTree()}}},layout:function(){if(this.layoutManager){this.layoutManager.layout(this)}},render:function(){if(!th.global_resources.loaded){return}this.layoutTree();this.repaint()}}});th.WindowScene=Class.define({type:"Window",superclass:th.Scene,members:{init:function(a,c){this._super(a,c);this.canvas.style.position="absolute";this.canvas.style.display="none";this.isVisible=false;this.move(100,100);this.label=new th.Label();this.label.text="I am a Window, so drag me around!";this.label.addCss("font","9pt Tahoma");this.label.addCss("color","white");this.isDraggable=true;if(this.isDraggable){th.observe(this.canvas,"mousedown",this.onmousedown,this);th.observe(window,"mouseup",this.onmouseup,this);th.observe(window,"mousemove",this.onmousemove,this)}},move:function(a,c){this.canvas.style.top=c+"px";this.canvas.style.left=a+"px";this.posX=a;this.posY=c;this.bus.fire("move",{x:a,y:c},this)},centerUp:function(){this.move(Math.round((window.innerWidth-this.canvas.width)*0.5),Math.round((window.innerHeight-this.canvas.height)*0.25))},center:function(){this.move(Math.round((window.innerWidth-this.canvas.width)*0.5),Math.round((window.innerHeight-this.canvas.height)*0.5))},toggle:function(){this.isVisible=!this.isVisible;if(this.isVisible){this.canvas.style.display="block"}else{this.canvas.style.display="none"}this.bus.fire("toggle",{isVisible:this.isVisible},this)},getPosition:function(){return{x:this.posX,y:this.posY}},onmousedown:function(i){var j=this.root.d();var h=th.cumulativeOffset(this.canvas).left+j.i.l;var c=h+this.canvas.width-j.i.r;var f=th.cumulativeOffset(this.canvas).top+j.i.t;var a=f+this.canvas.height-j.i.b;if(i.clientX>h&&i.clientX<c&&i.clientY>f&&i.clientY<a){return}this.startValue={mouse:{x:i.clientX,y:i.clientY},window:this.getPosition()};th.stopEvent(i)},onmousemove:function(d){if(this.startValue){var c=this.startValue;var a=c.window.x-(c.mouse.x-d.clientX);var f=c.window.y-(c.mouse.y-d.clientY);this.move(a,f);th.stopEvent(d)}},onmouseup:function(a){delete this.startValue}}});if(typeof th=="undefined"){th={}}th.Panel=Class.define({type:"Panel",superclass:th.Container,members:{init:function(a){this._super(a)},paintSelf:function(a){this.paintBackground(a)}}});th.Button=Class.define({type:"Button",superclass:th.Component,members:{init:function(a){this._super(a)},getPreferredSize:function(){var h=this.getInsets();var f=h.left+h.right;var l=h.top+h.bottom;var a=this.cssValue("height");if(a!==undefined){a=th.convertLengthToPixels(a,this)}var j=this.cssValue("width");if(j!==undefined){j=th.convertLengthToPixels(j,this)}if(a!==undefined&&j!==undefined){return{width:j+f,height:a+l}}var c=this.tmb();if((c)&&(c.top&&c.mid&&c.bot)){if(a===undefined){a=c.top.height+c.mid.height+c.bot.height}if(j===undefined){j=c.top.width}return{width:j+f,height:a+l}}var d=this.getFirstBackgroundImage();if(d){return{width:d.width+f,height:d.height+l}}return{width:f,height:l}},tmb:function(){var c=this.cssValue("-th-top-image");var a=this.cssValue("-th-middle-image");var d=this.cssValue("-th-bottom-image");if(c){c=th.global_resources.images[c]}if(a){a=th.global_resources.images[a]}if(d){d=th.global_resources.images[d]}if(c&&a&&d){return{top:c,mid:a,bot:d}}},paint:function(a){var c=this.d();var f=this.tmb();if(!f){f={}}if(f.top&&f.mid&&f.bot){if(c.b.h>=f.top.height+f.bot.height){a.drawImage(f.top,0,0);if(c.b.h>f.top.height+f.bot.height){a.drawImage(f.mid,0,f.top.height,f.mid.width,c.b.h-f.top.height-f.bot.height)}a.drawImage(f.bot,0,c.b.h-f.bot.height)}}else{this.paintBackground(a)}}}});th.Scrollbar=Class.define({type:"Scrollbar",superclass:th.Container,members:{init:function(a){if(!a){a={}}this._super(a);this.orientation=a.orientation||th.VERTICAL;this.value=a.value||0;this.min=a.min||0;this.max=a.max||100;this.extent=a.extent||0.1;this.increment=a.increment||2;this.up=new th.Button({className:"up"});this.down=new th.Button({className:"down"});this.bar=new th.Button({className:"bar"});this.add([this.up,this.down,this.bar]);this.bus.bind("click",this.up,this.scrollup,this);this.bus.bind("click",this.down,this.scrolldown,this);this.bus.bind("mousedrag",this.bar,this.onmousedrag,this);this.bus.bind("mouseup",this.bar,this.onmouseup,this)},onmousedrag:function(i){var f=(this.orientation==th.VERTICAL)?i.clientY:i.clientX;if(this.dragstart_value==undefined){this.dragstart_value=this.value;this.dragstart_mouse=f;return}var j=this.d();var h=f-this.dragstart_mouse;var a=j.b.ih-this.up.bounds.height-this.down.bounds.height-this.bar.bounds.height;var c=(this.max-this.min)/a;this.value=this.dragstart_value+Math.floor(h*c);if(this.value<this.min){this.value=this.min}if(this.value>this.max){this.value=this.max}if(this.scrollable){this.scrollable.scrollTop=this.value}this.render();this.repaintScrollable()},onmouseup:function(a){delete this.dragstart_value;delete this.dragstart_mouse},scrollup:function(a){if(this.value>this.min){this.value=Math.max(this.min,this.value-this.increment);if(this.scrollable){this.scrollable.scrollTop=this.value}this.render();this.repaintScrollable()}},scrolldown:function(a){if(this.value<this.max){this.value=Math.min(this.max,this.value+this.increment);if(this.scrollable){this.scrollable.scrollTop=this.value}this.render();this.repaintScrollable()}},repaintScrollable:function(){if(!this.scrollable){return}if((this.isInsideOf(this.scrollable))&&(!this.opaque)){return}this.scrollable.repaint()},tmb:function(){var c=this.cssValue("-th-vertical-top-image");var a=this.cssValue("-th-vertical-middle-image");var d=this.cssValue("-th-vertical-bottom-image");if(c){c=th.global_resources.images[c]}if(a){a=th.global_resources.images[a]}if(d){d=th.global_resources.images[d]}if(c&&a&&d){return{top:c,mid:a,bot:d}}},getPreferredSize:function(){var f=this.getInsets();var d=f.left+f.right;var j=f.top+f.bottom;var a=this.cssValue("height");if(a!==undefined){a=th.convertLengthToPixels(a,this)}var h=this.cssValue("width");if(h!==undefined){h=th.convertLengthToPixels(h,this)}if(a!==undefined&&h!==undefined){return{width:h+d,height:a+j}}var c=this.tmb();if(c.top&&c.mid&&c.bot){if(a===undefined){a=c.top.height+c.mid.height+c.bot.height}if(h===undefined){h=c.top.width}return{width:h+d,height:a+j}}},layout:function(){var n=this.d();var c=undefined;if(this.scrollable){var q=this.scrollable.bounds.height;c=this.scrollable.getScrollInfo();this.min=0;this.max=c.scrollHeight-q;this.value=c.scrollTop;this.extent=(c.scrollHeight-q)/c.scrollHeight}if(this.max<this.min){for(var j=0;j<this.children.length;j++){delete this.children[j].bounds}return}if(this.orientation==th.VERTICAL){var o=n.b.iw;var l=this.up.getPreferredSize().height;this.up.bounds={x:n.i.l,y:n.i.t,width:o,height:l};this.down.bounds={x:n.i.l,y:n.b.ih-l,width:o,height:l};var p=n.b.ih-this.up.bounds.height-this.down.bounds.height;var m=Math.min(Math.floor(p-(this.extent*p),n.b.ih-this.up.bounds.height-this.down.bounds.height));var a=Math.floor(this.up.bounds.height+Math.min((this.value/(this.max-this.min))*(p-m)));var f=(a+m)-this.down.bounds.y;if(f>0){a-=f;if(this.scrollable){this.value=this.max;this.scrollable.scrollTop=this.value;this.scrollable.repaint()}}this.bar.bounds={x:n.i.l,y:a,width:n.b.iw,height:m}}else{}},paint:function(a){var c=this.d();if(this.max<0){return}var f=this.tmb();if(!f){return}if(f.top){a.drawImage(f.top,c.i.l,this.up.bounds.height)}if(f.mid){a.drawImage(f.mid,c.i.l,this.up.bounds.height+f.top.height,f.mid.width,this.down.bounds.y-this.down.bounds.height-(this.up.bounds.x-this.up.bounds.height))}if(f.bot){a.drawImage(f.bot,c.i.l,this.down.bounds.y-f.bot.height)}this._super(a)}}});th.ResizeNib=Class.define({type:"ResizeNib",superclass:th.Component,members:{init:function(a){this._super(a);this.bus.bind("mousedown",this,this.onmousedown,this);this.bus.bind("mouseup",this,this.onmouseup,this);this.bus.bind("mousedrag",this,this.onmousedrag,this)},onmousedown:function(a){this.startPos={x:a.clientX,y:a.clientY}},onmousedrag:function(a){if(this.startPos){if(!this.firedDragStart){this.bus.fire("dragstart",this.startPos,this);this.firedDragStart=true}this.bus.fire("drag",{startPos:this.startPos,currentPos:{x:a.clientX,y:a.clientY}},this)}},onmouseup:function(a){if(this.startPos&&this.firedDragStart){this.bus.fire("dragstop",{startPos:this.startPos,currentPos:{x:a.clientX,y:a.clientY}},this);delete this.firedDragStart}delete this.startPos},paint:function(p){var j=this.d();if(this.orientation==th.VERTICAL){var m=7;var o=Math.floor((j.b.w/2)-(m/2));var n=7;p.fillStyle=this.cssValue("-th-vertical-bar-shadow-color");for(var h=0;h<3;h++){p.fillRect(o,n,m,1);n+=3}n=8;p.fillStyle=this.cssValue("-th-vertical-bar-color");for(var h=0;h<3;h++){p.fillRect(o,n,m,1);n+=3}}else{var f=7;var a=8;var l=f+2;var o=Math.floor(j.b.w/2-(a/2));var n=Math.floor(j.b.h/2-(l/2));var c=o;if(this.cssValue("-th-horizontal-bar-subtle-shadow-color")){p.fillStyle=this.cssValue("-th-horizontal-bar-subtle-shadow-color");for(var h=0;h<3;h++){p.fillRect(c,n,1,l);c+=3}}c=o+1;p.fillStyle=this.cssValue("-th-horizontal-bar-shadow-color");for(var h=0;h<3;h++){p.fillRect(c,n+l-1,1,1);c+=3}c=o+1;p.fillStyle=this.cssValue("-th-horizontal-bar-color");for(var h=0;h<3;h++){p.fillRect(c,n+1,1,f);c+=3}}}}});th.Splitter=Class.define({type:"Splitter",superclass:th.Panel,members:{init:function(a){this._super(a);this.topNib=new th.ResizeNib({orientation:this.orientation});this.bottomNib=new th.ResizeNib({orientation:this.orientation});this.add(this.topNib,this.bottomNib);this.label=a.label;if(this.label){this.add(this.label)}this.scrollbar=a.scrollbar;if(this.scrollbar){this.add(this.scrollbar)}this.bus.bind("drag",[this.topNib,this.bottomNib],this.ondrag,this);this.bus.bind("dragstart",[this.topNib,this.bottomNib],this.ondragstart,this);this.bus.bind("dragstop",[this.topNib,this.bottomNib],this.ondragstop,this);this.className=(this.orientation==th.VERTICAL)?"vertical":"horizontal"},ondrag:function(a){this.bus.fire("drag",a,this)},ondragstart:function(a){this.bus.fire("dragstart",a,this)},ondragstop:function(a){this.bus.fire("dragstop",a,this)},getPreferredSize:function(){var f=this.getInsets();var d=f.left+f.right;var j=f.top+f.bottom;var c=this.cssValue("height");if(c!==undefined){c=th.convertLengthToPixels(c,this)}var h=this.cssValue("width");if(h!==undefined){h=th.convertLengthToPixels(h,this)}if(c!==undefined&&h!==undefined){return{width:h+d,height:c+j}}if(this.scrollbar&&this.scrollbar.shouldLayout()){var a=this.scrollbar.getPreferredSize();if(a){return{width:a.width+d,height:a.height+j}}}return{width:(h===undefined)?d:h+d,height:(c===undefined)?j:c+j}},layout:function(){var a=this.d();if(!this.orientation){this.orientation=(this.bounds.height>this.bounds.width)?th.HORIZONTAL:th.VERTICAL}if(this.orientation==th.HORIZONTAL){this.topNib.bounds={x:a.i.l,y:a.i.t,height:a.b.iw,width:a.b.iw};this.bottomNib.bounds={x:a.i.l,y:a.b.ih-a.b.iw,height:a.b.iw,width:a.b.iw};if(this.scrollbar&&this.scrollbar.shouldLayout()){this.scrollbar.bounds={x:a.i.l,y:this.topNib.bounds.height,height:a.b.ih-(this.topNib.bounds.height*2),width:a.b.iw}}}else{this.topNib.bounds={x:a.i.l,y:a.i.t,height:a.b.ih,width:a.b.ih};this.bottomNib.bounds={x:a.b.iw-a.b.ih,y:a.i.t,height:a.b.ih,width:a.b.ih};if(this.label){this.label.bounds={x:this.topNib.bounds.x+this.topNib.bounds.width,y:a.i.t,height:a.b.ih,width:a.b.iw-(a.b.ih*2)}}}}}});th.SplitPanelContainer=Class.define({type:"SplitPanelContainer",superclass:th.Panel,members:{init:function(a){this._super(a);this.splitter=new th.Splitter({orientation:this.orientation,label:a.label})},getContents:function(){var a=th.remove(this.children,this.splitter);if(a.length>0){return a[0]}},layout:function(){var d=th.remove(this.children,this.splitter);if(this.children.length==d.length){this.add(this.splitter)}var c=this.splitter.getPreferredSize();var a=(this.orientation==th.HORIZONTAL)?c.width:c.height;if(this.splitter.shouldLayout()){if(this.orientation==th.HORIZONTAL){this.splitter.bounds={x:this.bounds.width-a,y:0,height:this.bounds.height,width:a}}else{this.splitter.bounds={x:0,y:this.bounds.height-a,height:a,width:this.bounds.width}}}else{a=0}if(d.length>0){if(this.orientation==th.HORIZONTAL){d[0].bounds={x:0,y:0,height:this.bounds.height,width:this.bounds.width-a}}else{d[0].bounds={x:0,y:0,height:this.bounds.height-a,width:this.bounds.width}}}}}});th.SplitPanel=Class.define({type:"SplitPanel",superclass:th.Panel,uses:[th.StringHelpers],members:{init:function(a){this._super(a);if(!this.orientation){this.orientation=th.HORIZONTAL}if(!this.regions){this.regions=[{},{}]}},ondragstart:function(c){var a=c.thComponent.parent;a.region.startSize=a.region.size},ondrag:function(c){var a=c.thComponent.parent;var d=(this.orientation==th.HORIZONTAL)?c.currentPos.x-c.startPos.x:c.currentPos.y-c.startPos.y;a.region.size=a.region.startSize+d;this.render()},ondragstop:function(c){var a=c.thComponent.parent;delete a.region.startSize},layout:function(){this.remove(this.children);for(var d=0;d<this.regions.length;d++){var l=this.regions[d];if(!l.container){l.container=new th.SplitPanelContainer({orientation:this.orientation,label:l.label});l.container.region=l;this.bus.bind("dragstart",l.container.splitter,this.ondragstart,this);this.bus.bind("drag",l.container.splitter,this.ondrag,this);this.bus.bind("dragstop",l.container.splitter,this.ondragstop,this)}if(l.contents&&(l.contents!=l.container.getContents())){l.container.removeAll();l.container.add(l.contents)}if(d==this.regions.length-1){l.container.splitter.addCss("display","none")}this.add(l.container)}var m=(this.orientation==th.HORIZONTAL)?this.bounds.width:this.bounds.height;var a=0;for(var d=0;d<this.regions.length;d++){var h=this.regions[d];if(!h.size){h.size=(this.defaultSize||(100/this.regions.length)+"%")}if(this.isPercentage(h.size)){h.size=Math.floor((parseInt(h.size)/100)*m)}if(h.size<30){h.size=30}a+=h.size}if(a>m){var j=a-m;for(var d=this.regions.length-1;d>=0;d--){var h=this.regions[d];var c=h.size;h.size-=j;if(h.size<30){h.size=30}j-=(c-h.size);if(j<=0){break}}}else{if(a<m){var h=this.regions[this.regions.length-1].size+=(m-a)}}var f=0;for(var d=0;d<this.regions.length;d++){var l=this.regions[d];if(this.orientation==th.HORIZONTAL){l.container.bounds={x:f,y:0,width:l.size,height:this.bounds.height}}else{l.container.bounds={x:0,y:f,width:this.bounds.width,height:l.size}}f+=l.size}}}});th.Label=Class.define({type:"Label",superclass:th.Panel,members:{init:function(a){if(!a){a={}}this._super(a);this.text=a.text||""},styleContext:function(a){if(!a){return}a.font=this.cssValue("font");a.fillStyle=this.cssValue("color");return a},getPreferredSize:function(){var c=this.styleContext(this.parent.getScratchContext());var d=this.getInsets();var a=c.measureText(this.text).width+2;a+=d.left+d.right;var f=Math.floor(c.measureText(this.text).ascent*1.5);f+=d.top+d.bottom;return{height:f,width:a}},paint:function(a){this._super(a);var l=this.d();this.styleContext(a);var h=a.measureText(this.text);if(this.text===undefined){this.text=""}var j=this.text;var c=j.length-2;while(h.width>(l.b.w-l.i.w)){if(c<=0){if(this.text.length>1){j="..."}else{j=this.text}break}var i=Math.floor(c/2);var f=i+(c%2);j=this.text.substring(0,i)+"..."+this.text.substring(this.text.length-f);h=a.measureText(j);c-=1}var m=l.i.t+h.ascent;if(th.browser.WebKit){m+=1}a.fillText(j,l.i.l,m)}}});th.HtmlLabel=Class.define({type:"Label",superclass:th.Panel,members:{init:function(a){if(!a){a={}}this._super(a);this.text=a.text||"";this.lastText="";this.parsedHtml=[];this.regTag=/#\w+|\w+/g;this.regTags=/<(\w+|\w+\s+|#[a-fA-F0-9]{3}|#[a-fA-F0-9]{6})>|<\/(\w+|\w+\s|#[a-fA-F0-9]{3}|#[a-fA-F0-9]{6})>/g},styleContext:function(a,c){if(!a||!c){return}a.font=[c["font-weight"],c["font-style"],c["font-size"],c["font-family"]].join(" ");a.fillStyle=c.color;return a},parseHtml:function(){if(this.lastText==this.text&&this.parsedHtml.length!=0){return}var f={"font-family":"Tahoma","font-size":"9pt","font-style":"","font-weight":"","text-decoration":"",color:"black"};var m=[f];var n=th.getSpaceDelimitedItems(this.cssValue("font"));var j=[];for(var h=0;h<n.length;h++){if(th.isCssLength(n[h])){f["font-size"]=n[h]}else{switch(n[h]){case"bold":f["font-weight"]="bold";break;case"italic":f["font-style"]="italic";break;default:j.push(n[h]);break}}}f["font-family"]=j.join(", ");f.color=this.cssValue("color");if(this.lastText==this.text&&this.parsedHtml.length==0){this.parsedHtml.push({style:f});return}var d,q,o=this.text;var l=[""];var a=0;this.parsedHtml=[];var p=this.text.match(this.regTags);if(p!=null){for(var h=0;h<p.length;h++){var c=o.indexOf(p[h]);this.parsedHtml.push({style:m[a],text:o.substring(0,c)});o=o.substring(c+p[h].length);q=p[h].match(this.regTag)[0];if(p[h][1]!="/"){d=th.clone(m[a]);switch(q){case"b":case"strong":d["font-weight"]="bold";break;case"i":d["font-style"]="italic";break;case"u":d["text-decoration"]="underline";break;default:if(q[0]=="#"){d.color=q}else{console.error("parseHtml: Can't parse the tag '"+q+"' => !skip! parsing!");return}break}m.push(d);l.push(q);a++}else{if(l[a]!=q){console.error("parseHtml: Close tag '"+q+"' but should close '"+l[a]+"' => !skip! parsing!");return}m.pop();l.pop();a--}}if(a!=0){console.error("parseHtml: not all tag were closed again => !skip! parsing!");return}}this.parsedHtml.push({style:m[0],text:o});this.shouldParse=false;this.lastText=this.text},getPreferredSize:function(){this.parseHtml();var c=this.styleContext(this.parent.getScratchContext(),this.parsedHtml[0].style);var d=this.getInsets();var a=c.measureText(this.text).width+2;a+=d.left+d.right;var f=Math.floor(c.measureText(this.text).ascent*1.5);f+=d.top+d.bottom;return{height:f,width:a}},paint:function(q){this._super(q);var j=this.d();if(this.text!=this.lastText){this.parseHtml()}if(this.text!=this.lastText){return}this.styleContext(q,this.parsedHtml[0].style);l=q.measureText("text");var m=j.i.t+l.ascent;if(th.browser.WebKit){m+=1}var c=0;var n=(j.b.w-j.i.w);var l,f,o;var p,a;q.save();for(var h=0;h<this.parsedHtml.length;h++){p=this.parsedHtml[h].text;a=this.parsedHtml[h].style;if(p==""){continue}this.styleContext(q,a);l=q.measureText(p);if(c+l.width<=n){q.fillText(p,j.i.l+c,m);if(a["text-decoration"]=="underline"){q.lineWidth="1px";q.strokeStyle=a.color;q.beginPath();q.moveTo(j.i.l+c,m+2.5);q.lineTo(j.i.l+c+l.width,m+2.5);q.stroke();q.closePath()}c+=l.width}else{o=p.length-2;f=p;while((c+l.width>n)&&o>0){f=p.substring(0,--o)+"...";l=q.measureText(f)}q.fillText(f,j.i.l+c,m);break}}q.restore()}}});th.ExpandingInfoPanel=Class.define({type:"ExpandingInfoPanel",superclass:th.Panel,members:{init:function(a){this._super(a)},getMinimumRowHeight:function(){return 40},getMinimumColumnWidth:function(){},layout:function(){if(this.children.length==0){return}var p=this.d();var y=Math.floor(Math.sqrt(this.children.length));var x=Math.floor(p.b.h/y);while(x<this.getMinimumRowHeight()&&y>1){y--;x=Math.floor(p.b.h/y)}var u=Math.floor(this.children.length/y);var v=this.children.length%y;var l=0;var a=p.b.h%y;var f=0;for(var n=0;n<y;n++){var o=(n==y-1)?x+a:x;var s=(v>0)?u+1:u;v--;var c=Math.floor(p.b.w/s);var m=p.b.w%s;var j=0;for(var q=0;q<s;q++){var t=(q==s-1)?c+m:c;this.children[l++].bounds={x:j,y:f,width:t,height:o};j+=t}f+=o}}}});th.List=Class.define({type:"List",superclass:th.Container,members:{init:function(a){if(!a){a={}}this._super(a);this.items=a.items||[];this.scrollTop=0;this.allowDeselection=a.allowDeselection||false;this.bus.bind("mousedown",this,this.onmousedown,this);this.bus.bind("keydown",this,this.onkeydown,this);this.renderer=new th.Label();this.renderer.addCss("visibility","hidden");this.add(this.renderer);if(a.topLabel){this.addTopLabel(a.topLabel)}},performCopy:function(){if(!this.selected){return false}return this.selected.text},performCut:function(){if(!this.selected){return}var a=this.selected.text;th.removeArrayItem(this.items,this.selected);delete this.selected;this.repaint();return a},performPaste:function(a){this.addItemWithString(a);this.repaint()},addTopLabel:function(a){this.label=a;this.label.className="header";this.add(this.label)},onmousedown:function(c){if(this.focusManager!==undefined){if(!this.focusManager.focus(this)){th.stopEvent(c);return}}var a=this.getItemForPosition({x:c.componentX,y:c.componentY});if(a!=this.selected){if(a){this.selected=a;this.bus.fire("itemselected",{container:this,item:this.selected},this);this.repaint()}else{if(this.allowDeselection){delete this.selected}}}th.stopEvent(c)},onkeydown:function(a){if(a.keyCode==38){this.moveSelectionUp();th.stopEvent(a)}else{if(a.keyCode==40){this.moveSelectionDown();th.stopEvent(a)}}},selectItemByText:function(d){if(this.items.length==0){return false}var c=null;if(th.isObject(this.items[0])){for(var a=0;a<this.items.length;a++){if(this.items[a].text==d){c=this.items[a];break}}if(c==null){return false}}else{if(this.items.indexOf(d)==-1){return false}c=this.items[this.items.indexOf(d)]}if(this.selected!=c){this.selected=c;this.repaint()}return true},moveSelectionUp:function(){if(!this.selected||this.items.length==0){return}var a=0;while(this.items[a]!=this.selected){a++}if(a!=0){this.selected=this.items[a-1];this.bus.fire("itemselected",{container:this,item:this.selected},this);this.repaint()}},moveSelectionDown:function(){if(!this.selected&&this.items.length==0){return}if(!this.selected&&this.items.length!=0){var a=-1}else{var a=0;while(this.items[a]!=this.selected){a++}}if(a!=this.items.length-1){this.selected=this.items[a+1];this.bus.fire("itemselected",{container:this,item:this.selected},this);this.repaint()}},getItemForPosition:function(f){f.y+=this.scrollTop;var d=this.getInsets().top;if(this.label){d+=this.label.bounds.height}for(var a=0;a<this.items.length;a++){var c=this.heights[a];if(f.y>=d&&f.y<=d+c){return this.items[a]}d+=c}},getItemText:function(a){if(a.text){return a.text}if(th.isString(a)){return a}return a.toString()},getRenderer:function(a){this.renderer.text=this.getItemText(a.item);this.renderer.selected=a.selected;this.renderer.pseudoClass=(this.renderer.selected)?"active":undefined;this.renderer.item=a.item;this.renderer.className=a.even?"even":"odd";if(a.item.contents){this.renderer.className+="more"}this.renderer.resolveCss();return this.renderer},getRenderContext:function(a,c){return{item:a,even:c%2==0,selected:this.selected===a}},getRowHeight:function(){if(!this.rowHeight){var f=this.d();var c=(this.items.length>0)?this.items[0]:undefined;if(c){var a=this.getRenderer(this.getRenderContext(c,0));this.rowHeight=a.getPreferredSize().height}}return this.rowHeight||0},getScrollInfo:function(){return{scrollTop:this.scrollTop,scrollHeight:this.getRowHeight()*this.items.length}},layout:function(){},paint:function(s){var n=this.d();var i=this.getScrollInfo();var j=Math.max(i.scrollHeight,n.b.h);var o=n.i.t;if(this.label){this.label.addCss("visibility","visible");var m=this.label.getPreferredSize().height;this.label.bounds={y:o,x:n.i.l,height:m,width:n.b.w};this.label.paint(s);this.label.border.paint(s);o+=m;this.label.addCss("visibility","hidden")}s.save();s.translate(0,-this.scrollTop);try{this.paintBackground(s,0,o,n.b.w,j);if(this.items.length==0){return}if(!this.renderer){console.log("No renderer for List of type "+this.type+" with id "+this.id+"; cannot paint contents");return}this.heights=[];var c=0;while(o<j&&c<this.items.length){var f=(c<this.items.length);var q=f?this.items[c]:"";var a=this.getRenderer(this.getRenderContext(q,c));if(!a){break}var p=n.b.w-n.i.w;var l=(this.rowHeight)?this.rowHeight:(f)?a.getPreferredSize().height:this.heights[this.heights.length-1];if(f){this.heights.push(l)}if((o+l)>=this.scrollTop){a.bounds={x:0,y:0,height:l,width:p};s.save();s.translate(n.i.l,o);s.beginPath();s.rect(0,0,p,l);s.closePath();s.clip();a.addCss("visibility","visible");a.paint(s);a.border.paint(s);a.addCss("visibility","hidden");s.restore()}c++;o+=l}}finally{s.restore()}}}});th.HorizontalTree=Class.define({type:"HorizontalTree",superclass:th.Panel,members:{init:function(a){if(!a){a={}}this._super(a);this.orientation=th.HORIZONTAL;this.lists=[];this.splitters=[];this.listWidths=[]},setData:function(c){for(var a=0;a<this.lists.length;a++){this.remove(this.lists[a]);this.remove(this.splitters[a]);this.bus.unbind(this.lists[a]);this.bus.unbind(this.splitters[a])}this.lists=[];this.splitters=[];this.data=c;this.showChildren(null,c)},ondragstart:function(c){var a=this.splitters.indexOf(c.thComponent);this.startSize=this.listWidths[a]},ondrag:function(c){var a=this.splitters.indexOf(c.thComponent);var d=(this.orientation==th.HORIZONTAL)?c.currentPos.x-c.startPos.x:c.currentPos.y-c.startPos.y;this.listWidths[a]=this.startSize+d;this.render()},ondragstop:function(a){delete this.startSize},updateData:function(a,c){a.contents=c;if(this.getSelectedItem()==a){this.showChildren(a,a.contents)}},replaceList:function(a,c){this.lists[a].items=c;delete this.lists[a].selected;this.render()},removeListsFrom:function(c){for(var a=c;a<this.lists.length;a++){this.bus.unbind(this.lists[a]);this.bus.unbind(this.splitters[a]);this.remove(this.lists[a]);this.remove(this.splitters[a])}this.lists=this.lists.slice(0,c);this.splitters=this.splitters.slice(0,c)},showChildren:function(d,c){if(this.details){this.remove(this.details);delete this.details}if(!th.isArray(c)){c(this.getSelectedPath(),this);this.render();return}if(!c||c.length==0){return}var h=this.createList(c);if(this.id){h.id=this.id+"-list-"+(this.lists.length+1)}this.bus.bind("itemselected",h,this.itemSelected,this);var a=this;this.bus.bind("dblclick",h,function(i){a.bus.fire("dblclick",i,a)});this.lists.push(h);this.add(h);var f=new th.Splitter({orientation:th.HORIZONTAL,scrollbar:new th.Scrollbar()});f.scrollbar.scrollable=h;f.scrollbar.opaque=false;this.bus.bind("dragstart",f,this.ondragstart,this);this.bus.bind("drag",f,this.ondrag,this);this.bus.bind("dragstop",f,this.ondragstop,this);this.splitters.push(f);this.add(f);if(this.parent){this.render()}},showDetails:function(a){if(this.details){this.remove(this.details)}if(this.parent){this.repaint()}},createList:function(a){var c=new th.List({items:a});if(this.renderer){c.renderer=this.renderer}c.oldGetRenderer=c.getRenderer;c.getRenderer=function(d){var f=c.oldGetRenderer(d);f.text=d.item.name;return f};return c},getSelectedItem:function(){var a=this.getSelectedPath();if(a.length>0){return a[a.length-1]}},getSelectedPath:function(d){d=d||false;var f=[];for(var c=0;c<this.lists.length;c++){if(this.lists[c].selected){f.push(this.lists[c].selected)}else{break}}if(f.length==0){return}if(d){var a="";for(var c=0;c<f.length-1;c++){a+=f[c].name+"/"}if(!f[f.length-1].contents){a+=f[f.length-1].name}else{a+=f[f.length-1].name+"/"}return a}else{return f}return f},itemSelected:function(l){var m=l.thComponent;if(!m.selected){return}var o=[];for(var f=0;f<this.lists.length;f++){o.push(this.lists[f].selected);if(this.lists[f]==m){for(var d=f+1;d<this.lists.length&&this.lists[d].selected;d++){this.lists[d-1].selected.lastSelected=this.lists[d].selected.name;delete this.lists[d].selected}break}}this.bus.fire("itemselected",{e:l},this);if(o.length<this.lists.length){var c=this.lists.slice(0,o.length);var a=this.splitters.slice(0,o.length);for(var n=o.length;n<this.lists.length;n++){this.bus.unbind(this.lists[n]);this.bus.unbind(this.splitters[n]);this.remove(this.lists[n]);this.remove(this.splitters[n])}this.lists=c;this.splitters=a}var h=o[o.length-1];if(h&&h.contents){this.showChildren(h,h.contents)}else{this.showDetails(h)}},getItem:function(d){var a=this.data;var f;for(var c=0;c<d.length;c++){for(var h=0;h<a.length;h++){if(a[h]==d[c]){f=a[h];a=f.contents;break}}}return f},layout:function(){var l=this.d();var a=l.i.l;for(var f=0;f<this.lists.length;f++){var j=this.lists[f];if(!this.listWidths){this.listWidths=[]}if(!this.listWidths[f]){this.listWidths[f]=th.convertLengthToPixels(this.cssValue("-th-list-width"),this)}var c=this.listWidths[f];j.bounds={x:a,y:l.i.t,width:c,height:l.b.h-l.i.h};a+=c;var h=this.splitters[f];c=h.getPreferredSize().width;h.bounds={x:a,y:l.i.t,width:c,height:l.b.h-l.i.h};a+=c}if(this.details){this.details.bounds={x:a,y:l.i.t,width:th.convertLengthToPixels(this.cssValue("-th-default-width"),this),height:l.b.h-l.i.h}}},paintSelf:function(a){this._super(a)}}});th.DEFAULT_CSS="* {/* this should probably be the browser's default font */font: 10pt Arial, sans-serif;}Scrollbar {/*-th-vertical-top-image: url(/images/dash_vscroll_track_top.png);*//*-th-vertical-middle-image: url(/images/dash_vscroll_track_middle.png);*//*-th-vertical-bottom-image: url(/images/dash_vscroll_track_bottom.png);*/-th-vertical-top-image: url(/images/scroll_gutter_top.png);-th-vertical-middle-image: url(/images/scroll_gutter_mid.png);-th-vertical-bottom-image: url(/images/scroll_gutter_btm.png);}Scrollbar > Button.bar {-th-top-image: url(/images/scroll_thumb_top.png);-th-middle-image: url(/images/scroll_thumb_mid.png);-th-bottom-image: url(/images/scroll_thumb_btm.png);}Scrollbar > Button.up {background-image: url(/images/scroll_cntrl_up.png);}Scrollbar > Button.down {background-image: url(/images/scroll_cntrl_dwn.png);}ResizeNib {-th-vertical-bar-color: rgb(10, 10, 8);-th-vertical-bar-shadow-color: rgb(185, 180, 158);-th-horizontal-bar-subtle-shadow-color: rgba(0, 0, 0, 0.1);-th-horizontal-bar-shadow-color: black;-th-horizontal-bar-color: rgb(183, 180, 160);}Label {padding: 2px 5px;color: black;}HorizontalTree {-th-list-width: 160px;-th-details-width: 150px;}Splitter.vertical {height: 20px;}Splitter.horizontal {width: 17px;}Button {background-color: gray;";if(typeof th=="undefined"){th={}}th.EditorContainer=Class.define({type:"EditorContainer",superclass:th.Panel,members:{init:function(a){this._super(a);this.model=new th.TextModel();this.cursor=new th.EditorCursor();this.scrollbar=new th.Scrollbar();this.scrollbar.scrollable=this;this.scrollbar.opaque=false;this.add(this.scrollbar);this.leftPadding=0;this.rightPadding=0;this.scrollTop=0},getScrollInfo:function(){return{scrollTop:this.scrollTop,scrollHeight:this.getRowCount()*this.charSize.height}},layout:function(){if(this.font===undefined){this.font=this.cssValue("font");var a=this.getScratchContext();a.font=this.font;this.charSize=a.measureText("M");this.charSize.height=Math.floor(this.charSize.ascent*2.8)}if(this.color===undefined){this.color=this.cssValue("color")}var c=this.d();this.scrollbar.bounds={x:c.b.w-14,y:0,height:c.b.h,width:14};this.scrollbar.increment=this.charSize.height;this.effw=c.b.iw-this.leftPadding-this.rightPadding;this.vll=Math.floor(this.effw/this.charSize.width);this.vlc=Math.ceil((c.b.ih-0.75*this.charSize.height)/this.charSize.height)},paintText:function(a){var h=this.d();var f=this.getFirstVisibleLine(this.scrollTop);var i=f.row;var c=0;a.font=this.font;a.fillStyle=this.color;a.translate(this.leftPadding,this.charSize.height*0.75-f.offset*this.charSize.height);while(c<=this.vlc&&i<this.model.getRowCount()){c+=this.paintLine(a,i);i++}},paintSelf:function(a){if(this.model.isEmpty()){return}a.save();this.paintUnderText(a);a.restore();a.save();this.paintText(a);a.restore();a.save();this.paintOverText(a);a.restore()},getRowCount:function(){},paintLine:function(a,c){return 0},paintUnderText:function(a){},paintOverText:function(a){},getFirstVisibleLine:function(a){}}});th.SimpleEditor=Class.define({type:"SimpleEditor",superclass:th.EditorContainer,members:{init:function(a){this._super(a);this.rightPadding=20;this.leftPadding=30;this.options={};this.options.wrap=(a.wrap===undefined)?false:(a.wrap=="true")},getRowCount:function(){if(!this.options.wrap){return this.model.getRowCount()}if(this.rowCountCache===undefined){var f=0;var a;for(var d=0;d<this.model.getRowCount();d++){a=this.model.getRowLength(d);f+=(a==0)?1:Math.ceil(a/this.vll)}this.rowCountCache=f}return this.rowCountCache},getFirstVisibleLine:function(m){if(!this.options.wrap){return{row:Math.floor(m/this.charSize.height),offset:0}}var h=Math.floor(m/this.charSize.height);var n=0;var j;var a;for(var f=0;f<this.model.getRowCount();f++){a=this.model.getRowLength(f);j=(a==0)?1:Math.ceil(a/this.vll);if(n+j>=h){return{row:f,offset:h-n}}n+=j}return{row:f,offset:0}},paintUnderText:function(a){a.fillStyle="#A9F4CF";a.fillRect(0,0,this.leftPadding-5,this.d().b.ih)},paintLine:function(c,f){var i=this.vll;var a=this.model.getRowLength(f);if(!this.options.wrap){i=a}var h=(a==0)?1:Math.ceil(a/i);if(this.model.isRowDirty(f)){c.fillText(f+1,-this.leftPadding,0);var j=this.model.getRow(f);for(var d=0;d<h;d++){c.fillText(j.substr(d*i,i),0,0);c.translate(0,this.charSize.height)}}else{c.translate(0,h*this.charSize.height)}return h},paintOverText:function(a){}}});th.TextModel=Class.define({type:"TextModel",members:{init:function(){this.rows=[];this.dirty=[]},appendRows:function(d){var c=d.split("\n");for(var a=0;a<c.length;a++){this.rows.push(c[a]);this.dirty.push(true)}},getRow:function(a){if(a<0||a>=this.rows.length){return""}return this.rows[a]},isRowDirty:function(a){return this.dirty[a]},getRowLength:function(a){if(a<0||a>=this.rows.length){return 0}return this.rows[a].length},isEmpty:function(){return(this.rows.length==0)},getRowCount:function(){return this.rows.length}}});th.EditorCursor=Class.define({type:"EditorCursor",members:{init:function(){this.row=0;this.col=0}}});if(typeof th=="undefined"){th={}}th.Hashtable=(function(){function f(E){return(typeof E==="undefined")}function a(E){return(typeof E==="function")}function o(E){return(typeof E==="string")}function q(F,E){return a(F[E])}function A(E){return q(E,"equals")}function w(E){return q(E,"hashCode")}function C(F){if(o(F)){return F}else{if(w(F)){var E=F.hashCode();if(!o(E)){return C(E)}return E}else{if(q(F,"toString")){return F.toString()}else{return String(F)}}}}function z(E,F){return E.equals(F)}function h(E,F){if(A(F)){return F.equals(E)}else{return E===F}}function c(F,E){return F===E}function u(F,K,H,L,G){var J;for(var I=0,E=F.length;I<E;I++){J=F[I];if(G(K,H(J))){return L?[I,J]:true}}return false}function y(H,G){if(q(H,"splice")){H.splice(G,1)}else{if(G===H.length-1){H.length=G}else{var F=H.slice(G+1);H.length=G;for(var I=0,E=F.length;I<E;I++){H[G+I]=F[I]}}}}function D(F,E){if(F===null){throw new Error("null is not a valid "+E)}else{if(f(F)){throw new Error(E+" must not be undefined")}}}var m="key",d="value";function l(E){D(E,m)}function i(E){D(E,d)}function n(F,G,E){this.entries=[];this.addEntry(F,G);if(E!==null){this.getEqualityFunction=function(){return E}}}function B(E){return E[0]}function p(E){return E[1]}n.prototype={getEqualityFunction:function(E){if(A(E)){return z}else{return h}},searchForEntry:function(E){return u(this.entries,E,B,true,this.getEqualityFunction(E))},getEntryForKey:function(E){return this.searchForEntry(E)[1]},getEntryIndexForKey:function(E){return this.searchForEntry(E)[0]},removeEntryForKey:function(F){var E=this.searchForEntry(F);if(E){y(this.entries,E[0]);return true}return false},addEntry:function(E,F){this.entries[this.entries.length]=[E,F]},size:function(){return this.entries.length},keys:function(G){var H=G.length;for(var F=0,E=this.entries.length;F<E;F++){G[H+F]=this.entries[F][0]}},values:function(F){var H=F.length;for(var G=0,E=this.entries.length;G<E;G++){F[H+G]=this.entries[G][1]}},containsKey:function(E){return u(this.entries,E,B,false,this.getEqualityFunction(E))},containsValue:function(E){return u(this.entries,E,p,false,c)}};function x(){}x.prototype=[];function t(E){return E[0]}function j(G,E,F){return u(G,E,t,true,F)}function v(F,E){var G=F[E];if(G&&(G instanceof x)){return G[1]}return null}function s(G,F){var H=[];var E={};G=a(G)?G:C;F=a(F)?F:null;this.put=function(K,M){l(K);i(M);var I=G(K);var N=v(E,I);if(N){var J=N.getEntryForKey(K);if(J){J[1]=M}else{N.addEntry(K,M)}}else{var L=new x();L[0]=I;L[1]=new n(K,M,F);H[H.length]=L;E[I]=L}};this.get=function(K){l(K);var I=G(K);var L=v(E,I);if(L){var J=L.getEntryForKey(K);if(J){return J[1]}}return null};this.containsKey=function(J){l(J);var I=G(J);var K=v(E,I);if(K){return K.containsKey(J)}return false};this.containsValue=function(K){i(K);for(var J=0,I=H.length;J<I;J++){if(H[J][1].containsValue(K)){return true}}return false};this.clear=function(){H.length=0;E={}};this.isEmpty=function(){return H.length===0};this.keys=function(){var K=[];for(var J=0,I=H.length;J<I;J++){H[J][1].keys(K)}return K};this.values=function(){var J=[];for(var K=0,I=H.length;K<I;K++){H[K][1].values(J)}return J};this.remove=function(K){l(K);var J=G(K);var L=v(E,J);if(L){if(L.removeEntryForKey(K)){if(L.size()===0){var I=j(H,J,L.getEqualityFunction(K));y(H,I[0]);delete E[J]}}}};this.size=function(){var K=0;for(var J=0,I=H.length;J<I;J++){K+=H[J][1].size()}return K}}return s})();if(typeof th=="undefined"){th={}}if(typeof th.formlayout=="undefined"){th.formlayout={}}th.formlayout.Exception=Class.define({members:{init:function(a){this.message=a},toString:function(){return this.message}}});th.formlayout.IllegalArgumentException=Class.define({superclass:th.formlayout.Exception,members:{init:function(a){this._super(a)}}});th.formlayout.IndexOutOfBoundsException=Class.define({superclass:th.formlayout.Exception,members:{init:function(a){this._super(a)}}});th.formlayout.FormLayoutParseException=Class.define({superclass:th.formlayout.Exception,members:{init:function(a){this._super(a)}}});th.formlayout.Unit=Class.define({members:{init:function(a,f,d,c){this.name=a;this.abbreviation=f;this.parseAbbreviation=d;this.requiresIntegers=c},toString:function(){return this.name},encode:function(){return this.parseAbbreviation||this.abbreviation},abbreviation:function(){return this.abbreviation}}});th.formlayout.Unit.valueOf=function(d,c){if(d.length==0){var a=th.formlayout.Sizes.getDefaultUnit();if(a){return a}return c?th.formlayout.ConstantSize.DIALOG_UNITS_X:th.formlayout.ConstantSize.DIALOG_UNITS_Y}else{if(d=="px"){return th.formlayout.ConstantSize.PIXEL}else{if(d=="dlu"){return c?th.formlayout.ConstantSize.DIALOG_UNITS_X:th.formlayout.ConstantSize.DIALOG_UNITS_Y}else{if(d=="em"){return th.formlayout.ConstantSize.EM}else{if(d=="pt"){return th.formlayout.ConstantSize.POINT}else{if(d=="in"){return th.formlayout.ConstantSize.INCH}else{if(d=="mm"){return th.formlayout.ConstantSize.MILLIMETER}else{if(d=="cm"){return th.formlayout.ConstantSize.CENTIMETER}else{throw"Invalid unit name '"+d+"'. Must be one of: px, dlu, pt, mm, cm, in"}}}}}}}}};th.formlayout.FormLayout=Class.define({members:{init:function(d,c){if(th.isString(d)){d=th.formlayout.ColumnSpec.decodeSpecs(d)}if(th.isString(c)){c=th.formlayout.RowSpec.decodeSpecs(c)}this.colSpecs=d;this.rowSpecs=c;this.colGroupIndices=[];this.rowGroupIndices=[];this.constraintMap=new th.Hashtable();this.componentSizeCache=new th.formlayout.ComponentSizeCache();var a=this;this.minimumWidthMeasure=function(f){return a.componentSizeCache.getMinimumSize(f).width};this.minimumHeightMeasure=function(f){return a.componentSizeCache.getMinimumSize(f).height};this.preferredWidthMeasure=function(f){return a.componentSizeCache.getPreferredSize(f).width};this.preferredHeightMeasure=function(f){return a.componentSizeCache.getPreferredSize(f).height}},getColumnCount:function(){return this.colSpecs.length},getColumnSpec:function(a){return this.colSpecs[a-1]},setColumnSpec:function(c,a){this.colSpecs[c-1]=a},appendColumn:function(a){this.colSpecs.push(a)},insertColumn:function(c,a){if(c<1||c>this.getColumnCount()){throw"The column index "+c+"must be in the range [1, "+this.getColumnCount()+"]."}this.colSpecs[c-1]=a;this.shiftComponentsHorizontally(c,false);this.adjustGroupIndices(this.colGroupIndices,c,false)},removeColumn:function(a){if(a<1||a>this.getColumnCount()){throw"The column index "+a+" must be in the range [1, "+this.getColumnCount()+"]."}this.colSpecs.remove(a-1);this.shiftComponentsHorizontally(a,true);this.adjustGroupIndices(this.colGroupIndices,a,true)},getRowCount:function(){return this.rowSpecs.length},getRowSpec:function(a){return this.rowSpecs[a-1]},setRowSpec:function(c,a){this.rowSpecs[c-1]=a},appendRow:function(a){this.rowSpecs.push(a)},insertRow:function(c,a){if(c<1||c>this.getRowCount()){throw"The row index "+c+" must be in the range [1, "+this.getRowCount()+"]."}this.rowSpecs.add(c-1,a);this.shiftComponentsVertically(c,false);this.adjustGroupIndices(this.rowGroupIndices,c,false)},removeRow:function(a){if(a<1||a>this.getRowCount()){throw"The row index "+a+"must be in the range [1, "+this.getRowCount()+"]."}this.rowSpecs.remove(a-1);this.shiftComponentsVertically(a,true);this.adjustGroupIndices(this.rowGroupIndices,a,true)},shiftComponentsHorizontally:function(c,a){var f=a?-1:1;var d=this.constraintMap.keys();th.forEach(d,function(l){var m=this.constraintMap.get(l);var j=m.gridX;var h=m.gridWidth;var i=j+h-1;if(j==c&&a){throw"The removed column "+c+" must not contain component origins.\nIllegal component="+l}else{if(j>=c){m.gridX+=f}else{if(i>=c){m.gridWidth+=f}}}})},shiftComponentsVertically:function(f,a){var d=a?-1:1;var c=this.constraintMap.keys();th.forEach(c,function(j){var n=this.constraintMap.get(j);var m=n.gridY;var l=n.gridHeight;var i=m+l-1;if(m==f&&a){throw"The removed row "+f+" must not contain component origins.\nIllegal component="+j}else{if(m>=f){n.gridY+=d}else{if(i>=f){n.gridHeight+=d}}}})},adjustGroupIndices:function(h,c,a){var m=a?-1:+1;for(var j=0;j<h.length;j++){var l=h[j];for(var f=0;f<l.length;f++){var d=l[f];if(d==c&&a){throw"The removed index "+c+" must not be grouped."}else{if(d>=c){l[f]+=m}}}}},getConstraints:function(a){return this.constraintMap.get(a)},setConstraints:function(a,c){c.ensureValidGridBounds(this.getColumnCount(),this.getRowCount());this.constraintMap.put(a,c)},removeConstraints:function(a){this.constraintMap.remove(a);this.componentSizeCache.removeEntry(a)},getColumnGroups:function(){return this.colGroupIndices},setColumnGroups:function(h){var a=this.getColumnCount();var i=[];for(var f=0;f<this.colGroupIndices.length;f++){for(var d=0;d<this.colGroupIndices[f].length;d++){var c=this.colGroupIndices[f][d];if(c<1||c>a){throw"Invalid column group index "+c+" in group "+(f+1)}if(i[c]){throw"Column index "+c+" must not be used in multiple column groups."}i[c]=true}}this.colGroupIndices=h},addGroupedColumn:function(i){var f=this.getColumnGroups();if(f.length==0){f=[0][i]}else{var d=f.length-1;var h=f[d];var a=h.length;var c=h.slice(0,a);c[a]=i;f[d]=c}this.setColumnGroups(f)},getRowGroups:function(){return this.rowGroupIndices},setRowGroups:function(f){var a=this.getRowCount();var l=[];for(var d=0;d<this.rowGroupIndices.length;d++){for(var c=0;c<this.rowGroupIndices[d].length;c++){var h=this.rowGroupIndices[d][c];if(h<1||h>a){throw"Invalid row group index "+h+" in group "+(d+1)}if(l[h]){throw"Row index "+h+" must not be used in multiple row groups."}l[h]=true}}this.rowGroupIndices=f},addGroupedRow:function(i){var f=this.getRowGroups();if(f.length==0){f=[0][i]}else{var d=f.length-1;var h=f[d];var a=h.length;var c=h.slice(0,a);c[a]=i;f[d]=c}this.setRowGroups(f)},getHonorsVisibility:function(){return this.honorsVisibility},setHonorsVisibility:function(a){var h=this.getHonorsVisibility();if(h==a){return}this.honorsVisibility=a;var f=this.constraintMap.keys();if(f.length==0){return}var d=f[0];var c=d.parent;if(c){c.render()}},setHonorsVisibilityForComponent:function(c,a){var d=this.getConstraints(c);if(a==d.honorsVisibility){return}d.honorsVisibility=a;if(c.parent){c.parent.render()}},addLayoutComponent:function(a,c){if(th.isString(c)){this.setConstraints(a,new th.formlayout.CellConstraints(c))}else{this.setConstraints(a,c)}},removeLayoutComponent:function(a){this.removeConstraints(a)},getMinimumSize:function(a){return this.computeLayoutSize(a,this.minimumWidthMeasure,this.minimumHeightMeasure)},getPreferredSize:function(a){return this.computeLayoutSize(a,this.preferredWidthMeasure,this.preferredHeightMeasure)},getMaximumSize:function(a){return{width:1000000,height:1000000}},invalidateLayout:function(a){this.invalidateCaches()},layout:function(i){this.initializeColAndRowComponentLists();var h=i.getSize();var d=i.getInsets();var c=h.width-d.left-d.right;var f=h.height-d.top-d.bottom;var a=this.computeGridOrigins(i,c,d.left,this.colSpecs,this.colComponents,this.colGroupIndices,this.minimumWidthMeasure,this.preferredWidthMeasure);var j=this.computeGridOrigins(i,f,d.top,this.rowSpecs,this.rowComponents,this.rowGroupIndices,this.minimumHeightMeasure,this.preferredHeightMeasure);this.layoutComponents(a,j)},initializeColAndRowComponentLists:function(){this.colComponents=[];for(var a=0;a<this.getColumnCount();a++){this.colComponents[a]=[]}this.rowComponents=[];for(var a=0;a<this.getRowCount();a++){this.rowComponents[a]=[]}var c=this.constraintMap.keys();th.forEach(c,function(d){var f=this.constraintMap.get(d);if(this.takeIntoAccount(d,f)){if(f.gridWidth==1){this.colComponents[f.gridX-1].push(d)}if(f.gridHeight==1){this.rowComponents[f.gridY-1].push(d)}}},this)},computeLayoutSize:function(i,f,x){this.initializeColAndRowComponentLists();var y=this.maximumSizes(i,this.colSpecs,this.colComponents,this.minimumWidthMeasure,this.preferredWidthMeasure,f);var w=this.maximumSizes(i,this.rowSpecs,this.rowComponents,this.minimumHeightMeasure,this.preferredHeightMeasure,x);var s=this.groupedSizes(this.colGroupIndices,y);var o=this.groupedSizes(this.rowGroupIndices,w);var a=this.computeOrigins(s,0);var j=this.computeOrigins(o,0);var v=this.sum(s);var h=this.sum(o);var u=v;var q=h;var c=this.computeMaximumFixedSpanTable(this.colSpecs);var d=this.computeMaximumFixedSpanTable(this.rowSpecs);var l=this.constraintMap.keys();var n=this;th.forEach(l,function(H){var E=n.constraintMap.get(H);if(!n.takeIntoAccount(H,E)){return}if((E.gridWidth>1)&&(E.gridWidth>c[E.gridX-1])){var F=f(H);var D=E.gridX-1;var C=D+E.gridWidth;var G=a[D];var z=v-a[C];var B=G+F+z;if(B>u){u=B}}if((E.gridHeight>1)&&(E.gridHeight>d[E.gridY-1])){var K=x(H);var J=E.gridY-1;var I=J+E.gridHeight;var G=j[J];var z=h-j[I];var A=G+K+z;if(A>q){q=A}}});var t=i.getInsets();var p=u+t.left+t.right;var m=q+t.top+t.bottom;return{width:p,height:m}},computeGridOrigins:function(m,o,h,n,f,l,s,i){var w=this.maximumSizes(m,n,f,s,i,s);var c=this.maximumSizes(m,n,f,s,i,i);var t=this.groupedSizes(l,w);var v=this.groupedSizes(l,c);var u=this.sum(t);var q=this.sum(v);var j=this.compressedSizes(n,o,u,q,t,c);var p=this.groupedSizes(l,j);var d=this.sum(p);var a=this.distributedSizes(n,o,d,p);return this.computeOrigins(a,h)},computeOrigins:function(d,h){var c=d.length;var f=[];f[0]=h;for(var a=1;a<=c;a++){f[a]=f[a-1]+d[a-1]}return f},layoutComponents:function(a,d){var c=this.constraintMap.keys();th.forEach(c,function(h){var j={};var n=this.constraintMap.get(h);var f=n.gridX-1;var m=n.gridY-1;var l=n.gridWidth;var i=n.gridHeight;j.x=a[f];j.y=d[m];j.width=a[f+l]-j.x;j.height=d[m+i]-j.y;n.setBounds(h,this,j,this.minimumWidthMeasure,this.minimumHeightMeasure,this.preferredWidthMeasure,this.preferredHeightMeasure)},this)},invalidateCaches:function(){this.componentSizeCache.invalidate()},maximumSizes:function(a,h,l,c,j,f){var n=h.length;var o=[];for(var d=0;d<n;d++){var m=h[d];o[d]=m.maximumSize(a,l[d],c,j,f)}return o},compressedSizes:function(f,n,j,m,q,o){if(n<j){return q}if(n>=m){return o}var h=f.length;var s=[];var a=m-n;var p=m-j;var c=a/p;for(var d=0;d<h;d++){var l=f[d];s[d]=o[d];if(l.getSize().compressible()){s[d]-=Math.round((o[d]-q[d])*c)}}return s},groupedSizes:function(a,h){if(!a||a.length==0){return h}var f=[];for(var d=0;d<f.length;d++){f[d]=h[d]}for(var j=0;j<a.length;j++){var l=a[j];var m=0;for(var d=0;d<l.length;d++){var c=l[d]-1;m=Math.max(m,f[c])}for(var d=0;d<l.length;d++){var c=l[d]-1;f[c]=m}}return f},distributedSizes:function(m,u,t,f){var v=u-t;if(v<0){return f}var o=m.length;var d=0;for(var h=0;h<o;h++){var p=m[h];d+=p.getResizeWeight()}if(d==0){return f}var w=[];var c=v;var s=parseInt(v);for(var h=0;h<o;h++){var p=m[h];var l=p.getResizeWeight();if(l==th.formlayout.FormSpec.NO_GROW){w[h]=f[h]}else{var n=c-s;var a=v*l/d;var j=a-n;var q=Math.round(j);w[h]=f[h]+q;c-=a;s-=q}}return w},computeMaximumFixedSpanTable:function(j){var d=j.length;var f=[];var h=1000000;for(var c=d-1;c>=0;c--){var a=j[c];if(a.canGrow()){h=0}f[c]=h;if(h<1000000){h++}}return f},sum:function(d){var c=0;for(var a=d.length-1;a>=0;a--){c+=d[a]}return c},takeIntoAccount:function(a,c){return a.cssValue("visibility")!="hidden"||((!c.honorsVisibility)&&!this.getHonorsVisibility())||!c.honorsVisibility},getLayoutInfo:function(i){this.initializeColAndRowComponentLists();var h=i.getSize();var d=i.getInsets();var c=h.width-d.left-d.right;var f=h.height-d.top-d.bottom;var a=this.computeGridOrigins(i,c,d.left,this.colSpecs,this.colComponents,this.colGroupIndices,this.minimumWidthMeasure,this.preferredWidthMeasure);var j=this.computeGridOrigins(i,f,d.top,this.rowSpecs,this.rowComponents,this.rowGroupIndices,this.minimumHeightMeasure,this.preferredHeightMeasure);return new th.formlayout.LayoutInfo(a,j)}}});th.formlayout.LayoutInfo=Class.define({members:{init:function(c,a){this.columnOrigins=c;this.rowOrigins=a},getX:function(){return this.columnOrigins[0]},getY:function(){return this.rowOrigins[0]},getWidth:function(){return this.columnOrigins[this.columnOrigins.length-1]-this.columnOrigins[0]},getHeight:function(){return this.rowOrigins[this.rowOrigins.length-1]-this.rowOrigins[0]}}});th.formlayout.ComponentSizeCache=Class.define({members:{init:function(){this.minimumSizes=new th.Hashtable();this.preferredSizes=new th.Hashtable()},invalidate:function(){this.minimumSizes.clear();this.preferredSizes.clear()},getSize:function(a,f,d){var c=f.get(a);if(!c){c=a[d]();f.put(a,c)}return c},getMinimumSize:function(a){return this.getSize(a,this.minimumSizes,"getMinimumSize")},getPreferredSize:function(a){return this.getSize(a,this.preferredSizes,"getPreferredSize")},removeEntry:function(a){this.minimumSizes.remove(a);this.preferredSizes.remove(a)}}});th.formlayout.FormSpec=Class.define({members:{NO_GROW:0,DEFAULT_GROW:1,spacer:false,init:function(d,a,c){this.defaultAlignment=d;this.size=a;this.resizeWeight=c||0},isSpacer:function(){return this.spacer},getDefaultAlignment:function(){return this.defaultAlignment},getSize:function(){return this.size},getResizeWeight:function(){return this.resizeWeight},canGrow:function(){return this.resizeWeight!=this.NO_GROW},isHorizontal:function(){throw"This needs to be overridden."},setDefaultAlignment:function(a){this.defaultAlignment=a},setSize:function(a){this.size=a},setResizeWeight:function(a){this.resizeWeight=a},maximumSize:function(c,f,a,h,d){return this.size.maximumSize(c,f,a,h,d)},parseAndInitValues:function(f){if(f.indexOf("spacer(")==0){f=f.substring("spacer(".length,f.length-1);this.spacer=true}var c=f.split(":");if(c.length==0){throw new th.formlayout.IllegalArgumentException("The form spec must not be empty.")}var a=0;var d=c[a++];var h=th.formlayout.DefaultAlignment.valueOf(d,this.isHorizontal());if(h){this.setDefaultAlignment(h);if(c.length==1){throw new th.formlayout.IllegalArgumentException("The form spec must provide a size.")}d=c[a++]}this.setSize(this.parseSize(d));if(a<c.length){this.setResizeWeight(this.parseResizeWeight(c[a]))}},parseSize:function(a){if(a.indexOf("[")==0&&a.indexOf("]")==a.length-1){return this.parseBoundedSize(a)}if(a.indexOf("max(")==0&&a.indexOf(")")==a.length-1){return this.parseOldBoundedSize(a,false)}if(a.indexOf("min(")==0&&a.indexOf(")")==a.length-1){return this.parseOldBoundedSize(a,true)}return this.parseAtomicSize(a)},parseBoundedSize:function(c){var i=c.substring(1,c.length-1);var l=i.split(/\s*,\s*/);var j=undefined;var a=undefined;var f=undefined;if(l.length==2){var h=this.parseAtomicSize(l[0]);var d=this.parseAtomicSize(l[1]);if(this.isConstant(h)){if(this.isConstant(d)){a=h;j=d;f=d}else{a=h;j=d}}else{j=h;f=d}}else{if(l.length==3){a=this.parseAtomicSize(l[0]);j=this.parseAtomicSize(l[1]);f=this.parseAtomicSize(l[2])}}if(((a==null)||(this.isConstant(a)))&&((f==null)||(this.isConstant(f)))){return new th.formlayout.BoundedSize(j,a,f)}throw new th.formlayout.IllegalArgumentException("Illegal bounded size '"+c+"'. Must be one of:\n[<constant size>,<logical size>]                 // lower bound\n[<logical size>,<constant size>]                 // upper bound\n[<constant size>,<logical size>,<constant size>] // lower and upper bound.\nExamples:\n[50dlu,pref]                                     // lower bound\n[pref,200dlu]                                    // upper bound\n[50dlu,pref,200dlu]                              // lower and upper bound.")},parseAtomicSize:function(d){var a=th.trim(d);if(a.indexOf("'")==0&&a.indexOf("'")==a.length-1){var f=a.length;if(f<2){throw new th.formlayout.IllegalArgumentException('Missing closing "\'" for prototype.')}return new th.formlayout.PrototypeSize(a.substring(1,f-1))}var c=th.formlayout.ComponentSize.valueOf(a);if(c!=null){return c}return th.formlayout.ConstantSize.valueOf(a,this.isHorizontal())},parseResizeWeight:function(c){if(c=="g"||c=="grow"){return th.formlayout.FormSpec.DEFAULT_GROW}if(c=="n"||c=="nogrow"||c=="none"){return th.formlayout.FormSpec.NO_GROW}if((c.indexOf("grow(")==0||c.indexOf("g(")==0)&&c.indexOf(")")==c.length-1){var d=c.indexOf("(");var f=c.indexOf(")");var a=c.substring(d+1,f);return parseFloat(a)}throw new th.formlayout.IllegalArgumentException("The resize argument '"+c+"' is invalid.  Must be one of: grow, g, none, n, grow(<double>), g(<double>)")},isConstant:function(a){return(a instanceof th.formlayout.ConstantSize)||(a instanceof th.formlayout.PrototypeSize)},toString:function(){buffer=this.defaultAlignment;buffer+=":";buffer+=this.size.toString();buffer+=":";if(this.resizeWeight==th.formlayout.FormSpec.NO_GROW){buffer+="noGrow"}else{if(this.resizeWeight==th.formlayout.FormSpec.DEFAULT_GROW){buffer+="grow"}else{buffer+="grow(";buffer+=this.resizeWeight;buffer+=")"}}return buffer},toShortString:function(){buffer=this.defaultAlignment.abbreviation();buffer+=":";buffer+=this.size.toString();buffer+=":";if(this.resizeWeight==th.formlayout.FormSpec.NO_GROW){buffer+="n"}else{if(this.resizeWeight==th.formlayout.FormSpec.DEFAULT_GROW){buffer+="g"}else{buffer+="g(";buffer+=this.resizeWeight;buffer+=")"}}return buffer},encode:function(){var a="";var c=this.isHorizontal()?th.formlayout.ColumnSpec.DEFAULT:th.formlayout.RowSpec.DEFAULT;if(!c.equals(this.defaultAlignment)){a+=this.defaultAlignment.abbreviation();a+=":"}a+=this.size.encode();if(this.resizeWeight==th.formlayout.FormSpec.NO_GROW){}else{if(this.resizeWeight==th.formlayout.FormSpec.DEFAULT_GROW){a+=":";a+="g"}else{a+=":";a+="g(";a+=this.resizeWeight;a+=")"}}return a}}});th.formlayout.DefaultAlignment=Class.define({members:{init:function(a){this.name=a},toString:function(){return this.name},abbreviation:function(){return this.name.charAt(0)}}});th.formlayout.DefaultAlignment.valueOf=function(c,a){if(c=="f"||c=="fill"){return th.formlayout.FormSpec.FILL_ALIGN}else{if(c=="c"||c=="center"){return th.formlayout.FormSpec.CENTER_ALIGN}else{if(a){if(c=="r"||c=="right"){return th.formlayout.FormSpec.RIGHT_ALIGN}else{if(c=="l"||c=="left"){return th.formlayout.FormSpec.LEFT_ALIGN}else{return}}}else{if(c=="t"||c=="top"){return th.formlayout.FormSpec.TOP_ALIGN}else{if(c=="b"||c=="bottom"){return th.formlayout.FormSpec.BOTTOM_ALIGN}else{return}}}}}};th.formlayout.FormSpec.LEFT_ALIGN=new th.formlayout.DefaultAlignment("left");th.formlayout.FormSpec.RIGHT_ALIGN=new th.formlayout.DefaultAlignment("right");th.formlayout.FormSpec.TOP_ALIGN=new th.formlayout.DefaultAlignment("top");th.formlayout.FormSpec.BOTTOM_ALIGN=new th.formlayout.DefaultAlignment("bottom");th.formlayout.FormSpec.CENTER_ALIGN=new th.formlayout.DefaultAlignment("center");th.formlayout.FormSpec.FILL_ALIGN=new th.formlayout.DefaultAlignment("fill");th.formlayout.ColumnSpec=Class.define({superclass:th.formlayout.FormSpec,members:{init:function(d,a,c){this._super(d,a,c)},isHorizontal:function(){return true}}});th.formlayout.ColumnSpec.decode=function(a,f){var d=th.trim(a);var c=d.toLowerCase();return th.formlayout.ColumnSpec.decodeExpanded(c)};th.formlayout.ColumnSpec.decodeExpanded=function(c){var a=th.formlayout.ColumnSpec.CACHE.get(c);if(!a){a=new th.formlayout.ColumnSpec(th.formlayout.ColumnSpec.DEFAULT,th.formlayout.Sizes.DEFAULT,th.formlayout.FormSpec.NO_GROW);a.parseAndInitValues(c);th.formlayout.ColumnSpec.CACHE.put(c,a)}return a};th.formlayout.ColumnSpec.decodeSpecs=function(a,c){return th.formlayout.FormSpecParser.parseColumnSpecs(a,c)};th.formlayout.ColumnSpec.createGap=function(a){return new th.formlayout.RowSpec(th.formlayout.ColumnSpec.DEFAULT,a,th.formlayout.ColumnSpec.NO_GROW)};th.formlayout.ColumnSpec.LEFT=th.formlayout.FormSpec.LEFT_ALIGN;th.formlayout.ColumnSpec.CENTER=th.formlayout.FormSpec.CENTER_ALIGN;th.formlayout.ColumnSpec.MIDDLE=th.formlayout.ColumnSpec.CENTER;th.formlayout.ColumnSpec.RIGHT=th.formlayout.FormSpec.RIGHT_ALIGN;th.formlayout.ColumnSpec.FILL=th.formlayout.FormSpec.FILL_ALIGN;th.formlayout.ColumnSpec.DEFAULT=th.formlayout.ColumnSpec.FILL;th.formlayout.ColumnSpec.CACHE=new th.Hashtable();th.formlayout.RowSpec=Class.define({superclass:th.formlayout.FormSpec,members:{init:function(d,a,c){this._super(d,a,c)},isHorizontal:function(){return false}}});th.formlayout.RowSpec.decode=function(c,f){var d=th.trim(c);var a=d.toLowerCase();return th.formlayout.RowSpec.decodeExpanded(a)};th.formlayout.RowSpec.decodeExpanded=function(c){var a=th.formlayout.RowSpec.CACHE.get(c);if(!a){a=new th.formlayout.RowSpec(th.formlayout.RowSpec.DEFAULT,th.formlayout.Sizes.DEFAULT,th.formlayout.FormSpec.NO_GROW);a.parseAndInitValues(c);th.formlayout.RowSpec.CACHE.put(c,a)}return a};th.formlayout.RowSpec.decodeSpecs=function(a,c){return th.formlayout.FormSpecParser.parseRowSpecs(a,c)};th.formlayout.RowSpec.createGap=function(a){return new th.formlayout.RowSpec(th.formlayout.RowSpec.DEFAULT,a,th.formlayout.RowSpec.NO_GROW)};th.formlayout.RowSpec.TOP=th.formlayout.FormSpec.TOP_ALIGN;th.formlayout.RowSpec.CENTER=th.formlayout.FormSpec.CENTER_ALIGN;th.formlayout.RowSpec.BOTTOM=th.formlayout.FormSpec.BOTTOM_ALIGN;th.formlayout.RowSpec.FILL=th.formlayout.FormSpec.FILL_ALIGN;th.formlayout.RowSpec.DEFAULT=th.formlayout.RowSpec.CENTER;th.formlayout.RowSpec.CACHE=new th.Hashtable();th.formlayout.BoundedSize=Class.define({members:{init:function(c,d,a){this.basis=c;this.lowerBound=d;this.upperBound=a},getBasis:function(){return this.basis},getLowerBound:function(){return this.lowerBound},getUpperBound:function(){return this.upperBound},maximumSize:function(c,h,a,i,d){var f=this.basis.maximumSize(c,h,a,i,d);if(this.lowerBound){f=Math.max(f,this.lowerBound.maximumSize(c,h,a,i,d))}if(this.upperBound){f=Math.min(f,this.upperBound.maximumSize(c,h,a,i,d))}return f},compressible:function(){return this.basis.compressible()},equals:function(a){if(this===a){return true}var c=a;return this.basis.equals(c.basis)&&((this.lowerBound==null&&c.lowerBound==null)||(this.lowerBound!=null&&this.lowerBound.equals(c.lowerBound)))&&((this.upperBound==null&&c.upperBound==null)||(this.upperBound!=null&&this.upperBound.equals(c.upperBound)))},hashCode:function(){var a=this.basis.hashCode();if(this.lowerBound){a=a*37+this.lowerBound.hashCode()}if(this.upperBound){a=a*37+this.upperBound.hashCode()}return a}}});th.formlayout.ConstantSize=Class.define({members:{init:function(c,a){this.value=c;this.unit=a},getValue:function(){return this.value},getUnit:function(){return this.unit},getPixelSize:function(a){if(this.unit==th.formlayout.ConstantSize.PIXEL){return this.intValue()}else{if(this.unit==th.formlayout.ConstantSize.EM){return th.formlayout.Sizes.emAsPixel(this.value,a)}else{if(this.unit==th.formlayout.ConstantSize.POINT){return th.formlayout.Sizes.pointAsPixel(this.intValue(),a)}else{if(this.unit==th.formlayout.ConstantSize.INCH){return th.formlayout.Sizes.inchAsPixel(this.value,a)}else{if(this.unit==th.formlayout.ConstantSize.MILLIMETER){return th.formlayout.Sizes.millimeterAsPixel(this.value,a)}else{if(this.unit==th.formlayout.ConstantSize.CENTIMETER){return th.formlayout.Sizes.centimeterAsPixel(this.value,a)}else{if(this.unit==th.formlayout.ConstantSize.DIALOG_UNITS_X){return th.formlayout.Sizes.dialogUnitXAsPixel(this.intValue(),a)}else{if(this.unit==th.formlayout.ConstantSize.DIALOG_UNITS_Y){return th.formlayout.Sizes.dialogUnitYAsPixel(this.intValue(),a)}else{throw"Invalid unit "+this.unit}}}}}}}}},maximumSize:function(c,f,a,h,d){return this.getPixelSize(c)},compressible:function(){return false},equals:function(c){if(this==c){return true}if(!(c instanceof th.formlayout.ConstantSize)){return false}var a=c;return this.value==a.value&&this.unit==a.unit},hashCode:function(){return this.value+37*this.unit.hashCode()},toString:function(){return this.value+unit.abbreviation()},encode:function(){return this.value+unit.encode()},intValue:function(){return Math.round(this.value)}}});th.formlayout.ConstantSize.valueOf=function(j,a){var f=th.formlayout.ConstantSize.splitValueAndUnit(j);var d=f[0];var c=f[1];var h=th.formlayout.Unit.valueOf(c,a);var i=parseFloat(d);if(h.requiresIntegers){if(i!=parseInt(i)){throw h.toString()+" value "+d+" must be an integer."}}return new th.formlayout.ConstantSize(i,h)};th.formlayout.ConstantSize.dluX=function(a){return new th.formlayout.ConstantSize(a,th.formlayout.ConstantSize.DLUX)};th.formlayout.ConstantSize.dluY=function(a){return new th.formlayout.ConstantSize(a,th.formlayout.ConstantSize.DLUY)};th.formlayout.ConstantSize.splitValueAndUnit=function(f){var c=[];var a=f.length;var d=a;while(d>0&&(!/[^a-zA-Z]/.test(f.charAt(d-1)))){d--}c[0]=f.substring(0,d);c[1]=f.substring(d);return c};th.formlayout.ConstantSize.PIXEL=new th.formlayout.Unit("Pixel","px",undefined,true);th.formlayout.ConstantSize.EM=new th.formlayout.Unit("Em","em",undefined,false);th.formlayout.ConstantSize.POINT=new th.formlayout.Unit("Point","pt",undefined,false);th.formlayout.ConstantSize.DIALOG_UNITS_X=new th.formlayout.Unit("Dialog units X","dluX","dlu",true);th.formlayout.ConstantSize.DIALOG_UNITS_Y=new th.formlayout.Unit("Dialog units Y","dluY","dlu",true);th.formlayout.ConstantSize.MILLIMETER=new th.formlayout.Unit("Millimeter","mm",undefined,false);th.formlayout.ConstantSize.CENTIMETER=new th.formlayout.Unit("Centimeter","cm",undefined,false);th.formlayout.ConstantSize.INCH=new th.formlayout.Unit("Inch","in",undefined,false);th.formlayout.ConstantSize.PX=th.formlayout.ConstantSize.PIXEL;th.formlayout.ConstantSize.PT=th.formlayout.ConstantSize.POINT;th.formlayout.ConstantSize.DLUX=th.formlayout.ConstantSize.DIALOG_UNITS_X;th.formlayout.ConstantSize.DLUY=th.formlayout.ConstantSize.DIALOG_UNITS_Y;th.formlayout.ConstantSize.MM=th.formlayout.ConstantSize.MILLIMETER;th.formlayout.ConstantSize.CM=th.formlayout.ConstantSize.CENTIMETER;th.formlayout.ConstantSize.IN=th.formlayout.ConstantSize.INCH;th.formlayout.PrototypeSize=Class.define({members:{init:function(a){this.proto=a},getPrototype:function(){return this.proto},maximumSize:function(c,f,a,h,d){throw"PrototypeSize.maximumSize() not yet implemented"},compressible:function(){return false},encode:function(){return"'"+this.proto+"'"},equals:function(a){if(this==a){return true}if(!(a instanceof th.formlayout.PrototypeSize)){return false}return this.proto==a.proto},toString:function(){return this.encode()}}});th.formlayout.ComponentSize=Class.define({members:{init:function(a){this.name=a},maximumSize:function(d,n,f,m,l){var a=this==th.formlayout.Sizes.MINIMUM?f:(this==th.formlayout.Sizes.PREFERRED?m:l);var h=0;for(var j=0;j<n.length;j++){var o=n[j];h=Math.max(h,a(o))}return h},compressible:function(){return this==th.formlayout.Sizes.DEFAULT},toString:function(){return this.encode()},encode:function(){return name.substring(0,1)}}});th.formlayout.ComponentSize.valueOf=function(a){if(a=="m"||a=="min"){return th.formlayout.Sizes.MINIMUM}if(a=="p"||a=="pref"){return th.formlayout.Sizes.PREFERRED}if(a=="d"||a=="default"){return th.formlayout.Sizes.DEFAULT}return};th.formlayout.DefaultUnitConverter=Class.define({members:{inchAsPixel:function(c,a){return th.convertAbsoluteUnitToPixels("in",c)},millimeterAsPixel:function(c,a){return th.convertAbsoluteUnitToPixels("mm",c)},centimeterAsPixel:function(a,c){return th.convertAbsoluteUnitToPixels("cm",a)},pointAsPixel:function(c,a){return th.convertAbsoluteUnitToPixels("pt",c)},emAsPixel:function(c,a){return th.convertEmToPixels(a.cssValue("font"),c)},dialogUnitXAsPixel:function(c,a){throw"Unsupported"},dialogUnitYAsPixel:function(c,a){throw"Unsupported"}}});th.formlayout.Sizes={};th.formlayout.Sizes.unitConverter=new th.formlayout.DefaultUnitConverter();th.formlayout.Sizes.pixel=function(a){return new th.formlayout.ConstantSize(a,th.formlayout.ConstantSize.PIXEL)};th.formlayout.Sizes.ZERO=th.formlayout.Sizes.pixel(0);th.formlayout.Sizes.DLUX1=th.formlayout.ConstantSize.dluX(1);th.formlayout.Sizes.DLUX2=th.formlayout.ConstantSize.dluX(2);th.formlayout.Sizes.DLUX3=th.formlayout.ConstantSize.dluX(3);th.formlayout.Sizes.DLUX4=th.formlayout.ConstantSize.dluX(4);th.formlayout.Sizes.DLUX5=th.formlayout.ConstantSize.dluX(5);th.formlayout.Sizes.DLUX6=th.formlayout.ConstantSize.dluX(6);th.formlayout.Sizes.DLUX7=th.formlayout.ConstantSize.dluX(7);th.formlayout.Sizes.DLUX8=th.formlayout.ConstantSize.dluX(8);th.formlayout.Sizes.DLUX9=th.formlayout.ConstantSize.dluX(9);th.formlayout.Sizes.DLUX11=th.formlayout.ConstantSize.dluX(11);th.formlayout.Sizes.DLUX14=th.formlayout.ConstantSize.dluX(14);th.formlayout.Sizes.DLUX21=th.formlayout.ConstantSize.dluX(21);th.formlayout.Sizes.DLUY1=th.formlayout.ConstantSize.dluY(1);th.formlayout.Sizes.DLUY2=th.formlayout.ConstantSize.dluY(2);th.formlayout.Sizes.DLUY3=th.formlayout.ConstantSize.dluY(3);th.formlayout.Sizes.DLUY4=th.formlayout.ConstantSize.dluY(4);th.formlayout.Sizes.DLUY5=th.formlayout.ConstantSize.dluY(5);th.formlayout.Sizes.DLUY6=th.formlayout.ConstantSize.dluY(6);th.formlayout.Sizes.DLUY7=th.formlayout.ConstantSize.dluY(7);th.formlayout.Sizes.DLUY8=th.formlayout.ConstantSize.dluY(8);th.formlayout.Sizes.DLUY9=th.formlayout.ConstantSize.dluY(9);th.formlayout.Sizes.DLUY11=th.formlayout.ConstantSize.dluY(11);th.formlayout.Sizes.DLUY14=th.formlayout.ConstantSize.dluY(14);th.formlayout.Sizes.DLUY21=th.formlayout.ConstantSize.dluY(21);th.formlayout.Sizes.MINIMUM=new th.formlayout.ComponentSize("minimum");th.formlayout.Sizes.PREFERRED=new th.formlayout.ComponentSize("preferred");th.formlayout.Sizes.DEFAULT=new th.formlayout.ComponentSize("default");th.formlayout.Sizes.defaultUnit=th.formlayout.ConstantSize.PIXEL;th.formlayout.Sizes.constant=function(f,a){var c=f.toLowerCase();var d=th.trim(c);return th.formlayout.ConstantSize.valueOf(d,a)};th.formlayout.Sizes.bounded=function(c,d,a){return th.formlayout.BoundedSize(c,d,a)};th.formlayout.Sizes.emAsPixel=function(c,a){return c==0?0:th.formlayout.Sizes.unitConverter.emAsPixel(c,a)};th.formlayout.Sizes.inchAsPixel=function(c,a){return c==0?0:th.formlayout.Sizes.unitConverter.inchAsPixel(c,a)};th.formlayout.Sizes.millimeterAsPixel=function(c,a){return c==0?0:th.formlayout.Sizes.unitConverter.millimeterAsPixel(c,a)};th.formlayout.Sizes.centimeterAsPixel=function(a,c){return a==0?0:th.formlayout.Sizes.unitConverter.centimeterAsPixel(a,c)};th.formlayout.Sizes.pointAsPixel=function(c,a){return c==0?0:th.formlayout.Sizes.unitConverter.pointAsPixel(c,a)};th.formlayout.Sizes.dialogUnitXAsPixel=function(c,a){return c==0?0:th.formlayout.Sizes.unitConverter.dialogUnitXAsPixel(c,a)};th.formlayout.Sizes.dialogUnitYAsPixel=function(c,a){return c==0?0:th.formlayout.Sizes.unitConverter.dialogUnitYAsPixel(c,a)};th.formlayout.Sizes.getDefaultUnit=function(){return th.formlayout.Sizes.defaultUnit};th.formlayout.Alignment=Class.define({members:{init:function(c,a){this.name=c;this.orientation=a},toString:function(){return this.name},abbreviation:function(){return this.name.charAt(0)},isHorizontal:function(){return this.orientation!=th.formlayout.Alignment.VERTICAL},isVertical:function(){return this.orientation!=th.formlayout.Alignment.HORIZONTAL}}});th.formlayout.Alignment.HORIZONTAL=0;th.formlayout.Alignment.VERTICAL=1;th.formlayout.Alignment.BOTH=2;th.formlayout.Alignment.valueOf=function(a){var c=a.toLowerCase();if(c=="d"||c=="default"){return th.formlayout.CellConstraints.DEFAULT}else{if(c=="f"||c=="fill"){return th.formlayout.CellConstraints.FILL}else{if(c=="c"||c=="center"){return th.formlayout.CellConstraints.CENTER}else{if(c=="l"||c=="left"){return th.formlayout.CellConstraints.LEFT}else{if(c=="r"||c=="right"){return th.formlayout.CellConstraints.RIGHT}else{if(c=="t"||c=="top"){return th.formlayout.CellConstraints.TOP}else{if(c=="b"||c=="bottom"){return th.formlayout.CellConstraints.BOTTOM}else{throw"Invalid alignment "+a+". Must be one of: left, center, right, top, bottom, fill, default, l, c, r, t, b, f, d."}}}}}}}};th.formlayout.CellConstraints=Class.define({members:{init:function(c,l,i,h,f,j,d){var a=undefined;if(th.isString(c)){a=c;delete c}this.gridX=(c==undefined)?1:c;this.gridY=(l==undefined)?1:l;this.gridWidth=(i==undefined)?1:i;this.gridHeight=(h==undefined)?1:h;this.hAlign=f||th.formlayout.CellConstraints.DEFAULT;this.vAlign=j||th.formlayout.CellConstraints.DEFAULT;this.insets=d||th.formlayout.CellConstraints.EMPTY_INSETS;if(this.gridX<=0){throw new th.formlayout.IndexOutOfBoundsException("The grid x must be a positive number.")}if(this.gridY<=0){throw new th.formlayout.IndexOutOfBoundsException("The grid y must be a positive number.")}if(this.gridWidth<=0){throw new th.formlayout.IndexOutOfBoundsException("The grid width must be a positive number.")}if(this.gridHeight<=0){throw new th.formlayout.IndexOutOfBoundsException("The grid height must be a positive number.")}this.ensureValidOrientations(this.hAlign,this.vAlign);if(a){this.initFromConstraints(a)}},ensureValidOrientations:function(a,c){if(!a.isHorizontal()){throw new th.formlayout.IllegalArgumentException("The horizontal alignment must be one of: left, center, right, fill, default.")}if(!c.isVertical()){throw new th.formlayout.IllegalArgumentException("The vertical alignment must be one of: top, center, botto, fill, default.")}},initFromConstraints:function(a){var f=a.split(",");var i=f.length;if(!(i==2||i==4||i==6)){throw new th.formlayout.IllegalArgumentException("You must provide 2, 4 or 6 arguments.")}var c=0;var h=parseInt(th.trim(f[c++]));if(!h){throw new th.formlayout.IllegalArgumentException("First cell constraint element must be a number.")}this.gridX=h;if(this.gridX<=0){throw new th.formlayout.IndexOutOfBoundsException("The grid x must be a positive number.")}h=parseInt(th.trim(f[c++]));if(!h){throw new th.formlayout.IllegalArgumentException("Second cell constraint element must be a number.")}this.gridY=h;if(this.gridY<=0){throw new th.formlayout.IndexOutOfBoundsException("The grid y must be a positive number.")}if(c>=f.length){return}var d=th.trim(f[c++]);h=parseInt(d);if(h){this.gridWidth=h;if(this.gridWidth<=0){throw new th.formlayout.IndexOutOfBoundsException("The grid width must be a positive number.")}h=parseInt(th.trim(f[c++]));if(h==null){throw new th.formlayout.IllegalArgumentException("Fourth cell constraint element must be like third.")}this.gridHeight=h;if(this.gridHeight<=0){throw new th.formlayout.IndexOutOfBoundsException("The grid height must be a positive number.")}if(c>=f.length){return}d=th.trim(f[c++])}this.hAlign=this.decodeAlignment(d);this.vAlign=this.decodeAlignment(th.trim(f[c++]));this.ensureValidOrientations(this.hAlign,this.vAlign)},ensureValidGridBounds:function(c,a){if(this.gridX<=0){throw new th.formlayout.IndexOutOfBoundsException("The column index "+this.gridX+" must be positive.")}if(this.gridX>c){throw new th.formlayout.IndexOutOfBoundsException("The column index "+this.gridX+" must be less than or equal to "+c+".")}if(this.gridX+this.gridWidth-1>c){throw new th.formlayout.IndexOutOfBoundsException("The grid width "+this.gridWidth+" must be less than or equal to "+(c-this.gridX+1)+".")}if(this.gridY<=0){throw new th.formlayout.IndexOutOfBoundsException("The row index "+this.gridY+" must be positive.")}if(this.gridY>a){throw new th.formlayout.IndexOutOfBoundsException("The row index "+this.gridY+" must be less than or equal to "+a+".")}if(this.gridY+this.gridHeight-1>a){throw new th.formlayout.IndexOutOfBoundsException("The grid height "+this.gridHeight+" must be less than or equal to "+(a-this.gridY+1)+".")}},decodeAlignment:function(a){return th.formlayout.Alignment.valueOf(a)},setBounds:function(E,D,z,f,j,C,i){var F=this.gridWidth==1?D.getColumnSpec(this.gridX):undefined;var A=this.gridHeight==1?D.getRowSpec(this.gridY):undefined;var q=this.concreteAlignment(this.hAlign,F);var n=this.concreteAlignment(this.vAlign,A);var s=this.insets?this.insets:th.formlayout.CellConstraints.EMPTY_INSETS;var u=z.x+s.left;var t=z.y+s.top;var B=z.width-s.left-s.right;var a=z.height-s.top-s.bottom;var d=this.componentSize(E,F,B,f,C);var p=this.componentSize(E,A,a,j,i);var m=this.origin(q,u,B,d);var l=this.origin(n,t,a,p);var o=this.extent(q,B,d);var v=this.extent(n,a,p);E.setBounds(m,l,o,v)},concreteAlignment:function(a,c){return !c?(a==th.formlayout.CellConstraints.DEFAULT?th.formlayout.CellConstraints.FILL:a):this.usedAlignment(a,c)},usedAlignment:function(a,c){if(a!=th.formlayout.CellConstraints.DEFAULT){return a}var d=c.getDefaultAlignment();if(d==th.formlayout.FormSpec.FILL_ALIGN){return th.formlayout.CellConstraints.FILL}if(d==th.formlayout.ColumnSpec.LEFT){return th.formlayout.CellConstraints.LEFT}else{if(d==th.formlayout.FormSpec.CENTER_ALIGN){return th.formlayout.CellConstraints.CENTER}else{if(d==th.formlayout.ColumnSpec.RIGHT){return th.formlayout.CellConstraints.RIGHT}else{if(d==th.formlayout.RowSpec.TOP){return th.formlayout.CellConstraints.TOP}else{return th.formlayout.CellConstraints.BOTTOM}}}}},componentSize:function(d,c,h,a,f){if(!c){return f(d)}else{if(c.getSize()==th.formlayout.Sizes.MINIMUM){return a(d)}else{if(c.getSize()==th.formlayout.Sizes.PREFERRED){return f(d)}else{return Math.min(h,f(d))}}}},origin:function(f,c,d,a){if(f==th.formlayout.CellConstraints.RIGHT||f==th.formlayout.CellConstraints.BOTTOM){return c+d-a}else{if(f==th.formlayout.CellConstraints.CENTER){return c+(d-a)/2}else{return c}}},extent:function(d,c,a){return d==th.formlayout.CellConstraints.FILL?c:a},toString:function(){var a="CellConstraints";a+="[x=";a+=this.gridX;a+="; y=";a+=this.gridY;a+="; w=";a+=this.gridWidth;a+="; h=";a+=this.gridHeight;a+="; hAlign=";a+=this.hAlign;a+="; vAlign=";a+=this.vAlign;a+="; honorsVisibility=";a+=this.honorsVisibility;a+="]";return a},xy:function(){var a=arguments;switch(arguments.length){case 2:return this.xywh(a[0],a[1],1,1);case 3:return this.xywh(a[0],a[1],1,1,a[2]);case 4:return this.xywh(a[0],a[1],1,1,a[2],a[3]);default:throw"wrong number of arguments passed to xy()"}},xyw:function(){var a=arguments;switch(arguments.length){case 3:return this.xywh(a[0],a[1],a[2],1,th.formlayout.CellConstraints.DEFAULT,th.formlayout.CellConstraints.DEFAULT);case 4:return this.xywh(a[0],a[1],a[2],1,a[3]);case 5:return this.xywh(a[0],a[1],a[2],1,a[3],a[4]);default:throw"wrong number of arguments passed to xyw()"}},xywh:function(){var c=arguments;switch(arguments.length){case 4:return this.xywh(c[0],c[1],c[2],c[3],th.formlayout.CellConstraints.DEFAULT,th.formlayout.CellConstraints.DEFAULT);case 5:var a=this.xywh(c[0],c[1],c[2],c[3]);a.setAlignment(c[4],true);return a;case 6:this.gridX=c[0];this.gridY=c[1];this.gridWidth=c[2];this.gridHeight=c[3];this.hAlign=c[4];this.vAlign=c[5];this.ensureValidOrientations(this.hAlign,this.vAlign);return this;default:throw"wrong number of arguments passed to xywh()"}}}});th.formlayout.CellConstraints.DEFAULT=new th.formlayout.Alignment("default",th.formlayout.Alignment.BOTH);th.formlayout.CellConstraints.FILL=new th.formlayout.Alignment("fill",th.formlayout.Alignment.BOTH);th.formlayout.CellConstraints.LEFT=new th.formlayout.Alignment("left",th.formlayout.Alignment.HORIZONTAL);th.formlayout.CellConstraints.RIGHT=new th.formlayout.Alignment("right",th.formlayout.Alignment.HORIZONTAL);th.formlayout.CellConstraints.CENTER=new th.formlayout.Alignment("center",th.formlayout.Alignment.BOTH);th.formlayout.CellConstraints.TOP=new th.formlayout.Alignment("top",th.formlayout.Alignment.VERTICAL);th.formlayout.CellConstraints.BOTTOM=new th.formlayout.Alignment("bottom",th.formlayout.Alignment.VERTICAL);th.formlayout.CellConstraints.EMPTY_INSETS={top:0,left:0,bottom:0,right:0};th.formlayout.FormSpecParser=Class.define({members:{init:function(d,c,f,a){this.layoutMap=f;this.source=d},parseColumnSpecs:function(){var c=this.split(this.source,0);var f=c.length;var a=[];for(var d=0;d<f;d++){var h=c[d];a[d]=th.formlayout.ColumnSpec.decodeExpanded(h)}return a},parseRowSpecs:function(){var f=this.split(this.source,0);var a=f.length;var d=[];for(var c=0;c<a;c++){var h=f[c];d[c]=th.formlayout.RowSpec.decodeExpanded(h)}return d},split:function(l,h){var q=[];var d=0;var m=0;var a=l.length;var p=0;var o;var n=true;for(var j=0;j<a;j++){o=l.charAt(j);if(n&&th.isWhitespace(o)){p++;continue}n=false;if((o==",")&&(d==0)&&(m==0)){var f=l.substring(p,j);this.addSpec(q,f,h+p);p=j+1;n=true}else{if(o=="("){if(m>0){this.fail(h+j,"illegal '(' in [...]")}d++}else{if(o==")"){if(m>0){this.fail(h+j,"illegal ')' in [...]")}d--;if(d<0){this.fail(h+j,"missing '('")}}else{if(o=="["){if(m>0){this.fail(h+j,"too many '['")}m++}else{if(o=="]"){m--;if(m<0){this.fail(h+j,"missing '['")}}}}}}}if(d>0){this.fail(h+a,"missing ')'")}if(m>0){this.fail(h+a,"missing ']")}if(p<a){var f=l.substring(p);this.addSpec(q,f,h+p)}return q},addSpec:function(d,j,h){var c=th.trim(j);var l=this.multiplier(c,h);if(!l){d.push(c);return}var f=this.split(l.expression,h+l.offset);for(var a=0;a<l.multiplier;a++){th.forEach(f,function(i){d.push(i)})}},multiplier:function(j,h){var i=new RegExp(th.formlayout.FormSpecParser.MULTIPLIER_PREFIX_PATTERN);if(!i.test(j)){return}var c=i.exec(j);c.end=c.index+c[0].length;if(c.index>0){this.fail(h+c.index,"illegal multiplier position")}var a=new RegExp(th.formlayout.DIGIT_PATTERN);if(!a.test(j)){return}var m=a.exec(j);m.end=c.index+c[0].length;var l=j.substring(0,m.end);var d=parseInt(l);if(isNaN(d)){this.fail(h,"Invalid multiplier")}if(d<=0){this.fail(h,"illegal 0 multiplier")}var f=j.substring(c.end,j.length()-1);return{multiplier:d,expression:f,offset:c.end}},fail:function(a,c,d){if(!d){d=this.source}throw new th.formlayout.FormLayoutParseException(this.message(d,a,c))},message:function(h,c,f){var a="\n";a+="\n";a+=h;a+="\n";for(var d=0;d<c;d++){a+=" "}a+="^";a+=f;return a}}});th.formlayout.FormSpecParser.parseColumnSpecs=function(a,c){var d=new th.formlayout.FormSpecParser(a,"encoded column specifications",c,true);return d.parseColumnSpecs()};th.formlayout.FormSpecParser.parseRowSpecs=function(a,c){var d=new th.formlayout.FormSpecParser(a,"encoded column specifications",c,false);return d.parseRowSpecs()};th.formlayout.FormSpecParser.MULTIPLIER_PREFIX_PATTERN="\\d+\\s*\\*\\s*\\(";th.formlayout.FormSpecParser.DIGIT_PATTERN="\\d+";