(function(){var d=false;var f=/xyz/.test(function(){xyz})?/\b_super\b/:{test:function(){return true}};this.Class=function(){this.type="Class"};Class.define=function(t){if(!t.superclass){t.superclass=Class}var s=t.superclass.prototype,u=t.members||{};d=true;var n=new t.superclass();d=false;if(t.uses){var q=Trait.define({uses:t.uses,_klass_prototype:n,_klass_properties:u});for(var p in q._exports){if(!q._exports.hasOwnProperty(p)){continue}if(u.hasOwnProperty(p)){if(typeof u[p]!="function"){throw new Trait.TraitError(p+" overrides trait method and must be a function.")}}else{u[p]=q._exports[p]}}}for(var m in u){if(!u.hasOwnProperty(m)){continue}n[m]=typeof u[m]=="function"&&typeof s[m]=="function"&&f.test(u[m])?(function(o,v){return function(){var x=this._super;this._super=s[o];var w=v.apply(this,arguments);this._super=x;return w}})(m,u[m]):u[m]}var l=function(){if(!d&&this.init){this.init.apply(this,arguments)}};l.prototype=n;l.constructor=l;l.superclass=t.superclass;l.prototype.type=t.type;l.does=function(w){if(!q){if(l.superclass.does){return l.superclass.does(w)}if(w){return false}return[]}var v=q.does(w);if(l.superclass.does){if(w){return v||l.superclass.does(w)}var x=l.superclass.does(w).concat([]);for(var o=v.length-1;o>=0;o--){if(x.indexOf(v[o])===-1){x.push(v[o])}}return x}return v};if(!l.prototype.hasOwnProperty("does")){l.prototype.does=l.does}return l};function a(l){return Object.prototype.toString.apply(l)==="[object Array]"}function i(l){if(l){return a(l)?l:[l]}return[]}function h(l){if(!l){return{}}var m={};if(!a(l)){m[l]=true;return m}for(var n=l.length-1;n>=0;n--){m[l[n]]=true}return m}function j(n,m){for(var l in m){if(!m.hasOwnProperty(l)){continue}n[l]=m[l]}return n}this.Trait=Class.define({members:{init:function(q){this._subtraits=i(q.uses);this._requires=h(q.requires);this._exports=q.methods?q.methods:{};var n;for(n in this._requires){if(!this._requires.hasOwnProperty(n)){continue}if(this._exports.hasOwnProperty(n)){throw new Trait.TraitError("Trait cannot require and provide the same method "+n)}}var p,l,m,s={};for(m=this._subtraits.length-1;m>=0;m--){p=this._subtraits[m];l=j({},p._exports);if(p._aliases){j(l,p._aliases)}if(p._excludes){for(n in p._excludes){if(!p._excludes.hasOwnProperty(n)){continue}delete l[n];j(s,p._excludes)}}for(n in l){if(!l.hasOwnProperty(n)){continue}if(q._klass_prototype&&q._klass_properties.hasOwnProperty(n)&&typeof q._klass_properties[n]=="function"){continue}if(this._exports.hasOwnProperty(n)){if((!q.methods||!q.methods.hasOwnProperty(n))&&this._exports[n]!=l[n]){throw new Trait.TraitError("Multiple subtraits provide method "+n+" creating a conflict. Exclude all but one of the methods or override the method in the trait/class to resolve.")}continue}this._exports[n]=l[n]}for(n in p._requires){if(!p._requires.hasOwnProperty(n)){continue}if(!this._exports.hasOwnProperty(n)){this._requires[n]=true}}delete p._aliases;delete p._excludes}for(n in s){if(!s.hasOwnProperty(n)){continue}if(!this._exports.hasOwnProperty(n)&&(!q._klass_prototype||(typeof q._klass_prototype[n]!="function"&&typeof q._klass_properties[n]!="function"))){throw new Trait.TraitError("Excluded method "+n+" must be provided by another class or trait.")}}for(n in this._requires){if(!this._requires.hasOwnProperty(n)){continue}if(this._exports.hasOwnProperty(n)){delete this._requires[n]}else{if(q._klass_prototype&&(typeof q._klass_prototype[n]!="function"&&typeof q._klass_properties[n]!="function")){throw new Trait.TraitError("Trait requirement "+n+" not fullfilled by class.")}}}},aliases:function(m){this._aliases=this._aliases||{};for(var l in m){if(!m.hasOwnProperty(l)){continue}if(!this._exports.hasOwnProperty(m[l])){throw new Trait.TraitError("can't alias "+l+" to "+m[l]+" because trait doesn't have that method")}if(this._exports.hasOwnProperty(l)){throw new Trait.TraitError("can't create an alias with name "+l+" because trait natively exports that method")}if(this._requires.hasOwnProperty(l)){throw new Trait.TraitError("can't create an alias with name "+l+" because trait requires method with same name")}this._aliases[l]=this._exports[m[l]]}return this},excludes:function(l){this._excludes=this._excludes||{};l=i(l);for(var m=l.length-1;m>=0;m--){if(!this._exports.hasOwnProperty(l[m])){throw new Trait.TraitError("can't exclude method "+l[m]+" because no such method exists in trait")}this._excludes[l[m]]=true}return this},does:function(o){if(!this._does){this._does=[this].concat(this._subtraits);var n,m,l;for(n=this._subtraits.length-1;n>=0;n--){l=this._subtraits[n].does();for(m=l.length-1;m>=0;m--){if(this._does.indexOf(l[m])===-1){this._does.push(l[m])}}}}if(o){return this._does.indexOf(o)>=0}return this._does},requires:function(l){if(l){return this._requires.hasOwnProperty(l)&&this._requires[l]}return this._requires},subtraits:function(l){if(l){return this._subtraits.indexOf(l)>=0}return this._subtraits},methods:function(l){if(l){return this._exports.hasOwnProperty(l)&&this._exports[l]}return this._exports}}});Trait.define=function(l){return new Trait(l)};Trait.TraitError=Class.define({superclass:Error,members:{init:function(l){this.name="TraitError";this.message=l}}})})();if(!("console" in window)){window.console={log:function(a){}}}if(location.href.indexOf("file:")==0){try{if(netscape.security.PrivilegeManager.enablePrivilege){netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead")}}catch(ex){console.log("Couldn't elevate priviledges to deal with file URLs")}}if(typeof th=="undefined"){th={}}th.browser={IE:!!(window.attachEvent&&!window.opera),Opera:!!window.opera,WebKit:navigator.userAgent.indexOf("AppleWebKit/")>-1,Gecko:navigator.userAgent.indexOf("Gecko")>-1&&navigator.userAgent.indexOf("KHTML")==-1,MobileSafari:!!navigator.userAgent.match(/Apple.*Mobile.*Safari/)};th.fixCanvas=function(a){if(!a.fillText&&a.mozDrawText){a.fillText=function(h,d,i,f){a.translate(d,i);a.mozTextStyle=a.font;a.mozDrawText(h);a.translate(-d,-i)}}if(!a.measureText&&a.mozMeasureText){a.measureText=function(f){if(a.font){a.mozTextStyle=a.font}var d=a.mozMeasureText(f);return{width:d}}}if(a.measureText&&!a.html5MeasureText){a.html5MeasureText=a.measureText;a.measureText=function(f){var d=a.html5MeasureText(f);d.ascent=a.html5MeasureText("m").width;return d}}if(!a.fillText){a.fillText=function(){}}if(!a.measureText){a.measureText=function(){return 10}}return a};th.byId=function(a){return document.getElementById(a)};th.isString=function(a){return !!arguments.length&&a!=null&&(typeof a=="string"||a instanceof String)};th.isArray=function(a){return a&&(a instanceof Array||typeof a=="array")};th.forEach=function(d,m,h){if(!d||!d.length){return}var a=th._getParts(d,h,m);d=a[0];for(var j=0,f=d.length;j<f;++j){a[2].call(a[1],d[j],j,d)}};th._getParts=function(d,f,a){return[th.isString(d)?d.split(""):d,f||this,th.isString(a)?new Function("item","index","array",a):a]};th.xhrGet=function(a){var d=new XMLHttpRequest();d.onreadystatechange=function(){if(d.readyState==4){a.load.apply(a.context,[d.responseText])}};d.open("GET",a.url);d.send(null)};th.remove=function(h,d){var f=[];for(var a=0;a<h.length;a++){if(h[a]!=d){f.push(h[a])}}return f};th.observe=function(h,a,f,d){var i=(d)?function(j){f.apply(d,[j])}:f;h["on"+a]=i};th.trim=String.prototype.trim?function(a){if(a==undefined){return a}return a.trim()}:function(a){if(a==undefined){return a}return a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")};th.mixin=function(h,f){if(!h){h={}}for(var d=1,a=arguments.length;d<a;d++){th._mixin(h,arguments[d])}return h};th._mixin_tobj={};th._mixin=function(h,d){for(var a in d){if(th._mixin_tobj[a]===undefined||th._mixin_tobj[a]!=d[a]){h[a]=d[a]}}if(th.browser.IE&&d){var f=d.toString;if(typeof f=="function"&&f!=h.toString&&f!=th._mixin_tobj.toString&&f!="\nfunction toString() {\n    [native code]\n}\n"){h.toString=d.toString}}return h};th.cumulativeOffset=function(d){var a=0,f=0;do{a+=d.offsetTop||0;f+=d.offsetLeft||0;d=d.offsetParent}while(d);return th._returnOffset(f,a)};th._returnOffset=function(d,f){var a=[d,f];a.left=d;a.top=f;return a};th.isPercentage=function(a){return(a.indexOf&&a.indexOf("%")!=-1)};th.isCssPixel=function(a){a=th.trim(a).toLowerCase();return(a.indexOf("px")==a.length-2)};th.isCssLength=function(a){if(a===undefined){return false}if(a==0){return true}return/^[\d\.]+(em|ex|px|\%|in|cm|mm|pt|pc)$/.test(a)};th.isCssBorderStyle=function(a){return/^(none|hidden|dotted|dashed|solid|double|groove|ridge|inset|outset)$/.test(a)};th.defaultCSSBorder=function(){return{top:{width:0,style:"none",color:"black"},bottom:{width:0,style:"none",color:"black"},left:{width:0,style:"none",color:"black"},right:{width:0,style:"none",color:"black"}}};th.defaultCSSMargin=function(){return{top:0,bottom:0,left:0,right:0}};th.defaultCSSPadding=function(){return{top:0,bottom:0,left:0,right:0}};th.getSpaceDelimitedItems=function(a){return th.parenAwareSplit(" ",a)};th.getCommaDelimitedItems=function(a){return th.parenAwareSplit(",",a)};th.parenAwareSplit=function(l,f){if(l.length!=1){throw"Invalid delimiter passed to parenAwareSplit: '"+l+"'"}var i=[];var d=0;var j;var h="";for(var a=0;a<f.length;a++){j=f[a];if(j==l){if(!d){i.push(th.trim(h));h="";continue}}else{if(j=="("){d++}else{if(j==")"){d--}}}h+=j}i.push(th.trim(h));return i};th.whitespace=" \t\n\r";th.isWhitespace=function(d){if(!d||d.length==0){return true}for(var a=0;a<d.length;a++){var f=d.charAt(a);if(th.whitespace.indexOf(f)==-1){return false}}return true};th.measureUsingDOM=function(h,f){if(!document){throw"Can't perform measurements outside of browser"}var a=document.getElementsByTagName("body")[0];var d=document.createElement("div");d.setAttribute("style","position: absolute; visibility:hidden");a.appendChild(d);if(f){h.apply(f,[d])}else{h(d)}a.removeChild(d)};th.measure_cache={};th.safeget=function(d,a){return(d==undefined)?a:d};th.unitRegex=/^([\d\.]+)(em|ex|px|\%|in|cm|mm|pt|pc)$/;th.absoluteUnitRegex=/^([\d\.]+)(px|in|cm|mm|pt|pc)$/;th.isBorderLength=function(a){return(a=="thin"||a=="medium"||a=="thick")};th.convertLengthToPixels=function(d,a){if(d==0){return 0}if(th.isBorderLength(d)){return th.convertBorderLengthToPixels(d)}else{if(th.absoluteUnitRegex.test(d)){return th.convertAbsoluteUnitToPixels(d)}}};th.convertBorderLengthToPixels=function(d){if(d===undefined){return 0}var f=d;if(th.measure_cache[f]){return th.measure_cache[f]}var a=undefined;th.measureUsingDOM(function(h){h.setAttribute("style","position: relative; border-left: "+d+" solid black");h.innerHTML="some text";a=h.scrollWidth-h.clientWidth});th.measure_cache[f]=a;return a};th.convertAbsoluteUnitToPixels=function(a,h){var f;if(h===undefined){var d=th.absoluteUnitRegex.exec(a);if(d.length!=3){throw"Passed length "+a+" isn't a CSS absolute unit"}f=d[2];h=Number(d[1])}else{f=a}if(f=="px"){return h}else{if(f=="in"||f=="cm"||f=="mm"||f=="pt"||f=="pc"){return th.measureAbsoluteUnit(h+f)}else{throw"Unsupported unit: "+f}}};th.measureAbsoluteUnit=function(d){if(d===undefined){return 0}var f=d;if(th.measure_cache[f]){return th.measure_cache[f]}var a=undefined;th.measureUsingDOM(function(i){var h=i.getAttribute("style");i.setAttribute("style",h+="; width: "+d);a=i.scrollWidth});th.measure_cache[f]=a;return a};th.convertEmToPixels=function(h,d){var f=h+d;if(th.measure_cache[f]){return th.measure_cache[f]}var a=undefined;th.measureUsingDOM(function(j){var i=j.getAttribute("style");j.setAttribute("style",i+="; font: "+h+"; width: "+d+"em");a=j.scrollWidth});th.measure_cache[f]=a;return a};th.getHierarchyString=function(d){var a="";while(d){var f=d.type;if(d.id){f+="#"+d.id}if(d.className){f+="."+d.className}a=f+=" "+a;d=d.parent}return th.trim(a)};th.isObject=function(a){return a!==undefined&&(a===null||typeof a=="object"||th.isArray(a)||th.isFunction(a))};th.isFunction=(function(){var a=function(d){return d&&(typeof d=="function"||d instanceof Function)};return a})();th.hitch=function(d,a){return function(){a.apply(d)}};th.delay=function(d,a,f){if(f){d=th.hitch(f,d)}setTimeout(d,a)};if(typeof th=="undefined"){th={}}th.CssParser=Class.define({members:{parse:function(d,a){if(!a){a={}}d=d.replace(/\s+/gi," ");th.forEach(this.munge(d,false).split("`b%"),function(f){f=f.split("%b`");if(f.length<2){return}f[0]=this.restore(f[0]);var h=a[f[0]]||{};a[f[0]]=th.mixin(h,this.parsedeclarations(f[1]))},this);return a},REbraces:/{[^{}]*}/,REfull:/\[[^\[\]]*\]|{[^{}]*}|\([^()]*\)|function(\s+\w+)?(\s*%b`\d+`b%){2}/,REatcomment:/\/\*@((?:[^\*]|\*[^\/])*)\*\//g,REcomment_string:/(?:\/\*(?:[^\*]|\*[^\/])*\*\/)|(\\.|"(?:[^\\\"]|\\.|\\\n)*"|'(?:[^\\\']|\\.|\\\n)*')/g,REmunged:/%\w`(\d+)`\w%/,uid:0,munged:{},munge:function(h,d){var a=this;h=h.replace(this.REatcomment,"$1").replace(this.REcomment_string,function(l,i){if(!i){return""}var j="%s`"+(++a.uid)+"`s%";a.munged[a.uid]=i.replace(/^\\/,"");return j});var f=d?this.REfull:this.REbraces;while(match=f.exec(h)){replacement="%b`"+(++this.uid)+"`b%";this.munged[this.uid]=match[0];h=h.replace(f,replacement)}return h},restore:function(a){if(a===undefined){return a}while(match=this.REmunged.exec(a)){a=a.replace(this.REmunged,this.munged[match[1]])}return th.trim(a)},parsedeclarations:function(d){var f=this.munged[d].replace(/(?:^\s*[{'"]\s*)|(?:\s*([^\\])[}'"]\s*$)/g,"$1");f=this.munge(f);var a={};th.forEach(f.split(";"),function(h){h=h.split(":");if(h.length<2){return}a[this.restore(h[0])]=this.restore(h[1])},this);return a}}});if(typeof th=="undefined"){th={}}th.EventHelpers=new Trait({methods:{wrapEvent:function(h,d){var a=h.clientX-th.cumulativeOffset(this.canvas).left;var i=h.clientY-th.cumulativeOffset(this.canvas).top;var f=d.getComponentForPosition(a,i,true);h.thComponent=f;this.addComponentXY(h,d,f)},addComponentXY:function(i,f,d){if(!d.bounds){console.log("No dest bounds - "+d.type);console.log(d.bounds);console.log(d);return}var a=i.clientX-th.cumulativeOffset(this.canvas).left;var l=i.clientY-th.cumulativeOffset(this.canvas).top;var h={x:a,y:l};var j=d;while(j){h.x-=j.bounds.x;h.y-=j.bounds.y;j=j.parent;if(j==f){i.componentX=h.x;i.componentY=h.y;return}}}}});th.StringHelpers=new Trait({methods:{isPercentage:function(a){return a.indexOf&&a.indexOf("%")!=-1}}});th.ComponentHelpers=new Trait({methods:{d:function(){var a=this.getInsets();return{b:(this.bounds)?{x:this.bounds.x,y:this.bounds.y,w:this.bounds.width,h:this.bounds.height,iw:this.bounds.width-a.left-a.right,ih:this.bounds.height-a.top-a.bottom}:{},i:{l:a.left,r:a.right,t:a.top,b:a.bottom,w:a.left+a.right,h:a.top+a.bottom}}},shouldPaint:function(){return(this.shouldLayout()&&this.cssValue("visibility")!="hidden")},shouldLayout:function(){return(this.cssValue("display")!="none")},emptyInsets:function(){return{left:0,right:0,bottom:0,top:0}},resolveCss:function(){var d=th.global_resources;var o;var j=th.getHierarchyString(this);if(d.resolvedCssCache[j]){o=d.resolvedCssCache[j]}else{o={};var h;var n=["userAgentCss","userCss","authorCss"];for(var f=0;f<n.length;f++){var m=n[f];th.forEach(d[m],function(w){for(var t in w){var B=t.split(",");for(var C=0;C<B.length;C++){var u=th.trim(B[C]);var q=this.getSpecificity(u);var z=u.split(":");var A=z[0];z=(z.length>1)?z.slice(1):["(default)"];if(this.matchesSelector(A)){var y=w[t];for(h in y){for(var v=0;v<z.length;v++){var x=z[v];if(o[x]===undefined){o[x]={}}var p={value:y[h],selector:u,specificity:q};if(o[x][h]){p=this.getSpecificityWinner(p,o[x][h])}o[x][h]=p}}}}}},this)}d.resolvedCssCache[j]=o;this.blowCssCaches()}this.styles={};for(var l in o){for(var a in o[l]){if(this.styles[l]===undefined){this.styles[l]={}}this.styles[l][a]=o[l][a].value}}this.refreshCss=false},matchesSelector:function(a){var i=a.toLowerCase();if(i=="*"){return true}if(i.indexOf(">")!=-1){var f=i.split(">");if(f.length!=2){console.log("unsupported child selector syntax; must be SEL1 > SEL2, was '"+a+"'");return false}if(this.matchesSelector(th.trim(f[1]))){if(!this.parent){return false}return(this.parent.matchesSelector(th.trim(f[0])))}return false}if(i.indexOf(" ")!=-1){var f=i.split(" ");if(f.length!=2){console.log("unsupported ancestor selector syntax; must be SEL1 SEL2, was '"+a+"'");return false}if(this.matchesSelector(th.trim(f[1]))){var d=this.parent;while(d){if(d.matchesSelector(th.trim(f[0]))){return true}d=d.parent}return false}}if(i.indexOf(".")==0){if(!this.className){return false}if(this.className.toLowerCase()==i.substring(1)){return true}}if(i.indexOf("#")==0){if(!this.id){return false}return("#"+this.id)==i}var h=this.type.toLowerCase();if(h==i){return true}if(this.id&&(i==(h+"#"+this.id))){return true}if(this.className&&(i==(h+"."+this.className.toLowerCase()))){return true}return false},getSpecificity:function(a,j){var f={a:0,b:0,c:0,d:0};if(j){f.a=1}var h=th.getSpaceDelimitedItems(a);for(var d=0;d<h.length;d++){var m=h[d];if(m=="*"||m=="+"||m==">"){continue}if(m.indexOf("#")==0){f.b+=1;continue}f.c+=m.split(".").length-1;var l=m.split(":");if(l.length==2){if(l[1]=="first-line"||l[1]=="first-letter"||l[1]=="before"||l[1]=="after"){f.d+=1}else{f.c+=1}}}return f},getSpecificityWinner:function(h,f){var d=h.specificity;var a=f.specificity;if(d.a>a.a){return h}if(a.a>d.a){return f}if(d.b>a.b){return h}if(a.b>d.b){return f}if(d.c>a.c){return h}if(a.c>d.c){return f}if(d.d>a.d){return h}if(a.d>d.d){return f}return h},paintBackground:function(A,v,t,z,p){if(v===undefined){v=0}if(t===undefined){t=0}if(z===undefined){z=this.bounds.width}if(p===undefined){p=this.bounds.height}if(this.cssValue("background-color")){A.fillStyle=this.cssValue("background-color");A.fillRect(v,t,z,p)}if(this.cssValue("background-image")){var l=this.cssValue("background-image");var a=this.cssValue("background-repeat");var q=this.cssValue("background-position");var o=th.getCommaDelimitedItems(l);var n=(a)?a.split(","):[undefined];var j=(q)?q.split(","):[undefined];var d=Math.max(o.length,n.length,j.length);for(var f=0;f<d;f++){var B=f;if(f>=o.length){B=(o.length%f)-1}var s=this.processImage(th.trim(o[B]),z,p);if(s){var u=f;if(f>=n.length){u=(n.length%f)-1}var m=f;if(f>=j.length){m=(j.length%f)-1}this.paintImage(A,s,th.trim(n[u]),th.trim(j[m]),v,t,z,p)}}}},getFirstBackgroundImage:function(){var a=this.cssValue("background-image");if(a){var d=th.getCommaDelimitedItems(a);if(d[0]){a=th.global_resources.images[d[0]];if(a){return a}}}},processImage:function(E,s,z){if(E.indexOf("-webkit-gradient")==0){var A=E.substring(E.indexOf("(")+1,E.length-1);var n=th.getCommaDelimitedItems(A);for(var y=0;y<n.length;y++){n[y]=th.trim(n[y])}if(n[0]!="linear"){console.log('Unsupported gradient: "'+E+'"; only linear gradients supported');return undefined}var m=n[1].split(" ");var l=n[2].split(" ");var v=[];var t=[];v[0]=(m[0]=="top"||m[0]=="bottom")?m[1]:m[0];v[1]=(m[0]=="top"||m[0]=="bottom")?m[0]:m[1];t[0]=(l[0]=="top"||l[0]=="bottom")?l[1]:l[0];t[1]=(l[0]=="top"||l[0]=="bottom")?l[0]:l[1];var q=[v,t];for(var D=0;D<q.length;D++){var d=q[D];for(var C=0;C<d.length;C++){if(d[C]=="top"){d[C]="0%"}if(d[C]=="bottom"){d[C]="100%"}if(d[C]=="left"){d[C]="0%"}if(d[C]=="right"){d[C]="100%"}if(th.isPercentage(d[C])){var p=parseInt(d[C])/100;d[C]=p*((C==0)?s:z)}}}var j=document.createElement("canvas");j.setAttribute("width",s);j.setAttribute("height",z);var x=j.getContext("2d");var f=x.createLinearGradient(v[0],v[1],t[0],t[1]);for(var B=3;B<n.length;B++){var u=n[B].split("(");if(u[1].indexOf(",")!=-1){var o=u[1].split(",");f.addColorStop(o[0],o[1])}else{u[1]=u[1].substring(0,u[1].length-1);f.addColorStop((u[0].toLowerCase()=="from"?0:1),u[1])}}x.fillStyle=f;x.fillRect(0,0,s,z);return j}else{if(!th.global_resources.images[E]){console.log("Warning: image identified by '"+E+"'")}else{return th.global_resources.images[E]}}},paintImage:function(z,F,l,E,m,j,o,C){if(!l){l="repeat"}if(!E){E="0% 0%"}if(!m){m=0}if(!j){j=0}if(!o){o=this.bounds.width}if(!C){C=this.bounds.height}z.save();try{if((m!=0)||(j!=0)){z.translate(m,j)}var f=E.toLowerCase().split(" ");if(f.length==1){f.push("50%")}if(f.length!=2){console.log('Unsupported position syntax; only "X" or "X Y" supported, you passed in " + position + "');return}var d=[];d[0]=(f[0]=="top"||f[0]=="bottom")?f[1]:f[0];d[1]=(f[0]=="top"||f[0]=="bottom")?f[0]:f[1];th.forEach(d,function(i,h){if(i=="top"){d[h]="0%"}if(i=="right"){d[h]="100%"}if(i=="bottom"){d[h]="100%"}if(i=="left"){d[h]="0%"}if(i=="center"){d[h]="50%"}});var n=[0,0];for(var B=0;B<d.length;B++){var p=th.isPercentage(d[B]);var v=this.convertPositionToPixel(d[B],(B==0)?o:C);if(p){n[B]=this.convertPositionToPixel(d[B],(B==0)?F.width:F.height)}d[B]=v}var u=d[0]-n[0];var t=d[1]-n[1];if(!this.shouldRepeat(l)){z.drawImage(F,d[0]-n[0],d[1]-n[1])}else{var a=(this.shouldRepeatX(l))?parseInt(o/F.width)+1:1;var A=(this.shouldRepeatY(l))?parseInt(C/F.height)+1:1;if(this.shouldRepeatX(l)){while(u>0){u-=F.width}}if(this.shouldRepeatY(l)){while(t>0){t-=F.height}}var s=u;for(var q=0;q<A;q++){u=s;for(var D=0;D<a;D++){z.drawImage(F,u,t);u+=F.width}t+=F.height}}}finally{z.restore()}},shouldRepeatX:function(a){return(a=="repeat"||a=="repeat-x")},shouldRepeatY:function(a){return(a=="repeat"||a=="repeat-y")},shouldRepeat:function(a){return(a!="no-repeat")},convertPositionToPixel:function(f,d){if(th.isPercentage(f)){var a=f.substring(0,f.length-1)/100;return d*a}else{if(th.isCssPixel(f)){return f.substring(0,f.length-2)}}},calculateInsets:function(m,d,a){var h=(this.component)?this.component:this;var l=m+d;if(h.insetCache){}var f={top:0,bottom:0,left:0,right:0};if(a){f.top+=a.top;f.left+=a.left;f.right+=a.right;f.bottom+=a.bottom}for(var i in f){var j=th.safeget(h.cssValue(m+i+d),0);if(j){j=th.convertLengthToPixels(j,h)}f[i]+=j}if(!h.insetCache){h.insetCache={}}h.insetCache[l]=f;return f},getCurrentPseudoClass:function(){if(this.pseudoClass){return this.pseudoClass}return"(default)"},cssValue:function(d,a){if(a===undefined){a=this.getCurrentPseudoClass()}if(this.localStyles[a]===undefined){this.localStyles[a]={}}if(this.localStyles[a][d]!==undefined){return this.localStyles[a][d]}if(typeof this.styles=="undefined"||this.refreshCss){this.resolveCss()}if(this.styles[a]===undefined){this.styles[a]={}}if(this.styles[a][d]){return this.styles[a][d]}if(a!="(default)"){return this.cssValue(d,"(default)")}if(d=="border-top-color"||d=="border-left-color"||d=="border-right-color"||d=="border-bottom-color"){return this.cssValue("color")}if(d=="border"||d=="border-top"||d=="border-left"||d=="border-right"||d=="border-bottom"){throw"Unsupported: request the individual border properties, please"}if(d=="margin"){throw"Unsupported: request the individual margin-top, margin-bottom, margin-right, and margin-left properties, please"}if(d=="padding"){throw"Unsupported: request the individual padding-top, padding-bottom, padding-right, and padding-left properties, please"}if(["color","letter-spacing","line-height","text-align","text-indent","text-transform","visibility","white-space","word-spacing","font"].indexOf(d)!=-1){if(this.parent){return this.parent.cssValue(d)}}if(d.indexOf("list-style-")!=-1){if(this.parent){return this.parent.cssValue(d)}}return},addCss:function(d,h,a){if(th.isString(d)){var i=d;this.blowCssCaches(i);if(a===undefined){a="(default)"}if(this.localStyles[a]===undefined){this.localStyles[a]={}}this.localStyles[a][i]=h}else{for(var f in d){this.addCss(f,d[f],a)}}},getSize:function(){var a=this.bounds;return{width:a.width,height:a.height}},setBounds:function(a,i,d,f){this.bounds={x:a,y:i,width:d,height:f}},getPreferredSize:function(){if(this.getPreferredHeight&&this.getPreferredWidth){var a=this.getPreferredHeight();var f=this.getPreferredWidth();return{height:a,width:f}}var d=this.getInsets();return{height:d.top+d.bottom,width:d.left+d.right}},getMinimumSize:function(){if(this.getMinimumHeight&&this.getMinimumWidth){var a=this.getMinimumHeight();var d=this.getMinimumWidth();return{height:a,width:d}}return this.getPreferredSize()},getMaximumSize:function(){if(this.getMaximumHeight&&this.getMaximumWidth){var a=this.getMaximumHeight();var d=this.getMaximumWidth();return{height:a,width:d}}return this.getPreferredSize()},getScene:function(){if(this.scene){return this.scene}if(!this.parent){return}var a=this.parent;while(!a.scene&&a.parent){a=a.parent}return a.scene},blowCssCaches:function(a){if(this.component){console.log("WARNING: BLOW CACHE has a component reference")}if(a===undefined){delete this.insetCache;return}if(a.indexOf("border")!=-1||a.indexOf("margin")!=-1||a.indexOf("padding")!=-1){delete this.insetCache}}}});th.ContainerHelpers=new Trait({methods:{getChildById:function(d){for(var a=0;a<this.children.length;a++){if(this.children[a].id==d){return this.children[a]}}},getComponentForPosition:function(a,h,f){for(var d=0;d<this.children.length;d++){if(!this.children[d].bounds){continue}if(this.children[d].bounds.x<=a&&this.children[d].bounds.y<=h&&(this.children[d].bounds.x+this.children[d].bounds.width)>=a&&(this.children[d].bounds.y+this.children[d].bounds.height)>=h){if(!f){return this.children[d]}if(!this.children[d].shouldPaint()){continue}return(this.children[d].getComponentForPosition)?this.children[d].getComponentForPosition(a-this.children[d].bounds.x,h-this.children[d].bounds.y,f):this.children[d]}}return this},removeAll:function(){this.remove(this.children)},getMinimumSize:function(){return(this.layoutManager)?this.layoutManager.getMinimumSize(this):this._super()},getPreferredSize:function(){return(this.layoutManager)?this.layoutManager.getPreferredSize(this):this._super()},getMaximumSize:function(){return(this.layoutManager)?this.layoutManager.getMaximumSize(this):this._super()}}});if(typeof th=="undefined"){th={}}th.VERTICAL="v";th.HORIZONTAL="h";th.Resources=Class.define({members:{init:function(){this.loading=false;this.userAgentCss=[];this.authorCss=[];this.userCss=[];this.resolvedCssCache={};this.blockUntilImagesLoaded=true;this.images={};this.sheetCount=0;this.currentSheet=0;this.imageCount=0;this.currentImage=0;this.loaded=false;this.cssLoaded=false;this.imagesLoaded=false;this.callbacks=[]},load:function(d,a){if(this.loaded){return}this.baseUrl=d;this.stringStyles=a;this.loading=true;this.parseCSS()},processImage:function(){this.currentImage++;if(this.imageCount==this.currentImage){this.imagesLoaded=true;this.onLoaded()}},onLoaded:function(){if(this.cssLoaded&&((this.blockUntilImagesLoaded&&this.imagesLoaded)||!this.blockUntilImagesLoaded)){this.loaded=true;this.loading=false;if(this.callbacks){th.forEach(this.callbacks,function(a){if(a.context){a.callback.apply(a.context)}else{a.callback()}})}}},registerOnLoadCallback:function(d,a){this.callbacks.push({callback:d,context:a})},parseCSS:function(){var f=[];var m=false;if(typeof this.baseUrl!=="undefined"){f.push({url:this.baseUrl+"css/default.css",array:this.userAgentCss,index:0})}else{if(th.DEFAULT_CSS){this.processCSS(th.DEFAULT_CSS,this.userAgentCss,0);m=true}}var j,d=document.getElementsByTagName("link");var a=0;for(var h=0;h<d.length;h++){j=d[h];if(j.rel.toLowerCase().indexOf("thstylesheet")>=0&&j.href){f.push({url:j.href,array:this.authorCss,index:a++})}}if(this.stringStyles){this.processCSS(this.stringStyles,this.authorCss,a++)}if(f.length==0){this.cssLoaded=true;return this.onLoaded()}this.sheetCount=f.length;if(m){this.sheetCount++}if(this.stringStyles){this.sheetCount++}th.forEach(f,function(i){th.xhrGet({url:i.url,load:function(l){this.processCSS(l,i.array,i.index)},context:this})},this)},processCSS:function(a,l,j){l[j]=new th.CssParser().parse(a);for(var o in l[j]){var m=[];for(var u in l[j][o]){m.push(u)}for(var h=0;h<m.length;h++){u=m[h];var q=l[j][o][u];var p=0;var n=-1;while((n=q.indexOf("url(",p))!=-1){var t=q.indexOf(")",n);if(t==-1){console.log("Warning: malformed url found ('"+q+"')");break}var s=q.substring(n,t);var d=s.substring(4);if(d.charAt(0)=="'"||d.charAt(0)=='"'){d=d.substring(1,d.length-1)}this.imageCount++;var f=new Image();if(this.blockUntilImagesLoaded){this.imagesLoaded=false;var v=this;f.onload=function(){v.processImage()};f.onerror=function(){v.processImage()}}f.src=d;this.images[q]=f;p=t+1}if(u=="margin"||u=="padding"){this.expandMarginOrPadding(u,q,l[j][o],m)}if(u=="border"){this.expandProperty("border-top",q,l[j][o],m);this.expandProperty("border-right",q,l[j][o],m);this.expandProperty("border-bottom",q,l[j][o],m);this.expandProperty("border-left",q,l[j][o],m)}if(u=="border-top"||u=="border-left"||u=="border-right"||u=="border-bottom"){this.expandBorder(u,q,l[j][o],m)}}}if(++this.currentSheet==this.sheetCount){this.cssLoaded=true;this.onLoaded()}},expandBorder:function(l,j,f,h){var a=th.getSpaceDelimitedItems(j);for(var d=0;d<a.length;d++){if(th.isCssLength(a[d])){this.expandProperty(l+"-width",a[d],f,h)}else{if(th.isCssBorderStyle(a[d])){this.expandProperty(l+"-style",a[d],f,h)}else{this.expandProperty(l+"-color",a[d],f,h)}}}delete f[l]},expandProperty:function(a,h,d,f){d[a]=h;f.push(a)},expandMarginOrPadding:function(i,h,d,f){var a=h.split(" ");if(a.length==3){a=[a[0],a[1],a[2],a[1]]}if(a.length==2){a=[a[0],a[1],a[0],a[1]]}if(a.length==1){a=[a[0],a[0],a[0],a[0]]}if(a.length>=4){this.expandProperty(i+"-top",a[0],d,f);this.expandProperty(i+"-right",a[1],d,f);this.expandProperty(i+"-bottom",a[2],d,f);this.expandProperty(i+"-left",a[3],d,f);delete d[i]}}}});th.Bus=Class.define({members:{init:function(){this.events={}},bind:function(j,d,a,l){var h=this.events[j];if(!h){h=[];this.events[j]=h}d=th.isArray(d)?d:[d];for(var m=0;m<d.length;m++){for(var f=0;f<h.length;f++){if(h[f].selector==d[m]&&h[f].listenerFn==a){return}}h.push({selector:d[m],listenerFn:a,context:l})}},unbind:function(a){for(var h in this.events){var f=this.events[h];for(var d=0;d<f.length;d++){if(f[d].selector===a){this.events[h]=th.remove(f,f[d]);f=this.events[h];d--}}}},fire:function(a,j,d){var h=this.events[a];if(!h||h.length==0){return}for(var f=0;f<h.length;f++){if(h[f].selector.constructor==String){if(h[f].selector.charAt(0)=="#"){if(d.id==h[f].selector.substring(1)){this.dispatchEvent(a,j,d,h[f])}}else{if(h[f].selector==d.declaredClass){this.dispatchEvent(a,j,d,h[f])}}}else{if(h[f].selector==d){this.dispatchEvent(a,j,d,h[f])}}}},dispatchEvent:function(a,f,d,h){f.thComponent=d;if(h.context){h.listenerFn.apply(h.context,[f])}else{h.listenerFn(f)}}}});th.FocusManager=Class.define({members:{bus:null,KEY_TAB:9,init:function(a){this.bus=a;this.subscribers=[];this.focused=-1;th.observe(window,"keydown",this.onKeyDown,this)},onKeyDown:function(f){if(f.keyCode==this.KEY_TAB&&this.subscribers.length!=0){f.preventDefault();if(this.focused==-1){return}var a;var d=this.subscribers[this.focused];if(f.shiftKey==false){a=(d.focusNext!==undefined?this.subscribers.indexOf(d.focusNext):this.focused+1)}else{a=(d.focusPrev!==undefined?this.subscribers.indexOf(d.focusPrev):this.focused-1)}a%=this.subscribers.length;if(a<0){a+=this.subscribers.length}this.focus(this.subscribers[a])}},focus:function(d){var a=this.subscribers.indexOf(d);if(a==-1){console.error("FocusManager:focus: no such subscribed component!");return}if(a==this.focused){console.debug("FocusManager:focus: refocus the component???")}e={};e.getsFocus=d;if(this.focused!=-1){var f=this.subscribers[this.focused];if(f.allowLoseFocus!==undefined){if(!f.allowLoseFocus(e)){if(f.dom||d.dom){th.delay(function(){this.bus.fire("focus:received",e,f);this.bus.fire("focus:canceled",e,d)},0,this)}return}}}if(this.focused!=-1){this.bus.fire("focus:lost",e,this.subscribers[this.focused])}this.focused=a;this.bus.fire("focus:received",e,this.subscribers[this.focused])},forceFocus:function(d){var a=this.subscribers.indexOf(d);if(a==-1){console.error("FocusManager:focus: no such subscribed component!");return}if(this.focused!=-1){this.bus.fire("focus:lost",{},this.subscribed[this.focused])}this.focused=a;this.bus.fire("focus:received",{},this.subscribers[this.focused])},subscribe:function(a){if(!this.hasSubscriber(a)){this.subscribers.push(a);a.focusManager=this}},hasSubscriber:function(a){return(this.subscribers.indexOf(a)!=-1)},unsubscribe:function(d){var a=this.subscribers.indexOf(components);if(a==-1){console.error("FocusManager:unsubscribe: no such subscribed component!");return}this.subscribers.splice(a,1);if(a==this.focused){this.bus.fire("focus:lost",{},d);delete d.focusManager;this.focused=-1}},hasFocus:function(a){return(this.subscribers.indexOf(a)==this.focused)}}});th.global_event_bus=new th.Bus();th.global_resources=new th.Resources();th.global_focus_manager=new th.FocusManager(th.global_event_bus);th.Scene=Class.define({uses:[th.EventHelpers],members:{bus:th.global_event_bus,init:function(a,h){if(th.isString(a)){a=document.getElementById("canvasOrId")}this.canvas=a;var f=h;var d="";if(h&&!th.isString(h)){f=h.baseUrl;d=h.stringStyles}this.smartRedraw=false;this.resources=th.global_resources;this.resourceCallbackRegistered=false;if(!this.resources.loaded&&!this.resources.loading){this.resources.load(f,d)}th.observe(window,"resize",function(){this.render()},this);this.root=new th.Panel({id:"root"});this.root.scene=this;this.testCanvas=document.createElement("canvas");this.scratchContext=this.testCanvas.getContext("2d");th.fixCanvas(this.scratchContext);this.parseTags();th.observe(window,"mousedown",function(i){this.wrapEvent(i,this.root);this.mouseDownComponent=i.thComponent;th.global_event_bus.fire("mousedown",i,i.thComponent)},this);th.observe(window,"dblclick",function(i){this.wrapEvent(i,this.root);th.global_event_bus.fire("dblclick",i,i.thComponent)},this);th.observe(window,"click",function(i){this.wrapEvent(i,this.root);th.global_event_bus.fire("click",i,i.thComponent)},this);th.observe(window,"mousemove",function(i){this.wrapEvent(i,this.root);th.global_event_bus.fire("mousemove",i,i.thComponent);if(this.mouseDownComponent){this.addComponentXY(i,this.root,this.mouseDownComponent);th.global_event_bus.fire("mousedrag",i,this.mouseDownComponent)}},this);th.observe(window,"mouseup",function(i){if(!this.mouseDownComponent){return}this.addComponentXY(i,this.root,this.mouseDownComponent);th.global_event_bus.fire("mouseup",i,this.mouseDownComponent);delete this.mouseDownComponent},this)},render:function(a){if(!this.resources.loaded){if(!this.resourceCallbackRegistered){this.resources.registerOnLoadCallback(this.render,this);if(a){this.resources.registerOnLoadCallback(function(){a(this)},this)}this.resourceCallbackRegistered=true}return}this.layout();this.paint();if(a){a(this)}},blockUntilRender:function(){if(!this.resources.loaded){}},parseTags:function(){this.parseCanvasAttributes("grid");var a=this.canvas.childNodes;this.attachChildElementsToParent(a,this.root)},parseCanvasAttributes:function(){th.forEach(arguments,function(a){if(this.canvas.hasAttribute(a)){this.root[a]=this.canvas.getAttribute(a)}},this)},attachChildElementsToParent:function(a,d){th.forEach(a,function(h){if(h.nodeType==Node.ELEMENT_NODE){var f=this.createComponentFromElement(h,d);if(f){d.add(f);this.attachChildElementsToParent(h.childNodes,f)}else{console.log("Couldn't create component from element \""+h.tagName+'"')}}},this)},createComponentFromElement:function(a,h){var m={};for(var o in th){var j=o.toLowerCase();if(m[j]){console.log('componentMap collision with key "'+j+'"')}m[j]=o}var d=a.tagName.toLowerCase();o=m[d];if(!o){return}var f=th[o];if(!f){return}var l=a.attributes;var i={};th.forEach(l,function(q){var p=q.name;var s=q.value;if(p=="cell"){p="constraints"}i[p]=s});var n=new f(i);if(!n.type){return}if(n.type.toLowerCase()!=d){return}return n},layout:function(){if(this.root){this.root.bounds={x:0,y:0,width:this.canvas.width,height:this.canvas.height};this.root.layoutTree()}},paint:function(d){if(!this.resources.loaded){if(!this.resourceCallbackRegistered){this.resources.registerOnLoadCallback(this.render,this);this.resourceCallbackRegistered=true}return}if(!d){d=this.root}if(d){if(d===this.root){d.resolveCss()}if(!d.opaque&&d.parent){return this.paint(d.parent)}var a=this.canvas.getContext("2d");th.fixCanvas(a);a.save();var f=d.parent;var h=d;while(f){a.translate(h.bounds.x,h.bounds.y);h=f;f=f.parent}if(!this.smartRedraw){a.clearRect(0,0,d.bounds.width,d.bounds.height)}a.beginPath();a.rect(0,0,d.bounds.width,d.bounds.height);a.closePath();a.clip();d.paint(a);if(d.border){d.border.paint(a)}a.restore()}}}});th.Rectangle=function(){if(arguments.length==1){this.x=arguments[0].x;this.y=arguments[0].y;this.w=arguments[0].w;this.h=arguments[0].h}else{if(arguments.length==4){this.x=arguments[0];this.y=arguments[1];this.w=arguments[2];this.h=arguments[3]}else{this.x=this.y=this.w=this.h=0}}};th.Rectangle.prototype.TOP=0;th.Rectangle.prototype.RIGHT=1;th.Rectangle.prototype.BOTTOM=2;th.Rectangle.prototype.LEFT=3;th.Rectangle.prototype.TOP_LEFT=0;th.Rectangle.prototype.TOP_RIGHT=1;th.Rectangle.prototype.BOTTOM_RIGHT=2;th.Rectangle.prototype.BOTTOM_LEFT=3;th.Rectangle.prototype.round=function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.w=Math.round(this.w);this.h=Math.round(this.h)};th.Rectangle.prototype.inset=function(){if(arguments.length==1){var j=arguments[0];if(typeof j=="number"){this.x+=j;this.y+=j;this.w-=2*j;this.h-=2*j}else{if((j instanceof Array)&&j.length==4){this.x+=j[this.LEFT];this.y+=j[this.TOP];this.w-=j[this.RIGHT]+j[this.LEFT];this.h-=j[this.TOP]+j[this.BOTTOM]}}}else{if(arguments.length==4){var i=arguments[0];var f=arguments[1];var a=arguments[2];var h=arguments[3];this.x+=h;this.y+=i;this.w-=h+f;this.h-=i+a}}};th.Rectangle.prototype.corner=function(a){switch(a){case this.TOP_LEFT:return{x:this.x,y:this.y};case this.TOP_RIGHT:return{x:this.x+this.w,y:this.y};case this.BOTTOM_RIGHT:return{x:this.x+this.w,y:this.y+this.h};case this.BOTTOM_LEFT:return{x:this.x,y:this.y+this.h}}};th.Rectangle.prototype.isEmpty=function(){return(this.w<=0||this.h<=0)};th.Size2D=function(){if(arguments.length==1){this.w=arguments[0].w;this.h=arguments[0].h}else{if(arguments.length==2){this.w=arguments[0];this.h=arguments[1]}else{this.w=this.h=0}}};th.Size2D.prototype.isZero=function(){return(this.w==0)&&(this.h==0)};th.SimpleBorder=Class.define({type:"Border",uses:[th.ComponentHelpers],members:{init:function(a){this.SIDES=["top","right","bottom","left"];this.component=a},getBorderWidth:function(a){var d=this.component.cssValue("border-"+a+"-width");if(d===undefined){return 0}return th.convertLengthToPixels(d,this.component)},getInsets:function(){return this.calculateInsets("border-","-width")},paint:function(o){for(var f=0;f<this.SIDES.length;f++){var p=this.SIDES[f];var a=this.getBorderWidth(p);if(a>0){var d=this.component.cssValue("border-"+p+"-color");var m,l,j,n;switch(p){case"top":m=0;l=0;j=a;n=this.component.bounds.width;break;case"right":m=this.component.bounds.width-a;l=0;j=this.component.bounds.height;n=a;break;case"bottom":m=0;l=this.component.bounds.height-a;j=a;n=this.component.bounds.width;break;case"left":m=0;l=0;j=this.component.bounds.height;n=a;break}this.paintBorder(o,d,m,l,n,j)}}},paintBorder:function(f,i,a,l,d,j){f.fillStyle=i;f.fillRect(a,l,d,j)}}});th.Border=Class.define({type:"Border",uses:[th.ComponentHelpers],members:{SIDES:["top","right","bottom","left"],CORNERS:["top-left","top-right","bottom-right","bottom-left"],TOP:0,TOP_LEFT:0,RIGHT:1,TOP_RIGHT:1,BOTTOM:2,BOTTOM_RIGHT:2,LEFT:3,BOTTOM_LEFT:3,BIT_TOP:1,BIT_RIGHT:2,BIT_BOTTOM:4,BIT_LEFT:8,init:function(a){this.component=a;this.outerRect=new th.Rectangle();this.innerRect=new th.Rectangle();this.borderStyles=[];this.borderWidths=[];this.borderRadii=[];this.borderColors=[];this.skipSides=0;this.oneUnitBorder=false;this.noBorderRadius=false;this.cornerDimensions={};for(var d=0;d<4;d++){this.borderStyles[d]="none";this.borderWidths[d]=0;this.borderColors[d]="rgba(0, 0, 0, 0)";this.borderRadii[d]=new th.Size2D();this.cornerDimensions[d]=new th.Size2D()}},getInsets:function(){return this.calculateInsets("border-","-width")},recalculateBorderData:function(){var o=this.component.d();var n=this.component.getScratchContext();var f="",j,h,a;for(var m=0;m<4;m++){var l=this.SIDES[m];j=th.convertBorderLengthToPixels(this.component.cssValue("border-"+l+"-width"));f=this.component.cssValue("border-"+l+"-color");if(f!==undefined){n.fillStyle=f;h=n.fillStyle;a=this.component.cssValue("border-"+l+"-style")}this.borderWidths[m]=(j===undefined)?0:j;this.borderColors[m]=(h===undefined)?"rgb(0, 0, 0)":h;this.borderStyles[m]=(a===undefined)?"none":a}this.outerRect=new th.Rectangle(0,0,o.b.w,o.b.h);this.innerRect=new th.Rectangle(this.outerRect);this.innerRect.inset(this.borderWidths[0],this.borderWidths[1],this.borderWidths[2],this.borderWidths[3]);this.cornerDimensions[0].w=this.borderWidths[3];this.cornerDimensions[0].h=this.borderWidths[0];this.cornerDimensions[1].w=this.borderWidths[1];this.cornerDimensions[1].h=this.borderWidths[0];this.cornerDimensions[2].w=this.borderWidths[1];this.cornerDimensions[2].h=this.borderWidths[2];this.cornerDimensions[3].w=this.borderWidths[3];this.cornerDimensions[3].h=this.borderWidths[2];this.oneUnitBorder=this.checkFourFloatsEqual(this.borderWidths,1);this.noBorderRadius=this.allCornersZeroSize(this.borderRadii);f=this.component.cssValue("background-color");if(f!==undefined){n.fillStyle=f}this.backgroundColor=n.fillStyle},next:function(d){var a=(d+1)%4;if(a<0){return a+4}return a},prev:function(d){var a=(d-1)%4;if(a<0){return a+4}return a},allCornersZeroSize:function(a){return(a[0].isZero()&&a[1].isZero()&&a[2].isZero()&&a[3].isZero())},checkFourFloatsEqual:function(a,d){return(a[0]==d&&a[1]==d&&a[2]==d&&a[3]==d)},areBorderSideFinalStylesSame:function(d){if(d==0){throw"th.Border:areBorderSideFinalStyleSame - Invalid side bit-field '0'"}firstStyle=0;for(var a=0;a<4;a++){if(firstStyle==a){if(((1<<a)&d)==0){firstStyle++}continue}if(((1<<a)&d)==0){continue}if(this.borderStyles[firstStyle]!=this.borderStyles[a]||this.borderColors[firstStyle]!=this.borderColors[a]){return false}}switch(this.borderStyles[firstStyle]){case"groove":case"ridge":case"inset":case"outset":return((d&(this.BIT_TOP|this.BIT_LEFT))==0||(d&(this.BIT_BOTTOM|this.BIT_RIGHT))==0)}return true},isSolidCornerStyle:function(d,a){switch(d){case"dotted":case"dashed":case"solid":return true;case"inset":case"outset":return a==this.TOP_LEFT||a==this.BOTTOM_RIGHT;case"groove":case"ridge":return this.oneUnitBorder&&(a==this.TOP_LEFT||a==this.BOTTOM_RIGHT);case"double":return this.oneUnitBorder;default:return false}},borderColorStyleForSolidCorner:function(d,a){switch(d){case"dotted":case"dashed":case"solid":case"double":return"solid";case"inset":case"groove":if(a==this.TOP_LEFT){return"dark"}else{if(a==this.BOTTOM_RIGHT){return"light"}}break;case"outset":case"ridge":if(a==this.TOP_LEFT){return"light"}else{if(a==this.BOTTOM_RIGHT){return"dark"}}break}return"none"},doCornerSubPath:function(a,d){var f={x:0,y:0};if(d==this.TOP_RIGHT||d==this.BOTTOM_RIGHT){f.x=this.outerRect.w-this.cornerDimensions[d].w}if(d==this.BOTTOM_RIGHT||d==this.BOTTOM_LEFT){f.y=this.outerRect.h-this.cornerDimensions[d].h}a.rect(this.outerRect.x+f.x,this.outerRect.y+f.y,this.cornerDimensions[d].w,this.cornerDimensions[d].h)},doSideClipWithoutCornersSubPath:function(d,a){var i={x:0,y:0};var h=this.next(a);if(a==this.TOP){i.x=this.cornerDimensions[this.TOP_LEFT].w}else{if(a==this.RIGHT){i.x=this.outerRect.w-this.borderWidths[this.RIGHT];i.y=this.cornerDimensions[this.TOP_RIGHT].h}else{if(a==this.BOTTOM){i.x=this.cornerDimensions[this.BOTTOM_LEFT].w;i.y=this.outerRect.h-this.borderWidths[this.BOTTOM]}else{if(a==this.LEFT){i.y=this.cornerDimensions[this.TOP_LEFT].h}}}}var j=new th.Size2D();j.w=this.cornerDimensions[a].w+this.cornerDimensions[h].w;j.h=this.cornerDimensions[a].h+this.cornerDimensions[h].h;var f=new th.Rectangle(this.outerRect.x+i.x,this.outerRect.y+i.y,this.outerRect.w-j.w,this.outerRect.h-j.h);if(a==this.TOP||a==this.BOTTOM){f.h=this.borderWidths[a]}else{f.w=this.borderWidths[a]}d.rect(f.x,f.y,f.w,f.h)},maybeMoveToMidPoint:function(f,a,h){var d={x:a.x-f.x,y:a.y-f.y};if(d.x!=0&&d.y!=0){k=Math.min((h.x-f.x)/d.x,(h.y-a.y)/d.y);a.x=f.x+d.x*k;a.y=f.y+px.y*k}},doSideClipSubPath:function(p,h){var a=[{x:0,y:0},{x:0,y:0}];var d=[{x:0,y:0},{x:0,y:0}];var f=this.prev(h);var m=this.next(h);var q=this.borderStyles[h]=="dashed"||this.borderStyles[h]=="dotted";var o=this.borderStyles[f]=="dashed"||this.borderStyles[f]=="dotted";var j=this.borderStyles[m]=="dashed"||this.borderStyles[m]=="dotted";var i=0;var n=0;if(!this.borderRadii[h].isZero()){i=1}else{if(o&&q){i=2}}if(!this.borderRadii[m].isZero()){n=1}else{if(o&&q){n=2}}var l={x:0,y:0};l.x=this.innerRect.x+this.innerRect.w/2;l.y=this.innerRect.y+this.innerRect.h/2;a[0]=this.outerRect.corner(h);a[1]=this.innerRect.corner(h);d[0]=this.outerRect.corner(m);d[1]=this.innerRect.corner(m);if(i==1){this.maybeMoveToMidPoint(a[0],a[1],l)}else{if(i==2){if(side=="top"||side=="bottom"){a[1]={x:this.outerRect.corner(h).x,y:this.innerRect.corner(h).y}}else{a[1]={x:this.innerRect.corner(h).x,y:this.outerRect.corner(h).y}}}}if(n==1){this.maybeMoveToMidPoint(d[0],d[1],l)}else{if(n==2){if(side=="top"||side=="bottom"){d[0]={x:this.innerRect.corner(m).x,y:this.outerRect.corner(m).y}}else{d[0]={x:this.outerRect.corner(m).x,y:this.innerRect.corner(m).y}}}}p.moveTo(a[0].x,a[0].y);p.lineTo(d[0].x,d[0].y);p.lineTo(d[1].x,d[1].y);p.lineTo(a[1].x,a[1].y);p.closePath()},fillSolidBorder:function(n,p,j,d,m,l,f){n.fillStyle=f;if(!this.allCornersZeroSize(d)){var o=this.computeInnerRadii(d,m);n.beginPath();this.traceRoundRect(n,p,d,true);this.traceRoundRect(n,j,o,false);n.fill();return}if(l==15&&this.checkFourFloatsEqual(m,m[0])){var a=new th.Rectangle(p);a.inset(m[0]/2);n.strokeStyle=f;n.lineWidth=m[0];n.beginPath();n.rect(a.x,a.y,a.w,a.h);n.stroke();return}var a=[{x:0,y:0,w:0,h:0},{x:0,y:0,w:0,h:0},{x:0,y:0,w:0,h:0},{x:0,y:0,w:0,h:0}];if(l&this.BIT_TOP){a[this.TOP].x=p.x;a[this.TOP].y=p.y;a[this.TOP].w=p.w;a[this.TOP].h=m[this.TOP]}if(l&this.BIT_BOTTOM){a[this.BOTTOM].x=p.x;a[this.BOTTOM].y=p.y+p.h;a[this.BOTTOM].y-=m[this.BOTTOM];a[this.BOTTOM].w=p.w;a[this.BOTTOM].h=m[this.BOTTOM]}if(l&this.BIT_LEFT){a[this.LEFT].x=p.x;a[this.LEFT].y=p.y;a[this.LEFT].w=m[this.LEFT];a[this.LEFT].h=p.h}if(l&this.BIT_RIGHT){a[this.RIGHT].x=p.x+p.w;a[this.RIGHT].y=p.y;a[this.RIGHT].x-=m[this.RIGHT];a[this.RIGHT].w=m[this.RIGHT];a[this.RIGHT].h=p.h}if((l&(this.BIT_TOP|this.BIT_LEFT))==(this.BIT_TOP|this.BIT_LEFT)){a[this.LEFT].y+=m[this.TOP];a[this.LEFT].h-=m[this.TOP]}if((l&(this.BIT_TOP|this.BIT_RIGHT))==(this.BIT_TOP|this.BIT_RIGHT)){a[this.TOP].w-=m[this.RIGHT]}if((l&(this.BIT_BOTTOM|this.BIT_RIGHT))==(this.BIT_BOTTOM|this.BIT_RIGHT)){a[this.RIGHT].h-=m[this.BOTTOM]}if((l&(this.BIT_BOTTOM|this.BIT_LEFT))==(this.BIT_BOTTOM|this.BIT_LEFT)){a[this.BOTTOM].x+=m[this.LEFT];a[this.BOTTOM].w-=m[this.LEFT]}for(var h=0;h<4;h++){if(l&(1<<h)){n.beginPath();n.rect(a[h].x,a[h].y,a[h].w,a[h].h);n.fill()}}},getLuminosity:function(f,d,a){return f*299+d*587+a*114},getBrightness:function(i,h,d){var a=(i+h+d)/3;var f=this.getLuminosity(i,h,d)/1000;return(a*25+f*75)/100},getSpecial3DColors:function(d,q){var o=[];var j,i;var a=parseInt(q.substring(1,2),16);var p=parseInt(q.substring(3,2),16);var m=parseInt(q.substring(5,2),16);var f=parseInt(d.substring(1,2),16);var h=parseInt(d.substring(3,2),16);var n=parseInt(d.substring(5,2),16);var l=this.getBrightness(a,p,m);var s=this.getBrightness(f,h,n);if(s<51){j=30;i=50;if(l==0){a=p=m=96}}else{if(s>204){j=45;i=70;if(l==254){a=p=m=192}}else{j=30+(s/17);i=50+(s*20/255)}}r=a-(j*a/100);g=p-(j*p/100);b=m-(j*m/100);o[0]="rgb("+parseInt(r)+","+parseInt(g)+","+parseInt(b)+")";r=a+(i*(255-a)/100);g=p+(i*(255-p)/100);b=m+(i*(255-m)/100);o[1]="rgb("+parseInt(r)+","+parseInt(g)+","+parseInt(b)+")";return o},makeBorderColor:function(d,h,i){var a;var f=0;switch(i){case"none":return"rgba(0, 0, 0, 0)";case"light":f=1;case"dark":a=this.getSpecial3DColors(h,d);return a[f];case"solid":default:return d}},computeColorForLine:function(a,i,d,f,h){return this.makeBorderColor(f,h,i[a])},drawBorderSides:function(x,q){if(q==0){return}var a;var h;var j=[];var t=[];var o=0;var p=[];for(var n=0;n<4;n++){if(((1<<n)&q)==0){continue}a=this.borderStyles[n];h=this.borderColors[n];break}if(a=="none"||a=="hidden"){return}if(this.oneUnitBorder&&(a=="ridge"||a=="groove"||a=="double")){a="solid"}switch(a){case"solid":case"dashed":case"dotted":j[0]="solid";t[0]="solid";o=1;break;case"groove":j[0]="dark";j[1]="light";t[0]="light";t[1]="dark";o=2;break;case"ridge":j[0]="light";j[1]="dark";t[0]="dark";t[1]="light";o=2;break;case"double":j[0]="solid";j[1]="none";j[2]="solid";t[0]="solid";t[1]="none";t[2]="solid";o=3;break;case"inset":j[0]="dark";t[0]="light";o=1;break;case"outset":j[0]="light";t[0]="dark";o=1;break;default:throw"Unhandled style '"+a+"'";break}if(q&(this.BIT_RIGHT|this.BIT_BOTTOM)){p=t}else{p=j}var v=[[],[],[]];if(o==1){for(var n=0;n<4;n++){v[0][n]=this.borderWidths[n]}}else{if(o==2){for(var n=0;n<4;n++){var s=this.borderWidths[n];v[0][n]=Math.floor(s/2)+s%2;v[1][n]=Math.floor(s/2)}}else{if(o==3){for(var n=0;n<4;n++){var s=this.borderWidths[n];if(s==1){v[0][n]=1;v[1][n]=v[2][n]=0}else{var d=s%3;v[0][n]=v[2][n]=v[1][n]=Math.floor((s-d)/3);if(d==1){v[1][n]++}else{if(d==2){v[0][n]++;v[2][n]++}}}}}}}var m=new th.Rectangle(this.outerRect);var u=new th.Rectangle(this.outerRect);var l=this.copyRadii(this.borderRadii);for(var n=0;n<o;n++){u.inset(v[n]);if(p[n]!="none"){var f=this.computeColorForLine(n,p,o,h,this.backgroundColor);this.fillSolidBorder(x,m,u,l,v[n],q,f)}l=this.computeInnerRadii(l,v[n]);m.x=u.x;m.y=u.y;m.w=u.w;m.h=u.h}},paint:function(t){var n=this.component.d();this.recalculateBorderData();var i=this.areBorderSideFinalStylesSame(1|8);var s=this.areBorderSideFinalStylesSame(2|4);var d=this.areBorderSideFinalStylesSame(15);if(d&&(this.borderStyles[0]=="none"||this.borderStyles[0]=="hidden")){return}this.outerRect.round();this.innerRect.round();if(this.outerRect.isEmpty()){return}if(d){this.drawBorderSides(t,this.BIT_TOP|this.BIT_RIGHT|this.BIT_BOTTOM|this.BIT_LEFT)}else{for(var p=0;p<4;p++){var f=[p,this.prev(p)];if(!this.borderRadii[p].isZero()){continue}if(this.borderWidths[f[0]]==1&&this.borderWidths[f[1]]==1){if(p==this.TOP_LEFT||p==this.TOP_RIGHT){this.cornerDimensions[p].w=0}else{this.cornerDimensions[p].h=0}}}for(var p=0;p<4;p++){if(this.cornerDimensions[p].isZero()){continue}var f=[p,this.prev(p)];var j=(1<<f[0])|(1<<f[1]);var h=this.areBorderSideFinalStylesSame(j);if(h&&this.borderRadii[p].isZero()&&this.isSolidCornerStyle(this.borderStyles[f[0]],p)){t.beginPath();this.doCornerSubPath(t,p);t.fillStyle=this.makeBorderColor(this.borderColors[f[0]],this.backgroundColor,this.borderColorStyleForSolidCorner(this.borderStyles[f[0]],p));t.fill();continue}t.save();t.beginPath();this.doCornerSubPath(t,p);t.clip();if(h){this.drawBorderSides(t,j)}else{var o=this.component.getScratchContext();o.canvas.height=n.b.h;o.canvas.width=n.b.w;o.clearRect(0,0,n.b.w,n.b.h);o.globalCompositeOperation="lighter";for(var q=0;q<2;q++){var m=f[q];var a=this.borderStyles[m];o.save();o.beginPath();this.doSideClipSubPath(o,m);o.clip();this.drawBorderSides(o,1<<m);o.restore()}t.globalCompositeOpertation="source-over";t.drawImage(o.canvas,0,0,n.b.w,n.b.h,0,0,n.b.w,n.b.h)}t.restore()}var l=0;if(this.oneUnitBorder&&this.noBorderRadius){if(i){this.drawBorderSides(t,1|8);l|=1|8}if(s){this.drawBorderSides(t,4|2);l|=4|2}}for(var m=0;m<4;m++){if(l&(1<<m)){continue}if(this.borderWidths[m]==0||this.borderStyles[m]=="hidden"||this.borderStyles[m]=="none"){continue}t.save();t.beginPath();this.doSideClipWithoutCornersSubPath(t,m);t.clip();this.drawBorderSides(t,1<<m);t.restore()}}},computeInnerRadii:function(d,a){var f={};f[this.TOP_LEFT]=new th.Size2D(Math.max(0,d[this.TOP_LEFT].w-a[3]),Math.max(0,d[this.TOP_LEFT].h-a[0]));f[this.TOP_RIGHT]=new th.Size2D(Math.max(0,d[this.TOP_RIGHT].w-a[1]),Math.max(0,d[this.TOP_RIGHT].h-a[0]));f[this.BOTTOM_RIGHT]=new th.Size2D(Math.max(0,d[this.BOTTOM_RIGHT].w-a[1]),Math.max(0,d[this.BOTTOM_RIGHT].h-a[2]));f[this.BOTTOM_LEFT]=new th.Size2D(Math.max(0,d[this.BOTTOM_LEFT].w-a[3]),Math.max(0,d[this.BOTTOM_LEFT].h-a[2]));return f},copyRadii:function(d){var a={};for(c in d){a[c]=new th.Size2D(d[c])}return a},traceRoundRect:function(a,f,h,d){if(d){a.moveTo(f.x,f.y+h[this.TOP_LEFT].h);a.quadraticCurveTo(f.x,f.y,f.x+h[this.TOP_LEFT].w,f.y);a.lineTo(f.x+f.w-h[this.TOP_RIGHT].w,f.y);a.quadraticCurveTo(f.x+f.w,f.y,f.x+f.w,f.y+h[this.TOP_RIGHT].h);a.lineTo(f.x+f.w,f.y+f.h-h[this.BOTTOM_RIGHT].h);a.quadraticCurveTo(f.x+f.w,f.y+f.h,f.x+f.w-h[this.BOTTOM_RIGHT].w,f.y+f.h);a.lineTo(f.x+h[this.BOTTOM_LEFT].w,f.y+f.h);a.quadraticCurveTo(f.x,f.y+f.h,f.x,f.y+f.h-h[this.BOTTOM_LEFT].h);a.lineTo(f.x,f.y+h[this.TOP_LEFT].h)}else{a.moveTo(f.x,f.y+h[this.TOP_LEFT].h);a.lineTo(f.x,f.y+f.h-h[this.BOTTOM_LEFT].h);a.quadraticCurveTo(f.x,f.y+f.h,f.x+h[this.BOTTOM_LEFT].w,f.y+f.h);a.lineTo(f.x+f.w-h[this.BOTTOM_RIGHT].w,f.y+f.h);a.quadraticCurveTo(f.x+f.w,f.y+f.h,f.x+f.w,f.y+f.h-h[this.BOTTOM_RIGHT].h);a.lineTo(f.x+f.w,f.y+h[this.TOP_RIGHT].h);a.quadraticCurveTo(f.x+f.w,f.y,f.x+f.w-h[this.TOP_RIGHT].w,f.y);a.lineTo(f.x+h[this.TOP_LEFT].w,f.y);a.quadraticCurveTo(f.x,f.y,f.x,f.y+h[this.TOP_LEFT].h)}}}});th.Component=Class.define({type:"Component",uses:[th.ComponentHelpers],members:{init:function(a){if(!a){a={}}for(parm in a){this[parm]=a[parm]}if(!this.bounds){this.bounds={}}this.border=new th.SimpleBorder(this);if(this.opaque==undefined){this.opaque=true}this.bus=th.global_event_bus;this.styles=undefined;this.localStyles={};this.refreshCss=true},getScratchContext:function(){var a=this.getScene();if(a){return a.scratchContext}},getInsets:function(){var a=this.border.getInsets();a=this.calculateInsets("padding-","",a);return a},getMargins:function(){return this.calculateInsets("margin-")},paint:function(a){},repaint:function(){if(!this.getScene()){return}this.getScene().paint(this)}}});th.SimpleLayout=Class.define({members:{init:function(a){if(!a){a={}}this.orientation=a.orientation||th.HORIZONTAL},layout:function(j){var t=j.d();if(j.children.length>0){var s=(this.orientation==th.HORIZONTAL);var m=(s)?t.b.iw:t.b.ih;var l=parseInt(m/j.children.length);var u=m%j.children.length;var o=(s)?t.i.l:t.i.t;var p=o;for(var q=0;q<j.children.length;q++){var f=0;if(u>0){u--;f=1}var a=o;var n=l+f;j.children[q].bounds=(s)?{x:a,y:p,width:n,height:t.b.ih}:{x:p,y:a,width:t.b.ih,height:t.b.iw};o+=n}}},getMinimumSize:function(a,h){var j=(this.orientation==th.HORIZONTAL)?"width":"height";var f=0;for(var d=0;d<a.children.length;d++){f+=a.children[d].getMinimumSize()[j]}return f},getPreferredSize:function(a){var h=(this.orientation==th.HORIZONTAL)?"width":"height";var f=0;for(var d=0;d<a.children.length;d++){f+=a.children[d].getPreferredSize()[h]}return f},getMaximumSize:function(a){var h=(this.orientation==th.HORIZONTAL)?"width":"height";var f=0;for(var d=0;d<a.children.length;d++){f+=a.children[d].getMaximumSize()[h]}return f}}});th.Container=Class.define({type:"Container",superclass:th.Component,uses:[th.ContainerHelpers],members:{init:function(a){this._super(a);this.children=[];this.checkedForFormLayout=false;this.layoutManager=new th.SimpleLayout()},add:function(){for(var d=0;d<arguments.length;d++){component=th.isArray(arguments[d])?arguments[d]:[arguments[d]];this.children=this.children.concat(component);for(var a=0;a<component.length;a++){component[a].parent=this;component[a].refreshCss=true}}},remove:function(){for(var f=0;f<arguments.length;f++){component=th.isArray(arguments[f])?arguments[f]:[arguments[f]];for(var d=0;d<component.length;d++){var a=this.children.length;this.children=th.remove(this.children,component[d]);if(a!=this.children.length){delete component[d].parent}}}},replace:function(d,a){this.bus.unbind(this.children[a]);d.parent=this;this.children[a]=d},paint:function(a){if(this.shouldPaint()){this.paintSelf(a);this.paintChildren(a)}},paintSelf:function(a){},paintChildren:function(a){for(var h=0;h<this.children.length;h++){if(!this.children[h].shouldPaint()){continue}if(!this.children[h].bounds){continue}a.save();try{a.translate(this.children[h].bounds.x,this.children[h].bounds.y)}catch(d){a.restore();continue}try{a.beginPath();a.rect(0,0,this.children[h].bounds.width,this.children[h].bounds.height);a.closePath();a.clip()}catch(f){}a.save();this.children[h].paint(a);if(this.children[h].border){this.children[h].border.paint(a)}a.restore();a.restore()}},installLayoutManager:function(f){this.layoutManager=f;var j=false;for(var d=0;d<this.children.length;d++){if(this.children[d]["constraints"]!==undefined){if(!this.children[d].cssValue("-th-constraints")){this.children[d].addCss("-th-constraints",this.children[d]["constraints"])}}if(this.children[d].cssValue("-th-constraints")){j=true}}if(f instanceof th.formlayout.FormLayout){if(!j){var h=1;var a=1;th.forEach(this.children,function(i){var n=false;while(h<=f.getRowCount()){while(a<=f.getColumnCount()){var m=f.getColumnSpec(a);if(m.isSpacer()){a++;continue}n=true;break}if(n){var l=f.getRowSpec(h);if(!l.isSpacer()){break}}n=false;h++;a=1}if(!n){return}f.addLayoutComponent(i,new th.formlayout.CellConstraints(a,h));a++})}else{th.forEach(this.children,function(i){var l=i.cssValue("-th-constraints");f.addLayoutComponent(i,new th.formlayout.CellConstraints(l))})}}},layoutTree:function(){if(!this.checkedForFormLayout){this.checkedForFormLayout=true;if(this.grid){var d=this.grid.split(";");if(d.length!=2){console.log("Couldn't parse 'grid' property: "+this.grid)}else{this.addCss("-th-grid-cols",d[0]);this.addCss("-th-grid-rows",d[1])}}var h=this.cssValue("-th-grid-cols");var f=this.cssValue("-th-grid-rows");if(h&&f){this.installLayoutManager(new th.formlayout.FormLayout(h,f))}}this.layout();for(var a=0;a<this.children.length;a++){if(this.children[a].layoutTree){this.children[a].layoutTree()}}},layout:function(){if(this.layoutManager){this.layoutManager.layout(this)}},render:function(){if(!th.global_resources.loaded){return}this.layoutTree();this.repaint()}}});th.Window=Class.define({type:"Window",members:{init:function(a){a=a||{};this.containerId=a.containerId||false;this.width=a.width||200;this.height=a.height||300;this.title=a.title||"NO TITLE GIVEN!";this.y=a.top||50;this.x=a.left||50;this.isVisible=false;this.closeOnClickOutside=!!a.closeOnClickOutside;if(!a.containerId){console.error('The "containerId" must be given!');return}if(th.byId(this.containerId)){console.error('There is already a element with the id "'+this.containerId+'"!');return}if(!a.userPanel){console.error('The "userPanel" must be given!');return}th.byId("popup_insert_point").innerHTML+='<div id="'+this.containerId+'" class="popupWindow"></div>';this.container=th.byId(this.containerId);dojo.attr(this.container,{width:this.width,height:this.height,tabindex:"-1"});this.container.innerHTML="<canvas id='"+this.containerId+"_canvas'></canvas>";this.canvas=th.byId(this.containerId+"_canvas");dojo.attr(this.canvas,{width:this.width,height:this.height,tabindex:"-1"});this.scene=new th.Scene(this.canvas);this.windowPanel=new th.components.WindowPanel(a.title,a.userPanel);this.windowPanel.windowBar.parentWindow=this;this.scene.root.add(this.windowPanel);this.move(this.x,this.y);dojo.connect(window,"mousedown",dojo.hitch(this,function(f){if(!this.isVisible||!this.closeOnClickOutside){return}var h=dojo.coords(this.container);if(f.clientX<h.l||f.clientX>(h.l+h.w)||f.clientY<h.t||f.clientY>(h.t+h.h)){this.toggle()}else{dojo.stopEvent(f)}}));dojo.connect(window,"keydown",dojo.hitch(this,function(d){if(!this.isVisible){return}if(d.keyCode==bespin.util.keys.Key.ESCAPE){this.toggle();dojo.stopEvent(d)}}))},toggle:function(){this.isVisible=!this.isVisible;if(this.isVisible){this.container.style.display="block";this.layoutAndRender()}else{this.container.style.display="none"}this.scene.bus.fire("toggle",{isVisible:this.isVisible},this)},layoutAndRender:function(){this.scene.layout();this.scene.render()},centerUp:function(){this.move(Math.round((window.innerWidth-this.width)*0.5),Math.round((window.innerHeight-this.height)*0.25))},center:function(){this.move(Math.round((window.innerWidth-this.width)*0.5),Math.round((window.innerHeight-this.height)*0.5))},move:function(a,d){this.y=d;this.x=a;this.container.style.top=d+"px";this.container.style.left=a+"px"},getPosition:function(){return{x:this.x,y:this.y}}}});if(typeof th=="undefined"){th={}}th.Panel=Class.define({type:"Panel",superclass:th.Container,members:{init:function(a){this._super(a)},paintSelf:function(a){this.paintBackground(a)}}});th.DomWrapper=Class.define({type:"DomWrapper",members:{bus:null,dom:null,focusManager:null,eventTravels:false,init:function(d,a){if(!a){a=th.global_event_bus}this.bus=a;this.dom=d;th.observe(this.dom,"focus",this.onDOMFocus,this);this.bus.bind("focus:received",this,this.onFocusReceived,this);this.bus.bind("focus:canceled",this,this.onCanceledFocus,this)},onDOMFocus:function(a){if(this.eventTravels){return}this.eventTravels=true;this.focusManager.focus(this)},onCanceledFocus:function(a){this.eventTravels=false},onFocusReceived:function(a){this.eventTravels=true;this.dom.focus();this.eventTravels=false},setFocusOrder:function(a,d){if(!this.focusManager.hasSubscriber(a)||!this.focusManager.hasSubscriber(d)){console.error("setFocusOrder: component not subscribed!")}this.focusNext=a;this.focusPrev=d}}});th.Button=Class.define({type:"Button",superclass:th.Component,members:{init:function(a){this._super(a)},getPreferredSize:function(){var j=this.getInsets();var h=j.left+j.right;var m=j.top+j.bottom;var a=this.cssValue("height");if(a!==undefined){a=th.convertLengthToPixels(a,this)}var l=this.cssValue("width");if(l!==undefined){l=th.convertLengthToPixels(l,this)}if(a!==undefined&&l!==undefined){return{width:l+h,height:a+m}}var d=this.tmb();if((d)&&(d.top&&d.mid&&d.bot)){if(a===undefined){a=d.top.height+d.mid.height+d.bot.height}if(l===undefined){l=d.top.width}return{width:l+h,height:a+m}}var f=this.getFirstBackgroundImage();if(f){return{width:f.width+h,height:f.height+m}}return{width:h,height:m}},tmb:function(){var d=this.cssValue("-th-top-image");var a=this.cssValue("-th-middle-image");var f=this.cssValue("-th-bottom-image");if(d){d=th.global_resources.images[d]}if(a){a=th.global_resources.images[a]}if(f){f=th.global_resources.images[f]}if(d&&a&&f){return{top:d,mid:a,bot:f}}},paint:function(a){var f=this.d();var h=this.tmb();if(!h){h={}}if(h.top&&h.mid&&h.bot){if(f.b.h>=h.top.height+h.bot.height){a.drawImage(h.top,0,0);if(f.b.h>h.top.height+h.bot.height){a.drawImage(h.mid,0,h.top.height,h.mid.width,f.b.h-h.top.height-h.bot.height)}a.drawImage(h.bot,0,f.b.h-h.bot.height)}}else{this.paintBackground(a)}}}});th.Scrollbar=Class.define({type:"Scrollbar",superclass:th.Container,members:{init:function(a){if(!a){a={}}this._super(a);this.orientation=a.orientation||th.VERTICAL;this.value=a.value||0;this.min=a.min||0;this.max=a.max||100;this.extent=a.extent||0.1;this.increment=a.increment||2;this.up=new th.Button({className:"up"});this.down=new th.Button({className:"down"});this.bar=new th.Button({className:"bar"});this.add([this.up,this.down,this.bar]);this.bus.bind("click",this.up,this.scrollup,this);this.bus.bind("click",this.down,this.scrolldown,this);this.bus.bind("mousedrag",this.bar,this.onmousedrag,this);this.bus.bind("mouseup",this.bar,this.onmouseup,this)},onmousedrag:function(j){var h=(this.orientation==th.VERTICAL)?j.clientY:j.clientX;if(this.dragstart_value==undefined){this.dragstart_value=this.value;this.dragstart_mouse=h;return}var l=this.d();var i=h-this.dragstart_mouse;var a=l.b.ih-this.up.bounds.height-this.down.bounds.height-this.bar.bounds.height;var f=(this.max-this.min)/a;this.value=this.dragstart_value+Math.floor(i*f);if(this.value<this.min){this.value=this.min}if(this.value>this.max){this.value=this.max}if(this.scrollable){this.scrollable.scrollTop=this.value}this.render();if(this.scrollable){this.scrollable.repaint()}},onmouseup:function(a){delete this.dragstart_value;delete this.dragstart_mouse},scrollup:function(a){if(this.value>this.min){this.value=Math.max(this.min,this.value-this.increment);if(this.scrollable){this.scrollable.scrollTop=this.value}this.render();if(this.scrollable){this.scrollable.repaint()}}},scrolldown:function(a){if(this.value<this.max){this.value=Math.min(this.max,this.value+this.increment);if(this.scrollable){this.scrollable.scrollTop=this.value}this.render();if(this.scrollable){this.scrollable.repaint()}}},tmb:function(){var d=this.cssValue("-th-vertical-top-image");var a=this.cssValue("-th-vertical-middle-image");var f=this.cssValue("-th-vertical-bottom-image");if(d){d=th.global_resources.images[d]}if(a){a=th.global_resources.images[a]}if(f){f=th.global_resources.images[f]}if(d&&a&&f){return{top:d,mid:a,bot:f}}},getPreferredSize:function(){var h=this.getInsets();var f=h.left+h.right;var l=h.top+h.bottom;var a=this.cssValue("height");if(a!==undefined){a=th.convertLengthToPixels(a,this)}var j=this.cssValue("width");if(j!==undefined){j=th.convertLengthToPixels(j,this)}if(a!==undefined&&j!==undefined){return{width:j+f,height:a+l}}var d=this.tmb();if(d.top&&d.mid&&d.bot){if(a===undefined){a=d.top.height+d.mid.height+d.bot.height}if(j===undefined){j=d.top.width}return{width:j+f,height:a+l}}},layout:function(){var o=this.d();var f=undefined;if(this.scrollable){var s=this.scrollable.bounds.height;f=this.scrollable.getScrollInfo();this.min=0;this.max=f.scrollHeight-s;this.value=f.scrollTop;this.extent=(f.scrollHeight-s)/f.scrollHeight}if(this.max<this.min){for(var l=0;l<this.children.length;l++){delete this.children[l].bounds}return}if(this.orientation==th.VERTICAL){var p=o.b.iw;var m=this.up.getPreferredSize().height;this.up.bounds={x:o.i.l,y:o.i.t,width:p,height:m};this.down.bounds={x:o.i.l,y:o.b.ih-m,width:p,height:m};var q=o.b.ih-this.up.bounds.height-this.down.bounds.height;var n=Math.min(Math.floor(q-(this.extent*q),o.b.ih-this.up.bounds.height-this.down.bounds.height));var a=Math.floor(this.up.bounds.height+Math.min((this.value/(this.max-this.min))*(q-n)));var j=(a+n)-this.down.bounds.y;if(j>0){a-=j;if(this.scrollable){this.value=this.max;this.scrollable.scrollTop=this.value;this.scrollable.repaint()}}this.bar.bounds={x:o.i.l,y:a,width:o.b.iw,height:n}}else{}},paint:function(a){var f=this.d();if(this.max<0){return}var h=this.tmb();if(!h){return}if(h.top){a.drawImage(h.top,f.i.l,this.up.bounds.height)}if(h.mid){a.drawImage(h.mid,f.i.l,this.up.bounds.height+h.top.height,h.mid.width,this.down.bounds.y-this.down.bounds.height-(this.up.bounds.x-this.up.bounds.height))}if(h.bot){a.drawImage(h.bot,f.i.l,this.down.bounds.y-h.bot.height)}this._super(a)}}});th.ResizeNib=Class.define({type:"ResizeNib",superclass:th.Component,members:{init:function(a){this._super(a);this.bus.bind("mousedown",this,this.onmousedown,this);this.bus.bind("mouseup",this,this.onmouseup,this);this.bus.bind("mousedrag",this,this.onmousedrag,this)},onmousedown:function(a){this.startPos={x:a.clientX,y:a.clientY}},onmousedrag:function(a){if(this.startPos){if(!this.firedDragStart){this.bus.fire("dragstart",this.startPos,this);this.firedDragStart=true}this.bus.fire("drag",{startPos:this.startPos,currentPos:{x:a.clientX,y:a.clientY}},this)}},onmouseup:function(a){if(this.startPos&&this.firedDragStart){this.bus.fire("dragstop",{startPos:this.startPos,currentPos:{x:a.clientX,y:a.clientY}},this);delete this.firedDragStart}delete this.startPos},paint:function(q){var l=this.d();if(this.orientation==th.VERTICAL){var n=7;var p=Math.floor((l.b.w/2)-(n/2));var o=7;q.fillStyle=this.cssValue("-th-vertical-bar-shadow-color");for(var j=0;j<3;j++){q.fillRect(p,o,n,1);o+=3}o=8;q.fillStyle=this.cssValue("-th-vertical-bar-color");for(var j=0;j<3;j++){q.fillRect(p,o,n,1);o+=3}}else{var h=7;var a=8;var m=h+2;var p=Math.floor(l.b.w/2-(a/2));var o=Math.floor(l.b.h/2-(m/2));var f=p;if(this.cssValue("-th-horizontal-bar-subtle-shadow-color")){q.fillStyle=this.cssValue("-th-horizontal-bar-subtle-shadow-color");for(var j=0;j<3;j++){q.fillRect(f,o,1,m);f+=3}}f=p+1;q.fillStyle=this.cssValue("-th-horizontal-bar-shadow-color");for(var j=0;j<3;j++){q.fillRect(f,o+m-1,1,1);f+=3}f=p+1;q.fillStyle=this.cssValue("-th-horizontal-bar-color");for(var j=0;j<3;j++){q.fillRect(f,o+1,1,h);f+=3}}}}});th.Splitter=Class.define({type:"Splitter",superclass:th.Panel,members:{init:function(a){this._super(a);this.topNib=new th.ResizeNib({orientation:this.orientation});this.bottomNib=new th.ResizeNib({orientation:this.orientation});this.add(this.topNib,this.bottomNib);this.label=a.label;if(this.label){this.add(this.label)}this.scrollbar=a.scrollbar;if(this.scrollbar){this.add(this.scrollbar)}this.bus.bind("drag",[this.topNib,this.bottomNib],this.ondrag,this);this.bus.bind("dragstart",[this.topNib,this.bottomNib],this.ondragstart,this);this.bus.bind("dragstop",[this.topNib,this.bottomNib],this.ondragstop,this);this.className=(this.orientation==th.VERTICAL)?"vertical":"horizontal"},ondrag:function(a){this.bus.fire("drag",a,this)},ondragstart:function(a){this.bus.fire("dragstart",a,this)},ondragstop:function(a){this.bus.fire("dragstop",a,this)},getPreferredSize:function(){var h=this.getInsets();var f=h.left+h.right;var l=h.top+h.bottom;var d=this.cssValue("height");if(d!==undefined){d=th.convertLengthToPixels(d,this)}var j=this.cssValue("width");if(j!==undefined){j=th.convertLengthToPixels(j,this)}if(d!==undefined&&j!==undefined){return{width:j+f,height:d+l}}if(this.scrollbar&&this.scrollbar.shouldLayout()){var a=this.scrollbar.getPreferredSize();if(a){return{width:a.width+f,height:a.height+l}}}return{width:(j===undefined)?f:j+f,height:(d===undefined)?l:d+l}},layout:function(){var a=this.d();if(!this.orientation){this.orientation=(this.bounds.height>this.bounds.width)?th.HORIZONTAL:th.VERTICAL}if(this.orientation==th.HORIZONTAL){this.topNib.bounds={x:a.i.l,y:a.i.t,height:a.b.iw,width:a.b.iw};this.bottomNib.bounds={x:a.i.l,y:a.b.ih-a.b.iw,height:a.b.iw,width:a.b.iw};if(this.scrollbar&&this.scrollbar.shouldLayout()){this.scrollbar.bounds={x:a.i.l,y:this.topNib.bounds.height,height:a.b.ih-(this.topNib.bounds.height*2),width:a.b.iw}}}else{this.topNib.bounds={x:a.i.l,y:a.i.t,height:a.b.ih,width:a.b.ih};this.bottomNib.bounds={x:a.b.iw-a.b.ih,y:a.i.t,height:a.b.ih,width:a.b.ih};if(this.label){this.label.bounds={x:this.topNib.bounds.x+this.topNib.bounds.width,y:a.i.t,height:a.b.ih,width:a.b.iw-(a.b.ih*2)}}}}}});th.SplitPanelContainer=Class.define({type:"SplitPanelContainer",superclass:th.Panel,members:{init:function(a){this._super(a);this.splitter=new th.Splitter({orientation:this.orientation,label:a.label})},getContents:function(){var a=th.remove(this.children,this.splitter);if(a.length>0){return a[0]}},layout:function(){var f=th.remove(this.children,this.splitter);if(this.children.length==f.length){this.add(this.splitter)}var d=this.splitter.getPreferredSize();var a=(this.orientation==th.HORIZONTAL)?d.width:d.height;if(this.splitter.shouldLayout()){if(this.orientation==th.HORIZONTAL){this.splitter.bounds={x:this.bounds.width-a,y:0,height:this.bounds.height,width:a}}else{this.splitter.bounds={x:0,y:this.bounds.height-a,height:a,width:this.bounds.width}}}else{a=0}if(f.length>0){if(this.orientation==th.HORIZONTAL){f[0].bounds={x:0,y:0,height:this.bounds.height,width:this.bounds.width-a}}else{f[0].bounds={x:0,y:0,height:this.bounds.height-a,width:this.bounds.width}}}}}});th.SplitPanel=Class.define({type:"SplitPanel",superclass:th.Panel,uses:[th.StringHelpers],members:{init:function(a){this._super(a);if(!this.orientation){this.orientation=th.HORIZONTAL}if(!this.regions){this.regions=[{},{}]}},ondragstart:function(d){var a=d.thComponent.parent;a.region.startSize=a.region.size},ondrag:function(d){var a=d.thComponent.parent;var f=(this.orientation==th.HORIZONTAL)?d.currentPos.x-d.startPos.x:d.currentPos.y-d.startPos.y;a.region.size=a.region.startSize+f;this.render()},ondragstop:function(d){var a=d.thComponent.parent;delete a.region.startSize},layout:function(){this.remove(this.children);for(var f=0;f<this.regions.length;f++){var m=this.regions[f];if(!m.container){m.container=new th.SplitPanelContainer({orientation:this.orientation,label:m.label});m.container.region=m;this.bus.bind("dragstart",m.container.splitter,this.ondragstart,this);this.bus.bind("drag",m.container.splitter,this.ondrag,this);this.bus.bind("dragstop",m.container.splitter,this.ondragstop,this)}if(m.contents&&(m.contents!=m.container.getContents())){m.container.removeAll();m.container.add(m.contents)}if(f==this.regions.length-1){m.container.splitter.addCss("display","none")}this.add(m.container)}var n=(this.orientation==th.HORIZONTAL)?this.bounds.width:this.bounds.height;var a=0;for(var f=0;f<this.regions.length;f++){var j=this.regions[f];if(!j.size){j.size=(this.defaultSize||(100/this.regions.length)+"%")}if(this.isPercentage(j.size)){j.size=Math.floor((parseInt(j.size)/100)*n)}if(j.size<30){j.size=30}a+=j.size}if(a>n){var l=a-n;for(var f=this.regions.length-1;f>=0;f--){var j=this.regions[f];var d=j.size;j.size-=l;if(j.size<30){j.size=30}l-=(d-j.size);if(l<=0){break}}}else{if(a<n){var j=this.regions[this.regions.length-1].size+=(n-a)}}var h=0;for(var f=0;f<this.regions.length;f++){var m=this.regions[f];if(this.orientation==th.HORIZONTAL){m.container.bounds={x:h,y:0,width:m.size,height:this.bounds.height}}else{m.container.bounds={x:0,y:h,width:this.bounds.width,height:m.size}}h+=m.size}}}});th.Label=Class.define({type:"Label",superclass:th.Panel,members:{init:function(a){if(!a){a={}}this._super(a);this.text=a.text||""},styleContext:function(a){if(!a){return}a.font=this.cssValue("font");a.fillStyle=this.cssValue("color");return a},getPreferredSize:function(){var d=this.styleContext(this.parent.getScratchContext());var f=this.getInsets();var a=d.measureText(this.text).width+2;a+=f.left+f.right;var j=Math.floor(d.measureText(this.text).ascent*1.5);j+=f.top+f.bottom;return{height:j,width:a}},paint:function(a){this._super(a);var m=this.d();this.styleContext(a);var i=a.measureText(this.text);if(this.text===undefined){this.text=""}var l=this.text;var f=l.length-2;while(i.width>(m.b.w-m.i.w)){if(f<=0){if(this.text.length>1){l="..."}else{l=this.text}break}var j=Math.floor(f/2);var h=j+(f%2);l=this.text.substring(0,j)+"..."+this.text.substring(this.text.length-h);i=a.measureText(l);f-=1}var n=m.i.t+i.ascent;if(th.browser.WebKit){n+=1}a.fillText(l,m.i.l,n)}}});th.ExpandingInfoPanel=Class.define({type:"ExpandingInfoPanel",superclass:th.Panel,members:{init:function(a){this._super(a)},getMinimumRowHeight:function(){return 40},getMinimumColumnWidth:function(){},layout:function(){if(this.children.length==0){return}var q=this.d();var A=Math.floor(Math.sqrt(this.children.length));var y=Math.floor(q.b.h/A);while(y<this.getMinimumRowHeight()&&A>1){A--;y=Math.floor(q.b.h/A)}var v=Math.floor(this.children.length/A);var x=this.children.length%A;var m=0;var a=q.b.h%A;var j=0;for(var o=0;o<A;o++){var p=(o==A-1)?y+a:y;var t=(x>0)?v+1:v;x--;var f=Math.floor(q.b.w/t);var n=q.b.w%t;var l=0;for(var s=0;s<t;s++){var u=(s==t-1)?f+n:f;this.children[m++].bounds={x:l,y:j,width:u,height:p};l+=u}j+=p}}}});th.List=Class.define({type:"List",superclass:th.Container,members:{init:function(a){if(!a){a={}}this._super(a);this.items=a.items||[];this.scrollTop=0;this.allowDeselection=a.allowDeselection||false;this.bus.bind("mousedown",this,this.onmousedown,this);this.renderer=new th.Label();this.renderer.addCss("visibility","hidden");this.add(this.renderer);if(a.topLabel){this.addTopLabel(a.topLabel)}},addTopLabel:function(a){this.label=a;this.label.className="header";this.add(this.label)},onmousedown:function(d){var a=this.getItemForPosition({x:d.componentX,y:d.componentY});if(a!=this.selected){if(a){this.selected=a;this.bus.fire("itemselected",{container:this,item:this.selected},this);this.repaint()}else{if(this.allowDeselection){delete this.selected}}}},selectItemByText:function(f){if(this.items.length==0){return false}var d=null;if(th.isObject(this.items[0])){for(var a=0;a<this.items.length;a++){if(this.items[a].name==f){d=this.items[a];break}}if(d==null){return false}}else{if(this.items.indexOf(f)==-1){return false}d=this.items[this.items.indexOf(f)]}if(this.selected!=d){this.selected=d;this.repaint()}return true},moveSelectionUp:function(){if(!this.selected||this.items.length==0){return}var a=0;while(this.items[a]!=this.selected){a++}if(a!=0){this.selected=this.items[a-1];this.bus.fire("itemselected",{container:this,item:this.selected},this);this.repaint()}},moveSelectionDown:function(){if(!this.selected||this.items.length==0){return}var a=0;while(this.items[a]!=this.selected){a++}if(a!=this.items.length-1){this.selected=this.items[a+1];this.bus.fire("itemselected",{container:this,item:this.selected},this);this.repaint()}},getItemForPosition:function(j){j.y+=this.scrollTop;var f=this.getInsets().top;if(this.label){f+=this.label.bounds.height}for(var a=0;a<this.items.length;a++){var d=this.heights[a];if(j.y>=f&&j.y<=f+d){return this.items[a]}f+=d}},getRenderer:function(a){this.renderer.text=a.item.toString();this.renderer.selected=a.selected;this.renderer.pseudoClass=(this.renderer.selected)?"active":undefined;this.renderer.item=a.item;this.renderer.className=a.even?"even":"odd";if(a.item.contents){this.renderer.className+="more"}this.renderer.resolveCss();return this.renderer},getRenderContext:function(a,d){return{item:a,even:d%2==0,selected:this.selected==a}},getRowHeight:function(){if(!this.rowHeight){var h=this.d();var f=(this.items.length>0)?this.items[0]:undefined;if(f){var a=this.getRenderer(this.getRenderContext(f,0));this.rowHeight=a.getPreferredSize().height}}return this.rowHeight||0},getScrollInfo:function(){return{scrollTop:this.scrollTop,scrollHeight:this.getRowHeight()*this.items.length}},layout:function(){},paint:function(t){var o=this.d();var j=this.getScrollInfo();var l=Math.max(j.scrollHeight,o.b.h);var p=o.i.t;if(this.label){this.label.addCss("visibility","visible");var n=this.label.getPreferredSize().height;this.label.bounds={y:p,x:o.i.l,height:n,width:o.b.w};this.label.paint(t);this.label.border.paint(t);p+=n;this.label.addCss("visibility","hidden")}t.save();t.translate(0,-this.scrollTop);try{this.paintBackground(t,0,p,o.b.w,l);if(this.items.length==0){return}if(!this.renderer){console.log("No renderer for List of type "+this.type+" with id "+this.id+"; cannot paint contents");return}this.heights=[];var f=0;while(p<l){var i=(f<this.items.length);var s=i?this.items[f]:"";var a=this.getRenderer(this.getRenderContext(s,f));if(!a){break}var q=o.b.w-o.i.w;var m=(this.rowHeight)?this.rowHeight:(i)?a.getPreferredSize().height:this.heights[this.heights.length-1];if(i){this.heights.push(m)}if((p+m)>=this.scrollTop){a.bounds={x:0,y:0,height:m,width:q};t.save();t.translate(o.i.l,p);t.beginPath();t.rect(0,0,q,m);t.closePath();t.clip();a.addCss("visibility","visible");a.paint(t);a.border.paint(t);a.addCss("visibility","hidden");t.restore()}f++;p+=m}}finally{t.restore()}}}});th.HorizontalTree=Class.define({type:"HorizontalTree",superclass:th.Panel,members:{init:function(a){if(!a){a={}}this._super(a);this.orientation=th.HORIZONTAL;this.lists=[];this.splitters=[];this.listWidths=[]},setData:function(d){for(var a=0;a<this.lists.length;a++){this.remove(this.lists[a]);this.remove(this.splitters[a]);this.bus.unbind(this.lists[a]);this.bus.unbind(this.splitters[a])}this.lists=[];this.splitters=[];this.data=d;this.showChildren(null,d)},ondragstart:function(d){var a=this.splitters.indexOf(d.thComponent);this.startSize=this.listWidths[a]},ondrag:function(d){var a=this.splitters.indexOf(d.thComponent);var f=(this.orientation==th.HORIZONTAL)?d.currentPos.x-d.startPos.x:d.currentPos.y-d.startPos.y;this.listWidths[a]=this.startSize+f;this.render()},ondragstop:function(a){delete this.startSize},updateData:function(a,d){a.contents=d;if(this.getSelectedItem()==a){this.showChildren(a,a.contents)}},replaceList:function(a,d){this.lists[a].items=d;delete this.lists[a].selected;this.render()},removeListsFrom:function(d){for(var a=d;a<this.lists.length;a++){this.bus.unbind(this.lists[a]);this.bus.unbind(this.splitters[a]);this.remove(this.lists[a]);this.remove(this.splitters[a])}this.lists=this.lists.slice(0,d);this.splitters=this.splitters.slice(0,d)},showChildren:function(f,d){if(this.details){this.remove(this.details);delete this.details}if(!th.isArray(d)){d(this.getSelectedPath(),this);this.render();return}if(!d||d.length==0){return}var i=this.createList(d);if(this.id){i.id=this.id+"-list-"+(this.lists.length+1)}this.bus.bind("itemselected",i,this.itemSelected,this);var a=this;this.bus.bind("dblclick",i,function(j){a.bus.fire("dblclick",j,a)});this.lists.push(i);this.add(i);var h=new th.Splitter({orientation:th.HORIZONTAL,scrollbar:new th.Scrollbar()});h.scrollbar.scrollable=i;h.scrollbar.opaque=false;this.bus.bind("dragstart",h,this.ondragstart,this);this.bus.bind("drag",h,this.ondrag,this);this.bus.bind("dragstop",h,this.ondragstop,this);this.splitters.push(h);this.add(h);if(this.parent){this.render()}},showDetails:function(a){if(this.details){this.remove(this.details)}if(this.parent){this.repaint()}},createList:function(a){var d=new th.List({items:a});if(this.renderer){d.renderer=this.renderer}d.oldGetRenderer=d.getRenderer;d.getRenderer=function(f){var h=d.oldGetRenderer(f);h.text=f.item.name;return h};return d},getSelectedItem:function(){var a=this.getSelectedPath();if(a.length>0){return a[a.length-1]}},getSelectedPath:function(f){f=f||false;var h=[];for(var d=0;d<this.lists.length;d++){if(this.lists[d].selected){h.push(this.lists[d].selected)}else{break}}if(h.length==0){return}if(f){var a="";for(var d=0;d<h.length-1;d++){a+=h[d].name+"/"}if(!h[h.length-1].contents){a+=h[h.length-1].name}else{a+=h[h.length-1].name+"/"}return a}else{return h}return h},itemSelected:function(m){var n=m.thComponent;if(!n.selected){return}var p=[];for(var h=0;h<this.lists.length;h++){p.push(this.lists[h].selected);if(this.lists[h]==n){for(var f=h+1;f<this.lists.length&&this.lists[f].selected;f++){this.lists[f-1].selected.lastSelected=this.lists[f].selected.name;delete this.lists[f].selected}break}}this.bus.fire("itemselected",{e:m},this);if(p.length<this.lists.length){var d=this.lists.slice(0,p.length);var a=this.splitters.slice(0,p.length);for(var o=p.length;o<this.lists.length;o++){this.bus.unbind(this.lists[o]);this.bus.unbind(this.splitters[o]);this.remove(this.lists[o]);this.remove(this.splitters[o])}this.lists=d;this.splitters=a}var l=p[p.length-1];if(l&&l.contents){this.showChildren(l,l.contents)}else{this.showDetails(l)}},getItem:function(f){var a=this.data;var h;for(var d=0;d<f.length;d++){for(var j=0;j<a.length;j++){if(a[j]==f[d]){h=a[j];a=h.contents;break}}}return h},layout:function(){var m=this.d();var a=m.i.l;for(var h=0;h<this.lists.length;h++){var l=this.lists[h];if(!this.listWidths){this.listWidths=[]}if(!this.listWidths[h]){this.listWidths[h]=th.convertLengthToPixels(this.cssValue("-th-list-width"),this)}var f=this.listWidths[h];l.bounds={x:a,y:m.i.t,width:f,height:m.b.h-m.i.h};a+=f;var j=this.splitters[h];f=j.getPreferredSize().width;j.bounds={x:a,y:m.i.t,width:f,height:m.b.h-m.i.h};a+=f}if(this.details){this.details.bounds={x:a,y:m.i.t,width:th.convertLengthToPixels(this.cssValue("-th-default-width"),this),height:m.b.h-m.i.h}}},paintSelf:function(a){this._super(a)}}});th.DEFAULT_CSS="#root {/* this should probably be the browser's default font */font: 10pt Arial, sans-serif;}Scrollbar {/*-th-vertical-top-image: url(/images/dash_vscroll_track_top.png);*//*-th-vertical-middle-image: url(/images/dash_vscroll_track_middle.png);*//*-th-vertical-bottom-image: url(/images/dash_vscroll_track_bottom.png);*/-th-vertical-top-image: url(/images/scroll_gutter_top.png);-th-vertical-middle-image: url(/images/scroll_gutter_mid.png);-th-vertical-bottom-image: url(/images/scroll_gutter_btm.png);}Scrollbar > Button.bar {-th-top-image: url(/images/scroll_thumb_top.png);-th-middle-image: url(/images/scroll_thumb_mid.png);-th-bottom-image: url(/images/scroll_thumb_btm.png);}Scrollbar > Button.up {background-image: url(/images/scroll_cntrl_up.png);}Scrollbar > Button.down {background-image: url(/images/scroll_cntrl_dwn.png);}ResizeNib {-th-vertical-bar-color: rgb(10, 10, 8);-th-vertical-bar-shadow-color: rgb(185, 180, 158);-th-horizontal-bar-subtle-shadow-color: rgba(0, 0, 0, 0.1);-th-horizontal-bar-shadow-color: black;-th-horizontal-bar-color: rgb(183, 180, 160);}Label {padding: 2px 5px;}HorizontalTree {-th-list-width: 160px;-th-details-width: 150px;}Splitter.vertical {height: 20px;}Splitter.horizontal {width: 17px;";if(typeof th=="undefined"){th={}}th.Hashtable=(function(){function h(F){return(typeof F==="undefined")}function a(F){return(typeof F==="function")}function p(F){return(typeof F==="string")}function s(G,F){return a(G[F])}function B(F){return s(F,"equals")}function x(F){return s(F,"hashCode")}function D(G){if(p(G)){return G}else{if(x(G)){var F=G.hashCode();if(!p(F)){return D(F)}return F}else{if(s(G,"toString")){return G.toString()}else{return String(G)}}}}function A(F,G){return F.equals(G)}function i(F,G){if(B(G)){return G.equals(F)}else{return F===G}}function d(G,F){return G===F}function v(G,L,I,M,H){var K;for(var J=0,F=G.length;J<F;J++){K=G[J];if(H(L,I(K))){return M?[J,K]:true}}return false}function z(I,H){if(s(I,"splice")){I.splice(H,1)}else{if(H===I.length-1){I.length=H}else{var G=I.slice(H+1);I.length=H;for(var J=0,F=G.length;J<F;J++){I[H+J]=G[J]}}}}function E(G,F){if(G===null){throw new Error("null is not a valid "+F)}else{if(h(G)){throw new Error(F+" must not be undefined")}}}var n="key",f="value";function m(F){E(F,n)}function j(F){E(F,f)}function o(G,H,F){this.entries=[];this.addEntry(G,H);if(F!==null){this.getEqualityFunction=function(){return F}}}function C(F){return F[0]}function q(F){return F[1]}o.prototype={getEqualityFunction:function(F){if(B(F)){return A}else{return i}},searchForEntry:function(F){return v(this.entries,F,C,true,this.getEqualityFunction(F))},getEntryForKey:function(F){return this.searchForEntry(F)[1]},getEntryIndexForKey:function(F){return this.searchForEntry(F)[0]},removeEntryForKey:function(G){var F=this.searchForEntry(G);if(F){z(this.entries,F[0]);return true}return false},addEntry:function(F,G){this.entries[this.entries.length]=[F,G]},size:function(){return this.entries.length},keys:function(H){var I=H.length;for(var G=0,F=this.entries.length;G<F;G++){H[I+G]=this.entries[G][0]}},values:function(G){var I=G.length;for(var H=0,F=this.entries.length;H<F;H++){G[I+H]=this.entries[H][1]}},containsKey:function(F){return v(this.entries,F,C,false,this.getEqualityFunction(F))},containsValue:function(F){return v(this.entries,F,q,false,d)}};function y(){}y.prototype=[];function u(F){return F[0]}function l(H,F,G){return v(H,F,u,true,G)}function w(G,F){var H=G[F];if(H&&(H instanceof y)){return H[1]}return null}function t(H,G){var I=[];var F={};H=a(H)?H:D;G=a(G)?G:null;this.put=function(L,N){m(L);j(N);var J=H(L);var O=w(F,J);if(O){var K=O.getEntryForKey(L);if(K){K[1]=N}else{O.addEntry(L,N)}}else{var M=new y();M[0]=J;M[1]=new o(L,N,G);I[I.length]=M;F[J]=M}};this.get=function(L){m(L);var J=H(L);var M=w(F,J);if(M){var K=M.getEntryForKey(L);if(K){return K[1]}}return null};this.containsKey=function(K){m(K);var J=H(K);var L=w(F,J);if(L){return L.containsKey(K)}return false};this.containsValue=function(L){j(L);for(var K=0,J=I.length;K<J;K++){if(I[K][1].containsValue(L)){return true}}return false};this.clear=function(){I.length=0;F={}};this.isEmpty=function(){return I.length===0};this.keys=function(){var L=[];for(var K=0,J=I.length;K<J;K++){I[K][1].keys(L)}return L};this.values=function(){var K=[];for(var L=0,J=I.length;L<J;L++){I[L][1].values(K)}return K};this.remove=function(L){m(L);var K=H(L);var M=w(F,K);if(M){if(M.removeEntryForKey(L)){if(M.size()===0){var J=l(I,K,M.getEqualityFunction(L));z(I,J[0]);delete F[K]}}}};this.size=function(){var L=0;for(var K=0,J=I.length;K<J;K++){L+=I[K][1].size()}return L}}return t})();if(typeof th=="undefined"){th={}}if(typeof th.formlayout=="undefined"){th.formlayout={}}th.formlayout.Exception=Class.define({members:{init:function(a){this.message=a},toString:function(){return this.message}}});th.formlayout.IllegalArgumentException=Class.define({superclass:th.formlayout.Exception,members:{init:function(a){this._super(a)}}});th.formlayout.IndexOutOfBoundsException=Class.define({superclass:th.formlayout.Exception,members:{init:function(a){this._super(a)}}});th.formlayout.FormLayoutParseException=Class.define({superclass:th.formlayout.Exception,members:{init:function(a){this._super(a)}}});th.formlayout.Unit=Class.define({members:{init:function(a,h,f,d){this.name=a;this.abbreviation=h;this.parseAbbreviation=f;this.requiresIntegers=d},toString:function(){return this.name},encode:function(){return this.parseAbbreviation||this.abbreviation},abbreviation:function(){return this.abbreviation}}});th.formlayout.Unit.valueOf=function(f,d){if(f.length==0){var a=th.formlayout.Sizes.getDefaultUnit();if(a){return a}return d?th.formlayout.ConstantSize.DIALOG_UNITS_X:th.formlayout.ConstantSize.DIALOG_UNITS_Y}else{if(f=="px"){return th.formlayout.ConstantSize.PIXEL}else{if(f=="dlu"){return d?th.formlayout.ConstantSize.DIALOG_UNITS_X:th.formlayout.ConstantSize.DIALOG_UNITS_Y}else{if(f=="em"){return th.formlayout.ConstantSize.EM}else{if(f=="pt"){return th.formlayout.ConstantSize.POINT}else{if(f=="in"){return th.formlayout.ConstantSize.INCH}else{if(f=="mm"){return th.formlayout.ConstantSize.MILLIMETER}else{if(f=="cm"){return th.formlayout.ConstantSize.CENTIMETER}else{throw"Invalid unit name '"+f+"'. Must be one of: px, dlu, pt, mm, cm, in"}}}}}}}}};th.formlayout.FormLayout=Class.define({members:{init:function(f,d){if(th.isString(f)){f=th.formlayout.ColumnSpec.decodeSpecs(f)}if(th.isString(d)){d=th.formlayout.RowSpec.decodeSpecs(d)}this.colSpecs=f;this.rowSpecs=d;this.colGroupIndices=[];this.rowGroupIndices=[];this.constraintMap=new th.Hashtable();this.componentSizeCache=new th.formlayout.ComponentSizeCache();var a=this;this.minimumWidthMeasure=function(h){return a.componentSizeCache.getMinimumSize(h).width};this.minimumHeightMeasure=function(h){return a.componentSizeCache.getMinimumSize(h).height};this.preferredWidthMeasure=function(h){return a.componentSizeCache.getPreferredSize(h).width};this.preferredHeightMeasure=function(h){return a.componentSizeCache.getPreferredSize(h).height}},getColumnCount:function(){return this.colSpecs.length},getColumnSpec:function(a){return this.colSpecs[a-1]},setColumnSpec:function(d,a){this.colSpecs[d-1]=a},appendColumn:function(a){this.colSpecs.push(a)},insertColumn:function(d,a){if(d<1||d>this.getColumnCount()){throw"The column index "+d+"must be in the range [1, "+this.getColumnCount()+"]."}this.colSpecs[d-1]=a;this.shiftComponentsHorizontally(d,false);this.adjustGroupIndices(this.colGroupIndices,d,false)},removeColumn:function(a){if(a<1||a>this.getColumnCount()){throw"The column index "+a+" must be in the range [1, "+this.getColumnCount()+"]."}this.colSpecs.remove(a-1);this.shiftComponentsHorizontally(a,true);this.adjustGroupIndices(this.colGroupIndices,a,true)},getRowCount:function(){return this.rowSpecs.length},getRowSpec:function(a){return this.rowSpecs[a-1]},setRowSpec:function(d,a){this.rowSpecs[d-1]=a},appendRow:function(a){this.rowSpecs.push(a)},insertRow:function(d,a){if(d<1||d>this.getRowCount()){throw"The row index "+d+" must be in the range [1, "+this.getRowCount()+"]."}this.rowSpecs.add(d-1,a);this.shiftComponentsVertically(d,false);this.adjustGroupIndices(this.rowGroupIndices,d,false)},removeRow:function(a){if(a<1||a>this.getRowCount()){throw"The row index "+a+"must be in the range [1, "+this.getRowCount()+"]."}this.rowSpecs.remove(a-1);this.shiftComponentsVertically(a,true);this.adjustGroupIndices(this.rowGroupIndices,a,true)},shiftComponentsHorizontally:function(d,a){var h=a?-1:1;var f=this.constraintMap.keys();th.forEach(f,function(m){var n=this.constraintMap.get(m);var l=n.gridX;var i=n.gridWidth;var j=l+i-1;if(l==d&&a){throw"The removed column "+d+" must not contain component origins.\nIllegal component="+m}else{if(l>=d){n.gridX+=h}else{if(j>=d){n.gridWidth+=h}}}})},shiftComponentsVertically:function(h,a){var f=a?-1:1;var d=this.constraintMap.keys();th.forEach(d,function(j){var n=this.constraintMap.get(j);var m=n.gridY;var l=n.gridHeight;var i=m+l-1;if(m==h&&a){throw"The removed row "+h+" must not contain component origins.\nIllegal component="+j}else{if(m>=h){n.gridY+=f}else{if(i>=h){n.gridHeight+=f}}}})},adjustGroupIndices:function(j,d,a){var n=a?-1:+1;for(var l=0;l<j.length;l++){var m=j[l];for(var h=0;h<m.length;h++){var f=m[h];if(f==d&&a){throw"The removed index "+d+" must not be grouped."}else{if(f>=d){m[h]+=n}}}}},getConstraints:function(a){return this.constraintMap.get(a)},setConstraints:function(a,d){d.ensureValidGridBounds(this.getColumnCount(),this.getRowCount());this.constraintMap.put(a,d)},removeConstraints:function(a){this.constraintMap.remove(a);this.componentSizeCache.removeEntry(a)},getColumnGroups:function(){return this.colGroupIndices},setColumnGroups:function(i){var a=this.getColumnCount();var l=[];for(var h=0;h<this.colGroupIndices.length;h++){for(var f=0;f<this.colGroupIndices[h].length;f++){var d=this.colGroupIndices[h][f];if(d<1||d>a){throw"Invalid column group index "+d+" in group "+(h+1)}if(l[d]){throw"Column index "+d+" must not be used in multiple column groups."}l[d]=true}}this.colGroupIndices=i},addGroupedColumn:function(j){var h=this.getColumnGroups();if(h.length==0){h=[0][j]}else{var f=h.length-1;var i=h[f];var a=i.length;var d=i.slice(0,a);d[a]=j;h[f]=d}this.setColumnGroups(h)},getRowGroups:function(){return this.rowGroupIndices},setRowGroups:function(h){var a=this.getRowCount();var m=[];for(var f=0;f<this.rowGroupIndices.length;f++){for(var d=0;d<this.rowGroupIndices[f].length;d++){var l=this.rowGroupIndices[f][d];if(l<1||l>a){throw"Invalid row group index "+l+" in group "+(f+1)}if(m[l]){throw"Row index "+l+" must not be used in multiple row groups."}m[l]=true}}this.rowGroupIndices=h},addGroupedRow:function(j){var h=this.getRowGroups();if(h.length==0){h=[0][j]}else{var f=h.length-1;var i=h[f];var a=i.length;var d=i.slice(0,a);d[a]=j;h[f]=d}this.setRowGroups(h)},getHonorsVisibility:function(){return this.honorsVisibility},setHonorsVisibility:function(a){var i=this.getHonorsVisibility();if(i==a){return}this.honorsVisibility=a;var h=this.constraintMap.keys();if(h.length==0){return}var f=h[0];var d=f.parent;if(d){d.render()}},setHonorsVisibilityForComponent:function(d,a){var f=this.getConstraints(d);if(a==f.honorsVisibility){return}f.honorsVisibility=a;if(d.parent){d.parent.render()}},addLayoutComponent:function(a,d){if(th.isString(d)){this.setConstraints(a,new th.formlayout.CellConstraints(d))}else{this.setConstraints(a,d)}},removeLayoutComponent:function(a){this.removeConstraints(a)},getMinimumSize:function(a){return this.computeLayoutSize(a,this.minimumWidthMeasure,this.minimumHeightMeasure)},getPreferredSize:function(a){return this.computeLayoutSize(a,this.preferredWidthMeasure,this.preferredHeightMeasure)},getMaximumSize:function(a){return{width:1000000,height:1000000}},invalidateLayout:function(a){this.invalidateCaches()},layout:function(j){this.initializeColAndRowComponentLists();var i=j.getSize();var f=j.getInsets();var d=i.width-f.left-f.right;var h=i.height-f.top-f.bottom;var a=this.computeGridOrigins(j,d,f.left,this.colSpecs,this.colComponents,this.colGroupIndices,this.minimumWidthMeasure,this.preferredWidthMeasure);var l=this.computeGridOrigins(j,h,f.top,this.rowSpecs,this.rowComponents,this.rowGroupIndices,this.minimumHeightMeasure,this.preferredHeightMeasure);this.layoutComponents(a,l)},initializeColAndRowComponentLists:function(){this.colComponents=[];for(var a=0;a<this.getColumnCount();a++){this.colComponents[a]=[]}this.rowComponents=[];for(var a=0;a<this.getRowCount();a++){this.rowComponents[a]=[]}var d=this.constraintMap.keys();th.forEach(d,function(f){var h=this.constraintMap.get(f);if(this.takeIntoAccount(f,h)){if(h.gridWidth==1){this.colComponents[h.gridX-1].push(f)}if(h.gridHeight==1){this.rowComponents[h.gridY-1].push(f)}}},this)},computeLayoutSize:function(j,h,y){this.initializeColAndRowComponentLists();var z=this.maximumSizes(j,this.colSpecs,this.colComponents,this.minimumWidthMeasure,this.preferredWidthMeasure,h);var x=this.maximumSizes(j,this.rowSpecs,this.rowComponents,this.minimumHeightMeasure,this.preferredHeightMeasure,y);var t=this.groupedSizes(this.colGroupIndices,z);var p=this.groupedSizes(this.rowGroupIndices,x);var a=this.computeOrigins(t,0);var l=this.computeOrigins(p,0);var w=this.sum(t);var i=this.sum(p);var v=w;var s=i;var d=this.computeMaximumFixedSpanTable(this.colSpecs);var f=this.computeMaximumFixedSpanTable(this.rowSpecs);var m=this.constraintMap.keys();var o=this;th.forEach(m,function(I){var F=o.constraintMap.get(I);if(!o.takeIntoAccount(I,F)){return}if((F.gridWidth>1)&&(F.gridWidth>d[F.gridX-1])){var G=h(I);var E=F.gridX-1;var D=E+F.gridWidth;var H=a[E];var A=w-a[D];var C=H+G+A;if(C>v){v=C}}if((F.gridHeight>1)&&(F.gridHeight>f[F.gridY-1])){var L=y(I);var K=F.gridY-1;var J=K+F.gridHeight;var H=l[K];var A=i-l[J];var B=H+L+A;if(B>s){s=B}}});var u=j.getInsets();var q=v+u.left+u.right;var n=s+u.top+u.bottom;return{width:q,height:n}},computeGridOrigins:function(n,p,i,o,h,m,t,j){var x=this.maximumSizes(n,o,h,t,j,t);var d=this.maximumSizes(n,o,h,t,j,j);var u=this.groupedSizes(m,x);var w=this.groupedSizes(m,d);var v=this.sum(u);var s=this.sum(w);var l=this.compressedSizes(o,p,v,s,u,d);var q=this.groupedSizes(m,l);var f=this.sum(q);var a=this.distributedSizes(o,p,f,q);return this.computeOrigins(a,i)},computeOrigins:function(f,j){var d=f.length;var h=[];h[0]=j;for(var a=1;a<=d;a++){h[a]=h[a-1]+f[a-1]}return h},layoutComponents:function(a,f){var d=this.constraintMap.keys();th.forEach(d,function(i){var l={};var o=this.constraintMap.get(i);var h=o.gridX-1;var n=o.gridY-1;var m=o.gridWidth;var j=o.gridHeight;l.x=a[h];l.y=f[n];l.width=a[h+m]-l.x;l.height=f[n+j]-l.y;o.setBounds(i,this,l,this.minimumWidthMeasure,this.minimumHeightMeasure,this.preferredWidthMeasure,this.preferredHeightMeasure)},this)},invalidateCaches:function(){this.componentSizeCache.invalidate()},maximumSizes:function(a,j,m,d,l,h){var o=j.length;var p=[];for(var f=0;f<o;f++){var n=j[f];p[f]=n.maximumSize(a,m[f],d,l,h)}return p},compressedSizes:function(h,o,l,n,s,p){if(o<l){return s}if(o>=n){return p}var j=h.length;var t=[];var a=n-o;var q=n-l;var d=a/q;for(var f=0;f<j;f++){var m=h[f];t[f]=p[f];if(m.getSize().compressible()){t[f]-=Math.round((p[f]-s[f])*d)}}return t},groupedSizes:function(a,j){if(!a||a.length==0){return j}var h=[];for(var f=0;f<h.length;f++){h[f]=j[f]}for(var l=0;l<a.length;l++){var m=a[l];var n=0;for(var f=0;f<m.length;f++){var d=m[f]-1;n=Math.max(n,h[d])}for(var f=0;f<m.length;f++){var d=m[f]-1;h[d]=n}}return h},distributedSizes:function(n,v,u,h){var w=v-u;if(w<0){return h}var p=n.length;var f=0;for(var j=0;j<p;j++){var q=n[j];f+=q.getResizeWeight()}if(f==0){return h}var x=[];var d=w;var t=parseInt(w);for(var j=0;j<p;j++){var q=n[j];var m=q.getResizeWeight();if(m==th.formlayout.FormSpec.NO_GROW){x[j]=h[j]}else{var o=d-t;var a=w*m/f;var l=a-o;var s=Math.round(l);x[j]=h[j]+s;d-=a;t-=s}}return x},computeMaximumFixedSpanTable:function(l){var f=l.length;var h=[];var j=1000000;for(var d=f-1;d>=0;d--){var a=l[d];if(a.canGrow()){j=0}h[d]=j;if(j<1000000){j++}}return h},sum:function(f){var d=0;for(var a=f.length-1;a>=0;a--){d+=f[a]}return d},takeIntoAccount:function(a,d){return a.cssValue("visibility")!="hidden"||((!d.honorsVisibility)&&!this.getHonorsVisibility())||!d.honorsVisibility},getLayoutInfo:function(j){this.initializeColAndRowComponentLists();var i=j.getSize();var f=j.getInsets();var d=i.width-f.left-f.right;var h=i.height-f.top-f.bottom;var a=this.computeGridOrigins(j,d,f.left,this.colSpecs,this.colComponents,this.colGroupIndices,this.minimumWidthMeasure,this.preferredWidthMeasure);var l=this.computeGridOrigins(j,h,f.top,this.rowSpecs,this.rowComponents,this.rowGroupIndices,this.minimumHeightMeasure,this.preferredHeightMeasure);return new th.formlayout.LayoutInfo(a,l)}}});th.formlayout.LayoutInfo=Class.define({members:{init:function(d,a){this.columnOrigins=d;this.rowOrigins=a},getX:function(){return this.columnOrigins[0]},getY:function(){return this.rowOrigins[0]},getWidth:function(){return this.columnOrigins[this.columnOrigins.length-1]-this.columnOrigins[0]},getHeight:function(){return this.rowOrigins[this.rowOrigins.length-1]-this.rowOrigins[0]}}});th.formlayout.ComponentSizeCache=Class.define({members:{init:function(){this.minimumSizes=new th.Hashtable();this.preferredSizes=new th.Hashtable()},invalidate:function(){this.minimumSizes.clear();this.preferredSizes.clear()},getSize:function(a,h,f){var d=h.get(a);if(!d){d=a[f]();h.put(a,d)}return d},getMinimumSize:function(a){return this.getSize(a,this.minimumSizes,"getMinimumSize")},getPreferredSize:function(a){return this.getSize(a,this.preferredSizes,"getPreferredSize")},removeEntry:function(a){this.minimumSizes.remove(a);this.preferredSizes.remove(a)}}});th.formlayout.FormSpec=Class.define({members:{NO_GROW:0,DEFAULT_GROW:1,spacer:false,init:function(f,a,d){this.defaultAlignment=f;this.size=a;this.resizeWeight=d||0},isSpacer:function(){return this.spacer},getDefaultAlignment:function(){return this.defaultAlignment},getSize:function(){return this.size},getResizeWeight:function(){return this.resizeWeight},canGrow:function(){return this.resizeWeight!=this.NO_GROW},isHorizontal:function(){throw"This needs to be overridden."},setDefaultAlignment:function(a){this.defaultAlignment=a},setSize:function(a){this.size=a},setResizeWeight:function(a){this.resizeWeight=a},maximumSize:function(d,h,a,i,f){return this.size.maximumSize(d,h,a,i,f)},parseAndInitValues:function(h){if(h.indexOf("spacer(")==0){h=h.substring("spacer(".length,h.length-1);this.spacer=true}var d=h.split(":");if(d.length==0){throw new th.formlayout.IllegalArgumentException("The form spec must not be empty.")}var a=0;var f=d[a++];var i=th.formlayout.DefaultAlignment.valueOf(f,this.isHorizontal());if(i){this.setDefaultAlignment(i);if(d.length==1){throw new th.formlayout.IllegalArgumentException("The form spec must provide a size.")}f=d[a++]}this.setSize(this.parseSize(f));if(a<d.length){this.setResizeWeight(this.parseResizeWeight(d[a]))}},parseSize:function(a){if(a.indexOf("[")==0&&a.indexOf("]")==a.length-1){return this.parseBoundedSize(a)}if(a.indexOf("max(")==0&&a.indexOf(")")==a.length-1){return this.parseOldBoundedSize(a,false)}if(a.indexOf("min(")==0&&a.indexOf(")")==a.length-1){return this.parseOldBoundedSize(a,true)}return this.parseAtomicSize(a)},parseBoundedSize:function(d){var j=d.substring(1,d.length-1);var m=j.split(/\s*,\s*/);var l=undefined;var a=undefined;var h=undefined;if(m.length==2){var i=this.parseAtomicSize(m[0]);var f=this.parseAtomicSize(m[1]);if(this.isConstant(i)){if(this.isConstant(f)){a=i;l=f;h=f}else{a=i;l=f}}else{l=i;h=f}}else{if(m.length==3){a=this.parseAtomicSize(m[0]);l=this.parseAtomicSize(m[1]);h=this.parseAtomicSize(m[2])}}if(((a==null)||(this.isConstant(a)))&&((h==null)||(this.isConstant(h)))){return new th.formlayout.BoundedSize(l,a,h)}throw new th.formlayout.IllegalArgumentException("Illegal bounded size '"+d+"'. Must be one of:\n[<constant size>,<logical size>]                 // lower bound\n[<logical size>,<constant size>]                 // upper bound\n[<constant size>,<logical size>,<constant size>] // lower and upper bound.\nExamples:\n[50dlu,pref]                                     // lower bound\n[pref,200dlu]                                    // upper bound\n[50dlu,pref,200dlu]                              // lower and upper bound.")},parseAtomicSize:function(f){var a=th.trim(f);if(a.indexOf("'")==0&&a.indexOf("'")==a.length-1){var h=a.length;if(h<2){throw new th.formlayout.IllegalArgumentException('Missing closing "\'" for prototype.')}return new th.formlayout.PrototypeSize(a.substring(1,h-1))}var d=th.formlayout.ComponentSize.valueOf(a);if(d!=null){return d}return th.formlayout.ConstantSize.valueOf(a,this.isHorizontal())},parseResizeWeight:function(d){if(d=="g"||d=="grow"){return th.formlayout.FormSpec.DEFAULT_GROW}if(d=="n"||d=="nogrow"||d=="none"){return th.formlayout.FormSpec.NO_GROW}if((d.indexOf("grow(")==0||d.indexOf("g(")==0)&&d.indexOf(")")==d.length-1){var f=d.indexOf("(");var h=d.indexOf(")");var a=d.substring(f+1,h);return parseFloat(a)}throw new th.formlayout.IllegalArgumentException("The resize argument '"+d+"' is invalid.  Must be one of: grow, g, none, n, grow(<double>), g(<double>)")},isConstant:function(a){return(a instanceof th.formlayout.ConstantSize)||(a instanceof th.formlayout.PrototypeSize)},toString:function(){buffer=this.defaultAlignment;buffer+=":";buffer+=this.size.toString();buffer+=":";if(this.resizeWeight==th.formlayout.FormSpec.NO_GROW){buffer+="noGrow"}else{if(this.resizeWeight==th.formlayout.FormSpec.DEFAULT_GROW){buffer+="grow"}else{buffer+="grow(";buffer+=this.resizeWeight;buffer+=")"}}return buffer},toShortString:function(){buffer=this.defaultAlignment.abbreviation();buffer+=":";buffer+=this.size.toString();buffer+=":";if(this.resizeWeight==th.formlayout.FormSpec.NO_GROW){buffer+="n"}else{if(this.resizeWeight==th.formlayout.FormSpec.DEFAULT_GROW){buffer+="g"}else{buffer+="g(";buffer+=this.resizeWeight;buffer+=")"}}return buffer},encode:function(){var a="";var d=this.isHorizontal()?th.formlayout.ColumnSpec.DEFAULT:th.formlayout.RowSpec.DEFAULT;if(!d.equals(this.defaultAlignment)){a+=this.defaultAlignment.abbreviation();a+=":"}a+=this.size.encode();if(this.resizeWeight==th.formlayout.FormSpec.NO_GROW){}else{if(this.resizeWeight==th.formlayout.FormSpec.DEFAULT_GROW){a+=":";a+="g"}else{a+=":";a+="g(";a+=this.resizeWeight;a+=")"}}return a}}});th.formlayout.DefaultAlignment=Class.define({members:{init:function(a){this.name=a},toString:function(){return this.name},abbreviation:function(){return this.name.charAt(0)}}});th.formlayout.DefaultAlignment.valueOf=function(d,a){if(d=="f"||d=="fill"){return th.formlayout.FormSpec.FILL_ALIGN}else{if(d=="c"||d=="center"){return th.formlayout.FormSpec.CENTER_ALIGN}else{if(a){if(d=="r"||d=="right"){return th.formlayout.FormSpec.RIGHT_ALIGN}else{if(d=="l"||d=="left"){return th.formlayout.FormSpec.LEFT_ALIGN}else{return}}}else{if(d=="t"||d=="top"){return th.formlayout.FormSpec.TOP_ALIGN}else{if(d=="b"||d=="bottom"){return th.formlayout.FormSpec.BOTTOM_ALIGN}else{return}}}}}};th.formlayout.FormSpec.LEFT_ALIGN=new th.formlayout.DefaultAlignment("left");th.formlayout.FormSpec.RIGHT_ALIGN=new th.formlayout.DefaultAlignment("right");th.formlayout.FormSpec.TOP_ALIGN=new th.formlayout.DefaultAlignment("top");th.formlayout.FormSpec.BOTTOM_ALIGN=new th.formlayout.DefaultAlignment("bottom");th.formlayout.FormSpec.CENTER_ALIGN=new th.formlayout.DefaultAlignment("center");th.formlayout.FormSpec.FILL_ALIGN=new th.formlayout.DefaultAlignment("fill");th.formlayout.ColumnSpec=Class.define({superclass:th.formlayout.FormSpec,members:{init:function(f,a,d){this._super(f,a,d)},isHorizontal:function(){return true}}});th.formlayout.ColumnSpec.decode=function(a,h){var f=th.trim(a);var d=f.toLowerCase();return th.formlayout.ColumnSpec.decodeExpanded(d)};th.formlayout.ColumnSpec.decodeExpanded=function(d){var a=th.formlayout.ColumnSpec.CACHE.get(d);if(!a){a=new th.formlayout.ColumnSpec(th.formlayout.ColumnSpec.DEFAULT,th.formlayout.Sizes.DEFAULT,th.formlayout.FormSpec.NO_GROW);a.parseAndInitValues(d);th.formlayout.ColumnSpec.CACHE.put(d,a)}return a};th.formlayout.ColumnSpec.decodeSpecs=function(a,d){return th.formlayout.FormSpecParser.parseColumnSpecs(a,d)};th.formlayout.ColumnSpec.createGap=function(a){return new th.formlayout.RowSpec(th.formlayout.ColumnSpec.DEFAULT,a,th.formlayout.ColumnSpec.NO_GROW)};th.formlayout.ColumnSpec.LEFT=th.formlayout.FormSpec.LEFT_ALIGN;th.formlayout.ColumnSpec.CENTER=th.formlayout.FormSpec.CENTER_ALIGN;th.formlayout.ColumnSpec.MIDDLE=th.formlayout.ColumnSpec.CENTER;th.formlayout.ColumnSpec.RIGHT=th.formlayout.FormSpec.RIGHT_ALIGN;th.formlayout.ColumnSpec.FILL=th.formlayout.FormSpec.FILL_ALIGN;th.formlayout.ColumnSpec.DEFAULT=th.formlayout.ColumnSpec.FILL;th.formlayout.ColumnSpec.CACHE=new th.Hashtable();th.formlayout.RowSpec=Class.define({superclass:th.formlayout.FormSpec,members:{init:function(f,a,d){this._super(f,a,d)},isHorizontal:function(){return false}}});th.formlayout.RowSpec.decode=function(d,h){var f=th.trim(d);var a=f.toLowerCase();return th.formlayout.RowSpec.decodeExpanded(a)};th.formlayout.RowSpec.decodeExpanded=function(d){var a=th.formlayout.RowSpec.CACHE.get(d);if(!a){a=new th.formlayout.RowSpec(th.formlayout.RowSpec.DEFAULT,th.formlayout.Sizes.DEFAULT,th.formlayout.FormSpec.NO_GROW);a.parseAndInitValues(d);th.formlayout.RowSpec.CACHE.put(d,a)}return a};th.formlayout.RowSpec.decodeSpecs=function(a,d){return th.formlayout.FormSpecParser.parseRowSpecs(a,d)};th.formlayout.RowSpec.createGap=function(a){return new th.formlayout.RowSpec(th.formlayout.RowSpec.DEFAULT,a,th.formlayout.RowSpec.NO_GROW)};th.formlayout.RowSpec.TOP=th.formlayout.FormSpec.TOP_ALIGN;th.formlayout.RowSpec.CENTER=th.formlayout.FormSpec.CENTER_ALIGN;th.formlayout.RowSpec.BOTTOM=th.formlayout.FormSpec.BOTTOM_ALIGN;th.formlayout.RowSpec.FILL=th.formlayout.FormSpec.FILL_ALIGN;th.formlayout.RowSpec.DEFAULT=th.formlayout.RowSpec.CENTER;th.formlayout.RowSpec.CACHE=new th.Hashtable();th.formlayout.BoundedSize=Class.define({members:{init:function(d,f,a){this.basis=d;this.lowerBound=f;this.upperBound=a},getBasis:function(){return this.basis},getLowerBound:function(){return this.lowerBound},getUpperBound:function(){return this.upperBound},maximumSize:function(d,i,a,j,f){var h=this.basis.maximumSize(d,i,a,j,f);if(this.lowerBound){h=Math.max(h,this.lowerBound.maximumSize(d,i,a,j,f))}if(this.upperBound){h=Math.min(h,this.upperBound.maximumSize(d,i,a,j,f))}return h},compressible:function(){return this.basis.compressible()},equals:function(a){if(this===a){return true}var d=a;return this.basis.equals(d.basis)&&((this.lowerBound==null&&d.lowerBound==null)||(this.lowerBound!=null&&this.lowerBound.equals(d.lowerBound)))&&((this.upperBound==null&&d.upperBound==null)||(this.upperBound!=null&&this.upperBound.equals(d.upperBound)))},hashCode:function(){var a=this.basis.hashCode();if(this.lowerBound){a=a*37+this.lowerBound.hashCode()}if(this.upperBound){a=a*37+this.upperBound.hashCode()}return a}}});th.formlayout.ConstantSize=Class.define({members:{init:function(d,a){this.value=d;this.unit=a},getValue:function(){return this.value},getUnit:function(){return this.unit},getPixelSize:function(a){if(this.unit==th.formlayout.ConstantSize.PIXEL){return this.intValue()}else{if(this.unit==th.formlayout.ConstantSize.EM){return th.formlayout.Sizes.emAsPixel(this.value,a)}else{if(this.unit==th.formlayout.ConstantSize.POINT){return th.formlayout.Sizes.pointAsPixel(this.intValue(),a)}else{if(this.unit==th.formlayout.ConstantSize.INCH){return th.formlayout.Sizes.inchAsPixel(this.value,a)}else{if(this.unit==th.formlayout.ConstantSize.MILLIMETER){return th.formlayout.Sizes.millimeterAsPixel(this.value,a)}else{if(this.unit==th.formlayout.ConstantSize.CENTIMETER){return th.formlayout.Sizes.centimeterAsPixel(this.value,a)}else{if(this.unit==th.formlayout.ConstantSize.DIALOG_UNITS_X){return th.formlayout.Sizes.dialogUnitXAsPixel(this.intValue(),a)}else{if(this.unit==th.formlayout.ConstantSize.DIALOG_UNITS_Y){return th.formlayout.Sizes.dialogUnitYAsPixel(this.intValue(),a)}else{throw"Invalid unit "+this.unit}}}}}}}}},maximumSize:function(d,h,a,i,f){return this.getPixelSize(d)},compressible:function(){return false},equals:function(d){if(this==d){return true}if(!(d instanceof th.formlayout.ConstantSize)){return false}var a=d;return this.value==a.value&&this.unit==a.unit},hashCode:function(){return this.value+37*this.unit.hashCode()},toString:function(){return this.value+unit.abbreviation()},encode:function(){return this.value+unit.encode()},intValue:function(){return Math.round(this.value)}}});th.formlayout.ConstantSize.valueOf=function(l,a){var h=th.formlayout.ConstantSize.splitValueAndUnit(l);var f=h[0];var d=h[1];var i=th.formlayout.Unit.valueOf(d,a);var j=parseFloat(f);if(i.requiresIntegers){if(j!=parseInt(j)){throw i.toString()+" value "+f+" must be an integer."}}return new th.formlayout.ConstantSize(j,i)};th.formlayout.ConstantSize.dluX=function(a){return new th.formlayout.ConstantSize(a,th.formlayout.ConstantSize.DLUX)};th.formlayout.ConstantSize.dluY=function(a){return new th.formlayout.ConstantSize(a,th.formlayout.ConstantSize.DLUY)};th.formlayout.ConstantSize.splitValueAndUnit=function(h){var d=[];var a=h.length;var f=a;while(f>0&&(!/[^a-zA-Z]/.test(h.charAt(f-1)))){f--}d[0]=h.substring(0,f);d[1]=h.substring(f);return d};th.formlayout.ConstantSize.PIXEL=new th.formlayout.Unit("Pixel","px",undefined,true);th.formlayout.ConstantSize.EM=new th.formlayout.Unit("Em","em",undefined,false);th.formlayout.ConstantSize.POINT=new th.formlayout.Unit("Point","pt",undefined,false);th.formlayout.ConstantSize.DIALOG_UNITS_X=new th.formlayout.Unit("Dialog units X","dluX","dlu",true);th.formlayout.ConstantSize.DIALOG_UNITS_Y=new th.formlayout.Unit("Dialog units Y","dluY","dlu",true);th.formlayout.ConstantSize.MILLIMETER=new th.formlayout.Unit("Millimeter","mm",undefined,false);th.formlayout.ConstantSize.CENTIMETER=new th.formlayout.Unit("Centimeter","cm",undefined,false);th.formlayout.ConstantSize.INCH=new th.formlayout.Unit("Inch","in",undefined,false);th.formlayout.ConstantSize.PX=th.formlayout.ConstantSize.PIXEL;th.formlayout.ConstantSize.PT=th.formlayout.ConstantSize.POINT;th.formlayout.ConstantSize.DLUX=th.formlayout.ConstantSize.DIALOG_UNITS_X;th.formlayout.ConstantSize.DLUY=th.formlayout.ConstantSize.DIALOG_UNITS_Y;th.formlayout.ConstantSize.MM=th.formlayout.ConstantSize.MILLIMETER;th.formlayout.ConstantSize.CM=th.formlayout.ConstantSize.CENTIMETER;th.formlayout.ConstantSize.IN=th.formlayout.ConstantSize.INCH;th.formlayout.PrototypeSize=Class.define({members:{init:function(a){this.proto=a},getPrototype:function(){return this.proto},maximumSize:function(d,h,a,i,f){throw"PrototypeSize.maximumSize() not yet implemented"},compressible:function(){return false},encode:function(){return"'"+this.proto+"'"},equals:function(a){if(this==a){return true}if(!(a instanceof th.formlayout.PrototypeSize)){return false}return this.proto==a.proto},toString:function(){return this.encode()}}});th.formlayout.ComponentSize=Class.define({members:{init:function(a){this.name=a},maximumSize:function(d,n,f,m,l){var a=this==th.formlayout.Sizes.MINIMUM?f:(this==th.formlayout.Sizes.PREFERRED?m:l);var h=0;for(var j=0;j<n.length;j++){var o=n[j];h=Math.max(h,a(o))}return h},compressible:function(){return this==th.formlayout.Sizes.DEFAULT},toString:function(){return this.encode()},encode:function(){return name.substring(0,1)}}});th.formlayout.ComponentSize.valueOf=function(a){if(a=="m"||a=="min"){return th.formlayout.Sizes.MINIMUM}if(a=="p"||a=="pref"){return th.formlayout.Sizes.PREFERRED}if(a=="d"||a=="default"){return th.formlayout.Sizes.DEFAULT}return};th.formlayout.DefaultUnitConverter=Class.define({members:{inchAsPixel:function(d,a){return th.convertAbsoluteUnitToPixels("in",d)},millimeterAsPixel:function(d,a){return th.convertAbsoluteUnitToPixels("mm",d)},centimeterAsPixel:function(a,d){return th.convertAbsoluteUnitToPixels("cm",a)},pointAsPixel:function(d,a){return th.convertAbsoluteUnitToPixels("pt",d)},emAsPixel:function(d,a){return th.convertEmToPixels(a.cssValue("font"),d)},dialogUnitXAsPixel:function(d,a){throw"Unsupported"},dialogUnitYAsPixel:function(d,a){throw"Unsupported"}}});th.formlayout.Sizes={};th.formlayout.Sizes.unitConverter=new th.formlayout.DefaultUnitConverter();th.formlayout.Sizes.pixel=function(a){return new th.formlayout.ConstantSize(a,th.formlayout.ConstantSize.PIXEL)};th.formlayout.Sizes.ZERO=th.formlayout.Sizes.pixel(0);th.formlayout.Sizes.DLUX1=th.formlayout.ConstantSize.dluX(1);th.formlayout.Sizes.DLUX2=th.formlayout.ConstantSize.dluX(2);th.formlayout.Sizes.DLUX3=th.formlayout.ConstantSize.dluX(3);th.formlayout.Sizes.DLUX4=th.formlayout.ConstantSize.dluX(4);th.formlayout.Sizes.DLUX5=th.formlayout.ConstantSize.dluX(5);th.formlayout.Sizes.DLUX6=th.formlayout.ConstantSize.dluX(6);th.formlayout.Sizes.DLUX7=th.formlayout.ConstantSize.dluX(7);th.formlayout.Sizes.DLUX8=th.formlayout.ConstantSize.dluX(8);th.formlayout.Sizes.DLUX9=th.formlayout.ConstantSize.dluX(9);th.formlayout.Sizes.DLUX11=th.formlayout.ConstantSize.dluX(11);th.formlayout.Sizes.DLUX14=th.formlayout.ConstantSize.dluX(14);th.formlayout.Sizes.DLUX21=th.formlayout.ConstantSize.dluX(21);th.formlayout.Sizes.DLUY1=th.formlayout.ConstantSize.dluY(1);th.formlayout.Sizes.DLUY2=th.formlayout.ConstantSize.dluY(2);th.formlayout.Sizes.DLUY3=th.formlayout.ConstantSize.dluY(3);th.formlayout.Sizes.DLUY4=th.formlayout.ConstantSize.dluY(4);th.formlayout.Sizes.DLUY5=th.formlayout.ConstantSize.dluY(5);th.formlayout.Sizes.DLUY6=th.formlayout.ConstantSize.dluY(6);th.formlayout.Sizes.DLUY7=th.formlayout.ConstantSize.dluY(7);th.formlayout.Sizes.DLUY8=th.formlayout.ConstantSize.dluY(8);th.formlayout.Sizes.DLUY9=th.formlayout.ConstantSize.dluY(9);th.formlayout.Sizes.DLUY11=th.formlayout.ConstantSize.dluY(11);th.formlayout.Sizes.DLUY14=th.formlayout.ConstantSize.dluY(14);th.formlayout.Sizes.DLUY21=th.formlayout.ConstantSize.dluY(21);th.formlayout.Sizes.MINIMUM=new th.formlayout.ComponentSize("minimum");th.formlayout.Sizes.PREFERRED=new th.formlayout.ComponentSize("preferred");th.formlayout.Sizes.DEFAULT=new th.formlayout.ComponentSize("default");th.formlayout.Sizes.defaultUnit=th.formlayout.ConstantSize.PIXEL;th.formlayout.Sizes.constant=function(h,a){var d=h.toLowerCase();var f=th.trim(d);return th.formlayout.ConstantSize.valueOf(f,a)};th.formlayout.Sizes.bounded=function(d,f,a){return th.formlayout.BoundedSize(d,f,a)};th.formlayout.Sizes.emAsPixel=function(d,a){return d==0?0:th.formlayout.Sizes.unitConverter.emAsPixel(d,a)};th.formlayout.Sizes.inchAsPixel=function(d,a){return d==0?0:th.formlayout.Sizes.unitConverter.inchAsPixel(d,a)};th.formlayout.Sizes.millimeterAsPixel=function(d,a){return d==0?0:th.formlayout.Sizes.unitConverter.millimeterAsPixel(d,a)};th.formlayout.Sizes.centimeterAsPixel=function(a,d){return a==0?0:th.formlayout.Sizes.unitConverter.centimeterAsPixel(a,d)};th.formlayout.Sizes.pointAsPixel=function(d,a){return d==0?0:th.formlayout.Sizes.unitConverter.pointAsPixel(d,a)};th.formlayout.Sizes.dialogUnitXAsPixel=function(d,a){return d==0?0:th.formlayout.Sizes.unitConverter.dialogUnitXAsPixel(d,a)};th.formlayout.Sizes.dialogUnitYAsPixel=function(d,a){return d==0?0:th.formlayout.Sizes.unitConverter.dialogUnitYAsPixel(d,a)};th.formlayout.Sizes.getDefaultUnit=function(){return th.formlayout.Sizes.defaultUnit};th.formlayout.Alignment=Class.define({members:{init:function(d,a){this.name=d;this.orientation=a},toString:function(){return this.name},abbreviation:function(){return this.name.charAt(0)},isHorizontal:function(){return this.orientation!=th.formlayout.Alignment.VERTICAL},isVertical:function(){return this.orientation!=th.formlayout.Alignment.HORIZONTAL}}});th.formlayout.Alignment.HORIZONTAL=0;th.formlayout.Alignment.VERTICAL=1;th.formlayout.Alignment.BOTH=2;th.formlayout.Alignment.valueOf=function(a){var d=a.toLowerCase();if(d=="d"||d=="default"){return th.formlayout.CellConstraints.DEFAULT}else{if(d=="f"||d=="fill"){return th.formlayout.CellConstraints.FILL}else{if(d=="c"||d=="center"){return th.formlayout.CellConstraints.CENTER}else{if(d=="l"||d=="left"){return th.formlayout.CellConstraints.LEFT}else{if(d=="r"||d=="right"){return th.formlayout.CellConstraints.RIGHT}else{if(d=="t"||d=="top"){return th.formlayout.CellConstraints.TOP}else{if(d=="b"||d=="bottom"){return th.formlayout.CellConstraints.BOTTOM}else{throw"Invalid alignment "+a+". Must be one of: left, center, right, top, bottom, fill, default, l, c, r, t, b, f, d."}}}}}}}};th.formlayout.CellConstraints=Class.define({members:{init:function(d,m,j,i,h,l,f){var a=undefined;if(th.isString(d)){a=d;delete d}this.gridX=(d==undefined)?1:d;this.gridY=(m==undefined)?1:m;this.gridWidth=(j==undefined)?1:j;this.gridHeight=(i==undefined)?1:i;this.hAlign=h||th.formlayout.CellConstraints.DEFAULT;this.vAlign=l||th.formlayout.CellConstraints.DEFAULT;this.insets=f||th.formlayout.CellConstraints.EMPTY_INSETS;if(this.gridX<=0){throw new th.formlayout.IndexOutOfBoundsException("The grid x must be a positive number.")}if(this.gridY<=0){throw new th.formlayout.IndexOutOfBoundsException("The grid y must be a positive number.")}if(this.gridWidth<=0){throw new th.formlayout.IndexOutOfBoundsException("The grid width must be a positive number.")}if(this.gridHeight<=0){throw new th.formlayout.IndexOutOfBoundsException("The grid height must be a positive number.")}this.ensureValidOrientations(this.hAlign,this.vAlign);if(a){this.initFromConstraints(a)}},ensureValidOrientations:function(a,d){if(!a.isHorizontal()){throw new th.formlayout.IllegalArgumentException("The horizontal alignment must be one of: left, center, right, fill, default.")}if(!d.isVertical()){throw new th.formlayout.IllegalArgumentException("The vertical alignment must be one of: top, center, botto, fill, default.")}},initFromConstraints:function(a){var h=a.split(",");var j=h.length;if(!(j==2||j==4||j==6)){throw new th.formlayout.IllegalArgumentException("You must provide 2, 4 or 6 arguments.")}var d=0;var i=parseInt(th.trim(h[d++]));if(!i){throw new th.formlayout.IllegalArgumentException("First cell constraint element must be a number.")}this.gridX=i;if(this.gridX<=0){throw new th.formlayout.IndexOutOfBoundsException("The grid x must be a positive number.")}i=parseInt(th.trim(h[d++]));if(!i){throw new th.formlayout.IllegalArgumentException("Second cell constraint element must be a number.")}this.gridY=i;if(this.gridY<=0){throw new th.formlayout.IndexOutOfBoundsException("The grid y must be a positive number.")}if(d>=h.length){return}var f=th.trim(h[d++]);i=parseInt(f);if(i){this.gridWidth=i;if(this.gridWidth<=0){throw new th.formlayout.IndexOutOfBoundsException("The grid width must be a positive number.")}i=parseInt(th.trim(h[d++]));if(i==null){throw new th.formlayout.IllegalArgumentException("Fourth cell constraint element must be like third.")}this.gridHeight=i;if(this.gridHeight<=0){throw new th.formlayout.IndexOutOfBoundsException("The grid height must be a positive number.")}if(d>=h.length){return}f=th.trim(h[d++])}this.hAlign=this.decodeAlignment(f);this.vAlign=this.decodeAlignment(th.trim(h[d++]));this.ensureValidOrientations(this.hAlign,this.vAlign)},ensureValidGridBounds:function(d,a){if(this.gridX<=0){throw new th.formlayout.IndexOutOfBoundsException("The column index "+this.gridX+" must be positive.")}if(this.gridX>d){throw new th.formlayout.IndexOutOfBoundsException("The column index "+this.gridX+" must be less than or equal to "+d+".")}if(this.gridX+this.gridWidth-1>d){throw new th.formlayout.IndexOutOfBoundsException("The grid width "+this.gridWidth+" must be less than or equal to "+(d-this.gridX+1)+".")}if(this.gridY<=0){throw new th.formlayout.IndexOutOfBoundsException("The row index "+this.gridY+" must be positive.")}if(this.gridY>a){throw new th.formlayout.IndexOutOfBoundsException("The row index "+this.gridY+" must be less than or equal to "+a+".")}if(this.gridY+this.gridHeight-1>a){throw new th.formlayout.IndexOutOfBoundsException("The grid height "+this.gridHeight+" must be less than or equal to "+(a-this.gridY+1)+".")}},decodeAlignment:function(a){return th.formlayout.Alignment.valueOf(a)},setBounds:function(E,D,z,f,j,C,i){var F=this.gridWidth==1?D.getColumnSpec(this.gridX):undefined;var A=this.gridHeight==1?D.getRowSpec(this.gridY):undefined;var q=this.concreteAlignment(this.hAlign,F);var n=this.concreteAlignment(this.vAlign,A);var s=this.insets?this.insets:th.formlayout.CellConstraints.EMPTY_INSETS;var u=z.x+s.left;var t=z.y+s.top;var B=z.width-s.left-s.right;var a=z.height-s.top-s.bottom;var d=this.componentSize(E,F,B,f,C);var p=this.componentSize(E,A,a,j,i);var m=this.origin(q,u,B,d);var l=this.origin(n,t,a,p);var o=this.extent(q,B,d);var v=this.extent(n,a,p);E.setBounds(m,l,o,v)},concreteAlignment:function(a,d){return !d?(a==th.formlayout.CellConstraints.DEFAULT?th.formlayout.CellConstraints.FILL:a):this.usedAlignment(a,d)},usedAlignment:function(a,d){if(a!=th.formlayout.CellConstraints.DEFAULT){return a}var f=d.getDefaultAlignment();if(f==th.formlayout.FormSpec.FILL_ALIGN){return th.formlayout.CellConstraints.FILL}if(f==th.formlayout.ColumnSpec.LEFT){return th.formlayout.CellConstraints.LEFT}else{if(f==th.formlayout.FormSpec.CENTER_ALIGN){return th.formlayout.CellConstraints.CENTER}else{if(f==th.formlayout.ColumnSpec.RIGHT){return th.formlayout.CellConstraints.RIGHT}else{if(f==th.formlayout.RowSpec.TOP){return th.formlayout.CellConstraints.TOP}else{return th.formlayout.CellConstraints.BOTTOM}}}}},componentSize:function(f,d,i,a,h){if(!d){return h(f)}else{if(d.getSize()==th.formlayout.Sizes.MINIMUM){return a(f)}else{if(d.getSize()==th.formlayout.Sizes.PREFERRED){return h(f)}else{return Math.min(i,h(f))}}}},origin:function(h,d,f,a){if(h==th.formlayout.CellConstraints.RIGHT||h==th.formlayout.CellConstraints.BOTTOM){return d+f-a}else{if(h==th.formlayout.CellConstraints.CENTER){return d+(f-a)/2}else{return d}}},extent:function(f,d,a){return f==th.formlayout.CellConstraints.FILL?d:a},toString:function(){var a="CellConstraints";a+="[x=";a+=this.gridX;a+="; y=";a+=this.gridY;a+="; w=";a+=this.gridWidth;a+="; h=";a+=this.gridHeight;a+="; hAlign=";a+=this.hAlign;a+="; vAlign=";a+=this.vAlign;a+="; honorsVisibility=";a+=this.honorsVisibility;a+="]";return a},xy:function(){var a=arguments;switch(arguments.length){case 2:return this.xywh(a[0],a[1],1,1);case 3:return this.xywh(a[0],a[1],1,1,a[2]);case 4:return this.xywh(a[0],a[1],1,1,a[2],a[3]);default:throw"wrong number of arguments passed to xy()"}},xyw:function(){var a=arguments;switch(arguments.length){case 3:return this.xywh(a[0],a[1],a[2],1,th.formlayout.CellConstraints.DEFAULT,th.formlayout.CellConstraints.DEFAULT);case 4:return this.xywh(a[0],a[1],a[2],1,a[3]);case 5:return this.xywh(a[0],a[1],a[2],1,a[3],a[4]);default:throw"wrong number of arguments passed to xyw()"}},xywh:function(){var d=arguments;switch(arguments.length){case 4:return this.xywh(d[0],d[1],d[2],d[3],th.formlayout.CellConstraints.DEFAULT,th.formlayout.CellConstraints.DEFAULT);case 5:var a=this.xywh(d[0],d[1],d[2],d[3]);a.setAlignment(d[4],true);return a;case 6:this.gridX=d[0];this.gridY=d[1];this.gridWidth=d[2];this.gridHeight=d[3];this.hAlign=d[4];this.vAlign=d[5];this.ensureValidOrientations(this.hAlign,this.vAlign);return this;default:throw"wrong number of arguments passed to xywh()"}}}});th.formlayout.CellConstraints.DEFAULT=new th.formlayout.Alignment("default",th.formlayout.Alignment.BOTH);th.formlayout.CellConstraints.FILL=new th.formlayout.Alignment("fill",th.formlayout.Alignment.BOTH);th.formlayout.CellConstraints.LEFT=new th.formlayout.Alignment("left",th.formlayout.Alignment.HORIZONTAL);th.formlayout.CellConstraints.RIGHT=new th.formlayout.Alignment("right",th.formlayout.Alignment.HORIZONTAL);th.formlayout.CellConstraints.CENTER=new th.formlayout.Alignment("center",th.formlayout.Alignment.BOTH);th.formlayout.CellConstraints.TOP=new th.formlayout.Alignment("top",th.formlayout.Alignment.VERTICAL);th.formlayout.CellConstraints.BOTTOM=new th.formlayout.Alignment("bottom",th.formlayout.Alignment.VERTICAL);th.formlayout.CellConstraints.EMPTY_INSETS={top:0,left:0,bottom:0,right:0};th.formlayout.FormSpecParser=Class.define({members:{init:function(f,d,h,a){this.layoutMap=h;this.source=f},parseColumnSpecs:function(){var d=this.split(this.source,0);var h=d.length;var a=[];for(var f=0;f<h;f++){var j=d[f];a[f]=th.formlayout.ColumnSpec.decodeExpanded(j)}return a},parseRowSpecs:function(){var h=this.split(this.source,0);var a=h.length;var f=[];for(var d=0;d<a;d++){var j=h[d];f[d]=th.formlayout.RowSpec.decodeExpanded(j)}return f},split:function(l,h){var q=[];var d=0;var m=0;var a=l.length;var p=0;var o;var n=true;for(var j=0;j<a;j++){o=l.charAt(j);if(n&&th.isWhitespace(o)){p++;continue}n=false;if((o==",")&&(d==0)&&(m==0)){var f=l.substring(p,j);this.addSpec(q,f,h+p);p=j+1;n=true}else{if(o=="("){if(m>0){this.fail(h+j,"illegal '(' in [...]")}d++}else{if(o==")"){if(m>0){this.fail(h+j,"illegal ')' in [...]")}d--;if(d<0){this.fail(h+j,"missing '('")}}else{if(o=="["){if(m>0){this.fail(h+j,"too many '['")}m++}else{if(o=="]"){m--;if(m<0){this.fail(h+j,"missing '['")}}}}}}}if(d>0){this.fail(h+a,"missing ')'")}if(m>0){this.fail(h+a,"missing ']")}if(p<a){var f=l.substring(p);this.addSpec(q,f,h+p)}return q},addSpec:function(f,l,j){var d=th.trim(l);var m=this.multiplier(d,j);if(!m){f.push(d);return}var h=this.split(m.expression,j+m.offset);for(var a=0;a<m.multiplier;a++){th.forEach(h,function(i){f.push(i)})}},multiplier:function(l,i){var j=new RegExp(th.formlayout.FormSpecParser.MULTIPLIER_PREFIX_PATTERN);if(!j.test(l)){return}var d=j.exec(l);d.end=d.index+d[0].length;if(d.index>0){this.fail(i+d.index,"illegal multiplier position")}var a=new RegExp(th.formlayout.DIGIT_PATTERN);if(!a.test(l)){return}var n=a.exec(l);n.end=d.index+d[0].length;var m=l.substring(0,n.end);var f=parseInt(m);if(isNaN(f)){this.fail(i,"Invalid multiplier")}if(f<=0){this.fail(i,"illegal 0 multiplier")}var h=l.substring(d.end,l.length()-1);return{multiplier:f,expression:h,offset:d.end}},fail:function(a,d,f){if(!f){f=this.source}throw new th.formlayout.FormLayoutParseException(this.message(f,a,d))},message:function(j,d,h){var a="\n";a+="\n";a+=j;a+="\n";for(var f=0;f<d;f++){a+=" "}a+="^";a+=h;return a}}});th.formlayout.FormSpecParser.parseColumnSpecs=function(a,d){var f=new th.formlayout.FormSpecParser(a,"encoded column specifications",d,true);return f.parseColumnSpecs()};th.formlayout.FormSpecParser.parseRowSpecs=function(a,d){var f=new th.formlayout.FormSpecParser(a,"encoded column specifications",d,false);return f.parseRowSpecs()};th.formlayout.FormSpecParser.MULTIPLIER_PREFIX_PATTERN="\\d+\\s*\\*\\s*\\(";th.formlayout.FormSpecParser.DIGIT_PATTERN="\\d+";